function uz(e,n){for(var l=0;l<n.length;l++){const h=n[l];if(typeof h!="string"&&!Array.isArray(h)){for(const m in h)if(m!=="default"&&!(m in e)){const y=Object.getOwnPropertyDescriptor(h,m);y&&Object.defineProperty(e,m,y.get?y:{enumerable:!0,get:()=>h[m]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))h(m);new MutationObserver(m=>{for(const y of m)if(y.type==="childList")for(const b of y.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&h(b)}).observe(document,{childList:!0,subtree:!0});function l(m){const y={};return m.integrity&&(y.integrity=m.integrity),m.referrerPolicy&&(y.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?y.credentials="include":m.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function h(m){if(m.ep)return;m.ep=!0;const y=l(m);fetch(m.href,y)}})();var hz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function dz(e){if(e.__esModule)return e;var n=e.default;if(typeof n=="function"){var l=function h(){if(this instanceof h){var m=[null];m.push.apply(m,arguments);var y=Function.bind.apply(n,m);return new y}return n.apply(this,arguments)};l.prototype=n.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(e).forEach(function(h){var m=Object.getOwnPropertyDescriptor(e,h);Object.defineProperty(l,h,m.get?m:{enumerable:!0,get:function(){return e[h]}})}),l}var VS={exports:{}},F_={},$S={exports:{}},mn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var If=Symbol.for("react.element"),pz=Symbol.for("react.portal"),fz=Symbol.for("react.fragment"),mz=Symbol.for("react.strict_mode"),gz=Symbol.for("react.profiler"),_z=Symbol.for("react.provider"),yz=Symbol.for("react.context"),vz=Symbol.for("react.forward_ref"),xz=Symbol.for("react.suspense"),wz=Symbol.for("react.memo"),bz=Symbol.for("react.lazy"),gE=Symbol.iterator;function Ez(e){return e===null||typeof e!="object"?null:(e=gE&&e[gE]||e["@@iterator"],typeof e=="function"?e:null)}var GS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qS=Object.assign,WS={};function zh(e,n,l){this.props=e,this.context=n,this.refs=WS,this.updater=l||GS}zh.prototype.isReactComponent={};zh.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};zh.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ZS(){}ZS.prototype=zh.prototype;function f1(e,n,l){this.props=e,this.context=n,this.refs=WS,this.updater=l||GS}var m1=f1.prototype=new ZS;m1.constructor=f1;qS(m1,zh.prototype);m1.isPureReactComponent=!0;var _E=Array.isArray,HS=Object.prototype.hasOwnProperty,g1={current:null},XS={key:!0,ref:!0,__self:!0,__source:!0};function KS(e,n,l){var h,m={},y=null,b=null;if(n!=null)for(h in n.ref!==void 0&&(b=n.ref),n.key!==void 0&&(y=""+n.key),n)HS.call(n,h)&&!XS.hasOwnProperty(h)&&(m[h]=n[h]);var s=arguments.length-2;if(s===1)m.children=l;else if(1<s){for(var A=Array(s),R=0;R<s;R++)A[R]=arguments[R+2];m.children=A}if(e&&e.defaultProps)for(h in s=e.defaultProps,s)m[h]===void 0&&(m[h]=s[h]);return{$$typeof:If,type:e,key:y,ref:b,props:m,_owner:g1.current}}function Tz(e,n){return{$$typeof:If,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function _1(e){return typeof e=="object"&&e!==null&&e.$$typeof===If}function Sz(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(l){return n[l]})}var yE=/\/+/g;function cv(e,n){return typeof e=="object"&&e!==null&&e.key!=null?Sz(""+e.key):n.toString(36)}function Og(e,n,l,h,m){var y=typeof e;(y==="undefined"||y==="boolean")&&(e=null);var b=!1;if(e===null)b=!0;else switch(y){case"string":case"number":b=!0;break;case"object":switch(e.$$typeof){case If:case pz:b=!0}}if(b)return b=e,m=m(b),e=h===""?"."+cv(b,0):h,_E(m)?(l="",e!=null&&(l=e.replace(yE,"$&/")+"/"),Og(m,n,l,"",function(R){return R})):m!=null&&(_1(m)&&(m=Tz(m,l+(!m.key||b&&b.key===m.key?"":(""+m.key).replace(yE,"$&/")+"/")+e)),n.push(m)),1;if(b=0,h=h===""?".":h+":",_E(e))for(var s=0;s<e.length;s++){y=e[s];var A=h+cv(y,s);b+=Og(y,n,l,A,m)}else if(A=Ez(e),typeof A=="function")for(e=A.call(e),s=0;!(y=e.next()).done;)y=y.value,A=h+cv(y,s++),b+=Og(y,n,l,A,m);else if(y==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return b}function dg(e,n,l){if(e==null)return e;var h=[],m=0;return Og(e,h,"","",function(y){return n.call(l,y,m++)}),h}function Cz(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(l){(e._status===0||e._status===-1)&&(e._status=1,e._result=l)},function(l){(e._status===0||e._status===-1)&&(e._status=2,e._result=l)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var Ni={current:null},Bg={transition:null},Az={ReactCurrentDispatcher:Ni,ReactCurrentBatchConfig:Bg,ReactCurrentOwner:g1};mn.Children={map:dg,forEach:function(e,n,l){dg(e,function(){n.apply(this,arguments)},l)},count:function(e){var n=0;return dg(e,function(){n++}),n},toArray:function(e){return dg(e,function(n){return n})||[]},only:function(e){if(!_1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};mn.Component=zh;mn.Fragment=fz;mn.Profiler=gz;mn.PureComponent=f1;mn.StrictMode=mz;mn.Suspense=xz;mn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Az;mn.cloneElement=function(e,n,l){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var h=qS({},e.props),m=e.key,y=e.ref,b=e._owner;if(n!=null){if(n.ref!==void 0&&(y=n.ref,b=g1.current),n.key!==void 0&&(m=""+n.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(A in n)HS.call(n,A)&&!XS.hasOwnProperty(A)&&(h[A]=n[A]===void 0&&s!==void 0?s[A]:n[A])}var A=arguments.length-2;if(A===1)h.children=l;else if(1<A){s=Array(A);for(var R=0;R<A;R++)s[R]=arguments[R+2];h.children=s}return{$$typeof:If,type:e.type,key:m,ref:y,props:h,_owner:b}};mn.createContext=function(e){return e={$$typeof:yz,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:_z,_context:e},e.Consumer=e};mn.createElement=KS;mn.createFactory=function(e){var n=KS.bind(null,e);return n.type=e,n};mn.createRef=function(){return{current:null}};mn.forwardRef=function(e){return{$$typeof:vz,render:e}};mn.isValidElement=_1;mn.lazy=function(e){return{$$typeof:bz,_payload:{_status:-1,_result:e},_init:Cz}};mn.memo=function(e,n){return{$$typeof:wz,type:e,compare:n===void 0?null:n}};mn.startTransition=function(e){var n=Bg.transition;Bg.transition={};try{e()}finally{Bg.transition=n}};mn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};mn.useCallback=function(e,n){return Ni.current.useCallback(e,n)};mn.useContext=function(e){return Ni.current.useContext(e)};mn.useDebugValue=function(){};mn.useDeferredValue=function(e){return Ni.current.useDeferredValue(e)};mn.useEffect=function(e,n){return Ni.current.useEffect(e,n)};mn.useId=function(){return Ni.current.useId()};mn.useImperativeHandle=function(e,n,l){return Ni.current.useImperativeHandle(e,n,l)};mn.useInsertionEffect=function(e,n){return Ni.current.useInsertionEffect(e,n)};mn.useLayoutEffect=function(e,n){return Ni.current.useLayoutEffect(e,n)};mn.useMemo=function(e,n){return Ni.current.useMemo(e,n)};mn.useReducer=function(e,n,l){return Ni.current.useReducer(e,n,l)};mn.useRef=function(e){return Ni.current.useRef(e)};mn.useState=function(e){return Ni.current.useState(e)};mn.useSyncExternalStore=function(e,n,l){return Ni.current.useSyncExternalStore(e,n,l)};mn.useTransition=function(){return Ni.current.useTransition()};mn.version="18.2.0";$S.exports=mn;var Te=$S.exports;const zr=Fc(Te),i_=uz({__proto__:null,default:zr},[Te]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mz=Te,Iz=Symbol.for("react.element"),kz=Symbol.for("react.fragment"),Pz=Object.prototype.hasOwnProperty,zz=Mz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rz={key:!0,ref:!0,__self:!0,__source:!0};function YS(e,n,l){var h,m={},y=null,b=null;l!==void 0&&(y=""+l),n.key!==void 0&&(y=""+n.key),n.ref!==void 0&&(b=n.ref);for(h in n)Pz.call(n,h)&&!Rz.hasOwnProperty(h)&&(m[h]=n[h]);if(e&&e.defaultProps)for(h in n=e.defaultProps,n)m[h]===void 0&&(m[h]=n[h]);return{$$typeof:Iz,type:e,key:y,ref:b,props:m,_owner:zz.current}}F_.Fragment=kz;F_.jsx=YS;F_.jsxs=YS;VS.exports=F_;var Q=VS.exports,Jv={},JS={exports:{}},_o={},QS={exports:{}},eC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(qe,St){var bt=qe.length;qe.push(St);e:for(;0<bt;){var Kt=bt-1>>>1,xn=qe[Kt];if(0<m(xn,St))qe[Kt]=St,qe[bt]=xn,bt=Kt;else break e}}function l(qe){return qe.length===0?null:qe[0]}function h(qe){if(qe.length===0)return null;var St=qe[0],bt=qe.pop();if(bt!==St){qe[0]=bt;e:for(var Kt=0,xn=qe.length,En=xn>>>1;Kt<En;){var Qt=2*(Kt+1)-1,cr=qe[Qt],Qn=Qt+1,Rr=qe[Qn];if(0>m(cr,bt))Qn<xn&&0>m(Rr,cr)?(qe[Kt]=Rr,qe[Qn]=bt,Kt=Qn):(qe[Kt]=cr,qe[Qt]=bt,Kt=Qt);else if(Qn<xn&&0>m(Rr,bt))qe[Kt]=Rr,qe[Qn]=bt,Kt=Qn;else break e}}return St}function m(qe,St){var bt=qe.sortIndex-St.sortIndex;return bt!==0?bt:qe.id-St.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;e.unstable_now=function(){return y.now()}}else{var b=Date,s=b.now();e.unstable_now=function(){return b.now()-s}}var A=[],R=[],U=1,V=null,$=3,pe=!1,Y=!1,K=!1,Ce=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(qe){for(var St=l(R);St!==null;){if(St.callback===null)h(R);else if(St.startTime<=qe)h(R),St.sortIndex=St.expirationTime,n(A,St);else break;St=l(R)}}function se(qe){if(K=!1,ce(qe),!Y)if(l(A)!==null)Y=!0,rn(De);else{var St=l(R);St!==null&&vn(se,St.startTime-qe)}}function De(qe,St){Y=!1,K&&(K=!1,ee(ut),ut=-1),pe=!0;var bt=$;try{for(ce(St),V=l(A);V!==null&&(!(V.expirationTime>St)||qe&&!Rt());){var Kt=V.callback;if(typeof Kt=="function"){V.callback=null,$=V.priorityLevel;var xn=Kt(V.expirationTime<=St);St=e.unstable_now(),typeof xn=="function"?V.callback=xn:V===l(A)&&h(A),ce(St)}else h(A);V=l(A)}if(V!==null)var En=!0;else{var Qt=l(R);Qt!==null&&vn(se,Qt.startTime-St),En=!1}return En}finally{V=null,$=bt,pe=!1}}var He=!1,Be=null,ut=-1,Ie=5,Je=-1;function Rt(){return!(e.unstable_now()-Je<Ie)}function ht(){if(Be!==null){var qe=e.unstable_now();Je=qe;var St=!0;try{St=Be(!0,qe)}finally{St?Ht():(He=!1,Be=null)}}else He=!1}var Ht;if(typeof ne=="function")Ht=function(){ne(ht)};else if(typeof MessageChannel<"u"){var Rn=new MessageChannel,Bt=Rn.port2;Rn.port1.onmessage=ht,Ht=function(){Bt.postMessage(null)}}else Ht=function(){Ce(ht,0)};function rn(qe){Be=qe,He||(He=!0,Ht())}function vn(qe,St){ut=Ce(function(){qe(e.unstable_now())},St)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(qe){qe.callback=null},e.unstable_continueExecution=function(){Y||pe||(Y=!0,rn(De))},e.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ie=0<qe?Math.floor(1e3/qe):5},e.unstable_getCurrentPriorityLevel=function(){return $},e.unstable_getFirstCallbackNode=function(){return l(A)},e.unstable_next=function(qe){switch($){case 1:case 2:case 3:var St=3;break;default:St=$}var bt=$;$=St;try{return qe()}finally{$=bt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(qe,St){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var bt=$;$=qe;try{return St()}finally{$=bt}},e.unstable_scheduleCallback=function(qe,St,bt){var Kt=e.unstable_now();switch(typeof bt=="object"&&bt!==null?(bt=bt.delay,bt=typeof bt=="number"&&0<bt?Kt+bt:Kt):bt=Kt,qe){case 1:var xn=-1;break;case 2:xn=250;break;case 5:xn=1073741823;break;case 4:xn=1e4;break;default:xn=5e3}return xn=bt+xn,qe={id:U++,callback:St,priorityLevel:qe,startTime:bt,expirationTime:xn,sortIndex:-1},bt>Kt?(qe.sortIndex=bt,n(R,qe),l(A)===null&&qe===l(R)&&(K?(ee(ut),ut=-1):K=!0,vn(se,bt-Kt))):(qe.sortIndex=xn,n(A,qe),Y||pe||(Y=!0,rn(De))),qe},e.unstable_shouldYield=Rt,e.unstable_wrapCallback=function(qe){var St=$;return function(){var bt=$;$=St;try{return qe.apply(this,arguments)}finally{$=bt}}}})(eC);QS.exports=eC;var Dz=QS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tC=Te,go=Dz;function dt(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,l=1;l<arguments.length;l++)n+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nC=new Set,of={};function Nc(e,n){vh(e,n),vh(e+"Capture",n)}function vh(e,n){for(of[e]=n,e=0;e<n.length;e++)nC.add(n[e])}var va=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qv=Object.prototype.hasOwnProperty,Lz=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vE={},xE={};function Oz(e){return Qv.call(xE,e)?!0:Qv.call(vE,e)?!1:Lz.test(e)?xE[e]=!0:(vE[e]=!0,!1)}function Bz(e,n,l,h){if(l!==null&&l.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return h?!1:l!==null?!l.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Fz(e,n,l,h){if(n===null||typeof n>"u"||Bz(e,n,l,h))return!0;if(h)return!1;if(l!==null)switch(l.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function ji(e,n,l,h,m,y,b){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=h,this.attributeNamespace=m,this.mustUseProperty=l,this.propertyName=e,this.type=n,this.sanitizeURL=y,this.removeEmptyString=b}var di={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){di[e]=new ji(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];di[n]=new ji(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){di[e]=new ji(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){di[e]=new ji(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){di[e]=new ji(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){di[e]=new ji(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){di[e]=new ji(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){di[e]=new ji(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){di[e]=new ji(e,5,!1,e.toLowerCase(),null,!1,!1)});var y1=/[\-:]([a-z])/g;function v1(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(y1,v1);di[n]=new ji(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(y1,v1);di[n]=new ji(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(y1,v1);di[n]=new ji(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){di[e]=new ji(e,1,!1,e.toLowerCase(),null,!1,!1)});di.xlinkHref=new ji("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){di[e]=new ji(e,1,!1,e.toLowerCase(),null,!0,!0)});function x1(e,n,l,h){var m=di.hasOwnProperty(n)?di[n]:null;(m!==null?m.type!==0:h||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(Fz(n,l,m,h)&&(l=null),h||m===null?Oz(n)&&(l===null?e.removeAttribute(n):e.setAttribute(n,""+l)):m.mustUseProperty?e[m.propertyName]=l===null?m.type===3?!1:"":l:(n=m.attributeName,h=m.attributeNamespace,l===null?e.removeAttribute(n):(m=m.type,l=m===3||m===4&&l===!0?"":""+l,h?e.setAttributeNS(h,n,l):e.setAttribute(n,l))))}var Ta=tC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pg=Symbol.for("react.element"),Xu=Symbol.for("react.portal"),Ku=Symbol.for("react.fragment"),w1=Symbol.for("react.strict_mode"),ex=Symbol.for("react.profiler"),rC=Symbol.for("react.provider"),iC=Symbol.for("react.context"),b1=Symbol.for("react.forward_ref"),tx=Symbol.for("react.suspense"),nx=Symbol.for("react.suspense_list"),E1=Symbol.for("react.memo"),ul=Symbol.for("react.lazy"),oC=Symbol.for("react.offscreen"),wE=Symbol.iterator;function xp(e){return e===null||typeof e!="object"?null:(e=wE&&e[wE]||e["@@iterator"],typeof e=="function"?e:null)}var wr=Object.assign,uv;function Np(e){if(uv===void 0)try{throw Error()}catch(l){var n=l.stack.trim().match(/\n( *(at )?)/);uv=n&&n[1]||""}return`
`+uv+e}var hv=!1;function dv(e,n){if(!e||hv)return"";hv=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(R){var h=R}Reflect.construct(e,[],n)}else{try{n.call()}catch(R){h=R}e.call(n.prototype)}else{try{throw Error()}catch(R){h=R}e()}}catch(R){if(R&&h&&typeof R.stack=="string"){for(var m=R.stack.split(`
`),y=h.stack.split(`
`),b=m.length-1,s=y.length-1;1<=b&&0<=s&&m[b]!==y[s];)s--;for(;1<=b&&0<=s;b--,s--)if(m[b]!==y[s]){if(b!==1||s!==1)do if(b--,s--,0>s||m[b]!==y[s]){var A=`
`+m[b].replace(" at new "," at ");return e.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",e.displayName)),A}while(1<=b&&0<=s);break}}}finally{hv=!1,Error.prepareStackTrace=l}return(e=e?e.displayName||e.name:"")?Np(e):""}function Nz(e){switch(e.tag){case 5:return Np(e.type);case 16:return Np("Lazy");case 13:return Np("Suspense");case 19:return Np("SuspenseList");case 0:case 2:case 15:return e=dv(e.type,!1),e;case 11:return e=dv(e.type.render,!1),e;case 1:return e=dv(e.type,!0),e;default:return""}}function rx(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ku:return"Fragment";case Xu:return"Portal";case ex:return"Profiler";case w1:return"StrictMode";case tx:return"Suspense";case nx:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case iC:return(e.displayName||"Context")+".Consumer";case rC:return(e._context.displayName||"Context")+".Provider";case b1:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case E1:return n=e.displayName||null,n!==null?n:rx(e.type)||"Memo";case ul:n=e._payload,e=e._init;try{return rx(e(n))}catch{}}return null}function jz(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rx(n);case 8:return n===w1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Cl(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function sC(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Uz(e){var n=sC(e)?"checked":"value",l=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),h=""+e[n];if(!e.hasOwnProperty(n)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var m=l.get,y=l.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return m.call(this)},set:function(b){h=""+b,y.call(this,b)}}),Object.defineProperty(e,n,{enumerable:l.enumerable}),{getValue:function(){return h},setValue:function(b){h=""+b},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function fg(e){e._valueTracker||(e._valueTracker=Uz(e))}function aC(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var l=n.getValue(),h="";return e&&(h=sC(e)?e.checked?"true":"false":e.value),e=h,e!==l?(n.setValue(e),!0):!1}function o_(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ix(e,n){var l=n.checked;return wr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??e._wrapperState.initialChecked})}function bE(e,n){var l=n.defaultValue==null?"":n.defaultValue,h=n.checked!=null?n.checked:n.defaultChecked;l=Cl(n.value!=null?n.value:l),e._wrapperState={initialChecked:h,initialValue:l,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function lC(e,n){n=n.checked,n!=null&&x1(e,"checked",n,!1)}function ox(e,n){lC(e,n);var l=Cl(n.value),h=n.type;if(l!=null)h==="number"?(l===0&&e.value===""||e.value!=l)&&(e.value=""+l):e.value!==""+l&&(e.value=""+l);else if(h==="submit"||h==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?sx(e,n.type,l):n.hasOwnProperty("defaultValue")&&sx(e,n.type,Cl(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function EE(e,n,l){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var h=n.type;if(!(h!=="submit"&&h!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,l||n===e.value||(e.value=n),e.defaultValue=n}l=e.name,l!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,l!==""&&(e.name=l)}function sx(e,n,l){(n!=="number"||o_(e.ownerDocument)!==e)&&(l==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+l&&(e.defaultValue=""+l))}var jp=Array.isArray;function ch(e,n,l,h){if(e=e.options,n){n={};for(var m=0;m<l.length;m++)n["$"+l[m]]=!0;for(l=0;l<e.length;l++)m=n.hasOwnProperty("$"+e[l].value),e[l].selected!==m&&(e[l].selected=m),m&&h&&(e[l].defaultSelected=!0)}else{for(l=""+Cl(l),n=null,m=0;m<e.length;m++){if(e[m].value===l){e[m].selected=!0,h&&(e[m].defaultSelected=!0);return}n!==null||e[m].disabled||(n=e[m])}n!==null&&(n.selected=!0)}}function ax(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(dt(91));return wr({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function TE(e,n){var l=n.value;if(l==null){if(l=n.children,n=n.defaultValue,l!=null){if(n!=null)throw Error(dt(92));if(jp(l)){if(1<l.length)throw Error(dt(93));l=l[0]}n=l}n==null&&(n=""),l=n}e._wrapperState={initialValue:Cl(l)}}function cC(e,n){var l=Cl(n.value),h=Cl(n.defaultValue);l!=null&&(l=""+l,l!==e.value&&(e.value=l),n.defaultValue==null&&e.defaultValue!==l&&(e.defaultValue=l)),h!=null&&(e.defaultValue=""+h)}function SE(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function uC(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lx(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?uC(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mg,hC=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,l,h,m){MSApp.execUnsafeLocalFunction(function(){return e(n,l,h,m)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(mg=mg||document.createElement("div"),mg.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=mg.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function sf(e,n){if(n){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=n;return}}e.textContent=n}var qp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vz=["Webkit","ms","Moz","O"];Object.keys(qp).forEach(function(e){Vz.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),qp[n]=qp[e]})});function dC(e,n,l){return n==null||typeof n=="boolean"||n===""?"":l||typeof n!="number"||n===0||qp.hasOwnProperty(e)&&qp[e]?(""+n).trim():n+"px"}function pC(e,n){e=e.style;for(var l in n)if(n.hasOwnProperty(l)){var h=l.indexOf("--")===0,m=dC(l,n[l],h);l==="float"&&(l="cssFloat"),h?e.setProperty(l,m):e[l]=m}}var $z=wr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cx(e,n){if(n){if($z[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(dt(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(dt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(dt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(dt(62))}}function ux(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hx=null;function T1(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var dx=null,uh=null,hh=null;function CE(e){if(e=zf(e)){if(typeof dx!="function")throw Error(dt(280));var n=e.stateNode;n&&(n=$_(n),dx(e.stateNode,e.type,n))}}function fC(e){uh?hh?hh.push(e):hh=[e]:uh=e}function mC(){if(uh){var e=uh,n=hh;if(hh=uh=null,CE(e),n)for(e=0;e<n.length;e++)CE(n[e])}}function gC(e,n){return e(n)}function _C(){}var pv=!1;function yC(e,n,l){if(pv)return e(n,l);pv=!0;try{return gC(e,n,l)}finally{pv=!1,(uh!==null||hh!==null)&&(_C(),mC())}}function af(e,n){var l=e.stateNode;if(l===null)return null;var h=$_(l);if(h===null)return null;l=h[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(e=e.type,h=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!h;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(dt(231,n,typeof l));return l}var px=!1;if(va)try{var wp={};Object.defineProperty(wp,"passive",{get:function(){px=!0}}),window.addEventListener("test",wp,wp),window.removeEventListener("test",wp,wp)}catch{px=!1}function Gz(e,n,l,h,m,y,b,s,A){var R=Array.prototype.slice.call(arguments,3);try{n.apply(l,R)}catch(U){this.onError(U)}}var Wp=!1,s_=null,a_=!1,fx=null,qz={onError:function(e){Wp=!0,s_=e}};function Wz(e,n,l,h,m,y,b,s,A){Wp=!1,s_=null,Gz.apply(qz,arguments)}function Zz(e,n,l,h,m,y,b,s,A){if(Wz.apply(this,arguments),Wp){if(Wp){var R=s_;Wp=!1,s_=null}else throw Error(dt(198));a_||(a_=!0,fx=R)}}function jc(e){var n=e,l=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(l=n.return),e=n.return;while(e)}return n.tag===3?l:null}function vC(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function AE(e){if(jc(e)!==e)throw Error(dt(188))}function Hz(e){var n=e.alternate;if(!n){if(n=jc(e),n===null)throw Error(dt(188));return n!==e?null:e}for(var l=e,h=n;;){var m=l.return;if(m===null)break;var y=m.alternate;if(y===null){if(h=m.return,h!==null){l=h;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===l)return AE(m),e;if(y===h)return AE(m),n;y=y.sibling}throw Error(dt(188))}if(l.return!==h.return)l=m,h=y;else{for(var b=!1,s=m.child;s;){if(s===l){b=!0,l=m,h=y;break}if(s===h){b=!0,h=m,l=y;break}s=s.sibling}if(!b){for(s=y.child;s;){if(s===l){b=!0,l=y,h=m;break}if(s===h){b=!0,h=y,l=m;break}s=s.sibling}if(!b)throw Error(dt(189))}}if(l.alternate!==h)throw Error(dt(190))}if(l.tag!==3)throw Error(dt(188));return l.stateNode.current===l?e:n}function xC(e){return e=Hz(e),e!==null?wC(e):null}function wC(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=wC(e);if(n!==null)return n;e=e.sibling}return null}var bC=go.unstable_scheduleCallback,ME=go.unstable_cancelCallback,Xz=go.unstable_shouldYield,Kz=go.unstable_requestPaint,Pr=go.unstable_now,Yz=go.unstable_getCurrentPriorityLevel,S1=go.unstable_ImmediatePriority,EC=go.unstable_UserBlockingPriority,l_=go.unstable_NormalPriority,Jz=go.unstable_LowPriority,TC=go.unstable_IdlePriority,N_=null,js=null;function Qz(e){if(js&&typeof js.onCommitFiberRoot=="function")try{js.onCommitFiberRoot(N_,e,void 0,(e.current.flags&128)===128)}catch{}}var vs=Math.clz32?Math.clz32:nR,eR=Math.log,tR=Math.LN2;function nR(e){return e>>>=0,e===0?32:31-(eR(e)/tR|0)|0}var gg=64,_g=4194304;function Up(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function c_(e,n){var l=e.pendingLanes;if(l===0)return 0;var h=0,m=e.suspendedLanes,y=e.pingedLanes,b=l&268435455;if(b!==0){var s=b&~m;s!==0?h=Up(s):(y&=b,y!==0&&(h=Up(y)))}else b=l&~m,b!==0?h=Up(b):y!==0&&(h=Up(y));if(h===0)return 0;if(n!==0&&n!==h&&!(n&m)&&(m=h&-h,y=n&-n,m>=y||m===16&&(y&4194240)!==0))return n;if(h&4&&(h|=l&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=h;0<n;)l=31-vs(n),m=1<<l,h|=e[l],n&=~m;return h}function rR(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iR(e,n){for(var l=e.suspendedLanes,h=e.pingedLanes,m=e.expirationTimes,y=e.pendingLanes;0<y;){var b=31-vs(y),s=1<<b,A=m[b];A===-1?(!(s&l)||s&h)&&(m[b]=rR(s,n)):A<=n&&(e.expiredLanes|=s),y&=~s}}function mx(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function SC(){var e=gg;return gg<<=1,!(gg&4194240)&&(gg=64),e}function fv(e){for(var n=[],l=0;31>l;l++)n.push(e);return n}function kf(e,n,l){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-vs(n),e[n]=l}function oR(e,n){var l=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var h=e.eventTimes;for(e=e.expirationTimes;0<l;){var m=31-vs(l),y=1<<m;n[m]=0,h[m]=-1,e[m]=-1,l&=~y}}function C1(e,n){var l=e.entangledLanes|=n;for(e=e.entanglements;l;){var h=31-vs(l),m=1<<h;m&n|e[h]&n&&(e[h]|=n),l&=~m}}var Wn=0;function CC(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var AC,A1,MC,IC,kC,gx=!1,yg=[],yl=null,vl=null,xl=null,lf=new Map,cf=new Map,dl=[],sR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function IE(e,n){switch(e){case"focusin":case"focusout":yl=null;break;case"dragenter":case"dragleave":vl=null;break;case"mouseover":case"mouseout":xl=null;break;case"pointerover":case"pointerout":lf.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":cf.delete(n.pointerId)}}function bp(e,n,l,h,m,y){return e===null||e.nativeEvent!==y?(e={blockedOn:n,domEventName:l,eventSystemFlags:h,nativeEvent:y,targetContainers:[m]},n!==null&&(n=zf(n),n!==null&&A1(n)),e):(e.eventSystemFlags|=h,n=e.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),e)}function aR(e,n,l,h,m){switch(n){case"focusin":return yl=bp(yl,e,n,l,h,m),!0;case"dragenter":return vl=bp(vl,e,n,l,h,m),!0;case"mouseover":return xl=bp(xl,e,n,l,h,m),!0;case"pointerover":var y=m.pointerId;return lf.set(y,bp(lf.get(y)||null,e,n,l,h,m)),!0;case"gotpointercapture":return y=m.pointerId,cf.set(y,bp(cf.get(y)||null,e,n,l,h,m)),!0}return!1}function PC(e){var n=Ec(e.target);if(n!==null){var l=jc(n);if(l!==null){if(n=l.tag,n===13){if(n=vC(l),n!==null){e.blockedOn=n,kC(e.priority,function(){MC(l)});return}}else if(n===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Fg(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var l=_x(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(l===null){l=e.nativeEvent;var h=new l.constructor(l.type,l);hx=h,l.target.dispatchEvent(h),hx=null}else return n=zf(l),n!==null&&A1(n),e.blockedOn=l,!1;n.shift()}return!0}function kE(e,n,l){Fg(e)&&l.delete(n)}function lR(){gx=!1,yl!==null&&Fg(yl)&&(yl=null),vl!==null&&Fg(vl)&&(vl=null),xl!==null&&Fg(xl)&&(xl=null),lf.forEach(kE),cf.forEach(kE)}function Ep(e,n){e.blockedOn===n&&(e.blockedOn=null,gx||(gx=!0,go.unstable_scheduleCallback(go.unstable_NormalPriority,lR)))}function uf(e){function n(m){return Ep(m,e)}if(0<yg.length){Ep(yg[0],e);for(var l=1;l<yg.length;l++){var h=yg[l];h.blockedOn===e&&(h.blockedOn=null)}}for(yl!==null&&Ep(yl,e),vl!==null&&Ep(vl,e),xl!==null&&Ep(xl,e),lf.forEach(n),cf.forEach(n),l=0;l<dl.length;l++)h=dl[l],h.blockedOn===e&&(h.blockedOn=null);for(;0<dl.length&&(l=dl[0],l.blockedOn===null);)PC(l),l.blockedOn===null&&dl.shift()}var dh=Ta.ReactCurrentBatchConfig,u_=!0;function cR(e,n,l,h){var m=Wn,y=dh.transition;dh.transition=null;try{Wn=1,M1(e,n,l,h)}finally{Wn=m,dh.transition=y}}function uR(e,n,l,h){var m=Wn,y=dh.transition;dh.transition=null;try{Wn=4,M1(e,n,l,h)}finally{Wn=m,dh.transition=y}}function M1(e,n,l,h){if(u_){var m=_x(e,n,l,h);if(m===null)Tv(e,n,h,h_,l),IE(e,h);else if(aR(m,e,n,l,h))h.stopPropagation();else if(IE(e,h),n&4&&-1<sR.indexOf(e)){for(;m!==null;){var y=zf(m);if(y!==null&&AC(y),y=_x(e,n,l,h),y===null&&Tv(e,n,h,h_,l),y===m)break;m=y}m!==null&&h.stopPropagation()}else Tv(e,n,h,null,l)}}var h_=null;function _x(e,n,l,h){if(h_=null,e=T1(h),e=Ec(e),e!==null)if(n=jc(e),n===null)e=null;else if(l=n.tag,l===13){if(e=vC(n),e!==null)return e;e=null}else if(l===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return h_=e,null}function zC(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Yz()){case S1:return 1;case EC:return 4;case l_:case Jz:return 16;case TC:return 536870912;default:return 16}default:return 16}}var fl=null,I1=null,Ng=null;function RC(){if(Ng)return Ng;var e,n=I1,l=n.length,h,m="value"in fl?fl.value:fl.textContent,y=m.length;for(e=0;e<l&&n[e]===m[e];e++);var b=l-e;for(h=1;h<=b&&n[l-h]===m[y-h];h++);return Ng=m.slice(e,1<h?1-h:void 0)}function jg(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function vg(){return!0}function PE(){return!1}function yo(e){function n(l,h,m,y,b){this._reactName=l,this._targetInst=m,this.type=h,this.nativeEvent=y,this.target=b,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(l=e[s],this[s]=l?l(y):y[s]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?vg:PE,this.isPropagationStopped=PE,this}return wr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=vg)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=vg)},persist:function(){},isPersistent:vg}),n}var Rh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},k1=yo(Rh),Pf=wr({},Rh,{view:0,detail:0}),hR=yo(Pf),mv,gv,Tp,j_=wr({},Pf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:P1,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Tp&&(Tp&&e.type==="mousemove"?(mv=e.screenX-Tp.screenX,gv=e.screenY-Tp.screenY):gv=mv=0,Tp=e),mv)},movementY:function(e){return"movementY"in e?e.movementY:gv}}),zE=yo(j_),dR=wr({},j_,{dataTransfer:0}),pR=yo(dR),fR=wr({},Pf,{relatedTarget:0}),_v=yo(fR),mR=wr({},Rh,{animationName:0,elapsedTime:0,pseudoElement:0}),gR=yo(mR),_R=wr({},Rh,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yR=yo(_R),vR=wr({},Rh,{data:0}),RE=yo(vR),xR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ER(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=bR[e])?!!n[e]:!1}function P1(){return ER}var TR=wr({},Pf,{key:function(e){if(e.key){var n=xR[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=jg(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?wR[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:P1,charCode:function(e){return e.type==="keypress"?jg(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?jg(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),SR=yo(TR),CR=wr({},j_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),DE=yo(CR),AR=wr({},Pf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:P1}),MR=yo(AR),IR=wr({},Rh,{propertyName:0,elapsedTime:0,pseudoElement:0}),kR=yo(IR),PR=wr({},j_,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),zR=yo(PR),RR=[9,13,27,32],z1=va&&"CompositionEvent"in window,Zp=null;va&&"documentMode"in document&&(Zp=document.documentMode);var DR=va&&"TextEvent"in window&&!Zp,DC=va&&(!z1||Zp&&8<Zp&&11>=Zp),LE=String.fromCharCode(32),OE=!1;function LC(e,n){switch(e){case"keyup":return RR.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OC(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Yu=!1;function LR(e,n){switch(e){case"compositionend":return OC(n);case"keypress":return n.which!==32?null:(OE=!0,LE);case"textInput":return e=n.data,e===LE&&OE?null:e;default:return null}}function OR(e,n){if(Yu)return e==="compositionend"||!z1&&LC(e,n)?(e=RC(),Ng=I1=fl=null,Yu=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return DC&&n.locale!=="ko"?null:n.data;default:return null}}var BR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function BE(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!BR[e.type]:n==="textarea"}function BC(e,n,l,h){fC(h),n=d_(n,"onChange"),0<n.length&&(l=new k1("onChange","change",null,l,h),e.push({event:l,listeners:n}))}var Hp=null,hf=null;function FR(e){HC(e,0)}function U_(e){var n=eh(e);if(aC(n))return e}function NR(e,n){if(e==="change")return n}var FC=!1;if(va){var yv;if(va){var vv="oninput"in document;if(!vv){var FE=document.createElement("div");FE.setAttribute("oninput","return;"),vv=typeof FE.oninput=="function"}yv=vv}else yv=!1;FC=yv&&(!document.documentMode||9<document.documentMode)}function NE(){Hp&&(Hp.detachEvent("onpropertychange",NC),hf=Hp=null)}function NC(e){if(e.propertyName==="value"&&U_(hf)){var n=[];BC(n,hf,e,T1(e)),yC(FR,n)}}function jR(e,n,l){e==="focusin"?(NE(),Hp=n,hf=l,Hp.attachEvent("onpropertychange",NC)):e==="focusout"&&NE()}function UR(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return U_(hf)}function VR(e,n){if(e==="click")return U_(n)}function $R(e,n){if(e==="input"||e==="change")return U_(n)}function GR(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var ws=typeof Object.is=="function"?Object.is:GR;function df(e,n){if(ws(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var l=Object.keys(e),h=Object.keys(n);if(l.length!==h.length)return!1;for(h=0;h<l.length;h++){var m=l[h];if(!Qv.call(n,m)||!ws(e[m],n[m]))return!1}return!0}function jE(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function UE(e,n){var l=jE(e);e=0;for(var h;l;){if(l.nodeType===3){if(h=e+l.textContent.length,e<=n&&h>=n)return{node:l,offset:n-e};e=h}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=jE(l)}}function jC(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?jC(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function UC(){for(var e=window,n=o_();n instanceof e.HTMLIFrameElement;){try{var l=typeof n.contentWindow.location.href=="string"}catch{l=!1}if(l)e=n.contentWindow;else break;n=o_(e.document)}return n}function R1(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function qR(e){var n=UC(),l=e.focusedElem,h=e.selectionRange;if(n!==l&&l&&l.ownerDocument&&jC(l.ownerDocument.documentElement,l)){if(h!==null&&R1(l)){if(n=h.start,e=h.end,e===void 0&&(e=n),"selectionStart"in l)l.selectionStart=n,l.selectionEnd=Math.min(e,l.value.length);else if(e=(n=l.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var m=l.textContent.length,y=Math.min(h.start,m);h=h.end===void 0?y:Math.min(h.end,m),!e.extend&&y>h&&(m=h,h=y,y=m),m=UE(l,y);var b=UE(l,h);m&&b&&(e.rangeCount!==1||e.anchorNode!==m.node||e.anchorOffset!==m.offset||e.focusNode!==b.node||e.focusOffset!==b.offset)&&(n=n.createRange(),n.setStart(m.node,m.offset),e.removeAllRanges(),y>h?(e.addRange(n),e.extend(b.node,b.offset)):(n.setEnd(b.node,b.offset),e.addRange(n)))}}for(n=[],e=l;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<n.length;l++)e=n[l],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var WR=va&&"documentMode"in document&&11>=document.documentMode,Ju=null,yx=null,Xp=null,vx=!1;function VE(e,n,l){var h=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;vx||Ju==null||Ju!==o_(h)||(h=Ju,"selectionStart"in h&&R1(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Xp&&df(Xp,h)||(Xp=h,h=d_(yx,"onSelect"),0<h.length&&(n=new k1("onSelect","select",null,n,l),e.push({event:n,listeners:h}),n.target=Ju)))}function xg(e,n){var l={};return l[e.toLowerCase()]=n.toLowerCase(),l["Webkit"+e]="webkit"+n,l["Moz"+e]="moz"+n,l}var Qu={animationend:xg("Animation","AnimationEnd"),animationiteration:xg("Animation","AnimationIteration"),animationstart:xg("Animation","AnimationStart"),transitionend:xg("Transition","TransitionEnd")},xv={},VC={};va&&(VC=document.createElement("div").style,"AnimationEvent"in window||(delete Qu.animationend.animation,delete Qu.animationiteration.animation,delete Qu.animationstart.animation),"TransitionEvent"in window||delete Qu.transitionend.transition);function V_(e){if(xv[e])return xv[e];if(!Qu[e])return e;var n=Qu[e],l;for(l in n)if(n.hasOwnProperty(l)&&l in VC)return xv[e]=n[l];return e}var $C=V_("animationend"),GC=V_("animationiteration"),qC=V_("animationstart"),WC=V_("transitionend"),ZC=new Map,$E="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ml(e,n){ZC.set(e,n),Nc(n,[e])}for(var wv=0;wv<$E.length;wv++){var bv=$E[wv],ZR=bv.toLowerCase(),HR=bv[0].toUpperCase()+bv.slice(1);Ml(ZR,"on"+HR)}Ml($C,"onAnimationEnd");Ml(GC,"onAnimationIteration");Ml(qC,"onAnimationStart");Ml("dblclick","onDoubleClick");Ml("focusin","onFocus");Ml("focusout","onBlur");Ml(WC,"onTransitionEnd");vh("onMouseEnter",["mouseout","mouseover"]);vh("onMouseLeave",["mouseout","mouseover"]);vh("onPointerEnter",["pointerout","pointerover"]);vh("onPointerLeave",["pointerout","pointerover"]);Nc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Nc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Nc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Nc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Nc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Nc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vp));function GE(e,n,l){var h=e.type||"unknown-event";e.currentTarget=l,Zz(h,n,void 0,e),e.currentTarget=null}function HC(e,n){n=(n&4)!==0;for(var l=0;l<e.length;l++){var h=e[l],m=h.event;h=h.listeners;e:{var y=void 0;if(n)for(var b=h.length-1;0<=b;b--){var s=h[b],A=s.instance,R=s.currentTarget;if(s=s.listener,A!==y&&m.isPropagationStopped())break e;GE(m,s,R),y=A}else for(b=0;b<h.length;b++){if(s=h[b],A=s.instance,R=s.currentTarget,s=s.listener,A!==y&&m.isPropagationStopped())break e;GE(m,s,R),y=A}}}if(a_)throw e=fx,a_=!1,fx=null,e}function nr(e,n){var l=n[Tx];l===void 0&&(l=n[Tx]=new Set);var h=e+"__bubble";l.has(h)||(XC(n,e,2,!1),l.add(h))}function Ev(e,n,l){var h=0;n&&(h|=4),XC(l,e,h,n)}var wg="_reactListening"+Math.random().toString(36).slice(2);function pf(e){if(!e[wg]){e[wg]=!0,nC.forEach(function(l){l!=="selectionchange"&&(XR.has(l)||Ev(l,!1,e),Ev(l,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[wg]||(n[wg]=!0,Ev("selectionchange",!1,n))}}function XC(e,n,l,h){switch(zC(n)){case 1:var m=cR;break;case 4:m=uR;break;default:m=M1}l=m.bind(null,n,l,e),m=void 0,!px||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),h?m!==void 0?e.addEventListener(n,l,{capture:!0,passive:m}):e.addEventListener(n,l,!0):m!==void 0?e.addEventListener(n,l,{passive:m}):e.addEventListener(n,l,!1)}function Tv(e,n,l,h,m){var y=h;if(!(n&1)&&!(n&2)&&h!==null)e:for(;;){if(h===null)return;var b=h.tag;if(b===3||b===4){var s=h.stateNode.containerInfo;if(s===m||s.nodeType===8&&s.parentNode===m)break;if(b===4)for(b=h.return;b!==null;){var A=b.tag;if((A===3||A===4)&&(A=b.stateNode.containerInfo,A===m||A.nodeType===8&&A.parentNode===m))return;b=b.return}for(;s!==null;){if(b=Ec(s),b===null)return;if(A=b.tag,A===5||A===6){h=y=b;continue e}s=s.parentNode}}h=h.return}yC(function(){var R=y,U=T1(l),V=[];e:{var $=ZC.get(e);if($!==void 0){var pe=k1,Y=e;switch(e){case"keypress":if(jg(l)===0)break e;case"keydown":case"keyup":pe=SR;break;case"focusin":Y="focus",pe=_v;break;case"focusout":Y="blur",pe=_v;break;case"beforeblur":case"afterblur":pe=_v;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=zE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=pR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=MR;break;case $C:case GC:case qC:pe=gR;break;case WC:pe=kR;break;case"scroll":pe=hR;break;case"wheel":pe=zR;break;case"copy":case"cut":case"paste":pe=yR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=DE}var K=(n&4)!==0,Ce=!K&&e==="scroll",ee=K?$!==null?$+"Capture":null:$;K=[];for(var ne=R,ce;ne!==null;){ce=ne;var se=ce.stateNode;if(ce.tag===5&&se!==null&&(ce=se,ee!==null&&(se=af(ne,ee),se!=null&&K.push(ff(ne,se,ce)))),Ce)break;ne=ne.return}0<K.length&&($=new pe($,Y,null,l,U),V.push({event:$,listeners:K}))}}if(!(n&7)){e:{if($=e==="mouseover"||e==="pointerover",pe=e==="mouseout"||e==="pointerout",$&&l!==hx&&(Y=l.relatedTarget||l.fromElement)&&(Ec(Y)||Y[xa]))break e;if((pe||$)&&($=U.window===U?U:($=U.ownerDocument)?$.defaultView||$.parentWindow:window,pe?(Y=l.relatedTarget||l.toElement,pe=R,Y=Y?Ec(Y):null,Y!==null&&(Ce=jc(Y),Y!==Ce||Y.tag!==5&&Y.tag!==6)&&(Y=null)):(pe=null,Y=R),pe!==Y)){if(K=zE,se="onMouseLeave",ee="onMouseEnter",ne="mouse",(e==="pointerout"||e==="pointerover")&&(K=DE,se="onPointerLeave",ee="onPointerEnter",ne="pointer"),Ce=pe==null?$:eh(pe),ce=Y==null?$:eh(Y),$=new K(se,ne+"leave",pe,l,U),$.target=Ce,$.relatedTarget=ce,se=null,Ec(U)===R&&(K=new K(ee,ne+"enter",Y,l,U),K.target=ce,K.relatedTarget=Ce,se=K),Ce=se,pe&&Y)t:{for(K=pe,ee=Y,ne=0,ce=K;ce;ce=Fu(ce))ne++;for(ce=0,se=ee;se;se=Fu(se))ce++;for(;0<ne-ce;)K=Fu(K),ne--;for(;0<ce-ne;)ee=Fu(ee),ce--;for(;ne--;){if(K===ee||ee!==null&&K===ee.alternate)break t;K=Fu(K),ee=Fu(ee)}K=null}else K=null;pe!==null&&qE(V,$,pe,K,!1),Y!==null&&Ce!==null&&qE(V,Ce,Y,K,!0)}}e:{if($=R?eh(R):window,pe=$.nodeName&&$.nodeName.toLowerCase(),pe==="select"||pe==="input"&&$.type==="file")var De=NR;else if(BE($))if(FC)De=$R;else{De=UR;var He=jR}else(pe=$.nodeName)&&pe.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(De=VR);if(De&&(De=De(e,R))){BC(V,De,l,U);break e}He&&He(e,$,R),e==="focusout"&&(He=$._wrapperState)&&He.controlled&&$.type==="number"&&sx($,"number",$.value)}switch(He=R?eh(R):window,e){case"focusin":(BE(He)||He.contentEditable==="true")&&(Ju=He,yx=R,Xp=null);break;case"focusout":Xp=yx=Ju=null;break;case"mousedown":vx=!0;break;case"contextmenu":case"mouseup":case"dragend":vx=!1,VE(V,l,U);break;case"selectionchange":if(WR)break;case"keydown":case"keyup":VE(V,l,U)}var Be;if(z1)e:{switch(e){case"compositionstart":var ut="onCompositionStart";break e;case"compositionend":ut="onCompositionEnd";break e;case"compositionupdate":ut="onCompositionUpdate";break e}ut=void 0}else Yu?LC(e,l)&&(ut="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(ut="onCompositionStart");ut&&(DC&&l.locale!=="ko"&&(Yu||ut!=="onCompositionStart"?ut==="onCompositionEnd"&&Yu&&(Be=RC()):(fl=U,I1="value"in fl?fl.value:fl.textContent,Yu=!0)),He=d_(R,ut),0<He.length&&(ut=new RE(ut,e,null,l,U),V.push({event:ut,listeners:He}),Be?ut.data=Be:(Be=OC(l),Be!==null&&(ut.data=Be)))),(Be=DR?LR(e,l):OR(e,l))&&(R=d_(R,"onBeforeInput"),0<R.length&&(U=new RE("onBeforeInput","beforeinput",null,l,U),V.push({event:U,listeners:R}),U.data=Be))}HC(V,n)})}function ff(e,n,l){return{instance:e,listener:n,currentTarget:l}}function d_(e,n){for(var l=n+"Capture",h=[];e!==null;){var m=e,y=m.stateNode;m.tag===5&&y!==null&&(m=y,y=af(e,l),y!=null&&h.unshift(ff(e,y,m)),y=af(e,n),y!=null&&h.push(ff(e,y,m))),e=e.return}return h}function Fu(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function qE(e,n,l,h,m){for(var y=n._reactName,b=[];l!==null&&l!==h;){var s=l,A=s.alternate,R=s.stateNode;if(A!==null&&A===h)break;s.tag===5&&R!==null&&(s=R,m?(A=af(l,y),A!=null&&b.unshift(ff(l,A,s))):m||(A=af(l,y),A!=null&&b.push(ff(l,A,s)))),l=l.return}b.length!==0&&e.push({event:n,listeners:b})}var KR=/\r\n?/g,YR=/\u0000|\uFFFD/g;function WE(e){return(typeof e=="string"?e:""+e).replace(KR,`
`).replace(YR,"")}function bg(e,n,l){if(n=WE(n),WE(e)!==n&&l)throw Error(dt(425))}function p_(){}var xx=null,wx=null;function bx(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Ex=typeof setTimeout=="function"?setTimeout:void 0,JR=typeof clearTimeout=="function"?clearTimeout:void 0,ZE=typeof Promise=="function"?Promise:void 0,QR=typeof queueMicrotask=="function"?queueMicrotask:typeof ZE<"u"?function(e){return ZE.resolve(null).then(e).catch(eD)}:Ex;function eD(e){setTimeout(function(){throw e})}function Sv(e,n){var l=n,h=0;do{var m=l.nextSibling;if(e.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"){if(h===0){e.removeChild(m),uf(n);return}h--}else l!=="$"&&l!=="$?"&&l!=="$!"||h++;l=m}while(l);uf(n)}function wl(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function HE(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"){if(n===0)return e;n--}else l==="/$"&&n++}e=e.previousSibling}return null}var Dh=Math.random().toString(36).slice(2),Bs="__reactFiber$"+Dh,mf="__reactProps$"+Dh,xa="__reactContainer$"+Dh,Tx="__reactEvents$"+Dh,tD="__reactListeners$"+Dh,nD="__reactHandles$"+Dh;function Ec(e){var n=e[Bs];if(n)return n;for(var l=e.parentNode;l;){if(n=l[xa]||l[Bs]){if(l=n.alternate,n.child!==null||l!==null&&l.child!==null)for(e=HE(e);e!==null;){if(l=e[Bs])return l;e=HE(e)}return n}e=l,l=e.parentNode}return null}function zf(e){return e=e[Bs]||e[xa],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function eh(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(dt(33))}function $_(e){return e[mf]||null}var Sx=[],th=-1;function Il(e){return{current:e}}function rr(e){0>th||(e.current=Sx[th],Sx[th]=null,th--)}function Jn(e,n){th++,Sx[th]=e.current,e.current=n}var Al={},Mi=Il(Al),Ji=Il(!1),Pc=Al;function xh(e,n){var l=e.type.contextTypes;if(!l)return Al;var h=e.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===n)return h.__reactInternalMemoizedMaskedChildContext;var m={},y;for(y in l)m[y]=n[y];return h&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=m),m}function Qi(e){return e=e.childContextTypes,e!=null}function f_(){rr(Ji),rr(Mi)}function XE(e,n,l){if(Mi.current!==Al)throw Error(dt(168));Jn(Mi,n),Jn(Ji,l)}function KC(e,n,l){var h=e.stateNode;if(n=n.childContextTypes,typeof h.getChildContext!="function")return l;h=h.getChildContext();for(var m in h)if(!(m in n))throw Error(dt(108,jz(e)||"Unknown",m));return wr({},l,h)}function m_(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Al,Pc=Mi.current,Jn(Mi,e),Jn(Ji,Ji.current),!0}function KE(e,n,l){var h=e.stateNode;if(!h)throw Error(dt(169));l?(e=KC(e,n,Pc),h.__reactInternalMemoizedMergedChildContext=e,rr(Ji),rr(Mi),Jn(Mi,e)):rr(Ji),Jn(Ji,l)}var ha=null,G_=!1,Cv=!1;function YC(e){ha===null?ha=[e]:ha.push(e)}function rD(e){G_=!0,YC(e)}function kl(){if(!Cv&&ha!==null){Cv=!0;var e=0,n=Wn;try{var l=ha;for(Wn=1;e<l.length;e++){var h=l[e];do h=h(!0);while(h!==null)}ha=null,G_=!1}catch(m){throw ha!==null&&(ha=ha.slice(e+1)),bC(S1,kl),m}finally{Wn=n,Cv=!1}}return null}var nh=[],rh=0,g_=null,__=0,No=[],jo=0,zc=null,pa=1,fa="";function vc(e,n){nh[rh++]=__,nh[rh++]=g_,g_=e,__=n}function JC(e,n,l){No[jo++]=pa,No[jo++]=fa,No[jo++]=zc,zc=e;var h=pa;e=fa;var m=32-vs(h)-1;h&=~(1<<m),l+=1;var y=32-vs(n)+m;if(30<y){var b=m-m%5;y=(h&(1<<b)-1).toString(32),h>>=b,m-=b,pa=1<<32-vs(n)+m|l<<m|h,fa=y+e}else pa=1<<y|l<<m|h,fa=e}function D1(e){e.return!==null&&(vc(e,1),JC(e,1,0))}function L1(e){for(;e===g_;)g_=nh[--rh],nh[rh]=null,__=nh[--rh],nh[rh]=null;for(;e===zc;)zc=No[--jo],No[jo]=null,fa=No[--jo],No[jo]=null,pa=No[--jo],No[jo]=null}var fo=null,po=null,lr=!1,ys=null;function QC(e,n){var l=Uo(5,null,null,0);l.elementType="DELETED",l.stateNode=n,l.return=e,n=e.deletions,n===null?(e.deletions=[l],e.flags|=16):n.push(l)}function YE(e,n){switch(e.tag){case 5:var l=e.type;return n=n.nodeType!==1||l.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,fo=e,po=wl(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,fo=e,po=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(l=zc!==null?{id:pa,overflow:fa}:null,e.memoizedState={dehydrated:n,treeContext:l,retryLane:1073741824},l=Uo(18,null,null,0),l.stateNode=n,l.return=e,e.child=l,fo=e,po=null,!0):!1;default:return!1}}function Cx(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ax(e){if(lr){var n=po;if(n){var l=n;if(!YE(e,n)){if(Cx(e))throw Error(dt(418));n=wl(l.nextSibling);var h=fo;n&&YE(e,n)?QC(h,l):(e.flags=e.flags&-4097|2,lr=!1,fo=e)}}else{if(Cx(e))throw Error(dt(418));e.flags=e.flags&-4097|2,lr=!1,fo=e}}}function JE(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;fo=e}function Eg(e){if(e!==fo)return!1;if(!lr)return JE(e),lr=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!bx(e.type,e.memoizedProps)),n&&(n=po)){if(Cx(e))throw eA(),Error(dt(418));for(;n;)QC(e,n),n=wl(n.nextSibling)}if(JE(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(dt(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"){if(n===0){po=wl(e.nextSibling);break e}n--}else l!=="$"&&l!=="$!"&&l!=="$?"||n++}e=e.nextSibling}po=null}}else po=fo?wl(e.stateNode.nextSibling):null;return!0}function eA(){for(var e=po;e;)e=wl(e.nextSibling)}function wh(){po=fo=null,lr=!1}function O1(e){ys===null?ys=[e]:ys.push(e)}var iD=Ta.ReactCurrentBatchConfig;function ms(e,n){if(e&&e.defaultProps){n=wr({},n),e=e.defaultProps;for(var l in e)n[l]===void 0&&(n[l]=e[l]);return n}return n}var y_=Il(null),v_=null,ih=null,B1=null;function F1(){B1=ih=v_=null}function N1(e){var n=y_.current;rr(y_),e._currentValue=n}function Mx(e,n,l){for(;e!==null;){var h=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,h!==null&&(h.childLanes|=n)):h!==null&&(h.childLanes&n)!==n&&(h.childLanes|=n),e===l)break;e=e.return}}function ph(e,n){v_=e,B1=ih=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(Yi=!0),e.firstContext=null)}function Go(e){var n=e._currentValue;if(B1!==e)if(e={context:e,memoizedValue:n,next:null},ih===null){if(v_===null)throw Error(dt(308));ih=e,v_.dependencies={lanes:0,firstContext:e}}else ih=ih.next=e;return n}var Tc=null;function j1(e){Tc===null?Tc=[e]:Tc.push(e)}function tA(e,n,l,h){var m=n.interleaved;return m===null?(l.next=l,j1(n)):(l.next=m.next,m.next=l),n.interleaved=l,wa(e,h)}function wa(e,n){e.lanes|=n;var l=e.alternate;for(l!==null&&(l.lanes|=n),l=e,e=e.return;e!==null;)e.childLanes|=n,l=e.alternate,l!==null&&(l.childLanes|=n),l=e,e=e.return;return l.tag===3?l.stateNode:null}var hl=!1;function U1(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function nA(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ma(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function bl(e,n,l){var h=e.updateQueue;if(h===null)return null;if(h=h.shared,bn&2){var m=h.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),h.pending=n,wa(e,l)}return m=h.interleaved,m===null?(n.next=n,j1(h)):(n.next=m.next,m.next=n),h.interleaved=n,wa(e,l)}function Ug(e,n,l){if(n=n.updateQueue,n!==null&&(n=n.shared,(l&4194240)!==0)){var h=n.lanes;h&=e.pendingLanes,l|=h,n.lanes=l,C1(e,l)}}function QE(e,n){var l=e.updateQueue,h=e.alternate;if(h!==null&&(h=h.updateQueue,l===h)){var m=null,y=null;if(l=l.firstBaseUpdate,l!==null){do{var b={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};y===null?m=y=b:y=y.next=b,l=l.next}while(l!==null);y===null?m=y=n:y=y.next=n}else m=y=n;l={baseState:h.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:h.shared,effects:h.effects},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=n:e.next=n,l.lastBaseUpdate=n}function x_(e,n,l,h){var m=e.updateQueue;hl=!1;var y=m.firstBaseUpdate,b=m.lastBaseUpdate,s=m.shared.pending;if(s!==null){m.shared.pending=null;var A=s,R=A.next;A.next=null,b===null?y=R:b.next=R,b=A;var U=e.alternate;U!==null&&(U=U.updateQueue,s=U.lastBaseUpdate,s!==b&&(s===null?U.firstBaseUpdate=R:s.next=R,U.lastBaseUpdate=A))}if(y!==null){var V=m.baseState;b=0,U=R=A=null,s=y;do{var $=s.lane,pe=s.eventTime;if((h&$)===$){U!==null&&(U=U.next={eventTime:pe,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var Y=e,K=s;switch($=n,pe=l,K.tag){case 1:if(Y=K.payload,typeof Y=="function"){V=Y.call(pe,V,$);break e}V=Y;break e;case 3:Y.flags=Y.flags&-65537|128;case 0:if(Y=K.payload,$=typeof Y=="function"?Y.call(pe,V,$):Y,$==null)break e;V=wr({},V,$);break e;case 2:hl=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,$=m.effects,$===null?m.effects=[s]:$.push(s))}else pe={eventTime:pe,lane:$,tag:s.tag,payload:s.payload,callback:s.callback,next:null},U===null?(R=U=pe,A=V):U=U.next=pe,b|=$;if(s=s.next,s===null){if(s=m.shared.pending,s===null)break;$=s,s=$.next,$.next=null,m.lastBaseUpdate=$,m.shared.pending=null}}while(1);if(U===null&&(A=V),m.baseState=A,m.firstBaseUpdate=R,m.lastBaseUpdate=U,n=m.shared.interleaved,n!==null){m=n;do b|=m.lane,m=m.next;while(m!==n)}else y===null&&(m.shared.lanes=0);Dc|=b,e.lanes=b,e.memoizedState=V}}function eT(e,n,l){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var h=e[n],m=h.callback;if(m!==null){if(h.callback=null,h=l,typeof m!="function")throw Error(dt(191,m));m.call(h)}}}var rA=new tC.Component().refs;function Ix(e,n,l,h){n=e.memoizedState,l=l(h,n),l=l==null?n:wr({},n,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var q_={isMounted:function(e){return(e=e._reactInternals)?jc(e)===e:!1},enqueueSetState:function(e,n,l){e=e._reactInternals;var h=Fi(),m=Tl(e),y=ma(h,m);y.payload=n,l!=null&&(y.callback=l),n=bl(e,y,m),n!==null&&(xs(n,e,m,h),Ug(n,e,m))},enqueueReplaceState:function(e,n,l){e=e._reactInternals;var h=Fi(),m=Tl(e),y=ma(h,m);y.tag=1,y.payload=n,l!=null&&(y.callback=l),n=bl(e,y,m),n!==null&&(xs(n,e,m,h),Ug(n,e,m))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var l=Fi(),h=Tl(e),m=ma(l,h);m.tag=2,n!=null&&(m.callback=n),n=bl(e,m,h),n!==null&&(xs(n,e,h,l),Ug(n,e,h))}};function tT(e,n,l,h,m,y,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(h,y,b):n.prototype&&n.prototype.isPureReactComponent?!df(l,h)||!df(m,y):!0}function iA(e,n,l){var h=!1,m=Al,y=n.contextType;return typeof y=="object"&&y!==null?y=Go(y):(m=Qi(n)?Pc:Mi.current,h=n.contextTypes,y=(h=h!=null)?xh(e,m):Al),n=new n(l,y),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=q_,e.stateNode=n,n._reactInternals=e,h&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=m,e.__reactInternalMemoizedMaskedChildContext=y),n}function nT(e,n,l,h){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(l,h),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(l,h),n.state!==e&&q_.enqueueReplaceState(n,n.state,null)}function kx(e,n,l,h){var m=e.stateNode;m.props=l,m.state=e.memoizedState,m.refs=rA,U1(e);var y=n.contextType;typeof y=="object"&&y!==null?m.context=Go(y):(y=Qi(n)?Pc:Mi.current,m.context=xh(e,y)),m.state=e.memoizedState,y=n.getDerivedStateFromProps,typeof y=="function"&&(Ix(e,n,y,l),m.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(n=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),n!==m.state&&q_.enqueueReplaceState(m,m.state,null),x_(e,l,m,h),m.state=e.memoizedState),typeof m.componentDidMount=="function"&&(e.flags|=4194308)}function Sp(e,n,l){if(e=l.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(dt(309));var h=l.stateNode}if(!h)throw Error(dt(147,e));var m=h,y=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===y?n.ref:(n=function(b){var s=m.refs;s===rA&&(s=m.refs={}),b===null?delete s[y]:s[y]=b},n._stringRef=y,n)}if(typeof e!="string")throw Error(dt(284));if(!l._owner)throw Error(dt(290,e))}return e}function Tg(e,n){throw e=Object.prototype.toString.call(n),Error(dt(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function rT(e){var n=e._init;return n(e._payload)}function oA(e){function n(ee,ne){if(e){var ce=ee.deletions;ce===null?(ee.deletions=[ne],ee.flags|=16):ce.push(ne)}}function l(ee,ne){if(!e)return null;for(;ne!==null;)n(ee,ne),ne=ne.sibling;return null}function h(ee,ne){for(ee=new Map;ne!==null;)ne.key!==null?ee.set(ne.key,ne):ee.set(ne.index,ne),ne=ne.sibling;return ee}function m(ee,ne){return ee=Sl(ee,ne),ee.index=0,ee.sibling=null,ee}function y(ee,ne,ce){return ee.index=ce,e?(ce=ee.alternate,ce!==null?(ce=ce.index,ce<ne?(ee.flags|=2,ne):ce):(ee.flags|=2,ne)):(ee.flags|=1048576,ne)}function b(ee){return e&&ee.alternate===null&&(ee.flags|=2),ee}function s(ee,ne,ce,se){return ne===null||ne.tag!==6?(ne=Rv(ce,ee.mode,se),ne.return=ee,ne):(ne=m(ne,ce),ne.return=ee,ne)}function A(ee,ne,ce,se){var De=ce.type;return De===Ku?U(ee,ne,ce.props.children,se,ce.key):ne!==null&&(ne.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ul&&rT(De)===ne.type)?(se=m(ne,ce.props),se.ref=Sp(ee,ne,ce),se.return=ee,se):(se=Zg(ce.type,ce.key,ce.props,null,ee.mode,se),se.ref=Sp(ee,ne,ce),se.return=ee,se)}function R(ee,ne,ce,se){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ce.containerInfo||ne.stateNode.implementation!==ce.implementation?(ne=Dv(ce,ee.mode,se),ne.return=ee,ne):(ne=m(ne,ce.children||[]),ne.return=ee,ne)}function U(ee,ne,ce,se,De){return ne===null||ne.tag!==7?(ne=kc(ce,ee.mode,se,De),ne.return=ee,ne):(ne=m(ne,ce),ne.return=ee,ne)}function V(ee,ne,ce){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=Rv(""+ne,ee.mode,ce),ne.return=ee,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case pg:return ce=Zg(ne.type,ne.key,ne.props,null,ee.mode,ce),ce.ref=Sp(ee,null,ne),ce.return=ee,ce;case Xu:return ne=Dv(ne,ee.mode,ce),ne.return=ee,ne;case ul:var se=ne._init;return V(ee,se(ne._payload),ce)}if(jp(ne)||xp(ne))return ne=kc(ne,ee.mode,ce,null),ne.return=ee,ne;Tg(ee,ne)}return null}function $(ee,ne,ce,se){var De=ne!==null?ne.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return De!==null?null:s(ee,ne,""+ce,se);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case pg:return ce.key===De?A(ee,ne,ce,se):null;case Xu:return ce.key===De?R(ee,ne,ce,se):null;case ul:return De=ce._init,$(ee,ne,De(ce._payload),se)}if(jp(ce)||xp(ce))return De!==null?null:U(ee,ne,ce,se,null);Tg(ee,ce)}return null}function pe(ee,ne,ce,se,De){if(typeof se=="string"&&se!==""||typeof se=="number")return ee=ee.get(ce)||null,s(ne,ee,""+se,De);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case pg:return ee=ee.get(se.key===null?ce:se.key)||null,A(ne,ee,se,De);case Xu:return ee=ee.get(se.key===null?ce:se.key)||null,R(ne,ee,se,De);case ul:var He=se._init;return pe(ee,ne,ce,He(se._payload),De)}if(jp(se)||xp(se))return ee=ee.get(ce)||null,U(ne,ee,se,De,null);Tg(ne,se)}return null}function Y(ee,ne,ce,se){for(var De=null,He=null,Be=ne,ut=ne=0,Ie=null;Be!==null&&ut<ce.length;ut++){Be.index>ut?(Ie=Be,Be=null):Ie=Be.sibling;var Je=$(ee,Be,ce[ut],se);if(Je===null){Be===null&&(Be=Ie);break}e&&Be&&Je.alternate===null&&n(ee,Be),ne=y(Je,ne,ut),He===null?De=Je:He.sibling=Je,He=Je,Be=Ie}if(ut===ce.length)return l(ee,Be),lr&&vc(ee,ut),De;if(Be===null){for(;ut<ce.length;ut++)Be=V(ee,ce[ut],se),Be!==null&&(ne=y(Be,ne,ut),He===null?De=Be:He.sibling=Be,He=Be);return lr&&vc(ee,ut),De}for(Be=h(ee,Be);ut<ce.length;ut++)Ie=pe(Be,ee,ut,ce[ut],se),Ie!==null&&(e&&Ie.alternate!==null&&Be.delete(Ie.key===null?ut:Ie.key),ne=y(Ie,ne,ut),He===null?De=Ie:He.sibling=Ie,He=Ie);return e&&Be.forEach(function(Rt){return n(ee,Rt)}),lr&&vc(ee,ut),De}function K(ee,ne,ce,se){var De=xp(ce);if(typeof De!="function")throw Error(dt(150));if(ce=De.call(ce),ce==null)throw Error(dt(151));for(var He=De=null,Be=ne,ut=ne=0,Ie=null,Je=ce.next();Be!==null&&!Je.done;ut++,Je=ce.next()){Be.index>ut?(Ie=Be,Be=null):Ie=Be.sibling;var Rt=$(ee,Be,Je.value,se);if(Rt===null){Be===null&&(Be=Ie);break}e&&Be&&Rt.alternate===null&&n(ee,Be),ne=y(Rt,ne,ut),He===null?De=Rt:He.sibling=Rt,He=Rt,Be=Ie}if(Je.done)return l(ee,Be),lr&&vc(ee,ut),De;if(Be===null){for(;!Je.done;ut++,Je=ce.next())Je=V(ee,Je.value,se),Je!==null&&(ne=y(Je,ne,ut),He===null?De=Je:He.sibling=Je,He=Je);return lr&&vc(ee,ut),De}for(Be=h(ee,Be);!Je.done;ut++,Je=ce.next())Je=pe(Be,ee,ut,Je.value,se),Je!==null&&(e&&Je.alternate!==null&&Be.delete(Je.key===null?ut:Je.key),ne=y(Je,ne,ut),He===null?De=Je:He.sibling=Je,He=Je);return e&&Be.forEach(function(ht){return n(ee,ht)}),lr&&vc(ee,ut),De}function Ce(ee,ne,ce,se){if(typeof ce=="object"&&ce!==null&&ce.type===Ku&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case pg:e:{for(var De=ce.key,He=ne;He!==null;){if(He.key===De){if(De=ce.type,De===Ku){if(He.tag===7){l(ee,He.sibling),ne=m(He,ce.props.children),ne.return=ee,ee=ne;break e}}else if(He.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ul&&rT(De)===He.type){l(ee,He.sibling),ne=m(He,ce.props),ne.ref=Sp(ee,He,ce),ne.return=ee,ee=ne;break e}l(ee,He);break}else n(ee,He);He=He.sibling}ce.type===Ku?(ne=kc(ce.props.children,ee.mode,se,ce.key),ne.return=ee,ee=ne):(se=Zg(ce.type,ce.key,ce.props,null,ee.mode,se),se.ref=Sp(ee,ne,ce),se.return=ee,ee=se)}return b(ee);case Xu:e:{for(He=ce.key;ne!==null;){if(ne.key===He)if(ne.tag===4&&ne.stateNode.containerInfo===ce.containerInfo&&ne.stateNode.implementation===ce.implementation){l(ee,ne.sibling),ne=m(ne,ce.children||[]),ne.return=ee,ee=ne;break e}else{l(ee,ne);break}else n(ee,ne);ne=ne.sibling}ne=Dv(ce,ee.mode,se),ne.return=ee,ee=ne}return b(ee);case ul:return He=ce._init,Ce(ee,ne,He(ce._payload),se)}if(jp(ce))return Y(ee,ne,ce,se);if(xp(ce))return K(ee,ne,ce,se);Tg(ee,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,ne!==null&&ne.tag===6?(l(ee,ne.sibling),ne=m(ne,ce),ne.return=ee,ee=ne):(l(ee,ne),ne=Rv(ce,ee.mode,se),ne.return=ee,ee=ne),b(ee)):l(ee,ne)}return Ce}var bh=oA(!0),sA=oA(!1),Rf={},Us=Il(Rf),gf=Il(Rf),_f=Il(Rf);function Sc(e){if(e===Rf)throw Error(dt(174));return e}function V1(e,n){switch(Jn(_f,n),Jn(gf,e),Jn(Us,Rf),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:lx(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=lx(n,e)}rr(Us),Jn(Us,n)}function Eh(){rr(Us),rr(gf),rr(_f)}function aA(e){Sc(_f.current);var n=Sc(Us.current),l=lx(n,e.type);n!==l&&(Jn(gf,e),Jn(Us,l))}function $1(e){gf.current===e&&(rr(Us),rr(gf))}var vr=Il(0);function w_(e){for(var n=e;n!==null;){if(n.tag===13){var l=n.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Av=[];function G1(){for(var e=0;e<Av.length;e++)Av[e]._workInProgressVersionPrimary=null;Av.length=0}var Vg=Ta.ReactCurrentDispatcher,Mv=Ta.ReactCurrentBatchConfig,Rc=0,xr=null,Xr=null,ii=null,b_=!1,Kp=!1,yf=0,oD=0;function Ti(){throw Error(dt(321))}function q1(e,n){if(n===null)return!1;for(var l=0;l<n.length&&l<e.length;l++)if(!ws(e[l],n[l]))return!1;return!0}function W1(e,n,l,h,m,y){if(Rc=y,xr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Vg.current=e===null||e.memoizedState===null?cD:uD,e=l(h,m),Kp){y=0;do{if(Kp=!1,yf=0,25<=y)throw Error(dt(301));y+=1,ii=Xr=null,n.updateQueue=null,Vg.current=hD,e=l(h,m)}while(Kp)}if(Vg.current=E_,n=Xr!==null&&Xr.next!==null,Rc=0,ii=Xr=xr=null,b_=!1,n)throw Error(dt(300));return e}function Z1(){var e=yf!==0;return yf=0,e}function Ds(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ii===null?xr.memoizedState=ii=e:ii=ii.next=e,ii}function qo(){if(Xr===null){var e=xr.alternate;e=e!==null?e.memoizedState:null}else e=Xr.next;var n=ii===null?xr.memoizedState:ii.next;if(n!==null)ii=n,Xr=e;else{if(e===null)throw Error(dt(310));Xr=e,e={memoizedState:Xr.memoizedState,baseState:Xr.baseState,baseQueue:Xr.baseQueue,queue:Xr.queue,next:null},ii===null?xr.memoizedState=ii=e:ii=ii.next=e}return ii}function vf(e,n){return typeof n=="function"?n(e):n}function Iv(e){var n=qo(),l=n.queue;if(l===null)throw Error(dt(311));l.lastRenderedReducer=e;var h=Xr,m=h.baseQueue,y=l.pending;if(y!==null){if(m!==null){var b=m.next;m.next=y.next,y.next=b}h.baseQueue=m=y,l.pending=null}if(m!==null){y=m.next,h=h.baseState;var s=b=null,A=null,R=y;do{var U=R.lane;if((Rc&U)===U)A!==null&&(A=A.next={lane:0,action:R.action,hasEagerState:R.hasEagerState,eagerState:R.eagerState,next:null}),h=R.hasEagerState?R.eagerState:e(h,R.action);else{var V={lane:U,action:R.action,hasEagerState:R.hasEagerState,eagerState:R.eagerState,next:null};A===null?(s=A=V,b=h):A=A.next=V,xr.lanes|=U,Dc|=U}R=R.next}while(R!==null&&R!==y);A===null?b=h:A.next=s,ws(h,n.memoizedState)||(Yi=!0),n.memoizedState=h,n.baseState=b,n.baseQueue=A,l.lastRenderedState=h}if(e=l.interleaved,e!==null){m=e;do y=m.lane,xr.lanes|=y,Dc|=y,m=m.next;while(m!==e)}else m===null&&(l.lanes=0);return[n.memoizedState,l.dispatch]}function kv(e){var n=qo(),l=n.queue;if(l===null)throw Error(dt(311));l.lastRenderedReducer=e;var h=l.dispatch,m=l.pending,y=n.memoizedState;if(m!==null){l.pending=null;var b=m=m.next;do y=e(y,b.action),b=b.next;while(b!==m);ws(y,n.memoizedState)||(Yi=!0),n.memoizedState=y,n.baseQueue===null&&(n.baseState=y),l.lastRenderedState=y}return[y,h]}function lA(){}function cA(e,n){var l=xr,h=qo(),m=n(),y=!ws(h.memoizedState,m);if(y&&(h.memoizedState=m,Yi=!0),h=h.queue,H1(dA.bind(null,l,h,e),[e]),h.getSnapshot!==n||y||ii!==null&&ii.memoizedState.tag&1){if(l.flags|=2048,xf(9,hA.bind(null,l,h,m,n),void 0,null),oi===null)throw Error(dt(349));Rc&30||uA(l,n,m)}return m}function uA(e,n,l){e.flags|=16384,e={getSnapshot:n,value:l},n=xr.updateQueue,n===null?(n={lastEffect:null,stores:null},xr.updateQueue=n,n.stores=[e]):(l=n.stores,l===null?n.stores=[e]:l.push(e))}function hA(e,n,l,h){n.value=l,n.getSnapshot=h,pA(n)&&fA(e)}function dA(e,n,l){return l(function(){pA(n)&&fA(e)})}function pA(e){var n=e.getSnapshot;e=e.value;try{var l=n();return!ws(e,l)}catch{return!0}}function fA(e){var n=wa(e,1);n!==null&&xs(n,e,1,-1)}function iT(e){var n=Ds();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vf,lastRenderedState:e},n.queue=e,e=e.dispatch=lD.bind(null,xr,e),[n.memoizedState,e]}function xf(e,n,l,h){return e={tag:e,create:n,destroy:l,deps:h,next:null},n=xr.updateQueue,n===null?(n={lastEffect:null,stores:null},xr.updateQueue=n,n.lastEffect=e.next=e):(l=n.lastEffect,l===null?n.lastEffect=e.next=e:(h=l.next,l.next=e,e.next=h,n.lastEffect=e)),e}function mA(){return qo().memoizedState}function $g(e,n,l,h){var m=Ds();xr.flags|=e,m.memoizedState=xf(1|n,l,void 0,h===void 0?null:h)}function W_(e,n,l,h){var m=qo();h=h===void 0?null:h;var y=void 0;if(Xr!==null){var b=Xr.memoizedState;if(y=b.destroy,h!==null&&q1(h,b.deps)){m.memoizedState=xf(n,l,y,h);return}}xr.flags|=e,m.memoizedState=xf(1|n,l,y,h)}function oT(e,n){return $g(8390656,8,e,n)}function H1(e,n){return W_(2048,8,e,n)}function gA(e,n){return W_(4,2,e,n)}function _A(e,n){return W_(4,4,e,n)}function yA(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function vA(e,n,l){return l=l!=null?l.concat([e]):null,W_(4,4,yA.bind(null,n,e),l)}function X1(){}function xA(e,n){var l=qo();n=n===void 0?null:n;var h=l.memoizedState;return h!==null&&n!==null&&q1(n,h[1])?h[0]:(l.memoizedState=[e,n],e)}function wA(e,n){var l=qo();n=n===void 0?null:n;var h=l.memoizedState;return h!==null&&n!==null&&q1(n,h[1])?h[0]:(e=e(),l.memoizedState=[e,n],e)}function bA(e,n,l){return Rc&21?(ws(l,n)||(l=SC(),xr.lanes|=l,Dc|=l,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,Yi=!0),e.memoizedState=l)}function sD(e,n){var l=Wn;Wn=l!==0&&4>l?l:4,e(!0);var h=Mv.transition;Mv.transition={};try{e(!1),n()}finally{Wn=l,Mv.transition=h}}function EA(){return qo().memoizedState}function aD(e,n,l){var h=Tl(e);if(l={lane:h,action:l,hasEagerState:!1,eagerState:null,next:null},TA(e))SA(n,l);else if(l=tA(e,n,l,h),l!==null){var m=Fi();xs(l,e,h,m),CA(l,n,h)}}function lD(e,n,l){var h=Tl(e),m={lane:h,action:l,hasEagerState:!1,eagerState:null,next:null};if(TA(e))SA(n,m);else{var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=n.lastRenderedReducer,y!==null))try{var b=n.lastRenderedState,s=y(b,l);if(m.hasEagerState=!0,m.eagerState=s,ws(s,b)){var A=n.interleaved;A===null?(m.next=m,j1(n)):(m.next=A.next,A.next=m),n.interleaved=m;return}}catch{}finally{}l=tA(e,n,m,h),l!==null&&(m=Fi(),xs(l,e,h,m),CA(l,n,h))}}function TA(e){var n=e.alternate;return e===xr||n!==null&&n===xr}function SA(e,n){Kp=b_=!0;var l=e.pending;l===null?n.next=n:(n.next=l.next,l.next=n),e.pending=n}function CA(e,n,l){if(l&4194240){var h=n.lanes;h&=e.pendingLanes,l|=h,n.lanes=l,C1(e,l)}}var E_={readContext:Go,useCallback:Ti,useContext:Ti,useEffect:Ti,useImperativeHandle:Ti,useInsertionEffect:Ti,useLayoutEffect:Ti,useMemo:Ti,useReducer:Ti,useRef:Ti,useState:Ti,useDebugValue:Ti,useDeferredValue:Ti,useTransition:Ti,useMutableSource:Ti,useSyncExternalStore:Ti,useId:Ti,unstable_isNewReconciler:!1},cD={readContext:Go,useCallback:function(e,n){return Ds().memoizedState=[e,n===void 0?null:n],e},useContext:Go,useEffect:oT,useImperativeHandle:function(e,n,l){return l=l!=null?l.concat([e]):null,$g(4194308,4,yA.bind(null,n,e),l)},useLayoutEffect:function(e,n){return $g(4194308,4,e,n)},useInsertionEffect:function(e,n){return $g(4,2,e,n)},useMemo:function(e,n){var l=Ds();return n=n===void 0?null:n,e=e(),l.memoizedState=[e,n],e},useReducer:function(e,n,l){var h=Ds();return n=l!==void 0?l(n):n,h.memoizedState=h.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},h.queue=e,e=e.dispatch=aD.bind(null,xr,e),[h.memoizedState,e]},useRef:function(e){var n=Ds();return e={current:e},n.memoizedState=e},useState:iT,useDebugValue:X1,useDeferredValue:function(e){return Ds().memoizedState=e},useTransition:function(){var e=iT(!1),n=e[0];return e=sD.bind(null,e[1]),Ds().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,l){var h=xr,m=Ds();if(lr){if(l===void 0)throw Error(dt(407));l=l()}else{if(l=n(),oi===null)throw Error(dt(349));Rc&30||uA(h,n,l)}m.memoizedState=l;var y={value:l,getSnapshot:n};return m.queue=y,oT(dA.bind(null,h,y,e),[e]),h.flags|=2048,xf(9,hA.bind(null,h,y,l,n),void 0,null),l},useId:function(){var e=Ds(),n=oi.identifierPrefix;if(lr){var l=fa,h=pa;l=(h&~(1<<32-vs(h)-1)).toString(32)+l,n=":"+n+"R"+l,l=yf++,0<l&&(n+="H"+l.toString(32)),n+=":"}else l=oD++,n=":"+n+"r"+l.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},uD={readContext:Go,useCallback:xA,useContext:Go,useEffect:H1,useImperativeHandle:vA,useInsertionEffect:gA,useLayoutEffect:_A,useMemo:wA,useReducer:Iv,useRef:mA,useState:function(){return Iv(vf)},useDebugValue:X1,useDeferredValue:function(e){var n=qo();return bA(n,Xr.memoizedState,e)},useTransition:function(){var e=Iv(vf)[0],n=qo().memoizedState;return[e,n]},useMutableSource:lA,useSyncExternalStore:cA,useId:EA,unstable_isNewReconciler:!1},hD={readContext:Go,useCallback:xA,useContext:Go,useEffect:H1,useImperativeHandle:vA,useInsertionEffect:gA,useLayoutEffect:_A,useMemo:wA,useReducer:kv,useRef:mA,useState:function(){return kv(vf)},useDebugValue:X1,useDeferredValue:function(e){var n=qo();return Xr===null?n.memoizedState=e:bA(n,Xr.memoizedState,e)},useTransition:function(){var e=kv(vf)[0],n=qo().memoizedState;return[e,n]},useMutableSource:lA,useSyncExternalStore:cA,useId:EA,unstable_isNewReconciler:!1};function Th(e,n){try{var l="",h=n;do l+=Nz(h),h=h.return;while(h);var m=l}catch(y){m=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:n,stack:m,digest:null}}function Pv(e,n,l){return{value:e,source:null,stack:l??null,digest:n??null}}function Px(e,n){try{console.error(n.value)}catch(l){setTimeout(function(){throw l})}}var dD=typeof WeakMap=="function"?WeakMap:Map;function AA(e,n,l){l=ma(-1,l),l.tag=3,l.payload={element:null};var h=n.value;return l.callback=function(){S_||(S_=!0,Ux=h),Px(e,n)},l}function MA(e,n,l){l=ma(-1,l),l.tag=3;var h=e.type.getDerivedStateFromError;if(typeof h=="function"){var m=n.value;l.payload=function(){return h(m)},l.callback=function(){Px(e,n)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(l.callback=function(){Px(e,n),typeof h!="function"&&(El===null?El=new Set([this]):El.add(this));var b=n.stack;this.componentDidCatch(n.value,{componentStack:b!==null?b:""})}),l}function sT(e,n,l){var h=e.pingCache;if(h===null){h=e.pingCache=new dD;var m=new Set;h.set(n,m)}else m=h.get(n),m===void 0&&(m=new Set,h.set(n,m));m.has(l)||(m.add(l),e=CD.bind(null,e,n,l),n.then(e,e))}function aT(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function lT(e,n,l,h,m){return e.mode&1?(e.flags|=65536,e.lanes=m,e):(e===n?e.flags|=65536:(e.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(n=ma(-1,1),n.tag=2,bl(l,n,1))),l.lanes|=1),e)}var pD=Ta.ReactCurrentOwner,Yi=!1;function Bi(e,n,l,h){n.child=e===null?sA(n,null,l,h):bh(n,e.child,l,h)}function cT(e,n,l,h,m){l=l.render;var y=n.ref;return ph(n,m),h=W1(e,n,l,h,y,m),l=Z1(),e!==null&&!Yi?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~m,ba(e,n,m)):(lr&&l&&D1(n),n.flags|=1,Bi(e,n,h,m),n.child)}function uT(e,n,l,h,m){if(e===null){var y=l.type;return typeof y=="function"&&!rw(y)&&y.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(n.tag=15,n.type=y,IA(e,n,y,h,m)):(e=Zg(l.type,null,h,n,n.mode,m),e.ref=n.ref,e.return=n,n.child=e)}if(y=e.child,!(e.lanes&m)){var b=y.memoizedProps;if(l=l.compare,l=l!==null?l:df,l(b,h)&&e.ref===n.ref)return ba(e,n,m)}return n.flags|=1,e=Sl(y,h),e.ref=n.ref,e.return=n,n.child=e}function IA(e,n,l,h,m){if(e!==null){var y=e.memoizedProps;if(df(y,h)&&e.ref===n.ref)if(Yi=!1,n.pendingProps=h=y,(e.lanes&m)!==0)e.flags&131072&&(Yi=!0);else return n.lanes=e.lanes,ba(e,n,m)}return zx(e,n,l,h,m)}function kA(e,n,l){var h=n.pendingProps,m=h.children,y=e!==null?e.memoizedState:null;if(h.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Jn(sh,uo),uo|=l;else{if(!(l&1073741824))return e=y!==null?y.baseLanes|l:l,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,Jn(sh,uo),uo|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:l,Jn(sh,uo),uo|=h}else y!==null?(h=y.baseLanes|l,n.memoizedState=null):h=l,Jn(sh,uo),uo|=h;return Bi(e,n,m,l),n.child}function PA(e,n){var l=n.ref;(e===null&&l!==null||e!==null&&e.ref!==l)&&(n.flags|=512,n.flags|=2097152)}function zx(e,n,l,h,m){var y=Qi(l)?Pc:Mi.current;return y=xh(n,y),ph(n,m),l=W1(e,n,l,h,y,m),h=Z1(),e!==null&&!Yi?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~m,ba(e,n,m)):(lr&&h&&D1(n),n.flags|=1,Bi(e,n,l,m),n.child)}function hT(e,n,l,h,m){if(Qi(l)){var y=!0;m_(n)}else y=!1;if(ph(n,m),n.stateNode===null)Gg(e,n),iA(n,l,h),kx(n,l,h,m),h=!0;else if(e===null){var b=n.stateNode,s=n.memoizedProps;b.props=s;var A=b.context,R=l.contextType;typeof R=="object"&&R!==null?R=Go(R):(R=Qi(l)?Pc:Mi.current,R=xh(n,R));var U=l.getDerivedStateFromProps,V=typeof U=="function"||typeof b.getSnapshotBeforeUpdate=="function";V||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(s!==h||A!==R)&&nT(n,b,h,R),hl=!1;var $=n.memoizedState;b.state=$,x_(n,h,b,m),A=n.memoizedState,s!==h||$!==A||Ji.current||hl?(typeof U=="function"&&(Ix(n,l,U,h),A=n.memoizedState),(s=hl||tT(n,l,s,h,$,A,R))?(V||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(n.flags|=4194308)):(typeof b.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=h,n.memoizedState=A),b.props=h,b.state=A,b.context=R,h=s):(typeof b.componentDidMount=="function"&&(n.flags|=4194308),h=!1)}else{b=n.stateNode,nA(e,n),s=n.memoizedProps,R=n.type===n.elementType?s:ms(n.type,s),b.props=R,V=n.pendingProps,$=b.context,A=l.contextType,typeof A=="object"&&A!==null?A=Go(A):(A=Qi(l)?Pc:Mi.current,A=xh(n,A));var pe=l.getDerivedStateFromProps;(U=typeof pe=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(s!==V||$!==A)&&nT(n,b,h,A),hl=!1,$=n.memoizedState,b.state=$,x_(n,h,b,m);var Y=n.memoizedState;s!==V||$!==Y||Ji.current||hl?(typeof pe=="function"&&(Ix(n,l,pe,h),Y=n.memoizedState),(R=hl||tT(n,l,R,h,$,Y,A)||!1)?(U||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(h,Y,A),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(h,Y,A)),typeof b.componentDidUpdate=="function"&&(n.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof b.componentDidUpdate!="function"||s===e.memoizedProps&&$===e.memoizedState||(n.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&$===e.memoizedState||(n.flags|=1024),n.memoizedProps=h,n.memoizedState=Y),b.props=h,b.state=Y,b.context=A,h=R):(typeof b.componentDidUpdate!="function"||s===e.memoizedProps&&$===e.memoizedState||(n.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&$===e.memoizedState||(n.flags|=1024),h=!1)}return Rx(e,n,l,h,y,m)}function Rx(e,n,l,h,m,y){PA(e,n);var b=(n.flags&128)!==0;if(!h&&!b)return m&&KE(n,l,!1),ba(e,n,y);h=n.stateNode,pD.current=n;var s=b&&typeof l.getDerivedStateFromError!="function"?null:h.render();return n.flags|=1,e!==null&&b?(n.child=bh(n,e.child,null,y),n.child=bh(n,null,s,y)):Bi(e,n,s,y),n.memoizedState=h.state,m&&KE(n,l,!0),n.child}function zA(e){var n=e.stateNode;n.pendingContext?XE(e,n.pendingContext,n.pendingContext!==n.context):n.context&&XE(e,n.context,!1),V1(e,n.containerInfo)}function dT(e,n,l,h,m){return wh(),O1(m),n.flags|=256,Bi(e,n,l,h),n.child}var Dx={dehydrated:null,treeContext:null,retryLane:0};function Lx(e){return{baseLanes:e,cachePool:null,transitions:null}}function RA(e,n,l){var h=n.pendingProps,m=vr.current,y=!1,b=(n.flags&128)!==0,s;if((s=b)||(s=e!==null&&e.memoizedState===null?!1:(m&2)!==0),s?(y=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(m|=1),Jn(vr,m&1),e===null)return Ax(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(b=h.children,e=h.fallback,y?(h=n.mode,y=n.child,b={mode:"hidden",children:b},!(h&1)&&y!==null?(y.childLanes=0,y.pendingProps=b):y=X_(b,h,0,null),e=kc(e,h,l,null),y.return=n,e.return=n,y.sibling=e,n.child=y,n.child.memoizedState=Lx(l),n.memoizedState=Dx,e):K1(n,b));if(m=e.memoizedState,m!==null&&(s=m.dehydrated,s!==null))return fD(e,n,b,h,s,m,l);if(y){y=h.fallback,b=n.mode,m=e.child,s=m.sibling;var A={mode:"hidden",children:h.children};return!(b&1)&&n.child!==m?(h=n.child,h.childLanes=0,h.pendingProps=A,n.deletions=null):(h=Sl(m,A),h.subtreeFlags=m.subtreeFlags&14680064),s!==null?y=Sl(s,y):(y=kc(y,b,l,null),y.flags|=2),y.return=n,h.return=n,h.sibling=y,n.child=h,h=y,y=n.child,b=e.child.memoizedState,b=b===null?Lx(l):{baseLanes:b.baseLanes|l,cachePool:null,transitions:b.transitions},y.memoizedState=b,y.childLanes=e.childLanes&~l,n.memoizedState=Dx,h}return y=e.child,e=y.sibling,h=Sl(y,{mode:"visible",children:h.children}),!(n.mode&1)&&(h.lanes=l),h.return=n,h.sibling=null,e!==null&&(l=n.deletions,l===null?(n.deletions=[e],n.flags|=16):l.push(e)),n.child=h,n.memoizedState=null,h}function K1(e,n){return n=X_({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function Sg(e,n,l,h){return h!==null&&O1(h),bh(n,e.child,null,l),e=K1(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function fD(e,n,l,h,m,y,b){if(l)return n.flags&256?(n.flags&=-257,h=Pv(Error(dt(422))),Sg(e,n,b,h)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(y=h.fallback,m=n.mode,h=X_({mode:"visible",children:h.children},m,0,null),y=kc(y,m,b,null),y.flags|=2,h.return=n,y.return=n,h.sibling=y,n.child=h,n.mode&1&&bh(n,e.child,null,b),n.child.memoizedState=Lx(b),n.memoizedState=Dx,y);if(!(n.mode&1))return Sg(e,n,b,null);if(m.data==="$!"){if(h=m.nextSibling&&m.nextSibling.dataset,h)var s=h.dgst;return h=s,y=Error(dt(419)),h=Pv(y,h,void 0),Sg(e,n,b,h)}if(s=(b&e.childLanes)!==0,Yi||s){if(h=oi,h!==null){switch(b&-b){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(h.suspendedLanes|b)?0:m,m!==0&&m!==y.retryLane&&(y.retryLane=m,wa(e,m),xs(h,e,m,-1))}return nw(),h=Pv(Error(dt(421))),Sg(e,n,b,h)}return m.data==="$?"?(n.flags|=128,n.child=e.child,n=AD.bind(null,e),m._reactRetry=n,null):(e=y.treeContext,po=wl(m.nextSibling),fo=n,lr=!0,ys=null,e!==null&&(No[jo++]=pa,No[jo++]=fa,No[jo++]=zc,pa=e.id,fa=e.overflow,zc=n),n=K1(n,h.children),n.flags|=4096,n)}function pT(e,n,l){e.lanes|=n;var h=e.alternate;h!==null&&(h.lanes|=n),Mx(e.return,n,l)}function zv(e,n,l,h,m){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:h,tail:l,tailMode:m}:(y.isBackwards=n,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=l,y.tailMode=m)}function DA(e,n,l){var h=n.pendingProps,m=h.revealOrder,y=h.tail;if(Bi(e,n,h.children,l),h=vr.current,h&2)h=h&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&pT(e,l,n);else if(e.tag===19)pT(e,l,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}h&=1}if(Jn(vr,h),!(n.mode&1))n.memoizedState=null;else switch(m){case"forwards":for(l=n.child,m=null;l!==null;)e=l.alternate,e!==null&&w_(e)===null&&(m=l),l=l.sibling;l=m,l===null?(m=n.child,n.child=null):(m=l.sibling,l.sibling=null),zv(n,!1,m,l,y);break;case"backwards":for(l=null,m=n.child,n.child=null;m!==null;){if(e=m.alternate,e!==null&&w_(e)===null){n.child=m;break}e=m.sibling,m.sibling=l,l=m,m=e}zv(n,!0,l,null,y);break;case"together":zv(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Gg(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function ba(e,n,l){if(e!==null&&(n.dependencies=e.dependencies),Dc|=n.lanes,!(l&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(dt(153));if(n.child!==null){for(e=n.child,l=Sl(e,e.pendingProps),n.child=l,l.return=n;e.sibling!==null;)e=e.sibling,l=l.sibling=Sl(e,e.pendingProps),l.return=n;l.sibling=null}return n.child}function mD(e,n,l){switch(n.tag){case 3:zA(n),wh();break;case 5:aA(n);break;case 1:Qi(n.type)&&m_(n);break;case 4:V1(n,n.stateNode.containerInfo);break;case 10:var h=n.type._context,m=n.memoizedProps.value;Jn(y_,h._currentValue),h._currentValue=m;break;case 13:if(h=n.memoizedState,h!==null)return h.dehydrated!==null?(Jn(vr,vr.current&1),n.flags|=128,null):l&n.child.childLanes?RA(e,n,l):(Jn(vr,vr.current&1),e=ba(e,n,l),e!==null?e.sibling:null);Jn(vr,vr.current&1);break;case 19:if(h=(l&n.childLanes)!==0,e.flags&128){if(h)return DA(e,n,l);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Jn(vr,vr.current),h)break;return null;case 22:case 23:return n.lanes=0,kA(e,n,l)}return ba(e,n,l)}var LA,Ox,OA,BA;LA=function(e,n){for(var l=n.child;l!==null;){if(l.tag===5||l.tag===6)e.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===n)break;for(;l.sibling===null;){if(l.return===null||l.return===n)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};Ox=function(){};OA=function(e,n,l,h){var m=e.memoizedProps;if(m!==h){e=n.stateNode,Sc(Us.current);var y=null;switch(l){case"input":m=ix(e,m),h=ix(e,h),y=[];break;case"select":m=wr({},m,{value:void 0}),h=wr({},h,{value:void 0}),y=[];break;case"textarea":m=ax(e,m),h=ax(e,h),y=[];break;default:typeof m.onClick!="function"&&typeof h.onClick=="function"&&(e.onclick=p_)}cx(l,h);var b;l=null;for(R in m)if(!h.hasOwnProperty(R)&&m.hasOwnProperty(R)&&m[R]!=null)if(R==="style"){var s=m[R];for(b in s)s.hasOwnProperty(b)&&(l||(l={}),l[b]="")}else R!=="dangerouslySetInnerHTML"&&R!=="children"&&R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&R!=="autoFocus"&&(of.hasOwnProperty(R)?y||(y=[]):(y=y||[]).push(R,null));for(R in h){var A=h[R];if(s=m!=null?m[R]:void 0,h.hasOwnProperty(R)&&A!==s&&(A!=null||s!=null))if(R==="style")if(s){for(b in s)!s.hasOwnProperty(b)||A&&A.hasOwnProperty(b)||(l||(l={}),l[b]="");for(b in A)A.hasOwnProperty(b)&&s[b]!==A[b]&&(l||(l={}),l[b]=A[b])}else l||(y||(y=[]),y.push(R,l)),l=A;else R==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,s=s?s.__html:void 0,A!=null&&s!==A&&(y=y||[]).push(R,A)):R==="children"?typeof A!="string"&&typeof A!="number"||(y=y||[]).push(R,""+A):R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&(of.hasOwnProperty(R)?(A!=null&&R==="onScroll"&&nr("scroll",e),y||s===A||(y=[])):(y=y||[]).push(R,A))}l&&(y=y||[]).push("style",l);var R=y;(n.updateQueue=R)&&(n.flags|=4)}};BA=function(e,n,l,h){l!==h&&(n.flags|=4)};function Cp(e,n){if(!lr)switch(e.tailMode){case"hidden":n=e.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:h.sibling=null}}function Si(e){var n=e.alternate!==null&&e.alternate.child===e.child,l=0,h=0;if(n)for(var m=e.child;m!==null;)l|=m.lanes|m.childLanes,h|=m.subtreeFlags&14680064,h|=m.flags&14680064,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)l|=m.lanes|m.childLanes,h|=m.subtreeFlags,h|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=h,e.childLanes=l,n}function gD(e,n,l){var h=n.pendingProps;switch(L1(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Si(n),null;case 1:return Qi(n.type)&&f_(),Si(n),null;case 3:return h=n.stateNode,Eh(),rr(Ji),rr(Mi),G1(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(e===null||e.child===null)&&(Eg(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,ys!==null&&(Gx(ys),ys=null))),Ox(e,n),Si(n),null;case 5:$1(n);var m=Sc(_f.current);if(l=n.type,e!==null&&n.stateNode!=null)OA(e,n,l,h,m),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!h){if(n.stateNode===null)throw Error(dt(166));return Si(n),null}if(e=Sc(Us.current),Eg(n)){h=n.stateNode,l=n.type;var y=n.memoizedProps;switch(h[Bs]=n,h[mf]=y,e=(n.mode&1)!==0,l){case"dialog":nr("cancel",h),nr("close",h);break;case"iframe":case"object":case"embed":nr("load",h);break;case"video":case"audio":for(m=0;m<Vp.length;m++)nr(Vp[m],h);break;case"source":nr("error",h);break;case"img":case"image":case"link":nr("error",h),nr("load",h);break;case"details":nr("toggle",h);break;case"input":bE(h,y),nr("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},nr("invalid",h);break;case"textarea":TE(h,y),nr("invalid",h)}cx(l,y),m=null;for(var b in y)if(y.hasOwnProperty(b)){var s=y[b];b==="children"?typeof s=="string"?h.textContent!==s&&(y.suppressHydrationWarning!==!0&&bg(h.textContent,s,e),m=["children",s]):typeof s=="number"&&h.textContent!==""+s&&(y.suppressHydrationWarning!==!0&&bg(h.textContent,s,e),m=["children",""+s]):of.hasOwnProperty(b)&&s!=null&&b==="onScroll"&&nr("scroll",h)}switch(l){case"input":fg(h),EE(h,y,!0);break;case"textarea":fg(h),SE(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=p_)}h=m,n.updateQueue=h,h!==null&&(n.flags|=4)}else{b=m.nodeType===9?m:m.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=uC(l)),e==="http://www.w3.org/1999/xhtml"?l==="script"?(e=b.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof h.is=="string"?e=b.createElement(l,{is:h.is}):(e=b.createElement(l),l==="select"&&(b=e,h.multiple?b.multiple=!0:h.size&&(b.size=h.size))):e=b.createElementNS(e,l),e[Bs]=n,e[mf]=h,LA(e,n,!1,!1),n.stateNode=e;e:{switch(b=ux(l,h),l){case"dialog":nr("cancel",e),nr("close",e),m=h;break;case"iframe":case"object":case"embed":nr("load",e),m=h;break;case"video":case"audio":for(m=0;m<Vp.length;m++)nr(Vp[m],e);m=h;break;case"source":nr("error",e),m=h;break;case"img":case"image":case"link":nr("error",e),nr("load",e),m=h;break;case"details":nr("toggle",e),m=h;break;case"input":bE(e,h),m=ix(e,h),nr("invalid",e);break;case"option":m=h;break;case"select":e._wrapperState={wasMultiple:!!h.multiple},m=wr({},h,{value:void 0}),nr("invalid",e);break;case"textarea":TE(e,h),m=ax(e,h),nr("invalid",e);break;default:m=h}cx(l,m),s=m;for(y in s)if(s.hasOwnProperty(y)){var A=s[y];y==="style"?pC(e,A):y==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&hC(e,A)):y==="children"?typeof A=="string"?(l!=="textarea"||A!=="")&&sf(e,A):typeof A=="number"&&sf(e,""+A):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(of.hasOwnProperty(y)?A!=null&&y==="onScroll"&&nr("scroll",e):A!=null&&x1(e,y,A,b))}switch(l){case"input":fg(e),EE(e,h,!1);break;case"textarea":fg(e),SE(e);break;case"option":h.value!=null&&e.setAttribute("value",""+Cl(h.value));break;case"select":e.multiple=!!h.multiple,y=h.value,y!=null?ch(e,!!h.multiple,y,!1):h.defaultValue!=null&&ch(e,!!h.multiple,h.defaultValue,!0);break;default:typeof m.onClick=="function"&&(e.onclick=p_)}switch(l){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Si(n),null;case 6:if(e&&n.stateNode!=null)BA(e,n,e.memoizedProps,h);else{if(typeof h!="string"&&n.stateNode===null)throw Error(dt(166));if(l=Sc(_f.current),Sc(Us.current),Eg(n)){if(h=n.stateNode,l=n.memoizedProps,h[Bs]=n,(y=h.nodeValue!==l)&&(e=fo,e!==null))switch(e.tag){case 3:bg(h.nodeValue,l,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&bg(h.nodeValue,l,(e.mode&1)!==0)}y&&(n.flags|=4)}else h=(l.nodeType===9?l:l.ownerDocument).createTextNode(h),h[Bs]=n,n.stateNode=h}return Si(n),null;case 13:if(rr(vr),h=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(lr&&po!==null&&n.mode&1&&!(n.flags&128))eA(),wh(),n.flags|=98560,y=!1;else if(y=Eg(n),h!==null&&h.dehydrated!==null){if(e===null){if(!y)throw Error(dt(318));if(y=n.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(dt(317));y[Bs]=n}else wh(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Si(n),y=!1}else ys!==null&&(Gx(ys),ys=null),y=!0;if(!y)return n.flags&65536?n:null}return n.flags&128?(n.lanes=l,n):(h=h!==null,h!==(e!==null&&e.memoizedState!==null)&&h&&(n.child.flags|=8192,n.mode&1&&(e===null||vr.current&1?Yr===0&&(Yr=3):nw())),n.updateQueue!==null&&(n.flags|=4),Si(n),null);case 4:return Eh(),Ox(e,n),e===null&&pf(n.stateNode.containerInfo),Si(n),null;case 10:return N1(n.type._context),Si(n),null;case 17:return Qi(n.type)&&f_(),Si(n),null;case 19:if(rr(vr),y=n.memoizedState,y===null)return Si(n),null;if(h=(n.flags&128)!==0,b=y.rendering,b===null)if(h)Cp(y,!1);else{if(Yr!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(b=w_(e),b!==null){for(n.flags|=128,Cp(y,!1),h=b.updateQueue,h!==null&&(n.updateQueue=h,n.flags|=4),n.subtreeFlags=0,h=l,l=n.child;l!==null;)y=l,e=h,y.flags&=14680066,b=y.alternate,b===null?(y.childLanes=0,y.lanes=e,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=b.childLanes,y.lanes=b.lanes,y.child=b.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=b.memoizedProps,y.memoizedState=b.memoizedState,y.updateQueue=b.updateQueue,y.type=b.type,e=b.dependencies,y.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),l=l.sibling;return Jn(vr,vr.current&1|2),n.child}e=e.sibling}y.tail!==null&&Pr()>Sh&&(n.flags|=128,h=!0,Cp(y,!1),n.lanes=4194304)}else{if(!h)if(e=w_(b),e!==null){if(n.flags|=128,h=!0,l=e.updateQueue,l!==null&&(n.updateQueue=l,n.flags|=4),Cp(y,!0),y.tail===null&&y.tailMode==="hidden"&&!b.alternate&&!lr)return Si(n),null}else 2*Pr()-y.renderingStartTime>Sh&&l!==1073741824&&(n.flags|=128,h=!0,Cp(y,!1),n.lanes=4194304);y.isBackwards?(b.sibling=n.child,n.child=b):(l=y.last,l!==null?l.sibling=b:n.child=b,y.last=b)}return y.tail!==null?(n=y.tail,y.rendering=n,y.tail=n.sibling,y.renderingStartTime=Pr(),n.sibling=null,l=vr.current,Jn(vr,h?l&1|2:l&1),n):(Si(n),null);case 22:case 23:return tw(),h=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==h&&(n.flags|=8192),h&&n.mode&1?uo&1073741824&&(Si(n),n.subtreeFlags&6&&(n.flags|=8192)):Si(n),null;case 24:return null;case 25:return null}throw Error(dt(156,n.tag))}function _D(e,n){switch(L1(n),n.tag){case 1:return Qi(n.type)&&f_(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Eh(),rr(Ji),rr(Mi),G1(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return $1(n),null;case 13:if(rr(vr),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(dt(340));wh()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return rr(vr),null;case 4:return Eh(),null;case 10:return N1(n.type._context),null;case 22:case 23:return tw(),null;case 24:return null;default:return null}}var Cg=!1,Ai=!1,yD=typeof WeakSet=="function"?WeakSet:Set,Mt=null;function oh(e,n){var l=e.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(h){Sr(e,n,h)}else l.current=null}function Bx(e,n,l){try{l()}catch(h){Sr(e,n,h)}}var fT=!1;function vD(e,n){if(xx=u_,e=UC(),R1(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var h=l.getSelection&&l.getSelection();if(h&&h.rangeCount!==0){l=h.anchorNode;var m=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{l.nodeType,y.nodeType}catch{l=null;break e}var b=0,s=-1,A=-1,R=0,U=0,V=e,$=null;t:for(;;){for(var pe;V!==l||m!==0&&V.nodeType!==3||(s=b+m),V!==y||h!==0&&V.nodeType!==3||(A=b+h),V.nodeType===3&&(b+=V.nodeValue.length),(pe=V.firstChild)!==null;)$=V,V=pe;for(;;){if(V===e)break t;if($===l&&++R===m&&(s=b),$===y&&++U===h&&(A=b),(pe=V.nextSibling)!==null)break;V=$,$=V.parentNode}V=pe}l=s===-1||A===-1?null:{start:s,end:A}}else l=null}l=l||{start:0,end:0}}else l=null;for(wx={focusedElem:e,selectionRange:l},u_=!1,Mt=n;Mt!==null;)if(n=Mt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Mt=e;else for(;Mt!==null;){n=Mt;try{var Y=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var K=Y.memoizedProps,Ce=Y.memoizedState,ee=n.stateNode,ne=ee.getSnapshotBeforeUpdate(n.elementType===n.type?K:ms(n.type,K),Ce);ee.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var ce=n.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(dt(163))}}catch(se){Sr(n,n.return,se)}if(e=n.sibling,e!==null){e.return=n.return,Mt=e;break}Mt=n.return}return Y=fT,fT=!1,Y}function Yp(e,n,l){var h=n.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var m=h=h.next;do{if((m.tag&e)===e){var y=m.destroy;m.destroy=void 0,y!==void 0&&Bx(n,l,y)}m=m.next}while(m!==h)}}function Z_(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var l=n=n.next;do{if((l.tag&e)===e){var h=l.create;l.destroy=h()}l=l.next}while(l!==n)}}function Fx(e){var n=e.ref;if(n!==null){var l=e.stateNode;switch(e.tag){case 5:e=l;break;default:e=l}typeof n=="function"?n(e):n.current=e}}function FA(e){var n=e.alternate;n!==null&&(e.alternate=null,FA(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Bs],delete n[mf],delete n[Tx],delete n[tD],delete n[nD])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function NA(e){return e.tag===5||e.tag===3||e.tag===4}function mT(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||NA(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Nx(e,n,l){var h=e.tag;if(h===5||h===6)e=e.stateNode,n?l.nodeType===8?l.parentNode.insertBefore(e,n):l.insertBefore(e,n):(l.nodeType===8?(n=l.parentNode,n.insertBefore(e,l)):(n=l,n.appendChild(e)),l=l._reactRootContainer,l!=null||n.onclick!==null||(n.onclick=p_));else if(h!==4&&(e=e.child,e!==null))for(Nx(e,n,l),e=e.sibling;e!==null;)Nx(e,n,l),e=e.sibling}function jx(e,n,l){var h=e.tag;if(h===5||h===6)e=e.stateNode,n?l.insertBefore(e,n):l.appendChild(e);else if(h!==4&&(e=e.child,e!==null))for(jx(e,n,l),e=e.sibling;e!==null;)jx(e,n,l),e=e.sibling}var ci=null,gs=!1;function al(e,n,l){for(l=l.child;l!==null;)jA(e,n,l),l=l.sibling}function jA(e,n,l){if(js&&typeof js.onCommitFiberUnmount=="function")try{js.onCommitFiberUnmount(N_,l)}catch{}switch(l.tag){case 5:Ai||oh(l,n);case 6:var h=ci,m=gs;ci=null,al(e,n,l),ci=h,gs=m,ci!==null&&(gs?(e=ci,l=l.stateNode,e.nodeType===8?e.parentNode.removeChild(l):e.removeChild(l)):ci.removeChild(l.stateNode));break;case 18:ci!==null&&(gs?(e=ci,l=l.stateNode,e.nodeType===8?Sv(e.parentNode,l):e.nodeType===1&&Sv(e,l),uf(e)):Sv(ci,l.stateNode));break;case 4:h=ci,m=gs,ci=l.stateNode.containerInfo,gs=!0,al(e,n,l),ci=h,gs=m;break;case 0:case 11:case 14:case 15:if(!Ai&&(h=l.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){m=h=h.next;do{var y=m,b=y.destroy;y=y.tag,b!==void 0&&(y&2||y&4)&&Bx(l,n,b),m=m.next}while(m!==h)}al(e,n,l);break;case 1:if(!Ai&&(oh(l,n),h=l.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=l.memoizedProps,h.state=l.memoizedState,h.componentWillUnmount()}catch(s){Sr(l,n,s)}al(e,n,l);break;case 21:al(e,n,l);break;case 22:l.mode&1?(Ai=(h=Ai)||l.memoizedState!==null,al(e,n,l),Ai=h):al(e,n,l);break;default:al(e,n,l)}}function gT(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var l=e.stateNode;l===null&&(l=e.stateNode=new yD),n.forEach(function(h){var m=MD.bind(null,e,h);l.has(h)||(l.add(h),h.then(m,m))})}}function fs(e,n){var l=n.deletions;if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];try{var y=e,b=n,s=b;e:for(;s!==null;){switch(s.tag){case 5:ci=s.stateNode,gs=!1;break e;case 3:ci=s.stateNode.containerInfo,gs=!0;break e;case 4:ci=s.stateNode.containerInfo,gs=!0;break e}s=s.return}if(ci===null)throw Error(dt(160));jA(y,b,m),ci=null,gs=!1;var A=m.alternate;A!==null&&(A.return=null),m.return=null}catch(R){Sr(m,n,R)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)UA(n,e),n=n.sibling}function UA(e,n){var l=e.alternate,h=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fs(n,e),Rs(e),h&4){try{Yp(3,e,e.return),Z_(3,e)}catch(K){Sr(e,e.return,K)}try{Yp(5,e,e.return)}catch(K){Sr(e,e.return,K)}}break;case 1:fs(n,e),Rs(e),h&512&&l!==null&&oh(l,l.return);break;case 5:if(fs(n,e),Rs(e),h&512&&l!==null&&oh(l,l.return),e.flags&32){var m=e.stateNode;try{sf(m,"")}catch(K){Sr(e,e.return,K)}}if(h&4&&(m=e.stateNode,m!=null)){var y=e.memoizedProps,b=l!==null?l.memoizedProps:y,s=e.type,A=e.updateQueue;if(e.updateQueue=null,A!==null)try{s==="input"&&y.type==="radio"&&y.name!=null&&lC(m,y),ux(s,b);var R=ux(s,y);for(b=0;b<A.length;b+=2){var U=A[b],V=A[b+1];U==="style"?pC(m,V):U==="dangerouslySetInnerHTML"?hC(m,V):U==="children"?sf(m,V):x1(m,U,V,R)}switch(s){case"input":ox(m,y);break;case"textarea":cC(m,y);break;case"select":var $=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!y.multiple;var pe=y.value;pe!=null?ch(m,!!y.multiple,pe,!1):$!==!!y.multiple&&(y.defaultValue!=null?ch(m,!!y.multiple,y.defaultValue,!0):ch(m,!!y.multiple,y.multiple?[]:"",!1))}m[mf]=y}catch(K){Sr(e,e.return,K)}}break;case 6:if(fs(n,e),Rs(e),h&4){if(e.stateNode===null)throw Error(dt(162));m=e.stateNode,y=e.memoizedProps;try{m.nodeValue=y}catch(K){Sr(e,e.return,K)}}break;case 3:if(fs(n,e),Rs(e),h&4&&l!==null&&l.memoizedState.isDehydrated)try{uf(n.containerInfo)}catch(K){Sr(e,e.return,K)}break;case 4:fs(n,e),Rs(e);break;case 13:fs(n,e),Rs(e),m=e.child,m.flags&8192&&(y=m.memoizedState!==null,m.stateNode.isHidden=y,!y||m.alternate!==null&&m.alternate.memoizedState!==null||(Q1=Pr())),h&4&&gT(e);break;case 22:if(U=l!==null&&l.memoizedState!==null,e.mode&1?(Ai=(R=Ai)||U,fs(n,e),Ai=R):fs(n,e),Rs(e),h&8192){if(R=e.memoizedState!==null,(e.stateNode.isHidden=R)&&!U&&e.mode&1)for(Mt=e,U=e.child;U!==null;){for(V=Mt=U;Mt!==null;){switch($=Mt,pe=$.child,$.tag){case 0:case 11:case 14:case 15:Yp(4,$,$.return);break;case 1:oh($,$.return);var Y=$.stateNode;if(typeof Y.componentWillUnmount=="function"){h=$,l=$.return;try{n=h,Y.props=n.memoizedProps,Y.state=n.memoizedState,Y.componentWillUnmount()}catch(K){Sr(h,l,K)}}break;case 5:oh($,$.return);break;case 22:if($.memoizedState!==null){yT(V);continue}}pe!==null?(pe.return=$,Mt=pe):yT(V)}U=U.sibling}e:for(U=null,V=e;;){if(V.tag===5){if(U===null){U=V;try{m=V.stateNode,R?(y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(s=V.stateNode,A=V.memoizedProps.style,b=A!=null&&A.hasOwnProperty("display")?A.display:null,s.style.display=dC("display",b))}catch(K){Sr(e,e.return,K)}}}else if(V.tag===6){if(U===null)try{V.stateNode.nodeValue=R?"":V.memoizedProps}catch(K){Sr(e,e.return,K)}}else if((V.tag!==22&&V.tag!==23||V.memoizedState===null||V===e)&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===e)break e;for(;V.sibling===null;){if(V.return===null||V.return===e)break e;U===V&&(U=null),V=V.return}U===V&&(U=null),V.sibling.return=V.return,V=V.sibling}}break;case 19:fs(n,e),Rs(e),h&4&&gT(e);break;case 21:break;default:fs(n,e),Rs(e)}}function Rs(e){var n=e.flags;if(n&2){try{e:{for(var l=e.return;l!==null;){if(NA(l)){var h=l;break e}l=l.return}throw Error(dt(160))}switch(h.tag){case 5:var m=h.stateNode;h.flags&32&&(sf(m,""),h.flags&=-33);var y=mT(e);jx(e,y,m);break;case 3:case 4:var b=h.stateNode.containerInfo,s=mT(e);Nx(e,s,b);break;default:throw Error(dt(161))}}catch(A){Sr(e,e.return,A)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function xD(e,n,l){Mt=e,VA(e)}function VA(e,n,l){for(var h=(e.mode&1)!==0;Mt!==null;){var m=Mt,y=m.child;if(m.tag===22&&h){var b=m.memoizedState!==null||Cg;if(!b){var s=m.alternate,A=s!==null&&s.memoizedState!==null||Ai;s=Cg;var R=Ai;if(Cg=b,(Ai=A)&&!R)for(Mt=m;Mt!==null;)b=Mt,A=b.child,b.tag===22&&b.memoizedState!==null?vT(m):A!==null?(A.return=b,Mt=A):vT(m);for(;y!==null;)Mt=y,VA(y),y=y.sibling;Mt=m,Cg=s,Ai=R}_T(e)}else m.subtreeFlags&8772&&y!==null?(y.return=m,Mt=y):_T(e)}}function _T(e){for(;Mt!==null;){var n=Mt;if(n.flags&8772){var l=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:Ai||Z_(5,n);break;case 1:var h=n.stateNode;if(n.flags&4&&!Ai)if(l===null)h.componentDidMount();else{var m=n.elementType===n.type?l.memoizedProps:ms(n.type,l.memoizedProps);h.componentDidUpdate(m,l.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=n.updateQueue;y!==null&&eT(n,y,h);break;case 3:var b=n.updateQueue;if(b!==null){if(l=null,n.child!==null)switch(n.child.tag){case 5:l=n.child.stateNode;break;case 1:l=n.child.stateNode}eT(n,b,l)}break;case 5:var s=n.stateNode;if(l===null&&n.flags&4){l=s;var A=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&l.focus();break;case"img":A.src&&(l.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var R=n.alternate;if(R!==null){var U=R.memoizedState;if(U!==null){var V=U.dehydrated;V!==null&&uf(V)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(dt(163))}Ai||n.flags&512&&Fx(n)}catch($){Sr(n,n.return,$)}}if(n===e){Mt=null;break}if(l=n.sibling,l!==null){l.return=n.return,Mt=l;break}Mt=n.return}}function yT(e){for(;Mt!==null;){var n=Mt;if(n===e){Mt=null;break}var l=n.sibling;if(l!==null){l.return=n.return,Mt=l;break}Mt=n.return}}function vT(e){for(;Mt!==null;){var n=Mt;try{switch(n.tag){case 0:case 11:case 15:var l=n.return;try{Z_(4,n)}catch(A){Sr(n,l,A)}break;case 1:var h=n.stateNode;if(typeof h.componentDidMount=="function"){var m=n.return;try{h.componentDidMount()}catch(A){Sr(n,m,A)}}var y=n.return;try{Fx(n)}catch(A){Sr(n,y,A)}break;case 5:var b=n.return;try{Fx(n)}catch(A){Sr(n,b,A)}}}catch(A){Sr(n,n.return,A)}if(n===e){Mt=null;break}var s=n.sibling;if(s!==null){s.return=n.return,Mt=s;break}Mt=n.return}}var wD=Math.ceil,T_=Ta.ReactCurrentDispatcher,Y1=Ta.ReactCurrentOwner,Vo=Ta.ReactCurrentBatchConfig,bn=0,oi=null,$r=null,hi=0,uo=0,sh=Il(0),Yr=0,wf=null,Dc=0,H_=0,J1=0,Jp=null,Ki=null,Q1=0,Sh=1/0,ua=null,S_=!1,Ux=null,El=null,Ag=!1,ml=null,C_=0,Qp=0,Vx=null,qg=-1,Wg=0;function Fi(){return bn&6?Pr():qg!==-1?qg:qg=Pr()}function Tl(e){return e.mode&1?bn&2&&hi!==0?hi&-hi:iD.transition!==null?(Wg===0&&(Wg=SC()),Wg):(e=Wn,e!==0||(e=window.event,e=e===void 0?16:zC(e.type)),e):1}function xs(e,n,l,h){if(50<Qp)throw Qp=0,Vx=null,Error(dt(185));kf(e,l,h),(!(bn&2)||e!==oi)&&(e===oi&&(!(bn&2)&&(H_|=l),Yr===4&&pl(e,hi)),eo(e,h),l===1&&bn===0&&!(n.mode&1)&&(Sh=Pr()+500,G_&&kl()))}function eo(e,n){var l=e.callbackNode;iR(e,n);var h=c_(e,e===oi?hi:0);if(h===0)l!==null&&ME(l),e.callbackNode=null,e.callbackPriority=0;else if(n=h&-h,e.callbackPriority!==n){if(l!=null&&ME(l),n===1)e.tag===0?rD(xT.bind(null,e)):YC(xT.bind(null,e)),QR(function(){!(bn&6)&&kl()}),l=null;else{switch(CC(h)){case 1:l=S1;break;case 4:l=EC;break;case 16:l=l_;break;case 536870912:l=TC;break;default:l=l_}l=KA(l,$A.bind(null,e))}e.callbackPriority=n,e.callbackNode=l}}function $A(e,n){if(qg=-1,Wg=0,bn&6)throw Error(dt(327));var l=e.callbackNode;if(fh()&&e.callbackNode!==l)return null;var h=c_(e,e===oi?hi:0);if(h===0)return null;if(h&30||h&e.expiredLanes||n)n=A_(e,h);else{n=h;var m=bn;bn|=2;var y=qA();(oi!==e||hi!==n)&&(ua=null,Sh=Pr()+500,Ic(e,n));do try{TD();break}catch(s){GA(e,s)}while(1);F1(),T_.current=y,bn=m,$r!==null?n=0:(oi=null,hi=0,n=Yr)}if(n!==0){if(n===2&&(m=mx(e),m!==0&&(h=m,n=$x(e,m))),n===1)throw l=wf,Ic(e,0),pl(e,h),eo(e,Pr()),l;if(n===6)pl(e,h);else{if(m=e.current.alternate,!(h&30)&&!bD(m)&&(n=A_(e,h),n===2&&(y=mx(e),y!==0&&(h=y,n=$x(e,y))),n===1))throw l=wf,Ic(e,0),pl(e,h),eo(e,Pr()),l;switch(e.finishedWork=m,e.finishedLanes=h,n){case 0:case 1:throw Error(dt(345));case 2:xc(e,Ki,ua);break;case 3:if(pl(e,h),(h&130023424)===h&&(n=Q1+500-Pr(),10<n)){if(c_(e,0)!==0)break;if(m=e.suspendedLanes,(m&h)!==h){Fi(),e.pingedLanes|=e.suspendedLanes&m;break}e.timeoutHandle=Ex(xc.bind(null,e,Ki,ua),n);break}xc(e,Ki,ua);break;case 4:if(pl(e,h),(h&4194240)===h)break;for(n=e.eventTimes,m=-1;0<h;){var b=31-vs(h);y=1<<b,b=n[b],b>m&&(m=b),h&=~y}if(h=m,h=Pr()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*wD(h/1960))-h,10<h){e.timeoutHandle=Ex(xc.bind(null,e,Ki,ua),h);break}xc(e,Ki,ua);break;case 5:xc(e,Ki,ua);break;default:throw Error(dt(329))}}}return eo(e,Pr()),e.callbackNode===l?$A.bind(null,e):null}function $x(e,n){var l=Jp;return e.current.memoizedState.isDehydrated&&(Ic(e,n).flags|=256),e=A_(e,n),e!==2&&(n=Ki,Ki=l,n!==null&&Gx(n)),e}function Gx(e){Ki===null?Ki=e:Ki.push.apply(Ki,e)}function bD(e){for(var n=e;;){if(n.flags&16384){var l=n.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var h=0;h<l.length;h++){var m=l[h],y=m.getSnapshot;m=m.value;try{if(!ws(y(),m))return!1}catch{return!1}}}if(l=n.child,n.subtreeFlags&16384&&l!==null)l.return=n,n=l;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function pl(e,n){for(n&=~J1,n&=~H_,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var l=31-vs(n),h=1<<l;e[l]=-1,n&=~h}}function xT(e){if(bn&6)throw Error(dt(327));fh();var n=c_(e,0);if(!(n&1))return eo(e,Pr()),null;var l=A_(e,n);if(e.tag!==0&&l===2){var h=mx(e);h!==0&&(n=h,l=$x(e,h))}if(l===1)throw l=wf,Ic(e,0),pl(e,n),eo(e,Pr()),l;if(l===6)throw Error(dt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,xc(e,Ki,ua),eo(e,Pr()),null}function ew(e,n){var l=bn;bn|=1;try{return e(n)}finally{bn=l,bn===0&&(Sh=Pr()+500,G_&&kl())}}function Lc(e){ml!==null&&ml.tag===0&&!(bn&6)&&fh();var n=bn;bn|=1;var l=Vo.transition,h=Wn;try{if(Vo.transition=null,Wn=1,e)return e()}finally{Wn=h,Vo.transition=l,bn=n,!(bn&6)&&kl()}}function tw(){uo=sh.current,rr(sh)}function Ic(e,n){e.finishedWork=null,e.finishedLanes=0;var l=e.timeoutHandle;if(l!==-1&&(e.timeoutHandle=-1,JR(l)),$r!==null)for(l=$r.return;l!==null;){var h=l;switch(L1(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&f_();break;case 3:Eh(),rr(Ji),rr(Mi),G1();break;case 5:$1(h);break;case 4:Eh();break;case 13:rr(vr);break;case 19:rr(vr);break;case 10:N1(h.type._context);break;case 22:case 23:tw()}l=l.return}if(oi=e,$r=e=Sl(e.current,null),hi=uo=n,Yr=0,wf=null,J1=H_=Dc=0,Ki=Jp=null,Tc!==null){for(n=0;n<Tc.length;n++)if(l=Tc[n],h=l.interleaved,h!==null){l.interleaved=null;var m=h.next,y=l.pending;if(y!==null){var b=y.next;y.next=m,h.next=b}l.pending=h}Tc=null}return e}function GA(e,n){do{var l=$r;try{if(F1(),Vg.current=E_,b_){for(var h=xr.memoizedState;h!==null;){var m=h.queue;m!==null&&(m.pending=null),h=h.next}b_=!1}if(Rc=0,ii=Xr=xr=null,Kp=!1,yf=0,Y1.current=null,l===null||l.return===null){Yr=1,wf=n,$r=null;break}e:{var y=e,b=l.return,s=l,A=n;if(n=hi,s.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var R=A,U=s,V=U.tag;if(!(U.mode&1)&&(V===0||V===11||V===15)){var $=U.alternate;$?(U.updateQueue=$.updateQueue,U.memoizedState=$.memoizedState,U.lanes=$.lanes):(U.updateQueue=null,U.memoizedState=null)}var pe=aT(b);if(pe!==null){pe.flags&=-257,lT(pe,b,s,y,n),pe.mode&1&&sT(y,R,n),n=pe,A=R;var Y=n.updateQueue;if(Y===null){var K=new Set;K.add(A),n.updateQueue=K}else Y.add(A);break e}else{if(!(n&1)){sT(y,R,n),nw();break e}A=Error(dt(426))}}else if(lr&&s.mode&1){var Ce=aT(b);if(Ce!==null){!(Ce.flags&65536)&&(Ce.flags|=256),lT(Ce,b,s,y,n),O1(Th(A,s));break e}}y=A=Th(A,s),Yr!==4&&(Yr=2),Jp===null?Jp=[y]:Jp.push(y),y=b;do{switch(y.tag){case 3:y.flags|=65536,n&=-n,y.lanes|=n;var ee=AA(y,A,n);QE(y,ee);break e;case 1:s=A;var ne=y.type,ce=y.stateNode;if(!(y.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(El===null||!El.has(ce)))){y.flags|=65536,n&=-n,y.lanes|=n;var se=MA(y,s,n);QE(y,se);break e}}y=y.return}while(y!==null)}ZA(l)}catch(De){n=De,$r===l&&l!==null&&($r=l=l.return);continue}break}while(1)}function qA(){var e=T_.current;return T_.current=E_,e===null?E_:e}function nw(){(Yr===0||Yr===3||Yr===2)&&(Yr=4),oi===null||!(Dc&268435455)&&!(H_&268435455)||pl(oi,hi)}function A_(e,n){var l=bn;bn|=2;var h=qA();(oi!==e||hi!==n)&&(ua=null,Ic(e,n));do try{ED();break}catch(m){GA(e,m)}while(1);if(F1(),bn=l,T_.current=h,$r!==null)throw Error(dt(261));return oi=null,hi=0,Yr}function ED(){for(;$r!==null;)WA($r)}function TD(){for(;$r!==null&&!Xz();)WA($r)}function WA(e){var n=XA(e.alternate,e,uo);e.memoizedProps=e.pendingProps,n===null?ZA(e):$r=n,Y1.current=null}function ZA(e){var n=e;do{var l=n.alternate;if(e=n.return,n.flags&32768){if(l=_D(l,n),l!==null){l.flags&=32767,$r=l;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Yr=6,$r=null;return}}else if(l=gD(l,n,uo),l!==null){$r=l;return}if(n=n.sibling,n!==null){$r=n;return}$r=n=e}while(n!==null);Yr===0&&(Yr=5)}function xc(e,n,l){var h=Wn,m=Vo.transition;try{Vo.transition=null,Wn=1,SD(e,n,l,h)}finally{Vo.transition=m,Wn=h}return null}function SD(e,n,l,h){do fh();while(ml!==null);if(bn&6)throw Error(dt(327));l=e.finishedWork;var m=e.finishedLanes;if(l===null)return null;if(e.finishedWork=null,e.finishedLanes=0,l===e.current)throw Error(dt(177));e.callbackNode=null,e.callbackPriority=0;var y=l.lanes|l.childLanes;if(oR(e,y),e===oi&&($r=oi=null,hi=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Ag||(Ag=!0,KA(l_,function(){return fh(),null})),y=(l.flags&15990)!==0,l.subtreeFlags&15990||y){y=Vo.transition,Vo.transition=null;var b=Wn;Wn=1;var s=bn;bn|=4,Y1.current=null,vD(e,l),UA(l,e),qR(wx),u_=!!xx,wx=xx=null,e.current=l,xD(l),Kz(),bn=s,Wn=b,Vo.transition=y}else e.current=l;if(Ag&&(Ag=!1,ml=e,C_=m),y=e.pendingLanes,y===0&&(El=null),Qz(l.stateNode),eo(e,Pr()),n!==null)for(h=e.onRecoverableError,l=0;l<n.length;l++)m=n[l],h(m.value,{componentStack:m.stack,digest:m.digest});if(S_)throw S_=!1,e=Ux,Ux=null,e;return C_&1&&e.tag!==0&&fh(),y=e.pendingLanes,y&1?e===Vx?Qp++:(Qp=0,Vx=e):Qp=0,kl(),null}function fh(){if(ml!==null){var e=CC(C_),n=Vo.transition,l=Wn;try{if(Vo.transition=null,Wn=16>e?16:e,ml===null)var h=!1;else{if(e=ml,ml=null,C_=0,bn&6)throw Error(dt(331));var m=bn;for(bn|=4,Mt=e.current;Mt!==null;){var y=Mt,b=y.child;if(Mt.flags&16){var s=y.deletions;if(s!==null){for(var A=0;A<s.length;A++){var R=s[A];for(Mt=R;Mt!==null;){var U=Mt;switch(U.tag){case 0:case 11:case 15:Yp(8,U,y)}var V=U.child;if(V!==null)V.return=U,Mt=V;else for(;Mt!==null;){U=Mt;var $=U.sibling,pe=U.return;if(FA(U),U===R){Mt=null;break}if($!==null){$.return=pe,Mt=$;break}Mt=pe}}}var Y=y.alternate;if(Y!==null){var K=Y.child;if(K!==null){Y.child=null;do{var Ce=K.sibling;K.sibling=null,K=Ce}while(K!==null)}}Mt=y}}if(y.subtreeFlags&2064&&b!==null)b.return=y,Mt=b;else e:for(;Mt!==null;){if(y=Mt,y.flags&2048)switch(y.tag){case 0:case 11:case 15:Yp(9,y,y.return)}var ee=y.sibling;if(ee!==null){ee.return=y.return,Mt=ee;break e}Mt=y.return}}var ne=e.current;for(Mt=ne;Mt!==null;){b=Mt;var ce=b.child;if(b.subtreeFlags&2064&&ce!==null)ce.return=b,Mt=ce;else e:for(b=ne;Mt!==null;){if(s=Mt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Z_(9,s)}}catch(De){Sr(s,s.return,De)}if(s===b){Mt=null;break e}var se=s.sibling;if(se!==null){se.return=s.return,Mt=se;break e}Mt=s.return}}if(bn=m,kl(),js&&typeof js.onPostCommitFiberRoot=="function")try{js.onPostCommitFiberRoot(N_,e)}catch{}h=!0}return h}finally{Wn=l,Vo.transition=n}}return!1}function wT(e,n,l){n=Th(l,n),n=AA(e,n,1),e=bl(e,n,1),n=Fi(),e!==null&&(kf(e,1,n),eo(e,n))}function Sr(e,n,l){if(e.tag===3)wT(e,e,l);else for(;n!==null;){if(n.tag===3){wT(n,e,l);break}else if(n.tag===1){var h=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(El===null||!El.has(h))){e=Th(l,e),e=MA(n,e,1),n=bl(n,e,1),e=Fi(),n!==null&&(kf(n,1,e),eo(n,e));break}}n=n.return}}function CD(e,n,l){var h=e.pingCache;h!==null&&h.delete(n),n=Fi(),e.pingedLanes|=e.suspendedLanes&l,oi===e&&(hi&l)===l&&(Yr===4||Yr===3&&(hi&130023424)===hi&&500>Pr()-Q1?Ic(e,0):J1|=l),eo(e,n)}function HA(e,n){n===0&&(e.mode&1?(n=_g,_g<<=1,!(_g&130023424)&&(_g=4194304)):n=1);var l=Fi();e=wa(e,n),e!==null&&(kf(e,n,l),eo(e,l))}function AD(e){var n=e.memoizedState,l=0;n!==null&&(l=n.retryLane),HA(e,l)}function MD(e,n){var l=0;switch(e.tag){case 13:var h=e.stateNode,m=e.memoizedState;m!==null&&(l=m.retryLane);break;case 19:h=e.stateNode;break;default:throw Error(dt(314))}h!==null&&h.delete(n),HA(e,l)}var XA;XA=function(e,n,l){if(e!==null)if(e.memoizedProps!==n.pendingProps||Ji.current)Yi=!0;else{if(!(e.lanes&l)&&!(n.flags&128))return Yi=!1,mD(e,n,l);Yi=!!(e.flags&131072)}else Yi=!1,lr&&n.flags&1048576&&JC(n,__,n.index);switch(n.lanes=0,n.tag){case 2:var h=n.type;Gg(e,n),e=n.pendingProps;var m=xh(n,Mi.current);ph(n,l),m=W1(null,n,h,e,m,l);var y=Z1();return n.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Qi(h)?(y=!0,m_(n)):y=!1,n.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,U1(n),m.updater=q_,n.stateNode=m,m._reactInternals=n,kx(n,h,e,l),n=Rx(null,n,h,!0,y,l)):(n.tag=0,lr&&y&&D1(n),Bi(null,n,m,l),n=n.child),n;case 16:h=n.elementType;e:{switch(Gg(e,n),e=n.pendingProps,m=h._init,h=m(h._payload),n.type=h,m=n.tag=kD(h),e=ms(h,e),m){case 0:n=zx(null,n,h,e,l);break e;case 1:n=hT(null,n,h,e,l);break e;case 11:n=cT(null,n,h,e,l);break e;case 14:n=uT(null,n,h,ms(h.type,e),l);break e}throw Error(dt(306,h,""))}return n;case 0:return h=n.type,m=n.pendingProps,m=n.elementType===h?m:ms(h,m),zx(e,n,h,m,l);case 1:return h=n.type,m=n.pendingProps,m=n.elementType===h?m:ms(h,m),hT(e,n,h,m,l);case 3:e:{if(zA(n),e===null)throw Error(dt(387));h=n.pendingProps,y=n.memoizedState,m=y.element,nA(e,n),x_(n,h,null,l);var b=n.memoizedState;if(h=b.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},n.updateQueue.baseState=y,n.memoizedState=y,n.flags&256){m=Th(Error(dt(423)),n),n=dT(e,n,h,l,m);break e}else if(h!==m){m=Th(Error(dt(424)),n),n=dT(e,n,h,l,m);break e}else for(po=wl(n.stateNode.containerInfo.firstChild),fo=n,lr=!0,ys=null,l=sA(n,null,h,l),n.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(wh(),h===m){n=ba(e,n,l);break e}Bi(e,n,h,l)}n=n.child}return n;case 5:return aA(n),e===null&&Ax(n),h=n.type,m=n.pendingProps,y=e!==null?e.memoizedProps:null,b=m.children,bx(h,m)?b=null:y!==null&&bx(h,y)&&(n.flags|=32),PA(e,n),Bi(e,n,b,l),n.child;case 6:return e===null&&Ax(n),null;case 13:return RA(e,n,l);case 4:return V1(n,n.stateNode.containerInfo),h=n.pendingProps,e===null?n.child=bh(n,null,h,l):Bi(e,n,h,l),n.child;case 11:return h=n.type,m=n.pendingProps,m=n.elementType===h?m:ms(h,m),cT(e,n,h,m,l);case 7:return Bi(e,n,n.pendingProps,l),n.child;case 8:return Bi(e,n,n.pendingProps.children,l),n.child;case 12:return Bi(e,n,n.pendingProps.children,l),n.child;case 10:e:{if(h=n.type._context,m=n.pendingProps,y=n.memoizedProps,b=m.value,Jn(y_,h._currentValue),h._currentValue=b,y!==null)if(ws(y.value,b)){if(y.children===m.children&&!Ji.current){n=ba(e,n,l);break e}}else for(y=n.child,y!==null&&(y.return=n);y!==null;){var s=y.dependencies;if(s!==null){b=y.child;for(var A=s.firstContext;A!==null;){if(A.context===h){if(y.tag===1){A=ma(-1,l&-l),A.tag=2;var R=y.updateQueue;if(R!==null){R=R.shared;var U=R.pending;U===null?A.next=A:(A.next=U.next,U.next=A),R.pending=A}}y.lanes|=l,A=y.alternate,A!==null&&(A.lanes|=l),Mx(y.return,l,n),s.lanes|=l;break}A=A.next}}else if(y.tag===10)b=y.type===n.type?null:y.child;else if(y.tag===18){if(b=y.return,b===null)throw Error(dt(341));b.lanes|=l,s=b.alternate,s!==null&&(s.lanes|=l),Mx(b,l,n),b=y.sibling}else b=y.child;if(b!==null)b.return=y;else for(b=y;b!==null;){if(b===n){b=null;break}if(y=b.sibling,y!==null){y.return=b.return,b=y;break}b=b.return}y=b}Bi(e,n,m.children,l),n=n.child}return n;case 9:return m=n.type,h=n.pendingProps.children,ph(n,l),m=Go(m),h=h(m),n.flags|=1,Bi(e,n,h,l),n.child;case 14:return h=n.type,m=ms(h,n.pendingProps),m=ms(h.type,m),uT(e,n,h,m,l);case 15:return IA(e,n,n.type,n.pendingProps,l);case 17:return h=n.type,m=n.pendingProps,m=n.elementType===h?m:ms(h,m),Gg(e,n),n.tag=1,Qi(h)?(e=!0,m_(n)):e=!1,ph(n,l),iA(n,h,m),kx(n,h,m,l),Rx(null,n,h,!0,e,l);case 19:return DA(e,n,l);case 22:return kA(e,n,l)}throw Error(dt(156,n.tag))};function KA(e,n){return bC(e,n)}function ID(e,n,l,h){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Uo(e,n,l,h){return new ID(e,n,l,h)}function rw(e){return e=e.prototype,!(!e||!e.isReactComponent)}function kD(e){if(typeof e=="function")return rw(e)?1:0;if(e!=null){if(e=e.$$typeof,e===b1)return 11;if(e===E1)return 14}return 2}function Sl(e,n){var l=e.alternate;return l===null?(l=Uo(e.tag,n,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=n,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&14680064,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,n=e.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l}function Zg(e,n,l,h,m,y){var b=2;if(h=e,typeof e=="function")rw(e)&&(b=1);else if(typeof e=="string")b=5;else e:switch(e){case Ku:return kc(l.children,m,y,n);case w1:b=8,m|=8;break;case ex:return e=Uo(12,l,n,m|2),e.elementType=ex,e.lanes=y,e;case tx:return e=Uo(13,l,n,m),e.elementType=tx,e.lanes=y,e;case nx:return e=Uo(19,l,n,m),e.elementType=nx,e.lanes=y,e;case oC:return X_(l,m,y,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case rC:b=10;break e;case iC:b=9;break e;case b1:b=11;break e;case E1:b=14;break e;case ul:b=16,h=null;break e}throw Error(dt(130,e==null?e:typeof e,""))}return n=Uo(b,l,n,m),n.elementType=e,n.type=h,n.lanes=y,n}function kc(e,n,l,h){return e=Uo(7,e,h,n),e.lanes=l,e}function X_(e,n,l,h){return e=Uo(22,e,h,n),e.elementType=oC,e.lanes=l,e.stateNode={isHidden:!1},e}function Rv(e,n,l){return e=Uo(6,e,null,n),e.lanes=l,e}function Dv(e,n,l){return n=Uo(4,e.children!==null?e.children:[],e.key,n),n.lanes=l,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function PD(e,n,l,h,m){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fv(0),this.expirationTimes=fv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fv(0),this.identifierPrefix=h,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function iw(e,n,l,h,m,y,b,s,A){return e=new PD(e,n,l,s,A),n===1?(n=1,y===!0&&(n|=8)):n=0,y=Uo(3,null,null,n),e.current=y,y.stateNode=e,y.memoizedState={element:h,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},U1(y),e}function zD(e,n,l){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xu,key:h==null?null:""+h,children:e,containerInfo:n,implementation:l}}function YA(e){if(!e)return Al;e=e._reactInternals;e:{if(jc(e)!==e||e.tag!==1)throw Error(dt(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Qi(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(dt(171))}if(e.tag===1){var l=e.type;if(Qi(l))return KC(e,l,n)}return n}function JA(e,n,l,h,m,y,b,s,A){return e=iw(l,h,!0,e,m,y,b,s,A),e.context=YA(null),l=e.current,h=Fi(),m=Tl(l),y=ma(h,m),y.callback=n??null,bl(l,y,m),e.current.lanes=m,kf(e,m,h),eo(e,h),e}function K_(e,n,l,h){var m=n.current,y=Fi(),b=Tl(m);return l=YA(l),n.context===null?n.context=l:n.pendingContext=l,n=ma(y,b),n.payload={element:e},h=h===void 0?null:h,h!==null&&(n.callback=h),e=bl(m,n,b),e!==null&&(xs(e,m,b,y),Ug(e,m,b)),b}function M_(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function bT(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<n?l:n}}function ow(e,n){bT(e,n),(e=e.alternate)&&bT(e,n)}function RD(){return null}var QA=typeof reportError=="function"?reportError:function(e){console.error(e)};function sw(e){this._internalRoot=e}Y_.prototype.render=sw.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(dt(409));K_(e,n,null,null)};Y_.prototype.unmount=sw.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Lc(function(){K_(null,e,null,null)}),n[xa]=null}};function Y_(e){this._internalRoot=e}Y_.prototype.unstable_scheduleHydration=function(e){if(e){var n=IC();e={blockedOn:null,target:e,priority:n};for(var l=0;l<dl.length&&n!==0&&n<dl[l].priority;l++);dl.splice(l,0,e),l===0&&PC(e)}};function aw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function J_(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ET(){}function DD(e,n,l,h,m){if(m){if(typeof h=="function"){var y=h;h=function(){var R=M_(b);y.call(R)}}var b=JA(n,h,e,0,null,!1,!1,"",ET);return e._reactRootContainer=b,e[xa]=b.current,pf(e.nodeType===8?e.parentNode:e),Lc(),b}for(;m=e.lastChild;)e.removeChild(m);if(typeof h=="function"){var s=h;h=function(){var R=M_(A);s.call(R)}}var A=iw(e,0,!1,null,null,!1,!1,"",ET);return e._reactRootContainer=A,e[xa]=A.current,pf(e.nodeType===8?e.parentNode:e),Lc(function(){K_(n,A,l,h)}),A}function Q_(e,n,l,h,m){var y=l._reactRootContainer;if(y){var b=y;if(typeof m=="function"){var s=m;m=function(){var A=M_(b);s.call(A)}}K_(n,b,e,m)}else b=DD(l,n,e,m,h);return M_(b)}AC=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var l=Up(n.pendingLanes);l!==0&&(C1(n,l|1),eo(n,Pr()),!(bn&6)&&(Sh=Pr()+500,kl()))}break;case 13:Lc(function(){var h=wa(e,1);if(h!==null){var m=Fi();xs(h,e,1,m)}}),ow(e,1)}};A1=function(e){if(e.tag===13){var n=wa(e,134217728);if(n!==null){var l=Fi();xs(n,e,134217728,l)}ow(e,134217728)}};MC=function(e){if(e.tag===13){var n=Tl(e),l=wa(e,n);if(l!==null){var h=Fi();xs(l,e,n,h)}ow(e,n)}};IC=function(){return Wn};kC=function(e,n){var l=Wn;try{return Wn=e,n()}finally{Wn=l}};dx=function(e,n,l){switch(n){case"input":if(ox(e,l),n=l.name,l.type==="radio"&&n!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<l.length;n++){var h=l[n];if(h!==e&&h.form===e.form){var m=$_(h);if(!m)throw Error(dt(90));aC(h),ox(h,m)}}}break;case"textarea":cC(e,l);break;case"select":n=l.value,n!=null&&ch(e,!!l.multiple,n,!1)}};gC=ew;_C=Lc;var LD={usingClientEntryPoint:!1,Events:[zf,eh,$_,fC,mC,ew]},Ap={findFiberByHostInstance:Ec,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},OD={bundleType:Ap.bundleType,version:Ap.version,rendererPackageName:Ap.rendererPackageName,rendererConfig:Ap.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ta.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=xC(e),e===null?null:e.stateNode},findFiberByHostInstance:Ap.findFiberByHostInstance||RD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mg.isDisabled&&Mg.supportsFiber)try{N_=Mg.inject(OD),js=Mg}catch{}}_o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LD;_o.createPortal=function(e,n){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!aw(n))throw Error(dt(200));return zD(e,n,null,l)};_o.createRoot=function(e,n){if(!aw(e))throw Error(dt(299));var l=!1,h="",m=QA;return n!=null&&(n.unstable_strictMode===!0&&(l=!0),n.identifierPrefix!==void 0&&(h=n.identifierPrefix),n.onRecoverableError!==void 0&&(m=n.onRecoverableError)),n=iw(e,1,!1,null,null,l,!1,h,m),e[xa]=n.current,pf(e.nodeType===8?e.parentNode:e),new sw(n)};_o.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(dt(188)):(e=Object.keys(e).join(","),Error(dt(268,e)));return e=xC(n),e=e===null?null:e.stateNode,e};_o.flushSync=function(e){return Lc(e)};_o.hydrate=function(e,n,l){if(!J_(n))throw Error(dt(200));return Q_(null,e,n,!0,l)};_o.hydrateRoot=function(e,n,l){if(!aw(e))throw Error(dt(405));var h=l!=null&&l.hydratedSources||null,m=!1,y="",b=QA;if(l!=null&&(l.unstable_strictMode===!0&&(m=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onRecoverableError!==void 0&&(b=l.onRecoverableError)),n=JA(n,null,e,1,l??null,m,!1,y,b),e[xa]=n.current,pf(e),h)for(e=0;e<h.length;e++)l=h[e],m=l._getVersion,m=m(l._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[l,m]:n.mutableSourceEagerHydrationData.push(l,m);return new Y_(n)};_o.render=function(e,n,l){if(!J_(n))throw Error(dt(200));return Q_(null,e,n,!1,l)};_o.unmountComponentAtNode=function(e){if(!J_(e))throw Error(dt(40));return e._reactRootContainer?(Lc(function(){Q_(null,null,e,!1,function(){e._reactRootContainer=null,e[xa]=null})}),!0):!1};_o.unstable_batchedUpdates=ew;_o.unstable_renderSubtreeIntoContainer=function(e,n,l,h){if(!J_(l))throw Error(dt(200));if(e==null||e._reactInternals===void 0)throw Error(dt(38));return Q_(e,n,l,!1,h)};_o.version="18.2.0-next-9e3b772b8-20220608";function eM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eM)}catch(e){console.error(e)}}eM(),JS.exports=_o;var tM=JS.exports;const Ig=Fc(tM);var TT=tM;Jv.createRoot=TT.createRoot,Jv.hydrateRoot=TT.hydrateRoot;/**
 * @remix-run/router v1.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ar(){return ar=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(e[h]=l[h])}return e},ar.apply(this,arguments)}var Ur;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ur||(Ur={}));const ST="popstate";function BD(e){e===void 0&&(e={});function n(h,m){let{pathname:y,search:b,hash:s}=h.location;return bf("",{pathname:y,search:b,hash:s},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function l(h,m){return typeof m=="string"?m:Oc(m)}return ND(n,l,null,e)}function sn(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Ch(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function FD(){return Math.random().toString(36).substr(2,8)}function CT(e,n){return{usr:e.state,key:e.key,idx:n}}function bf(e,n,l,h){return l===void 0&&(l=null),ar({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof n=="string"?Sa(n):n,{state:l,key:n&&n.key||h||FD()})}function Oc(e){let{pathname:n="/",search:l="",hash:h=""}=e;return l&&l!=="?"&&(n+=l.charAt(0)==="?"?l:"?"+l),h&&h!=="#"&&(n+=h.charAt(0)==="#"?h:"#"+h),n}function Sa(e){let n={};if(e){let l=e.indexOf("#");l>=0&&(n.hash=e.substr(l),e=e.substr(0,l));let h=e.indexOf("?");h>=0&&(n.search=e.substr(h),e=e.substr(0,h)),e&&(n.pathname=e)}return n}function ND(e,n,l,h){h===void 0&&(h={});let{window:m=document.defaultView,v5Compat:y=!1}=h,b=m.history,s=Ur.Pop,A=null,R=U();R==null&&(R=0,b.replaceState(ar({},b.state,{idx:R}),""));function U(){return(b.state||{idx:null}).idx}function V(){s=Ur.Pop;let Ce=U(),ee=Ce==null?null:Ce-R;R=Ce,A&&A({action:s,location:K.location,delta:ee})}function $(Ce,ee){s=Ur.Push;let ne=bf(K.location,Ce,ee);l&&l(ne,Ce),R=U()+1;let ce=CT(ne,R),se=K.createHref(ne);try{b.pushState(ce,"",se)}catch(De){if(De instanceof DOMException&&De.name==="DataCloneError")throw De;m.location.assign(se)}y&&A&&A({action:s,location:K.location,delta:1})}function pe(Ce,ee){s=Ur.Replace;let ne=bf(K.location,Ce,ee);l&&l(ne,Ce),R=U();let ce=CT(ne,R),se=K.createHref(ne);b.replaceState(ce,"",se),y&&A&&A({action:s,location:K.location,delta:0})}function Y(Ce){let ee=m.location.origin!=="null"?m.location.origin:m.location.href,ne=typeof Ce=="string"?Ce:Oc(Ce);return sn(ee,"No window.location.(origin|href) available to create URL for href: "+ne),new URL(ne,ee)}let K={get action(){return s},get location(){return e(m,b)},listen(Ce){if(A)throw new Error("A history only accepts one active listener");return m.addEventListener(ST,V),A=Ce,()=>{m.removeEventListener(ST,V),A=null}},createHref(Ce){return n(m,Ce)},createURL:Y,encodeLocation(Ce){let ee=Y(Ce);return{pathname:ee.pathname,search:ee.search,hash:ee.hash}},push:$,replace:pe,go(Ce){return b.go(Ce)}};return K}var kr;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(kr||(kr={}));const jD=new Set(["lazy","caseSensitive","path","id","index","children"]);function UD(e){return e.index===!0}function qx(e,n,l,h){return l===void 0&&(l=[]),h===void 0&&(h={}),e.map((m,y)=>{let b=[...l,y],s=typeof m.id=="string"?m.id:b.join("-");if(sn(m.index!==!0||!m.children,"Cannot specify children on an index route"),sn(!h[s],'Found a route id collision on id "'+s+`".  Route id's must be globally unique within Data Router usages`),UD(m)){let A=ar({},m,n(m),{id:s});return h[s]=A,A}else{let A=ar({},m,n(m),{id:s,children:void 0});return h[s]=A,m.children&&(A.children=qx(m.children,n,b,h)),A}})}function ah(e,n,l){l===void 0&&(l="/");let h=typeof n=="string"?Sa(n):n,m=Lh(h.pathname||"/",l);if(m==null)return null;let y=nM(e);VD(y);let b=null;for(let s=0;b==null&&s<y.length;++s)b=YD(y[s],eL(m));return b}function nM(e,n,l,h){n===void 0&&(n=[]),l===void 0&&(l=[]),h===void 0&&(h="");let m=(y,b,s)=>{let A={relativePath:s===void 0?y.path||"":s,caseSensitive:y.caseSensitive===!0,childrenIndex:b,route:y};A.relativePath.startsWith("/")&&(sn(A.relativePath.startsWith(h),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+h+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(h.length));let R=ga([h,A.relativePath]),U=l.concat(A);y.children&&y.children.length>0&&(sn(y.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+R+'".')),nM(y.children,n,U,R)),!(y.path==null&&!y.index)&&n.push({path:R,score:XD(R,y.index),routesMeta:U})};return e.forEach((y,b)=>{var s;if(y.path===""||!((s=y.path)!=null&&s.includes("?")))m(y,b);else for(let A of rM(y.path))m(y,b,A)}),n}function rM(e){let n=e.split("/");if(n.length===0)return[];let[l,...h]=n,m=l.endsWith("?"),y=l.replace(/\?$/,"");if(h.length===0)return m?[y,""]:[y];let b=rM(h.join("/")),s=[];return s.push(...b.map(A=>A===""?y:[y,A].join("/"))),m&&s.push(...b),s.map(A=>e.startsWith("/")&&A===""?"/":A)}function VD(e){e.sort((n,l)=>n.score!==l.score?l.score-n.score:KD(n.routesMeta.map(h=>h.childrenIndex),l.routesMeta.map(h=>h.childrenIndex)))}const $D=/^:\w+$/,GD=3,qD=2,WD=1,ZD=10,HD=-2,AT=e=>e==="*";function XD(e,n){let l=e.split("/"),h=l.length;return l.some(AT)&&(h+=HD),n&&(h+=qD),l.filter(m=>!AT(m)).reduce((m,y)=>m+($D.test(y)?GD:y===""?WD:ZD),h)}function KD(e,n){return e.length===n.length&&e.slice(0,-1).every((h,m)=>h===n[m])?e[e.length-1]-n[n.length-1]:0}function YD(e,n){let{routesMeta:l}=e,h={},m="/",y=[];for(let b=0;b<l.length;++b){let s=l[b],A=b===l.length-1,R=m==="/"?n:n.slice(m.length)||"/",U=JD({path:s.relativePath,caseSensitive:s.caseSensitive,end:A},R);if(!U)return null;Object.assign(h,U.params);let V=s.route;y.push({params:h,pathname:ga([m,U.pathname]),pathnameBase:iL(ga([m,U.pathnameBase])),route:V}),U.pathnameBase!=="/"&&(m=ga([m,U.pathnameBase]))}return y}function JD(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[l,h]=QD(e.path,e.caseSensitive,e.end),m=n.match(l);if(!m)return null;let y=m[0],b=y.replace(/(.)\/+$/,"$1"),s=m.slice(1);return{params:h.reduce((R,U,V)=>{if(U==="*"){let $=s[V]||"";b=y.slice(0,y.length-$.length).replace(/(.)\/+$/,"$1")}return R[U]=tL(s[V]||"",U),R},{}),pathname:y,pathnameBase:b,pattern:e}}function QD(e,n,l){n===void 0&&(n=!1),l===void 0&&(l=!0),Ch(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let h=[],m="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(b,s)=>(h.push(s),"/([^\\/]+)"));return e.endsWith("*")?(h.push("*"),m+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?m+="\\/*$":e!==""&&e!=="/"&&(m+="(?:(?=\\/|$))"),[new RegExp(m,n?void 0:"i"),h]}function eL(e){try{return decodeURI(e)}catch(n){return Ch(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),e}}function tL(e,n){try{return decodeURIComponent(e)}catch(l){return Ch(!1,'The value for the URL param "'+n+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+l+").")),e}}function Lh(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let l=n.endsWith("/")?n.length-1:n.length,h=e.charAt(l);return h&&h!=="/"?null:e.slice(l)||"/"}function nL(e,n){n===void 0&&(n="/");let{pathname:l,search:h="",hash:m=""}=typeof e=="string"?Sa(e):e;return{pathname:l?l.startsWith("/")?l:rL(l,n):n,search:oL(h),hash:sL(m)}}function rL(e,n){let l=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(m=>{m===".."?l.length>1&&l.pop():m!=="."&&l.push(m)}),l.length>1?l.join("/"):"/"}function Lv(e,n,l,h){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(h)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Df(e){return e.filter((n,l)=>l===0||n.route.path&&n.route.path.length>0)}function ey(e,n,l,h){h===void 0&&(h=!1);let m;typeof e=="string"?m=Sa(e):(m=ar({},e),sn(!m.pathname||!m.pathname.includes("?"),Lv("?","pathname","search",m)),sn(!m.pathname||!m.pathname.includes("#"),Lv("#","pathname","hash",m)),sn(!m.search||!m.search.includes("#"),Lv("#","search","hash",m)));let y=e===""||m.pathname==="",b=y?"/":m.pathname,s;if(h||b==null)s=l;else{let V=n.length-1;if(b.startsWith("..")){let $=b.split("/");for(;$[0]==="..";)$.shift(),V-=1;m.pathname=$.join("/")}s=V>=0?n[V]:"/"}let A=nL(m,s),R=b&&b!=="/"&&b.endsWith("/"),U=(y||b===".")&&l.endsWith("/");return!A.pathname.endsWith("/")&&(R||U)&&(A.pathname+="/"),A}const ga=e=>e.join("/").replace(/\/\/+/g,"/"),iL=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),oL=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sL=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;class lw{constructor(n,l,h,m){m===void 0&&(m=!1),this.status=n,this.statusText=l||"",this.internal=m,h instanceof Error?(this.data=h.toString(),this.error=h):this.data=h}}function iM(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const oM=["post","put","patch","delete"],aL=new Set(oM),lL=["get",...oM],cL=new Set(lL),uL=new Set([301,302,303,307,308]),hL=new Set([307,308]),Ov={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},dL={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Mp={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},sM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,pL=e=>({hasErrorBoundary:!!e.hasErrorBoundary});function fL(e){const n=e.window?e.window:typeof window<"u"?window:void 0,l=typeof n<"u"&&typeof n.document<"u"&&typeof n.document.createElement<"u",h=!l;sn(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let m;if(e.mapRouteProperties)m=e.mapRouteProperties;else if(e.detectErrorBoundary){let Fe=e.detectErrorBoundary;m=Ve=>({hasErrorBoundary:Fe(Ve)})}else m=pL;let y={},b=qx(e.routes,m,void 0,y),s,A=e.basename||"/",R=ar({v7_normalizeFormMethod:!1,v7_prependBasename:!1},e.future),U=null,V=new Set,$=null,pe=null,Y=null,K=e.hydrationData!=null,Ce=ah(b,e.history.location,A),ee=null;if(Ce==null){let Fe=Bo(404,{pathname:e.history.location.pathname}),{matches:Ve,route:at}=LT(b);Ce=Ve,ee={[at.id]:Fe}}let ne=!Ce.some(Fe=>Fe.route.lazy)&&(!Ce.some(Fe=>Fe.route.loader)||e.hydrationData!=null),ce,se={historyAction:e.history.action,location:e.history.location,matches:Ce,initialized:ne,navigation:Ov,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||ee,fetchers:new Map,blockers:new Map},De=Ur.Pop,He=!1,Be,ut=!1,Ie=!1,Je=[],Rt=[],ht=new Map,Ht=0,Rn=-1,Bt=new Map,rn=new Set,vn=new Map,qe=new Map,St=new Map,bt=!1;function Kt(){return U=e.history.listen(Fe=>{let{action:Ve,location:at,delta:Et}=Fe;if(bt){bt=!1;return}Ch(St.size===0||Et!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let $t=Lr({currentLocation:se.location,nextLocation:at,historyAction:Ve});if($t&&Et!=null){bt=!0,e.history.go(Et*-1),no($t,{state:"blocked",location:at,proceed(){no($t,{state:"proceeding",proceed:void 0,reset:void 0,location:at}),e.history.go(Et)},reset(){let ie=new Map(se.blockers);ie.set($t,Mp),Qt({blockers:ie})}});return}return ai(Ve,at)}),se.initialized||ai(Ur.Pop,se.location),ce}function xn(){U&&U(),V.clear(),Be&&Be.abort(),se.fetchers.forEach((Fe,Ve)=>Mr(Ve)),se.blockers.forEach((Fe,Ve)=>zi(Ve))}function En(Fe){return V.add(Fe),()=>V.delete(Fe)}function Qt(Fe){se=ar({},se,Fe),V.forEach(Ve=>Ve(se))}function cr(Fe,Ve){var at,Et;let $t=se.actionData!=null&&se.navigation.formMethod!=null&&_s(se.navigation.formMethod)&&se.navigation.state==="loading"&&((at=Fe.state)==null?void 0:at._isRedirect)!==!0,ie;Ve.actionData?Object.keys(Ve.actionData).length>0?ie=Ve.actionData:ie=null:$t?ie=se.actionData:ie=null;let N=Ve.loaderData?DT(se.loaderData,Ve.loaderData,Ve.matches||[],Ve.errors):se.loaderData,j=se.blockers;j.size>0&&(j=new Map(j),j.forEach((ue,ye)=>j.set(ye,Mp)));let H=He===!0||se.navigation.formMethod!=null&&_s(se.navigation.formMethod)&&((Et=Fe.state)==null?void 0:Et._isRedirect)!==!0;s&&(b=s,s=void 0),ut||De===Ur.Pop||(De===Ur.Push?e.history.push(Fe,Fe.state):De===Ur.Replace&&e.history.replace(Fe,Fe.state)),Qt(ar({},Ve,{actionData:ie,loaderData:N,historyAction:De,location:Fe,initialized:!0,navigation:Ov,revalidation:"idle",restoreScrollPosition:ro(Fe,Ve.matches||se.matches),preventScrollReset:H,blockers:j})),De=Ur.Pop,He=!1,ut=!1,Ie=!1,Je=[],Rt=[]}async function Qn(Fe,Ve){if(typeof Fe=="number"){e.history.go(Fe);return}let at=Wx(se.location,se.matches,A,R.v7_prependBasename,Fe,Ve==null?void 0:Ve.fromRouteId,Ve==null?void 0:Ve.relative),{path:Et,submission:$t,error:ie}=MT(R.v7_normalizeFormMethod,!1,at,Ve),N=se.location,j=bf(se.location,Et,Ve&&Ve.state);j=ar({},j,e.history.encodeLocation(j));let H=Ve&&Ve.replace!=null?Ve.replace:void 0,ue=Ur.Push;H===!0?ue=Ur.Replace:H===!1||$t!=null&&_s($t.formMethod)&&$t.formAction===se.location.pathname+se.location.search&&(ue=Ur.Replace);let ye=Ve&&"preventScrollReset"in Ve?Ve.preventScrollReset===!0:void 0,we=Lr({currentLocation:N,nextLocation:j,historyAction:ue});if(we){no(we,{state:"blocked",location:j,proceed(){no(we,{state:"proceeding",proceed:void 0,reset:void 0,location:j}),Qn(Fe,Ve)},reset(){let be=new Map(se.blockers);be.set(we,Mp),Qt({blockers:be})}});return}return await ai(ue,j,{submission:$t,pendingError:ie,preventScrollReset:ye,replace:Ve&&Ve.replace})}function Rr(){if(bo(),Qt({revalidation:"loading"}),se.navigation.state!=="submitting"){if(se.navigation.state==="idle"){ai(se.historyAction,se.location,{startUninterruptedRevalidation:!0});return}ai(De||se.historyAction,se.navigation.location,{overrideNavigation:se.navigation})}}async function ai(Fe,Ve,at){Be&&Be.abort(),Be=null,De=Fe,ut=(at&&at.startUninterruptedRevalidation)===!0,To(se.location,se.matches),He=(at&&at.preventScrollReset)===!0;let Et=s||b,$t=at&&at.overrideNavigation,ie=ah(Et,Ve,A);if(!ie){let be=Bo(404,{pathname:Ve.pathname}),{matches:ge,route:ze}=LT(Et);fi(),cr(Ve,{matches:ge,loaderData:{},errors:{[ze.id]:be}});return}if(se.initialized&&!Ie&&vL(se.location,Ve)&&!(at&&at.submission&&_s(at.submission.formMethod))){cr(Ve,{matches:ie});return}Be=new AbortController;let N=kp(e.history,Ve,Be.signal,at&&at.submission),j,H;if(at&&at.pendingError)H={[lh(ie).route.id]:at.pendingError};else if(at&&at.submission&&_s(at.submission.formMethod)){let be=await Ar(N,Ve,at.submission,ie,{replace:at.replace});if(be.shortCircuited)return;j=be.pendingActionData,H=be.pendingActionError,$t=kg(Ve,at.submission),N=new Request(N.url,{signal:N.signal})}let{shortCircuited:ue,loaderData:ye,errors:we}=await xo(N,Ve,ie,$t,at&&at.submission,at&&at.fetcherSubmission,at&&at.replace,j,H);ue||(Be=null,cr(Ve,ar({matches:ie},j?{actionData:j}:{},{loaderData:ye,errors:we})))}async function Ar(Fe,Ve,at,Et,$t){$t===void 0&&($t={}),bo();let ie=TL(Ve,at);Qt({navigation:ie});let N,j=Hx(Et,Ve);if(!j.route.action&&!j.route.lazy)N={type:kr.error,error:Bo(405,{method:Fe.method,pathname:Ve.pathname,routeId:j.route.id})};else if(N=await Ip("action",Fe,j,Et,y,m,A),Fe.signal.aborted)return{shortCircuited:!0};if(mh(N)){let H;return $t&&$t.replace!=null?H=$t.replace:H=N.location===se.location.pathname+se.location.search,await gn(se,N,{submission:at,replace:H}),{shortCircuited:!0}}if(ef(N)){let H=lh(Et,j.route.id);return($t&&$t.replace)!==!0&&(De=Ur.Push),{pendingActionData:{},pendingActionError:{[H.route.id]:N.error}}}if(Cc(N))throw Bo(400,{type:"defer-action"});return{pendingActionData:{[j.route.id]:N.data}}}async function xo(Fe,Ve,at,Et,$t,ie,N,j,H){let ue=Et||kg(Ve,$t),ye=$t||ie||FT(ue),we=s||b,[be,ge]=IT(e.history,se,at,ye,Ve,Ie,Je,Rt,vn,rn,we,A,j,H);if(fi(Ft=>!(at&&at.some(Vn=>Vn.route.id===Ft))||be&&be.some(Vn=>Vn.route.id===Ft)),Rn=++Ht,be.length===0&&ge.length===0){let Ft=Eo();return cr(Ve,ar({matches:at,loaderData:{},errors:H||null},j?{actionData:j}:{},Ft?{fetchers:new Map(se.fetchers)}:{})),{shortCircuited:!0}}if(!ut){ge.forEach(Vn=>{let Ln=se.fetchers.get(Vn.key),mi=Pp(void 0,Ln?Ln.data:void 0);se.fetchers.set(Vn.key,mi)});let Ft=j||se.actionData;Qt(ar({navigation:ue},Ft?Object.keys(Ft).length===0?{actionData:null}:{actionData:Ft}:{},ge.length>0?{fetchers:new Map(se.fetchers)}:{}))}ge.forEach(Ft=>{ht.has(Ft.key)&&Dr(Ft.key),Ft.controller&&ht.set(Ft.key,Ft.controller)});let ze=()=>ge.forEach(Ft=>Dr(Ft.key));Be&&Be.signal.addEventListener("abort",ze);let{results:et,loaderResults:ct,fetcherResults:tt}=await qr(se.matches,at,be,ge,Fe);if(Fe.signal.aborted)return{shortCircuited:!0};Be&&Be.signal.removeEventListener("abort",ze),ge.forEach(Ft=>ht.delete(Ft.key));let zt=OT(et);if(zt){if(zt.idx>=be.length){let Ft=ge[zt.idx-be.length].key;rn.add(Ft)}return await gn(se,zt.result,{replace:N}),{shortCircuited:!0}}let{loaderData:Dt,errors:Lt}=RT(se,at,be,ct,H,ge,tt,qe);qe.forEach((Ft,Vn)=>{Ft.subscribe(Ln=>{(Ln||Ft.done)&&qe.delete(Vn)})});let Gt=Eo(),Yt=ki(Rn),Dn=Gt||Yt||ge.length>0;return ar({loaderData:Dt,errors:Lt},Dn?{fetchers:new Map(se.fetchers)}:{})}function Xt(Fe){return se.fetchers.get(Fe)||dL}function wo(Fe,Ve,at,Et){if(h)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");ht.has(Fe)&&Dr(Fe);let $t=s||b,ie=Wx(se.location,se.matches,A,R.v7_prependBasename,at,Ve,Et==null?void 0:Et.relative),N=ah($t,ie,A);if(!N){Qr(Fe,Ve,Bo(404,{pathname:ie}));return}let{path:j,submission:H,error:ue}=MT(R.v7_normalizeFormMethod,!0,ie,Et);if(ue){Qr(Fe,Ve,ue);return}let ye=Hx(N,j);if(He=(Et&&Et.preventScrollReset)===!0,H&&_s(H.formMethod)){Gr(Fe,Ve,j,ye,N,H);return}vn.set(Fe,{routeId:Ve,path:j}),Wo(Fe,Ve,j,ye,N,H)}async function Gr(Fe,Ve,at,Et,$t,ie){if(bo(),vn.delete(Fe),!Et.route.action&&!Et.route.lazy){let an=Bo(405,{method:ie.formMethod,pathname:at,routeId:Ve});Qr(Fe,Ve,an);return}let N=se.fetchers.get(Fe),j=SL(ie,N);se.fetchers.set(Fe,j),Qt({fetchers:new Map(se.fetchers)});let H=new AbortController,ue=kp(e.history,at,H.signal,ie);ht.set(Fe,H);let ye=Ht,we=await Ip("action",ue,Et,$t,y,m,A);if(ue.signal.aborted){ht.get(Fe)===H&&ht.delete(Fe);return}if(mh(we))if(ht.delete(Fe),Rn>ye){let an=Wu(void 0);se.fetchers.set(Fe,an),Qt({fetchers:new Map(se.fetchers)});return}else{rn.add(Fe);let an=Pp(ie);return se.fetchers.set(Fe,an),Qt({fetchers:new Map(se.fetchers)}),gn(se,we,{submission:ie,isFetchActionRedirect:!0})}if(ef(we)){Qr(Fe,Ve,we.error);return}if(Cc(we))throw Bo(400,{type:"defer-action"});let be=se.navigation.location||se.location,ge=kp(e.history,be,H.signal),ze=s||b,et=se.navigation.state!=="idle"?ah(ze,se.navigation.location,A):se.matches;sn(et,"Didn't find any matches after fetcher action");let ct=++Ht;Bt.set(Fe,ct);let tt=Pp(ie,we.data);se.fetchers.set(Fe,tt);let[zt,Dt]=IT(e.history,se,et,ie,be,Ie,Je,Rt,vn,rn,ze,A,{[Et.route.id]:we.data},void 0);Dt.filter(an=>an.key!==Fe).forEach(an=>{let ur=an.key,Zo=se.fetchers.get(ur),Vh=Pp(void 0,Zo?Zo.data:void 0);se.fetchers.set(ur,Vh),ht.has(ur)&&Dr(ur),an.controller&&ht.set(ur,an.controller)}),Qt({fetchers:new Map(se.fetchers)});let Lt=()=>Dt.forEach(an=>Dr(an.key));H.signal.addEventListener("abort",Lt);let{results:Gt,loaderResults:Yt,fetcherResults:Dn}=await qr(se.matches,et,zt,Dt,ge);if(H.signal.aborted)return;H.signal.removeEventListener("abort",Lt),Bt.delete(Fe),ht.delete(Fe),Dt.forEach(an=>ht.delete(an.key));let Ft=OT(Gt);if(Ft){if(Ft.idx>=zt.length){let an=Dt[Ft.idx-zt.length].key;rn.add(an)}return gn(se,Ft.result)}let{loaderData:Vn,errors:Ln}=RT(se,se.matches,zt,Yt,void 0,Dt,Dn,qe);if(se.fetchers.has(Fe)){let an=Wu(we.data);se.fetchers.set(Fe,an)}let mi=ki(ct);se.navigation.state==="loading"&&ct>Rn?(sn(De,"Expected pending action"),Be&&Be.abort(),cr(se.navigation.location,{matches:et,loaderData:Vn,errors:Ln,fetchers:new Map(se.fetchers)})):(Qt(ar({errors:Ln,loaderData:DT(se.loaderData,Vn,et,Ln)},mi||Dt.length>0?{fetchers:new Map(se.fetchers)}:{})),Ie=!1)}async function Wo(Fe,Ve,at,Et,$t,ie){let N=se.fetchers.get(Fe),j=Pp(ie,N?N.data:void 0);se.fetchers.set(Fe,j),Qt({fetchers:new Map(se.fetchers)});let H=new AbortController,ue=kp(e.history,at,H.signal);ht.set(Fe,H);let ye=Ht,we=await Ip("loader",ue,Et,$t,y,m,A);if(Cc(we)&&(we=await cM(we,ue.signal,!0)||we),ht.get(Fe)===H&&ht.delete(Fe),ue.signal.aborted)return;if(mh(we))if(Rn>ye){let ge=Wu(void 0);se.fetchers.set(Fe,ge),Qt({fetchers:new Map(se.fetchers)});return}else{rn.add(Fe),await gn(se,we);return}if(ef(we)){let ge=lh(se.matches,Ve);se.fetchers.delete(Fe),Qt({fetchers:new Map(se.fetchers),errors:{[ge.route.id]:we.error}});return}sn(!Cc(we),"Unhandled fetcher deferred data");let be=Wu(we.data);se.fetchers.set(Fe,be),Qt({fetchers:new Map(se.fetchers)})}async function gn(Fe,Ve,at){let{submission:Et,replace:$t,isFetchActionRedirect:ie}=at===void 0?{}:at;Ve.revalidate&&(Ie=!0);let N=bf(Fe.location,Ve.location,ar({_isRedirect:!0},ie?{_isFetchActionRedirect:!0}:{}));if(sn(N,"Expected a location on the redirect navigation"),l){let ue=!1;if(Ve.reloadDocument)ue=!0;else if(sM.test(Ve.location)){const ye=e.history.createURL(Ve.location);ue=ye.origin!==n.location.origin||Lh(ye.pathname,A)==null}if(ue){$t?n.location.replace(Ve.location):n.location.assign(Ve.location);return}}Be=null;let j=$t===!0?Ur.Replace:Ur.Push,H=Et||FT(Fe.navigation);if(hL.has(Ve.status)&&H&&_s(H.formMethod))await ai(j,N,{submission:ar({},H,{formAction:Ve.location}),preventScrollReset:He});else if(ie)await ai(j,N,{overrideNavigation:kg(N),fetcherSubmission:H,preventScrollReset:He});else{let ue=kg(N,H);await ai(j,N,{overrideNavigation:ue,preventScrollReset:He})}}async function qr(Fe,Ve,at,Et,$t){let ie=await Promise.all([...at.map(H=>Ip("loader",$t,H,Ve,y,m,A)),...Et.map(H=>H.matches&&H.match&&H.controller?Ip("loader",kp(e.history,H.path,H.controller.signal),H.match,H.matches,y,m,A):{type:kr.error,error:Bo(404,{pathname:H.path})})]),N=ie.slice(0,at.length),j=ie.slice(at.length);return await Promise.all([BT(Fe,at,N,N.map(()=>$t.signal),!1,se.loaderData),BT(Fe,Et.map(H=>H.match),j,Et.map(H=>H.controller?H.controller.signal:null),!0)]),{results:ie,loaderResults:N,fetcherResults:j}}function bo(){Ie=!0,Je.push(...fi()),vn.forEach((Fe,Ve)=>{ht.has(Ve)&&(Rt.push(Ve),Dr(Ve))})}function Qr(Fe,Ve,at){let Et=lh(se.matches,Ve);Mr(Fe),Qt({errors:{[Et.route.id]:at},fetchers:new Map(se.fetchers)})}function Mr(Fe){let Ve=se.fetchers.get(Fe);ht.has(Fe)&&!(Ve&&Ve.state==="loading"&&Bt.has(Fe))&&Dr(Fe),vn.delete(Fe),Bt.delete(Fe),rn.delete(Fe),se.fetchers.delete(Fe)}function Dr(Fe){let Ve=ht.get(Fe);sn(Ve,"Expected fetch controller: "+Fe),Ve.abort(),ht.delete(Fe)}function Ii(Fe){for(let Ve of Fe){let at=Xt(Ve),Et=Wu(at.data);se.fetchers.set(Ve,Et)}}function Eo(){let Fe=[],Ve=!1;for(let at of rn){let Et=se.fetchers.get(at);sn(Et,"Expected fetcher: "+at),Et.state==="loading"&&(rn.delete(at),Fe.push(at),Ve=!0)}return Ii(Fe),Ve}function ki(Fe){let Ve=[];for(let[at,Et]of Bt)if(Et<Fe){let $t=se.fetchers.get(at);sn($t,"Expected fetcher: "+at),$t.state==="loading"&&(Dr(at),Bt.delete(at),Ve.push(at))}return Ii(Ve),Ve.length>0}function Pi(Fe,Ve){let at=se.blockers.get(Fe)||Mp;return St.get(Fe)!==Ve&&St.set(Fe,Ve),at}function zi(Fe){se.blockers.delete(Fe),St.delete(Fe)}function no(Fe,Ve){let at=se.blockers.get(Fe)||Mp;sn(at.state==="unblocked"&&Ve.state==="blocked"||at.state==="blocked"&&Ve.state==="blocked"||at.state==="blocked"&&Ve.state==="proceeding"||at.state==="blocked"&&Ve.state==="unblocked"||at.state==="proceeding"&&Ve.state==="unblocked","Invalid blocker state transition: "+at.state+" -> "+Ve.state);let Et=new Map(se.blockers);Et.set(Fe,Ve),Qt({blockers:Et})}function Lr(Fe){let{currentLocation:Ve,nextLocation:at,historyAction:Et}=Fe;if(St.size===0)return;St.size>1&&Ch(!1,"A router only supports one blocker at a time");let $t=Array.from(St.entries()),[ie,N]=$t[$t.length-1],j=se.blockers.get(ie);if(!(j&&j.state==="proceeding")&&N({currentLocation:Ve,nextLocation:at,historyAction:Et}))return ie}function fi(Fe){let Ve=[];return qe.forEach((at,Et)=>{(!Fe||Fe(Et))&&(at.cancel(),Ve.push(Et),qe.delete(Et))}),Ve}function Vt(Fe,Ve,at){if($=Fe,Y=Ve,pe=at||null,!K&&se.navigation===Ov){K=!0;let Et=ro(se.location,se.matches);Et!=null&&Qt({restoreScrollPosition:Et})}return()=>{$=null,Y=null,pe=null}}function Ri(Fe,Ve){return pe&&pe(Fe,Ve.map(Et=>EL(Et,se.loaderData)))||Fe.key}function To(Fe,Ve){if($&&Y){let at=Ri(Fe,Ve);$[at]=Y()}}function ro(Fe,Ve){if($){let at=Ri(Fe,Ve),Et=$[at];if(typeof Et=="number")return Et}return null}function So(Fe){y={},s=qx(Fe,m,void 0,y)}return ce={get basename(){return A},get state(){return se},get routes(){return b},initialize:Kt,subscribe:En,enableScrollRestoration:Vt,navigate:Qn,fetch:wo,revalidate:Rr,createHref:Fe=>e.history.createHref(Fe),encodeLocation:Fe=>e.history.encodeLocation(Fe),getFetcher:Xt,deleteFetcher:Mr,dispose:xn,getBlocker:Pi,deleteBlocker:zi,_internalFetchControllers:ht,_internalActiveDeferreds:qe,_internalSetRoutes:So},ce}function mL(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Wx(e,n,l,h,m,y,b){let s,A;if(y!=null&&b!=="path"){s=[];for(let U of n)if(s.push(U),U.route.id===y){A=U;break}}else s=n,A=n[n.length-1];let R=ey(m||".",Df(s).map(U=>U.pathnameBase),Lh(e.pathname,l)||e.pathname,b==="path");return m==null&&(R.search=e.search,R.hash=e.hash),(m==null||m===""||m===".")&&A&&A.route.index&&!cw(R.search)&&(R.search=R.search?R.search.replace(/^\?/,"?index&"):"?index"),h&&l!=="/"&&(R.pathname=R.pathname==="/"?l:ga([l,R.pathname])),Oc(R)}function MT(e,n,l,h){if(!h||!mL(h))return{path:l};if(h.formMethod&&!bL(h.formMethod))return{path:l,error:Bo(405,{method:h.formMethod})};let m=()=>({path:l,error:Bo(400,{type:"invalid-body"})}),y=h.formMethod||"get",b=e?y.toUpperCase():y.toLowerCase(),s=lM(l);if(h.body!==void 0){if(h.formEncType==="text/plain"){if(!_s(b))return m();let $=typeof h.body=="string"?h.body:h.body instanceof FormData||h.body instanceof URLSearchParams?Array.from(h.body.entries()).reduce((pe,Y)=>{let[K,Ce]=Y;return""+pe+K+"="+Ce+`
`},""):String(h.body);return{path:l,submission:{formMethod:b,formAction:s,formEncType:h.formEncType,formData:void 0,json:void 0,text:$}}}else if(h.formEncType==="application/json"){if(!_s(b))return m();try{let $=typeof h.body=="string"?JSON.parse(h.body):h.body;return{path:l,submission:{formMethod:b,formAction:s,formEncType:h.formEncType,formData:void 0,json:$,text:void 0}}}catch{return m()}}}sn(typeof FormData=="function","FormData is not available in this environment");let A,R;if(h.formData)A=Zx(h.formData),R=h.formData;else if(h.body instanceof FormData)A=Zx(h.body),R=h.body;else if(h.body instanceof URLSearchParams)A=h.body,R=zT(A);else if(h.body==null)A=new URLSearchParams,R=new FormData;else try{A=new URLSearchParams(h.body),R=zT(A)}catch{return m()}let U={formMethod:b,formAction:s,formEncType:h&&h.formEncType||"application/x-www-form-urlencoded",formData:R,json:void 0,text:void 0};if(_s(U.formMethod))return{path:l,submission:U};let V=Sa(l);return n&&V.search&&cw(V.search)&&A.append("index",""),V.search="?"+A,{path:Oc(V),submission:U}}function gL(e,n){let l=e;if(n){let h=e.findIndex(m=>m.route.id===n);h>=0&&(l=e.slice(0,h))}return l}function IT(e,n,l,h,m,y,b,s,A,R,U,V,$,pe){let Y=pe?Object.values(pe)[0]:$?Object.values($)[0]:void 0,K=e.createURL(n.location),Ce=e.createURL(m),ee=pe?Object.keys(pe)[0]:void 0,ce=gL(l,ee).filter((De,He)=>{if(De.route.lazy)return!0;if(De.route.loader==null)return!1;if(_L(n.loaderData,n.matches[He],De)||b.some(Ie=>Ie===De.route.id))return!0;let Be=n.matches[He],ut=De;return kT(De,ar({currentUrl:K,currentParams:Be.params,nextUrl:Ce,nextParams:ut.params},h,{actionResult:Y,defaultShouldRevalidate:y||K.pathname+K.search===Ce.pathname+Ce.search||K.search!==Ce.search||aM(Be,ut)}))}),se=[];return A.forEach((De,He)=>{if(!l.some(Rt=>Rt.route.id===De.routeId))return;let Be=ah(U,De.path,V);if(!Be){se.push({key:He,routeId:De.routeId,path:De.path,matches:null,match:null,controller:null});return}let ut=n.fetchers.get(He),Ie=Hx(Be,De.path),Je=!1;R.has(He)?Je=!1:s.includes(He)?Je=!0:ut&&ut.state!=="idle"&&ut.data===void 0?Je=y:Je=kT(Ie,ar({currentUrl:K,currentParams:n.matches[n.matches.length-1].params,nextUrl:Ce,nextParams:l[l.length-1].params},h,{actionResult:Y,defaultShouldRevalidate:y})),Je&&se.push({key:He,routeId:De.routeId,path:De.path,matches:Be,match:Ie,controller:new AbortController})}),[ce,se]}function _L(e,n,l){let h=!n||l.route.id!==n.route.id,m=e[l.route.id]===void 0;return h||m}function aM(e,n){let l=e.route.path;return e.pathname!==n.pathname||l!=null&&l.endsWith("*")&&e.params["*"]!==n.params["*"]}function kT(e,n){if(e.route.shouldRevalidate){let l=e.route.shouldRevalidate(n);if(typeof l=="boolean")return l}return n.defaultShouldRevalidate}async function PT(e,n,l){if(!e.lazy)return;let h=await e.lazy();if(!e.lazy)return;let m=l[e.id];sn(m,"No route found in manifest");let y={};for(let b in h){let A=m[b]!==void 0&&b!=="hasErrorBoundary";Ch(!A,'Route "'+m.id+'" has a static property "'+b+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+b+'" will be ignored.')),!A&&!jD.has(b)&&(y[b]=h[b])}Object.assign(m,y),Object.assign(m,ar({},n(m),{lazy:void 0}))}async function Ip(e,n,l,h,m,y,b,s){s===void 0&&(s={});let A,R,U,V=Y=>{let K,Ce=new Promise((ee,ne)=>K=ne);return U=()=>K(),n.signal.addEventListener("abort",U),Promise.race([Y({request:n,params:l.params,context:s.requestContext}),Ce])};try{let Y=l.route[e];if(l.route.lazy)if(Y)R=(await Promise.all([V(Y),PT(l.route,y,m)]))[0];else if(await PT(l.route,y,m),Y=l.route[e],Y)R=await V(Y);else if(e==="action"){let K=new URL(n.url),Ce=K.pathname+K.search;throw Bo(405,{method:n.method,pathname:Ce,routeId:l.route.id})}else return{type:kr.data,data:void 0};else if(Y)R=await V(Y);else{let K=new URL(n.url),Ce=K.pathname+K.search;throw Bo(404,{pathname:Ce})}sn(R!==void 0,"You defined "+(e==="action"?"an action":"a loader")+" for route "+('"'+l.route.id+"\" but didn't return anything from your `"+e+"` ")+"function. Please return a value or `null`.")}catch(Y){A=kr.error,R=Y}finally{U&&n.signal.removeEventListener("abort",U)}if(wL(R)){let Y=R.status;if(uL.has(Y)){let ee=R.headers.get("Location");if(sn(ee,"Redirects returned/thrown from loaders/actions must have a Location header"),!sM.test(ee))ee=Wx(new URL(n.url),h.slice(0,h.indexOf(l)+1),b,!0,ee);else if(!s.isStaticRequest){let ne=new URL(n.url),ce=ee.startsWith("//")?new URL(ne.protocol+ee):new URL(ee),se=Lh(ce.pathname,b)!=null;ce.origin===ne.origin&&se&&(ee=ce.pathname+ce.search+ce.hash)}if(s.isStaticRequest)throw R.headers.set("Location",ee),R;return{type:kr.redirect,status:Y,location:ee,revalidate:R.headers.get("X-Remix-Revalidate")!==null,reloadDocument:R.headers.get("X-Remix-Reload-Document")!==null}}if(s.isRouteRequest)throw{type:A===kr.error?kr.error:kr.data,response:R};let K,Ce=R.headers.get("Content-Type");return Ce&&/\bapplication\/json\b/.test(Ce)?K=await R.json():K=await R.text(),A===kr.error?{type:A,error:new lw(Y,R.statusText,K),headers:R.headers}:{type:kr.data,data:K,statusCode:R.status,headers:R.headers}}if(A===kr.error)return{type:A,error:R};if(xL(R)){var $,pe;return{type:kr.deferred,deferredData:R,statusCode:($=R.init)==null?void 0:$.status,headers:((pe=R.init)==null?void 0:pe.headers)&&new Headers(R.init.headers)}}return{type:kr.data,data:R}}function kp(e,n,l,h){let m=e.createURL(lM(n)).toString(),y={signal:l};if(h&&_s(h.formMethod)){let{formMethod:b,formEncType:s}=h;y.method=b.toUpperCase(),s==="application/json"?(y.headers=new Headers({"Content-Type":s}),y.body=JSON.stringify(h.json)):s==="text/plain"?y.body=h.text:s==="application/x-www-form-urlencoded"&&h.formData?y.body=Zx(h.formData):y.body=h.formData}return new Request(m,y)}function Zx(e){let n=new URLSearchParams;for(let[l,h]of e.entries())n.append(l,typeof h=="string"?h:h.name);return n}function zT(e){let n=new FormData;for(let[l,h]of e.entries())n.append(l,h);return n}function yL(e,n,l,h,m){let y={},b=null,s,A=!1,R={};return l.forEach((U,V)=>{let $=n[V].route.id;if(sn(!mh(U),"Cannot handle redirect results in processLoaderData"),ef(U)){let pe=lh(e,$),Y=U.error;h&&(Y=Object.values(h)[0],h=void 0),b=b||{},b[pe.route.id]==null&&(b[pe.route.id]=Y),y[$]=void 0,A||(A=!0,s=iM(U.error)?U.error.status:500),U.headers&&(R[$]=U.headers)}else Cc(U)?(m.set($,U.deferredData),y[$]=U.deferredData.data):y[$]=U.data,U.statusCode!=null&&U.statusCode!==200&&!A&&(s=U.statusCode),U.headers&&(R[$]=U.headers)}),h&&(b=h,y[Object.keys(h)[0]]=void 0),{loaderData:y,errors:b,statusCode:s||200,loaderHeaders:R}}function RT(e,n,l,h,m,y,b,s){let{loaderData:A,errors:R}=yL(n,l,h,m,s);for(let U=0;U<y.length;U++){let{key:V,match:$,controller:pe}=y[U];sn(b!==void 0&&b[U]!==void 0,"Did not find corresponding fetcher result");let Y=b[U];if(!(pe&&pe.signal.aborted))if(ef(Y)){let K=lh(e.matches,$==null?void 0:$.route.id);R&&R[K.route.id]||(R=ar({},R,{[K.route.id]:Y.error})),e.fetchers.delete(V)}else if(mh(Y))sn(!1,"Unhandled fetcher revalidation redirect");else if(Cc(Y))sn(!1,"Unhandled fetcher deferred data");else{let K=Wu(Y.data);e.fetchers.set(V,K)}}return{loaderData:A,errors:R}}function DT(e,n,l,h){let m=ar({},n);for(let y of l){let b=y.route.id;if(n.hasOwnProperty(b)?n[b]!==void 0&&(m[b]=n[b]):e[b]!==void 0&&y.route.loader&&(m[b]=e[b]),h&&h.hasOwnProperty(b))break}return m}function lh(e,n){return(n?e.slice(0,e.findIndex(h=>h.route.id===n)+1):[...e]).reverse().find(h=>h.route.hasErrorBoundary===!0)||e[0]}function LT(e){let n=e.find(l=>l.index||!l.path||l.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:n}],route:n}}function Bo(e,n){let{pathname:l,routeId:h,method:m,type:y}=n===void 0?{}:n,b="Unknown Server Error",s="Unknown @remix-run/router error";return e===400?(b="Bad Request",m&&l&&h?s="You made a "+m+' request to "'+l+'" but '+('did not provide a `loader` for route "'+h+'", ')+"so there is no way to handle the request.":y==="defer-action"?s="defer() is not supported in actions":y==="invalid-body"&&(s="Unable to encode submission body")):e===403?(b="Forbidden",s='Route "'+h+'" does not match URL "'+l+'"'):e===404?(b="Not Found",s='No route matches URL "'+l+'"'):e===405&&(b="Method Not Allowed",m&&l&&h?s="You made a "+m.toUpperCase()+' request to "'+l+'" but '+('did not provide an `action` for route "'+h+'", ')+"so there is no way to handle the request.":m&&(s='Invalid request method "'+m.toUpperCase()+'"')),new lw(e||500,b,new Error(s),!0)}function OT(e){for(let n=e.length-1;n>=0;n--){let l=e[n];if(mh(l))return{result:l,idx:n}}}function lM(e){let n=typeof e=="string"?Sa(e):e;return Oc(ar({},n,{hash:""}))}function vL(e,n){return e.pathname!==n.pathname||e.search!==n.search?!1:e.hash===""?n.hash!=="":e.hash===n.hash?!0:n.hash!==""}function Cc(e){return e.type===kr.deferred}function ef(e){return e.type===kr.error}function mh(e){return(e&&e.type)===kr.redirect}function xL(e){let n=e;return n&&typeof n=="object"&&typeof n.data=="object"&&typeof n.subscribe=="function"&&typeof n.cancel=="function"&&typeof n.resolveData=="function"}function wL(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function bL(e){return cL.has(e.toLowerCase())}function _s(e){return aL.has(e.toLowerCase())}async function BT(e,n,l,h,m,y){for(let b=0;b<l.length;b++){let s=l[b],A=n[b];if(!A)continue;let R=e.find(V=>V.route.id===A.route.id),U=R!=null&&!aM(R,A)&&(y&&y[A.route.id])!==void 0;if(Cc(s)&&(m||U)){let V=h[b];sn(V,"Expected an AbortSignal for revalidating fetcher deferred result"),await cM(s,V,m).then($=>{$&&(l[b]=$||l[b])})}}}async function cM(e,n,l){if(l===void 0&&(l=!1),!await e.deferredData.resolveData(n)){if(l)try{return{type:kr.data,data:e.deferredData.unwrappedData}}catch(m){return{type:kr.error,error:m}}return{type:kr.data,data:e.deferredData.data}}}function cw(e){return new URLSearchParams(e).getAll("index").some(n=>n==="")}function EL(e,n){let{route:l,pathname:h,params:m}=e;return{id:l.id,pathname:h,params:m,data:n[l.id],handle:l.handle}}function Hx(e,n){let l=typeof n=="string"?Sa(n).search:n.search;if(e[e.length-1].route.index&&cw(l||""))return e[e.length-1];let h=Df(e);return h[h.length-1]}function FT(e){let{formMethod:n,formAction:l,formEncType:h,text:m,formData:y,json:b}=e;if(!(!n||!l||!h)){if(m!=null)return{formMethod:n,formAction:l,formEncType:h,formData:void 0,json:void 0,text:m};if(y!=null)return{formMethod:n,formAction:l,formEncType:h,formData:y,json:void 0,text:void 0};if(b!==void 0)return{formMethod:n,formAction:l,formEncType:h,formData:void 0,json:b,text:void 0}}}function kg(e,n){return n?{state:"loading",location:e,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function TL(e,n){return{state:"submitting",location:e,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}}function Pp(e,n){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:n," _hasFetcherDoneAnything ":!0}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n," _hasFetcherDoneAnything ":!0}}function SL(e,n){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:n?n.data:void 0," _hasFetcherDoneAnything ":!0}}function Wu(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e," _hasFetcherDoneAnything ":!0}}/**
 * React Router v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function I_(){return I_=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(e[h]=l[h])}return e},I_.apply(this,arguments)}const ty=Te.createContext(null),uM=Te.createContext(null),Oh=Te.createContext(null),ny=Te.createContext(null),$s=Te.createContext({outlet:null,matches:[],isDataRoute:!1}),hM=Te.createContext(null);function CL(e,n){let{relative:l}=n===void 0?{}:n;Bh()||sn(!1);let{basename:h,navigator:m}=Te.useContext(Oh),{hash:y,pathname:b,search:s}=pM(e,{relative:l}),A=b;return h!=="/"&&(A=b==="/"?h:ga([h,b])),m.createHref({pathname:A,search:s,hash:y})}function Bh(){return Te.useContext(ny)!=null}function Ca(){return Bh()||sn(!1),Te.useContext(ny).location}function dM(e){Te.useContext(Oh).static||Te.useLayoutEffect(e)}function Fh(){let{isDataRoute:e}=Te.useContext($s);return e?jL():AL()}function AL(){Bh()||sn(!1);let e=Te.useContext(ty),{basename:n,navigator:l}=Te.useContext(Oh),{matches:h}=Te.useContext($s),{pathname:m}=Ca(),y=JSON.stringify(Df(h).map(A=>A.pathnameBase)),b=Te.useRef(!1);return dM(()=>{b.current=!0}),Te.useCallback(function(A,R){if(R===void 0&&(R={}),!b.current)return;if(typeof A=="number"){l.go(A);return}let U=ey(A,JSON.parse(y),m,R.relative==="path");e==null&&n!=="/"&&(U.pathname=U.pathname==="/"?n:ga([n,U.pathname])),(R.replace?l.replace:l.push)(U,R.state,R)},[n,l,y,m,e])}const ML=Te.createContext(null);function IL(e){let n=Te.useContext($s).outlet;return n&&Te.createElement(ML.Provider,{value:e},n)}function kL(){let{matches:e}=Te.useContext($s),n=e[e.length-1];return n?n.params:{}}function pM(e,n){let{relative:l}=n===void 0?{}:n,{matches:h}=Te.useContext($s),{pathname:m}=Ca(),y=JSON.stringify(Df(h).map(b=>b.pathnameBase));return Te.useMemo(()=>ey(e,JSON.parse(y),m,l==="path"),[e,y,m,l])}function PL(e,n,l){Bh()||sn(!1);let{navigator:h}=Te.useContext(Oh),{matches:m}=Te.useContext($s),y=m[m.length-1],b=y?y.params:{};y&&y.pathname;let s=y?y.pathnameBase:"/";y&&y.route;let A=Ca(),R;if(n){var U;let K=typeof n=="string"?Sa(n):n;s==="/"||(U=K.pathname)!=null&&U.startsWith(s)||sn(!1),R=K}else R=A;let V=R.pathname||"/",$=s==="/"?V:V.slice(s.length)||"/",pe=ah(e,{pathname:$}),Y=OL(pe&&pe.map(K=>Object.assign({},K,{params:Object.assign({},b,K.params),pathname:ga([s,h.encodeLocation?h.encodeLocation(K.pathname).pathname:K.pathname]),pathnameBase:K.pathnameBase==="/"?s:ga([s,h.encodeLocation?h.encodeLocation(K.pathnameBase).pathname:K.pathnameBase])})),m,l);return n&&Y?Te.createElement(ny.Provider,{value:{location:I_({pathname:"/",search:"",hash:"",state:null,key:"default"},R),navigationType:Ur.Pop}},Y):Y}function zL(){let e=gM(),n=iM(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),l=e instanceof Error?e.stack:null,m={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},y=null;return Te.createElement(Te.Fragment,null,Te.createElement("h2",null,"Unexpected Application Error!"),Te.createElement("h3",{style:{fontStyle:"italic"}},n),l?Te.createElement("pre",{style:m},l):null,y)}const RL=Te.createElement(zL,null);class DL extends Te.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,l){return l.location!==n.location||l.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error||l.error,location:l.location,revalidation:n.revalidation||l.revalidation}}componentDidCatch(n,l){console.error("React Router caught the following error during render",n,l)}render(){return this.state.error?Te.createElement($s.Provider,{value:this.props.routeContext},Te.createElement(hM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function LL(e){let{routeContext:n,match:l,children:h}=e,m=Te.useContext(ty);return m&&m.static&&m.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(m.staticContext._deepestRenderedBoundaryId=l.route.id),Te.createElement($s.Provider,{value:n},h)}function OL(e,n,l){var h;if(n===void 0&&(n=[]),l===void 0&&(l=null),e==null){var m;if((m=l)!=null&&m.errors)e=l.matches;else return null}let y=e,b=(h=l)==null?void 0:h.errors;if(b!=null){let s=y.findIndex(A=>A.route.id&&(b==null?void 0:b[A.route.id]));s>=0||sn(!1),y=y.slice(0,Math.min(y.length,s+1))}return y.reduceRight((s,A,R)=>{let U=A.route.id?b==null?void 0:b[A.route.id]:null,V=null;l&&(V=A.route.errorElement||RL);let $=n.concat(y.slice(0,R+1)),pe=()=>{let Y;return U?Y=V:A.route.Component?Y=Te.createElement(A.route.Component,null):A.route.element?Y=A.route.element:Y=s,Te.createElement(LL,{match:A,routeContext:{outlet:s,matches:$,isDataRoute:l!=null},children:Y})};return l&&(A.route.ErrorBoundary||A.route.errorElement||R===0)?Te.createElement(DL,{location:l.location,revalidation:l.revalidation,component:V,error:U,children:pe(),routeContext:{outlet:null,matches:$,isDataRoute:!0}}):pe()},null)}var fM=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(fM||{}),Ah=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ah||{});function BL(e){let n=Te.useContext(ty);return n||sn(!1),n}function mM(e){let n=Te.useContext(uM);return n||sn(!1),n}function FL(e){let n=Te.useContext($s);return n||sn(!1),n}function uw(e){let n=FL(),l=n.matches[n.matches.length-1];return l.route.id||sn(!1),l.route.id}function NL(){let e=mM(Ah.UseLoaderData),n=uw(Ah.UseLoaderData);if(e.errors&&e.errors[n]!=null){console.error("You cannot `useLoaderData` in an errorElement (routeId: "+n+")");return}return e.loaderData[n]}function gM(){var e;let n=Te.useContext(hM),l=mM(Ah.UseRouteError),h=uw(Ah.UseRouteError);return n||((e=l.errors)==null?void 0:e[h])}function jL(){let{router:e}=BL(fM.UseNavigateStable),n=uw(Ah.UseNavigateStable),l=Te.useRef(!1);return dM(()=>{l.current=!0}),Te.useCallback(function(m,y){y===void 0&&(y={}),l.current&&(typeof m=="number"?e.navigate(m):e.navigate(m,I_({fromRouteId:n},y)))},[e,n])}const UL="startTransition",NT=i_[UL];function VL(e){let{fallbackElement:n,router:l,future:h}=e,[m,y]=Te.useState(l.state),{v7_startTransition:b}=h||{},s=Te.useCallback(V=>{b&&NT?NT(()=>y(V)):y(V)},[y,b]);Te.useLayoutEffect(()=>l.subscribe(s),[l,s]);let A=Te.useMemo(()=>({createHref:l.createHref,encodeLocation:l.encodeLocation,go:V=>l.navigate(V),push:(V,$,pe)=>l.navigate(V,{state:$,preventScrollReset:pe==null?void 0:pe.preventScrollReset}),replace:(V,$,pe)=>l.navigate(V,{replace:!0,state:$,preventScrollReset:pe==null?void 0:pe.preventScrollReset})}),[l]),R=l.basename||"/",U=Te.useMemo(()=>({router:l,navigator:A,static:!1,basename:R}),[l,A,R]);return Te.createElement(Te.Fragment,null,Te.createElement(ty.Provider,{value:U},Te.createElement(uM.Provider,{value:m},Te.createElement(qL,{basename:R,location:m.location,navigationType:m.historyAction,navigator:A},m.initialized?Te.createElement($L,{routes:l.routes,state:m}):n))),null)}function $L(e){let{routes:n,state:l}=e;return PL(n,void 0,l)}function GL(e){let{to:n,replace:l,state:h,relative:m}=e;Bh()||sn(!1);let{matches:y}=Te.useContext($s),{pathname:b}=Ca(),s=Fh(),A=ey(n,Df(y).map(U=>U.pathnameBase),b,m==="path"),R=JSON.stringify(A);return Te.useEffect(()=>s(JSON.parse(R),{replace:l,state:h,relative:m}),[s,R,m,l,h]),null}function hw(e){return IL(e.context)}function ca(e){sn(!1)}function qL(e){let{basename:n="/",children:l=null,location:h,navigationType:m=Ur.Pop,navigator:y,static:b=!1}=e;Bh()&&sn(!1);let s=n.replace(/^\/*/,"/"),A=Te.useMemo(()=>({basename:s,navigator:y,static:b}),[s,y,b]);typeof h=="string"&&(h=Sa(h));let{pathname:R="/",search:U="",hash:V="",state:$=null,key:pe="default"}=h,Y=Te.useMemo(()=>{let K=Lh(R,s);return K==null?null:{location:{pathname:K,search:U,hash:V,state:$,key:pe},navigationType:m}},[s,R,U,V,$,pe,m]);return Y==null?null:Te.createElement(Oh.Provider,{value:A},Te.createElement(ny.Provider,{children:l,value:Y}))}new Promise(()=>{});function Xx(e,n){n===void 0&&(n=[]);let l=[];return Te.Children.forEach(e,(h,m)=>{if(!Te.isValidElement(h))return;let y=[...n,m];if(h.type===Te.Fragment){l.push.apply(l,Xx(h.props.children,y));return}h.type!==ca&&sn(!1),!h.props.index||!h.props.children||sn(!1);let b={id:h.props.id||y.join("-"),caseSensitive:h.props.caseSensitive,element:h.props.element,Component:h.props.Component,index:h.props.index,path:h.props.path,loader:h.props.loader,action:h.props.action,errorElement:h.props.errorElement,ErrorBoundary:h.props.ErrorBoundary,hasErrorBoundary:h.props.ErrorBoundary!=null||h.props.errorElement!=null,shouldRevalidate:h.props.shouldRevalidate,handle:h.props.handle,lazy:h.props.lazy};h.props.children&&(b.children=Xx(h.props.children,y)),l.push(b)}),l}function WL(e){let n={hasErrorBoundary:e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&Object.assign(n,{element:Te.createElement(e.Component),Component:void 0}),e.ErrorBoundary&&Object.assign(n,{errorElement:Te.createElement(e.ErrorBoundary),ErrorBoundary:void 0}),n}/**
 * React Router DOM v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ef(){return Ef=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(e[h]=l[h])}return e},Ef.apply(this,arguments)}function ZL(e,n){if(e==null)return{};var l={},h=Object.keys(e),m,y;for(y=0;y<h.length;y++)m=h[y],!(n.indexOf(m)>=0)&&(l[m]=e[m]);return l}function HL(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function XL(e,n){return e.button===0&&(!n||n==="_self")&&!HL(e)}const KL=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];function YL(e,n){return fL({basename:n==null?void 0:n.basename,future:Ef({},n==null?void 0:n.future,{v7_prependBasename:!0}),history:BD({window:n==null?void 0:n.window}),hydrationData:(n==null?void 0:n.hydrationData)||JL(),routes:e,mapRouteProperties:WL}).initialize()}function JL(){var e;let n=(e=window)==null?void 0:e.__staticRouterHydrationData;return n&&n.errors&&(n=Ef({},n,{errors:QL(n.errors)})),n}function QL(e){if(!e)return null;let n=Object.entries(e),l={};for(let[h,m]of n)if(m&&m.__type==="RouteErrorResponse")l[h]=new lw(m.status,m.statusText,m.data,m.internal===!0);else if(m&&m.__type==="Error"){if(m.__subType){let y=window[m.__subType];if(typeof y=="function")try{let b=new y(m.message);b.stack="",l[h]=b}catch{}}if(l[h]==null){let y=new Error(m.message);y.stack="",l[h]=y}}else l[h]=m;return l}const e3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",t3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Kx=Te.forwardRef(function(n,l){let{onClick:h,relative:m,reloadDocument:y,replace:b,state:s,target:A,to:R,preventScrollReset:U}=n,V=ZL(n,KL),{basename:$}=Te.useContext(Oh),pe,Y=!1;if(typeof R=="string"&&t3.test(R)&&(pe=R,e3))try{let ne=new URL(window.location.href),ce=R.startsWith("//")?new URL(ne.protocol+R):new URL(R),se=Lh(ce.pathname,$);ce.origin===ne.origin&&se!=null?R=se+ce.search+ce.hash:Y=!0}catch{}let K=CL(R,{relative:m}),Ce=n3(R,{replace:b,state:s,target:A,preventScrollReset:U,relative:m});function ee(ne){h&&h(ne),ne.defaultPrevented||Ce(ne)}return Te.createElement("a",Ef({},V,{href:pe||K,onClick:Y||y?h:ee,ref:l,target:A}))});var jT;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher"})(jT||(jT={}));var UT;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(UT||(UT={}));function n3(e,n){let{target:l,replace:h,state:m,preventScrollReset:y,relative:b}=n===void 0?{}:n,s=Fh(),A=Ca(),R=pM(e,{relative:b});return Te.useCallback(U=>{if(XL(U,l)){U.preventDefault();let V=h!==void 0?h:Oc(A)===Oc(R);s(e,{replace:V,state:m,preventScrollReset:y,relative:b})}},[A,s,R,h,m,l,e,y,b])}const r3={},i3=(e,n)=>{var l,h;switch(n.type){case"logging":{const{user:m,accessToken:y}=n.payload;return{...e,user:m,accessToken:y}}case"updateAcessToken":{const{user:m,accessToken:y}=n.payload;return{...e,user:m,accessToken:y}}case"logout":return{...e,user:void 0,accessToken:void 0};case"updateUserInfo":{const{name:m,email:y}=n.payload;return{...e,user:{...e.user,name:m!==void 0?m:(l=e.user)==null?void 0:l.name,email:y!==void 0?y:(h=e.user)==null?void 0:h.email}}}case"updateUserPassword":{const{accessToken:m}=n.payload;return{...e,accessToken:m}}default:return{...e}}},Yx=Te.createContext(null),o3=({children:e})=>{const[n,l]=Te.useReducer(i3,r3),[h,m]=Te.useState(()=>{const y=localStorage.getItem("persist");return y!==null?JSON.parse(y):!1});return Q.jsx(Yx.Provider,{value:{auth:n,dispatchAuth:l,persist:h,setPersist:m},children:e})},Aa=()=>{const{auth:e}=Te.useContext(Yx);return Te.useDebugValue(e,n=>n!=null&&n.user?"Logged In":"Logged Out"),Te.useContext(Yx)};function _M(e,n){return function(){return e.apply(n,arguments)}}const{toString:s3}=Object.prototype,{getPrototypeOf:dw}=Object,ry=(e=>n=>{const l=s3.call(n);return e[l]||(e[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),Gs=e=>(e=e.toLowerCase(),n=>ry(n)===e),iy=e=>n=>typeof n===e,{isArray:Nh}=Array,Tf=iy("undefined");function a3(e){return e!==null&&!Tf(e)&&e.constructor!==null&&!Tf(e.constructor)&&$o(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const yM=Gs("ArrayBuffer");function l3(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&yM(e.buffer),n}const c3=iy("string"),$o=iy("function"),vM=iy("number"),oy=e=>e!==null&&typeof e=="object",u3=e=>e===!0||e===!1,Hg=e=>{if(ry(e)!=="object")return!1;const n=dw(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},h3=Gs("Date"),d3=Gs("File"),p3=Gs("Blob"),f3=Gs("FileList"),m3=e=>oy(e)&&$o(e.pipe),g3=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||$o(e.append)&&((n=ry(e))==="formdata"||n==="object"&&$o(e.toString)&&e.toString()==="[object FormData]"))},_3=Gs("URLSearchParams"),y3=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Lf(e,n,{allOwnKeys:l=!1}={}){if(e===null||typeof e>"u")return;let h,m;if(typeof e!="object"&&(e=[e]),Nh(e))for(h=0,m=e.length;h<m;h++)n.call(null,e[h],h,e);else{const y=l?Object.getOwnPropertyNames(e):Object.keys(e),b=y.length;let s;for(h=0;h<b;h++)s=y[h],n.call(null,e[s],s,e)}}function xM(e,n){n=n.toLowerCase();const l=Object.keys(e);let h=l.length,m;for(;h-- >0;)if(m=l[h],n===m.toLowerCase())return m;return null}const wM=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),bM=e=>!Tf(e)&&e!==wM;function Jx(){const{caseless:e}=bM(this)&&this||{},n={},l=(h,m)=>{const y=e&&xM(n,m)||m;Hg(n[y])&&Hg(h)?n[y]=Jx(n[y],h):Hg(h)?n[y]=Jx({},h):Nh(h)?n[y]=h.slice():n[y]=h};for(let h=0,m=arguments.length;h<m;h++)arguments[h]&&Lf(arguments[h],l);return n}const v3=(e,n,l,{allOwnKeys:h}={})=>(Lf(n,(m,y)=>{l&&$o(m)?e[y]=_M(m,l):e[y]=m},{allOwnKeys:h}),e),x3=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),w3=(e,n,l,h)=>{e.prototype=Object.create(n.prototype,h),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),l&&Object.assign(e.prototype,l)},b3=(e,n,l,h)=>{let m,y,b;const s={};if(n=n||{},e==null)return n;do{for(m=Object.getOwnPropertyNames(e),y=m.length;y-- >0;)b=m[y],(!h||h(b,e,n))&&!s[b]&&(n[b]=e[b],s[b]=!0);e=l!==!1&&dw(e)}while(e&&(!l||l(e,n))&&e!==Object.prototype);return n},E3=(e,n,l)=>{e=String(e),(l===void 0||l>e.length)&&(l=e.length),l-=n.length;const h=e.indexOf(n,l);return h!==-1&&h===l},T3=e=>{if(!e)return null;if(Nh(e))return e;let n=e.length;if(!vM(n))return null;const l=new Array(n);for(;n-- >0;)l[n]=e[n];return l},S3=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&dw(Uint8Array)),C3=(e,n)=>{const h=(e&&e[Symbol.iterator]).call(e);let m;for(;(m=h.next())&&!m.done;){const y=m.value;n.call(e,y[0],y[1])}},A3=(e,n)=>{let l;const h=[];for(;(l=e.exec(n))!==null;)h.push(l);return h},M3=Gs("HTMLFormElement"),I3=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,h,m){return h.toUpperCase()+m}),VT=(({hasOwnProperty:e})=>(n,l)=>e.call(n,l))(Object.prototype),k3=Gs("RegExp"),EM=(e,n)=>{const l=Object.getOwnPropertyDescriptors(e),h={};Lf(l,(m,y)=>{n(m,y,e)!==!1&&(h[y]=m)}),Object.defineProperties(e,h)},P3=e=>{EM(e,(n,l)=>{if($o(e)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const h=e[l];if($o(h)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},z3=(e,n)=>{const l={},h=m=>{m.forEach(y=>{l[y]=!0})};return Nh(e)?h(e):h(String(e).split(n)),l},R3=()=>{},D3=(e,n)=>(e=+e,Number.isFinite(e)?e:n),Bv="abcdefghijklmnopqrstuvwxyz",$T="0123456789",TM={DIGIT:$T,ALPHA:Bv,ALPHA_DIGIT:Bv+Bv.toUpperCase()+$T},L3=(e=16,n=TM.ALPHA_DIGIT)=>{let l="";const{length:h}=n;for(;e--;)l+=n[Math.random()*h|0];return l};function O3(e){return!!(e&&$o(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const B3=e=>{const n=new Array(10),l=(h,m)=>{if(oy(h)){if(n.indexOf(h)>=0)return;if(!("toJSON"in h)){n[m]=h;const y=Nh(h)?[]:{};return Lf(h,(b,s)=>{const A=l(b,m+1);!Tf(A)&&(y[s]=A)}),n[m]=void 0,y}}return h};return l(e,0)},F3=Gs("AsyncFunction"),N3=e=>e&&(oy(e)||$o(e))&&$o(e.then)&&$o(e.catch),Ye={isArray:Nh,isArrayBuffer:yM,isBuffer:a3,isFormData:g3,isArrayBufferView:l3,isString:c3,isNumber:vM,isBoolean:u3,isObject:oy,isPlainObject:Hg,isUndefined:Tf,isDate:h3,isFile:d3,isBlob:p3,isRegExp:k3,isFunction:$o,isStream:m3,isURLSearchParams:_3,isTypedArray:S3,isFileList:f3,forEach:Lf,merge:Jx,extend:v3,trim:y3,stripBOM:x3,inherits:w3,toFlatObject:b3,kindOf:ry,kindOfTest:Gs,endsWith:E3,toArray:T3,forEachEntry:C3,matchAll:A3,isHTMLForm:M3,hasOwnProperty:VT,hasOwnProp:VT,reduceDescriptors:EM,freezeMethods:P3,toObjectSet:z3,toCamelCase:I3,noop:R3,toFiniteNumber:D3,findKey:xM,global:wM,isContextDefined:bM,ALPHABET:TM,generateString:L3,isSpecCompliantForm:O3,toJSONObject:B3,isAsyncFn:F3,isThenable:N3};function wn(e,n,l,h,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),l&&(this.config=l),h&&(this.request=h),m&&(this.response=m)}Ye.inherits(wn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ye.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const SM=wn.prototype,CM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{CM[e]={value:e}});Object.defineProperties(wn,CM);Object.defineProperty(SM,"isAxiosError",{value:!0});wn.from=(e,n,l,h,m,y)=>{const b=Object.create(SM);return Ye.toFlatObject(e,b,function(A){return A!==Error.prototype},s=>s!=="isAxiosError"),wn.call(b,e.message,n,l,h,m),b.cause=e,b.name=e.name,y&&Object.assign(b,y),b};const j3=null;function Qx(e){return Ye.isPlainObject(e)||Ye.isArray(e)}function AM(e){return Ye.endsWith(e,"[]")?e.slice(0,-2):e}function GT(e,n,l){return e?e.concat(n).map(function(m,y){return m=AM(m),!l&&y?"["+m+"]":m}).join(l?".":""):n}function U3(e){return Ye.isArray(e)&&!e.some(Qx)}const V3=Ye.toFlatObject(Ye,{},null,function(n){return/^is[A-Z]/.test(n)});function sy(e,n,l){if(!Ye.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,l=Ye.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(K,Ce){return!Ye.isUndefined(Ce[K])});const h=l.metaTokens,m=l.visitor||U,y=l.dots,b=l.indexes,A=(l.Blob||typeof Blob<"u"&&Blob)&&Ye.isSpecCompliantForm(n);if(!Ye.isFunction(m))throw new TypeError("visitor must be a function");function R(Y){if(Y===null)return"";if(Ye.isDate(Y))return Y.toISOString();if(!A&&Ye.isBlob(Y))throw new wn("Blob is not supported. Use a Buffer instead.");return Ye.isArrayBuffer(Y)||Ye.isTypedArray(Y)?A&&typeof Blob=="function"?new Blob([Y]):Buffer.from(Y):Y}function U(Y,K,Ce){let ee=Y;if(Y&&!Ce&&typeof Y=="object"){if(Ye.endsWith(K,"{}"))K=h?K:K.slice(0,-2),Y=JSON.stringify(Y);else if(Ye.isArray(Y)&&U3(Y)||(Ye.isFileList(Y)||Ye.endsWith(K,"[]"))&&(ee=Ye.toArray(Y)))return K=AM(K),ee.forEach(function(ce,se){!(Ye.isUndefined(ce)||ce===null)&&n.append(b===!0?GT([K],se,y):b===null?K:K+"[]",R(ce))}),!1}return Qx(Y)?!0:(n.append(GT(Ce,K,y),R(Y)),!1)}const V=[],$=Object.assign(V3,{defaultVisitor:U,convertValue:R,isVisitable:Qx});function pe(Y,K){if(!Ye.isUndefined(Y)){if(V.indexOf(Y)!==-1)throw Error("Circular reference detected in "+K.join("."));V.push(Y),Ye.forEach(Y,function(ee,ne){(!(Ye.isUndefined(ee)||ee===null)&&m.call(n,ee,Ye.isString(ne)?ne.trim():ne,K,$))===!0&&pe(ee,K?K.concat(ne):[ne])}),V.pop()}}if(!Ye.isObject(e))throw new TypeError("data must be an object");return pe(e),n}function qT(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(h){return n[h]})}function pw(e,n){this._pairs=[],e&&sy(e,this,n)}const MM=pw.prototype;MM.append=function(n,l){this._pairs.push([n,l])};MM.toString=function(n){const l=n?function(h){return n.call(this,h,qT)}:qT;return this._pairs.map(function(m){return l(m[0])+"="+l(m[1])},"").join("&")};function $3(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function IM(e,n,l){if(!n)return e;const h=l&&l.encode||$3,m=l&&l.serialize;let y;if(m?y=m(n,l):y=Ye.isURLSearchParams(n)?n.toString():new pw(n,l).toString(h),y){const b=e.indexOf("#");b!==-1&&(e=e.slice(0,b)),e+=(e.indexOf("?")===-1?"?":"&")+y}return e}class G3{constructor(){this.handlers=[]}use(n,l,h){return this.handlers.push({fulfilled:n,rejected:l,synchronous:h?h.synchronous:!1,runWhen:h?h.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){Ye.forEach(this.handlers,function(h){h!==null&&n(h)})}}const WT=G3,kM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},q3=typeof URLSearchParams<"u"?URLSearchParams:pw,W3=typeof FormData<"u"?FormData:null,Z3=typeof Blob<"u"?Blob:null,H3=(()=>{let e;return typeof navigator<"u"&&((e=navigator.product)==="ReactNative"||e==="NativeScript"||e==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),X3=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Ns={isBrowser:!0,classes:{URLSearchParams:q3,FormData:W3,Blob:Z3},isStandardBrowserEnv:H3,isStandardBrowserWebWorkerEnv:X3,protocols:["http","https","file","blob","url","data"]};function K3(e,n){return sy(e,new Ns.classes.URLSearchParams,Object.assign({visitor:function(l,h,m,y){return Ns.isNode&&Ye.isBuffer(l)?(this.append(h,l.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},n))}function Y3(e){return Ye.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function J3(e){const n={},l=Object.keys(e);let h;const m=l.length;let y;for(h=0;h<m;h++)y=l[h],n[y]=e[y];return n}function PM(e){function n(l,h,m,y){let b=l[y++];const s=Number.isFinite(+b),A=y>=l.length;return b=!b&&Ye.isArray(m)?m.length:b,A?(Ye.hasOwnProp(m,b)?m[b]=[m[b],h]:m[b]=h,!s):((!m[b]||!Ye.isObject(m[b]))&&(m[b]=[]),n(l,h,m[b],y)&&Ye.isArray(m[b])&&(m[b]=J3(m[b])),!s)}if(Ye.isFormData(e)&&Ye.isFunction(e.entries)){const l={};return Ye.forEachEntry(e,(h,m)=>{n(Y3(h),m,l,0)}),l}return null}const Q3={"Content-Type":void 0};function eO(e,n,l){if(Ye.isString(e))try{return(n||JSON.parse)(e),Ye.trim(e)}catch(h){if(h.name!=="SyntaxError")throw h}return(l||JSON.stringify)(e)}const ay={transitional:kM,adapter:["xhr","http"],transformRequest:[function(n,l){const h=l.getContentType()||"",m=h.indexOf("application/json")>-1,y=Ye.isObject(n);if(y&&Ye.isHTMLForm(n)&&(n=new FormData(n)),Ye.isFormData(n))return m&&m?JSON.stringify(PM(n)):n;if(Ye.isArrayBuffer(n)||Ye.isBuffer(n)||Ye.isStream(n)||Ye.isFile(n)||Ye.isBlob(n))return n;if(Ye.isArrayBufferView(n))return n.buffer;if(Ye.isURLSearchParams(n))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let s;if(y){if(h.indexOf("application/x-www-form-urlencoded")>-1)return K3(n,this.formSerializer).toString();if((s=Ye.isFileList(n))||h.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return sy(s?{"files[]":n}:n,A&&new A,this.formSerializer)}}return y||m?(l.setContentType("application/json",!1),eO(n)):n}],transformResponse:[function(n){const l=this.transitional||ay.transitional,h=l&&l.forcedJSONParsing,m=this.responseType==="json";if(n&&Ye.isString(n)&&(h&&!this.responseType||m)){const b=!(l&&l.silentJSONParsing)&&m;try{return JSON.parse(n)}catch(s){if(b)throw s.name==="SyntaxError"?wn.from(s,wn.ERR_BAD_RESPONSE,this,null,this.response):s}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ns.classes.FormData,Blob:Ns.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ye.forEach(["delete","get","head"],function(n){ay.headers[n]={}});Ye.forEach(["post","put","patch"],function(n){ay.headers[n]=Ye.merge(Q3)});const fw=ay,tO=Ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nO=e=>{const n={};let l,h,m;return e&&e.split(`
`).forEach(function(b){m=b.indexOf(":"),l=b.substring(0,m).trim().toLowerCase(),h=b.substring(m+1).trim(),!(!l||n[l]&&tO[l])&&(l==="set-cookie"?n[l]?n[l].push(h):n[l]=[h]:n[l]=n[l]?n[l]+", "+h:h)}),n},ZT=Symbol("internals");function zp(e){return e&&String(e).trim().toLowerCase()}function Xg(e){return e===!1||e==null?e:Ye.isArray(e)?e.map(Xg):String(e)}function rO(e){const n=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=l.exec(e);)n[h[1]]=h[2];return n}const iO=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Fv(e,n,l,h,m){if(Ye.isFunction(h))return h.call(this,n,l);if(m&&(n=l),!!Ye.isString(n)){if(Ye.isString(h))return n.indexOf(h)!==-1;if(Ye.isRegExp(h))return h.test(n)}}function oO(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,l,h)=>l.toUpperCase()+h)}function sO(e,n){const l=Ye.toCamelCase(" "+n);["get","set","has"].forEach(h=>{Object.defineProperty(e,h+l,{value:function(m,y,b){return this[h].call(this,n,m,y,b)},configurable:!0})})}class ly{constructor(n){n&&this.set(n)}set(n,l,h){const m=this;function y(s,A,R){const U=zp(A);if(!U)throw new Error("header name must be a non-empty string");const V=Ye.findKey(m,U);(!V||m[V]===void 0||R===!0||R===void 0&&m[V]!==!1)&&(m[V||A]=Xg(s))}const b=(s,A)=>Ye.forEach(s,(R,U)=>y(R,U,A));return Ye.isPlainObject(n)||n instanceof this.constructor?b(n,l):Ye.isString(n)&&(n=n.trim())&&!iO(n)?b(nO(n),l):n!=null&&y(l,n,h),this}get(n,l){if(n=zp(n),n){const h=Ye.findKey(this,n);if(h){const m=this[h];if(!l)return m;if(l===!0)return rO(m);if(Ye.isFunction(l))return l.call(this,m,h);if(Ye.isRegExp(l))return l.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,l){if(n=zp(n),n){const h=Ye.findKey(this,n);return!!(h&&this[h]!==void 0&&(!l||Fv(this,this[h],h,l)))}return!1}delete(n,l){const h=this;let m=!1;function y(b){if(b=zp(b),b){const s=Ye.findKey(h,b);s&&(!l||Fv(h,h[s],s,l))&&(delete h[s],m=!0)}}return Ye.isArray(n)?n.forEach(y):y(n),m}clear(n){const l=Object.keys(this);let h=l.length,m=!1;for(;h--;){const y=l[h];(!n||Fv(this,this[y],y,n,!0))&&(delete this[y],m=!0)}return m}normalize(n){const l=this,h={};return Ye.forEach(this,(m,y)=>{const b=Ye.findKey(h,y);if(b){l[b]=Xg(m),delete l[y];return}const s=n?oO(y):String(y).trim();s!==y&&delete l[y],l[s]=Xg(m),h[s]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const l=Object.create(null);return Ye.forEach(this,(h,m)=>{h!=null&&h!==!1&&(l[m]=n&&Ye.isArray(h)?h.join(", "):h)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,l])=>n+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...l){const h=new this(n);return l.forEach(m=>h.set(m)),h}static accessor(n){const h=(this[ZT]=this[ZT]={accessors:{}}).accessors,m=this.prototype;function y(b){const s=zp(b);h[s]||(sO(m,b),h[s]=!0)}return Ye.isArray(n)?n.forEach(y):y(n),this}}ly.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ye.freezeMethods(ly.prototype);Ye.freezeMethods(ly);const _a=ly;function Nv(e,n){const l=this||fw,h=n||l,m=_a.from(h.headers);let y=h.data;return Ye.forEach(e,function(s){y=s.call(l,y,m.normalize(),n?n.status:void 0)}),m.normalize(),y}function zM(e){return!!(e&&e.__CANCEL__)}function Of(e,n,l){wn.call(this,e??"canceled",wn.ERR_CANCELED,n,l),this.name="CanceledError"}Ye.inherits(Of,wn,{__CANCEL__:!0});function aO(e,n,l){const h=l.config.validateStatus;!l.status||!h||h(l.status)?e(l):n(new wn("Request failed with status code "+l.status,[wn.ERR_BAD_REQUEST,wn.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}const lO=Ns.isStandardBrowserEnv?function(){return{write:function(l,h,m,y,b,s){const A=[];A.push(l+"="+encodeURIComponent(h)),Ye.isNumber(m)&&A.push("expires="+new Date(m).toGMTString()),Ye.isString(y)&&A.push("path="+y),Ye.isString(b)&&A.push("domain="+b),s===!0&&A.push("secure"),document.cookie=A.join("; ")},read:function(l){const h=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(l){this.write(l,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function cO(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function uO(e,n){return n?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e}function RM(e,n){return e&&!cO(n)?uO(e,n):n}const hO=Ns.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a");let h;function m(y){let b=y;return n&&(l.setAttribute("href",b),b=l.href),l.setAttribute("href",b),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:l.pathname.charAt(0)==="/"?l.pathname:"/"+l.pathname}}return h=m(window.location.href),function(b){const s=Ye.isString(b)?m(b):b;return s.protocol===h.protocol&&s.host===h.host}}():function(){return function(){return!0}}();function dO(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function pO(e,n){e=e||10;const l=new Array(e),h=new Array(e);let m=0,y=0,b;return n=n!==void 0?n:1e3,function(A){const R=Date.now(),U=h[y];b||(b=R),l[m]=A,h[m]=R;let V=y,$=0;for(;V!==m;)$+=l[V++],V=V%e;if(m=(m+1)%e,m===y&&(y=(y+1)%e),R-b<n)return;const pe=U&&R-U;return pe?Math.round($*1e3/pe):void 0}}function HT(e,n){let l=0;const h=pO(50,250);return m=>{const y=m.loaded,b=m.lengthComputable?m.total:void 0,s=y-l,A=h(s),R=y<=b;l=y;const U={loaded:y,total:b,progress:b?y/b:void 0,bytes:s,rate:A||void 0,estimated:A&&b&&R?(b-y)/A:void 0,event:m};U[n?"download":"upload"]=!0,e(U)}}const fO=typeof XMLHttpRequest<"u",mO=fO&&function(e){return new Promise(function(l,h){let m=e.data;const y=_a.from(e.headers).normalize(),b=e.responseType;let s;function A(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}Ye.isFormData(m)&&(Ns.isStandardBrowserEnv||Ns.isStandardBrowserWebWorkerEnv?y.setContentType(!1):y.setContentType("multipart/form-data;",!1));let R=new XMLHttpRequest;if(e.auth){const pe=e.auth.username||"",Y=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";y.set("Authorization","Basic "+btoa(pe+":"+Y))}const U=RM(e.baseURL,e.url);R.open(e.method.toUpperCase(),IM(U,e.params,e.paramsSerializer),!0),R.timeout=e.timeout;function V(){if(!R)return;const pe=_a.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),K={data:!b||b==="text"||b==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:pe,config:e,request:R};aO(function(ee){l(ee),A()},function(ee){h(ee),A()},K),R=null}if("onloadend"in R?R.onloadend=V:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(V)},R.onabort=function(){R&&(h(new wn("Request aborted",wn.ECONNABORTED,e,R)),R=null)},R.onerror=function(){h(new wn("Network Error",wn.ERR_NETWORK,e,R)),R=null},R.ontimeout=function(){let Y=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const K=e.transitional||kM;e.timeoutErrorMessage&&(Y=e.timeoutErrorMessage),h(new wn(Y,K.clarifyTimeoutError?wn.ETIMEDOUT:wn.ECONNABORTED,e,R)),R=null},Ns.isStandardBrowserEnv){const pe=(e.withCredentials||hO(U))&&e.xsrfCookieName&&lO.read(e.xsrfCookieName);pe&&y.set(e.xsrfHeaderName,pe)}m===void 0&&y.setContentType(null),"setRequestHeader"in R&&Ye.forEach(y.toJSON(),function(Y,K){R.setRequestHeader(K,Y)}),Ye.isUndefined(e.withCredentials)||(R.withCredentials=!!e.withCredentials),b&&b!=="json"&&(R.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&R.addEventListener("progress",HT(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&R.upload&&R.upload.addEventListener("progress",HT(e.onUploadProgress)),(e.cancelToken||e.signal)&&(s=pe=>{R&&(h(!pe||pe.type?new Of(null,e,R):pe),R.abort(),R=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s)));const $=dO(U);if($&&Ns.protocols.indexOf($)===-1){h(new wn("Unsupported protocol "+$+":",wn.ERR_BAD_REQUEST,e));return}R.send(m||null)})},Kg={http:j3,xhr:mO};Ye.forEach(Kg,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const gO={getAdapter:e=>{e=Ye.isArray(e)?e:[e];const{length:n}=e;let l,h;for(let m=0;m<n&&(l=e[m],!(h=Ye.isString(l)?Kg[l.toLowerCase()]:l));m++);if(!h)throw h===!1?new wn(`Adapter ${l} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Ye.hasOwnProp(Kg,l)?`Adapter '${l}' is not available in the build`:`Unknown adapter '${l}'`);if(!Ye.isFunction(h))throw new TypeError("adapter is not a function");return h},adapters:Kg};function jv(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Of(null,e)}function XT(e){return jv(e),e.headers=_a.from(e.headers),e.data=Nv.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gO.getAdapter(e.adapter||fw.adapter)(e).then(function(h){return jv(e),h.data=Nv.call(e,e.transformResponse,h),h.headers=_a.from(h.headers),h},function(h){return zM(h)||(jv(e),h&&h.response&&(h.response.data=Nv.call(e,e.transformResponse,h.response),h.response.headers=_a.from(h.response.headers))),Promise.reject(h)})}const KT=e=>e instanceof _a?e.toJSON():e;function Mh(e,n){n=n||{};const l={};function h(R,U,V){return Ye.isPlainObject(R)&&Ye.isPlainObject(U)?Ye.merge.call({caseless:V},R,U):Ye.isPlainObject(U)?Ye.merge({},U):Ye.isArray(U)?U.slice():U}function m(R,U,V){if(Ye.isUndefined(U)){if(!Ye.isUndefined(R))return h(void 0,R,V)}else return h(R,U,V)}function y(R,U){if(!Ye.isUndefined(U))return h(void 0,U)}function b(R,U){if(Ye.isUndefined(U)){if(!Ye.isUndefined(R))return h(void 0,R)}else return h(void 0,U)}function s(R,U,V){if(V in n)return h(R,U);if(V in e)return h(void 0,R)}const A={url:y,method:y,data:y,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:s,headers:(R,U)=>m(KT(R),KT(U),!0)};return Ye.forEach(Object.keys(Object.assign({},e,n)),function(U){const V=A[U]||m,$=V(e[U],n[U],U);Ye.isUndefined($)&&V!==s||(l[U]=$)}),l}const DM="1.4.0",mw={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{mw[e]=function(h){return typeof h===e||"a"+(n<1?"n ":" ")+e}});const YT={};mw.transitional=function(n,l,h){function m(y,b){return"[Axios v"+DM+"] Transitional option '"+y+"'"+b+(h?". "+h:"")}return(y,b,s)=>{if(n===!1)throw new wn(m(b," has been removed"+(l?" in "+l:"")),wn.ERR_DEPRECATED);return l&&!YT[b]&&(YT[b]=!0,console.warn(m(b," has been deprecated since v"+l+" and will be removed in the near future"))),n?n(y,b,s):!0}};function _O(e,n,l){if(typeof e!="object")throw new wn("options must be an object",wn.ERR_BAD_OPTION_VALUE);const h=Object.keys(e);let m=h.length;for(;m-- >0;){const y=h[m],b=n[y];if(b){const s=e[y],A=s===void 0||b(s,y,e);if(A!==!0)throw new wn("option "+y+" must be "+A,wn.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new wn("Unknown option "+y,wn.ERR_BAD_OPTION)}}const e1={assertOptions:_O,validators:mw},ll=e1.validators;class k_{constructor(n){this.defaults=n,this.interceptors={request:new WT,response:new WT}}request(n,l){typeof n=="string"?(l=l||{},l.url=n):l=n||{},l=Mh(this.defaults,l);const{transitional:h,paramsSerializer:m,headers:y}=l;h!==void 0&&e1.assertOptions(h,{silentJSONParsing:ll.transitional(ll.boolean),forcedJSONParsing:ll.transitional(ll.boolean),clarifyTimeoutError:ll.transitional(ll.boolean)},!1),m!=null&&(Ye.isFunction(m)?l.paramsSerializer={serialize:m}:e1.assertOptions(m,{encode:ll.function,serialize:ll.function},!0)),l.method=(l.method||this.defaults.method||"get").toLowerCase();let b;b=y&&Ye.merge(y.common,y[l.method]),b&&Ye.forEach(["delete","get","head","post","put","patch","common"],Y=>{delete y[Y]}),l.headers=_a.concat(b,y);const s=[];let A=!0;this.interceptors.request.forEach(function(K){typeof K.runWhen=="function"&&K.runWhen(l)===!1||(A=A&&K.synchronous,s.unshift(K.fulfilled,K.rejected))});const R=[];this.interceptors.response.forEach(function(K){R.push(K.fulfilled,K.rejected)});let U,V=0,$;if(!A){const Y=[XT.bind(this),void 0];for(Y.unshift.apply(Y,s),Y.push.apply(Y,R),$=Y.length,U=Promise.resolve(l);V<$;)U=U.then(Y[V++],Y[V++]);return U}$=s.length;let pe=l;for(V=0;V<$;){const Y=s[V++],K=s[V++];try{pe=Y(pe)}catch(Ce){K.call(this,Ce);break}}try{U=XT.call(this,pe)}catch(Y){return Promise.reject(Y)}for(V=0,$=R.length;V<$;)U=U.then(R[V++],R[V++]);return U}getUri(n){n=Mh(this.defaults,n);const l=RM(n.baseURL,n.url);return IM(l,n.params,n.paramsSerializer)}}Ye.forEach(["delete","get","head","options"],function(n){k_.prototype[n]=function(l,h){return this.request(Mh(h||{},{method:n,url:l,data:(h||{}).data}))}});Ye.forEach(["post","put","patch"],function(n){function l(h){return function(y,b,s){return this.request(Mh(s||{},{method:n,headers:h?{"Content-Type":"multipart/form-data"}:{},url:y,data:b}))}}k_.prototype[n]=l(),k_.prototype[n+"Form"]=l(!0)});const Yg=k_;class gw{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(y){l=y});const h=this;this.promise.then(m=>{if(!h._listeners)return;let y=h._listeners.length;for(;y-- >0;)h._listeners[y](m);h._listeners=null}),this.promise.then=m=>{let y;const b=new Promise(s=>{h.subscribe(s),y=s}).then(m);return b.cancel=function(){h.unsubscribe(y)},b},n(function(y,b,s){h.reason||(h.reason=new Of(y,b,s),l(h.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const l=this._listeners.indexOf(n);l!==-1&&this._listeners.splice(l,1)}static source(){let n;return{token:new gw(function(m){n=m}),cancel:n}}}const yO=gw;function vO(e){return function(l){return e.apply(null,l)}}function xO(e){return Ye.isObject(e)&&e.isAxiosError===!0}const t1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(t1).forEach(([e,n])=>{t1[n]=e});const wO=t1;function LM(e){const n=new Yg(e),l=_M(Yg.prototype.request,n);return Ye.extend(l,Yg.prototype,n,{allOwnKeys:!0}),Ye.extend(l,n,null,{allOwnKeys:!0}),l.create=function(m){return LM(Mh(e,m))},l}const Jr=LM(fw);Jr.Axios=Yg;Jr.CanceledError=Of;Jr.CancelToken=yO;Jr.isCancel=zM;Jr.VERSION=DM;Jr.toFormData=sy;Jr.AxiosError=wn;Jr.Cancel=Jr.CanceledError;Jr.all=function(n){return Promise.all(n)};Jr.spread=vO;Jr.isAxiosError=xO;Jr.mergeConfig=Mh;Jr.AxiosHeaders=_a;Jr.formToJSON=e=>PM(Ye.isHTMLForm(e)?new FormData(e):e);Jr.HttpStatusCode=wO;Jr.default=Jr;const Bf=Jr,bO=async()=>Bf.get("http://localhost:3001/api/v1/tours").then(e=>e.data),da=Bf.create({baseURL:"http://localhost:3001/api/v1",headers:{"Content-Type":"application/json"},withCredentials:!0}),EO=async(e,n)=>{const l={email:e,password:n},h={withCredentials:!0};return(await Bf.post("http://localhost:3001/api/v1/users/login",l,h)).data},TO=async()=>(await Bf.get("http://localhost:3001/api/v1/users/signout",{withCredentials:!0})).data,SO=async(e,n)=>{const l={name:e,email:n};return(await da.patch("/users/updateMe",l,{withCredentials:!0})).data},CO=async(e,n,l)=>{const h={currentPassword:e,newPassword:n,confirmNewPassword:l};return(await da.patch("/users/updateMyPassword",h,{withCredentials:!0})).data},AO=async e=>(await da.get(`http://localhost:3001/api/v1/bookings/checkout/${e}`)).data,MO=()=>{const{dispatchAuth:e}=Aa();return async()=>{try{await TO(),e({type:"logout"})}catch(l){console.error(l)}}},IO=()=>{const{auth:e}=Aa(),n=e.user,l=Fh(),h=MO(),m=async()=>{await h(),l("/")};return Q.jsxs("header",{className:"header",children:[Q.jsxs("nav",{className:"nav nav--tours",children:[Q.jsx(Kx,{to:"/",className:"nav__el",children:"All tours"}),Q.jsxs("form",{className:"nav__search",children:[Q.jsx("button",{className:"nav__search-btn",children:Q.jsx("svg",{children:Q.jsx("use",{xlinkHref:"/img/icons.svg#icon-search"})})}),Q.jsx("input",{type:"text",placeholder:"Search tours",className:"nav__search-input"})]})]}),Q.jsx("div",{className:"header__logo",children:Q.jsx("img",{src:"/img/logo-white.png",alt:"Natours logo"})}),Q.jsx("nav",{className:"nav nav--user",children:n?Q.jsxs(Q.Fragment,{children:[Q.jsx("button",{onClick:m,className:"nav__el nal__el--logout",children:"Logout"}),Q.jsxs("a",{href:"/account",className:"nav__el",children:[Q.jsx("img",{src:`/img/users/${n.photo}`,alt:"User photo",className:"nav__user-img"}),Q.jsx("span",{children:n.name})]})]}):Q.jsxs(Q.Fragment,{children:[Q.jsx(Kx,{to:"/login",style:{paddingRight:"20px"},children:Q.jsx("button",{className:"nav__el",children:"Log in"})}),Q.jsx("button",{className:"nav__el nav__el--cta",children:"Sign up"})]})})]})};const kO=({cardData:e})=>{const l=new Date(e.startDates[0]).toLocaleString("en-US",{year:"numeric",month:"long"});return Q.jsxs("div",{className:"card",children:[Q.jsxs("div",{className:"card__header",children:[Q.jsxs("div",{className:"card__picture",children:[Q.jsx("div",{className:"card__picture-overlay",children:" "}),Q.jsx("img",{src:`/img/tours/${e.imageCover}`,alt:"Tour 1",className:"card__picture-img"})]}),Q.jsx("h3",{className:"heading-tertirary",children:Q.jsx("span",{children:e.name})})]}),Q.jsxs("div",{className:"card__details",children:[Q.jsxs("h4",{className:"card__sub-heading",children:[e.difficulty," ",e.duration,"-day tour"]}),Q.jsx("p",{className:"card__text",children:e.summary}),Q.jsxs("div",{className:"card__data",children:[Q.jsx("svg",{className:"card__icon",children:Q.jsx("use",{xlinkHref:"img/icons.svg#icon-map-pin"})}),Q.jsx("span",{children:e.startLocation.description})]}),Q.jsxs("div",{className:"card__data",children:[Q.jsx("svg",{className:"card__icon",children:Q.jsx("use",{xlinkHref:"img/icons.svg#icon-calendar"})}),Q.jsx("span",{children:l})]}),Q.jsxs("div",{className:"card__data",children:[Q.jsx("svg",{className:"card__icon",children:Q.jsx("use",{xlinkHref:"img/icons.svg#icon-flag"})}),Q.jsxs("span",{children:[e.locations.length," stops"]})]}),Q.jsxs("div",{className:"card__data",children:[Q.jsx("svg",{className:"card__icon",children:Q.jsx("use",{xlinkHref:"img/icons.svg#icon-user"})}),Q.jsxs("span",{children:[e.maxGroupSize," people"]})]})]}),Q.jsxs("div",{className:"card__footer",children:[Q.jsxs("p",{children:[Q.jsxs("span",{className:"card__footer-value",children:["$",e.price]}),Q.jsx("span",{className:"card__footer-text",children:" per person"})]}),Q.jsxs("p",{className:"card__ratings",children:[Q.jsx("span",{className:"card__footer-value",children:e.ratingsAverage+" "}),Q.jsxs("span",{className:"card__footer-text",children:["rating "," "+e.ratingsQuantity]})]}),Q.jsx(Kx,{to:`/tours/${e.slug}`,className:"btn btn--green btn--small",children:"Details"})]})]})},PO=({children:e})=>Q.jsx("main",{className:"main",children:Q.jsx("div",{className:"card-container",children:e})});var OM={exports:{}},zO="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",RO=zO,DO=RO;function BM(){}function FM(){}FM.resetWarningCache=BM;var LO=function(){function e(h,m,y,b,s,A){if(A!==DO){var R=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw R.name="Invariant Violation",R}}e.isRequired=e;function n(){return e}var l={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:FM,resetWarningCache:BM};return l.PropTypes=l,l};OM.exports=LO();var OO=OM.exports;const yn=Fc(OO);var BO=typeof Element<"u",FO=typeof Map=="function",NO=typeof Set=="function",jO=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Jg(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var l,h,m;if(Array.isArray(e)){if(l=e.length,l!=n.length)return!1;for(h=l;h--!==0;)if(!Jg(e[h],n[h]))return!1;return!0}var y;if(FO&&e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(y=e.entries();!(h=y.next()).done;)if(!n.has(h.value[0]))return!1;for(y=e.entries();!(h=y.next()).done;)if(!Jg(h.value[1],n.get(h.value[0])))return!1;return!0}if(NO&&e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(y=e.entries();!(h=y.next()).done;)if(!n.has(h.value[0]))return!1;return!0}if(jO&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(n)){if(l=e.length,l!=n.length)return!1;for(h=l;h--!==0;)if(e[h]!==n[h])return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof n.valueOf=="function")return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof n.toString=="function")return e.toString()===n.toString();if(m=Object.keys(e),l=m.length,l!==Object.keys(n).length)return!1;for(h=l;h--!==0;)if(!Object.prototype.hasOwnProperty.call(n,m[h]))return!1;if(BO&&e instanceof Element)return!1;for(h=l;h--!==0;)if(!((m[h]==="_owner"||m[h]==="__v"||m[h]==="__o")&&e.$$typeof)&&!Jg(e[m[h]],n[m[h]]))return!1;return!0}return e!==e&&n!==n}var UO=function(n,l){try{return Jg(n,l)}catch(h){if((h.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw h}};const VO=Fc(UO);var $O=function(e,n,l,h,m,y,b,s){if(!e){var A;if(n===void 0)A=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var R=[l,h,m,y,b,s],U=0;A=new Error(n.replace(/%s/g,function(){return R[U++]})),A.name="Invariant Violation"}throw A.framesToPop=1,A}},GO=$O;const JT=Fc(GO);var qO=function(n,l,h,m){var y=h?h.call(m,n,l):void 0;if(y!==void 0)return!!y;if(n===l)return!0;if(typeof n!="object"||!n||typeof l!="object"||!l)return!1;var b=Object.keys(n),s=Object.keys(l);if(b.length!==s.length)return!1;for(var A=Object.prototype.hasOwnProperty.bind(l),R=0;R<b.length;R++){var U=b[R];if(!A(U))return!1;var V=n[U],$=l[U];if(y=h?h.call(m,V,$,U):void 0,y===!1||y===void 0&&V!==$)return!1}return!0};const WO=Fc(qO);function Ir(){return Ir=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(e[h]=l[h])}return e},Ir.apply(this,arguments)}function _w(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,n1(e,n)}function n1(e,n){return n1=Object.setPrototypeOf||function(l,h){return l.__proto__=h,l},n1(e,n)}function QT(e,n){if(e==null)return{};var l,h,m={},y=Object.keys(e);for(h=0;h<y.length;h++)n.indexOf(l=y[h])>=0||(m[l]=e[l]);return m}var Zt={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},ZO={rel:["amphtml","canonical","alternate"]},HO={type:["application/ld+json"]},XO={charset:"",name:["robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},eS=Object.keys(Zt).map(function(e){return Zt[e]}),P_={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},KO=Object.keys(P_).reduce(function(e,n){return e[P_[n]]=n,e},{}),gh=function(e,n){for(var l=e.length-1;l>=0;l-=1){var h=e[l];if(Object.prototype.hasOwnProperty.call(h,n))return h[n]}return null},YO=function(e){var n=gh(e,Zt.TITLE),l=gh(e,"titleTemplate");if(Array.isArray(n)&&(n=n.join("")),l&&n)return l.replace(/%s/g,function(){return n});var h=gh(e,"defaultTitle");return n||h||void 0},JO=function(e){return gh(e,"onChangeClientState")||function(){}},Uv=function(e,n){return n.filter(function(l){return l[e]!==void 0}).map(function(l){return l[e]}).reduce(function(l,h){return Ir({},l,h)},{})},QO=function(e,n){return n.filter(function(l){return l[Zt.BASE]!==void 0}).map(function(l){return l[Zt.BASE]}).reverse().reduce(function(l,h){if(!l.length)for(var m=Object.keys(h),y=0;y<m.length;y+=1){var b=m[y].toLowerCase();if(e.indexOf(b)!==-1&&h[b])return l.concat(h)}return l},[])},Rp=function(e,n,l){var h={};return l.filter(function(m){return!!Array.isArray(m[e])||(m[e]!==void 0&&console&&typeof console.warn=="function"&&console.warn("Helmet: "+e+' should be of type "Array". Instead found type "'+typeof m[e]+'"'),!1)}).map(function(m){return m[e]}).reverse().reduce(function(m,y){var b={};y.filter(function(V){for(var $,pe=Object.keys(V),Y=0;Y<pe.length;Y+=1){var K=pe[Y],Ce=K.toLowerCase();n.indexOf(Ce)===-1||$==="rel"&&V[$].toLowerCase()==="canonical"||Ce==="rel"&&V[Ce].toLowerCase()==="stylesheet"||($=Ce),n.indexOf(K)===-1||K!=="innerHTML"&&K!=="cssText"&&K!=="itemprop"||($=K)}if(!$||!V[$])return!1;var ee=V[$].toLowerCase();return h[$]||(h[$]={}),b[$]||(b[$]={}),!h[$][ee]&&(b[$][ee]=!0,!0)}).reverse().forEach(function(V){return m.push(V)});for(var s=Object.keys(b),A=0;A<s.length;A+=1){var R=s[A],U=Ir({},h[R],b[R]);h[R]=U}return m},[]).reverse()},eB=function(e,n){if(Array.isArray(e)&&e.length){for(var l=0;l<e.length;l+=1)if(e[l][n])return!0}return!1},NM=function(e){return Array.isArray(e)?e.join(""):e},Vv=function(e,n){return Array.isArray(e)?e.reduce(function(l,h){return function(m,y){for(var b=Object.keys(m),s=0;s<b.length;s+=1)if(y[b[s]]&&y[b[s]].includes(m[b[s]]))return!0;return!1}(h,n)?l.priority.push(h):l.default.push(h),l},{priority:[],default:[]}):{default:e}},tS=function(e,n){var l;return Ir({},e,((l={})[n]=void 0,l))},tB=[Zt.NOSCRIPT,Zt.SCRIPT,Zt.STYLE],$v=function(e,n){return n===void 0&&(n=!0),n===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},nS=function(e){return Object.keys(e).reduce(function(n,l){var h=e[l]!==void 0?l+'="'+e[l]+'"':""+l;return n?n+" "+h:h},"")},rS=function(e,n){return n===void 0&&(n={}),Object.keys(e).reduce(function(l,h){return l[P_[h]||h]=e[h],l},n)},Qg=function(e,n){return n.map(function(l,h){var m,y=((m={key:h})["data-rh"]=!0,m);return Object.keys(l).forEach(function(b){var s=P_[b]||b;s==="innerHTML"||s==="cssText"?y.dangerouslySetInnerHTML={__html:l.innerHTML||l.cssText}:y[s]=l[b]}),zr.createElement(e,y)})},Oo=function(e,n,l){switch(e){case Zt.TITLE:return{toComponent:function(){return m=n.titleAttributes,(y={key:h=n.title})["data-rh"]=!0,b=rS(m,y),[zr.createElement(Zt.TITLE,b,h)];var h,m,y,b},toString:function(){return function(h,m,y,b){var s=nS(y),A=NM(m);return s?"<"+h+' data-rh="true" '+s+">"+$v(A,b)+"</"+h+">":"<"+h+' data-rh="true">'+$v(A,b)+"</"+h+">"}(e,n.title,n.titleAttributes,l)}};case"bodyAttributes":case"htmlAttributes":return{toComponent:function(){return rS(n)},toString:function(){return nS(n)}};default:return{toComponent:function(){return Qg(e,n)},toString:function(){return function(h,m,y){return m.reduce(function(b,s){var A=Object.keys(s).filter(function(V){return!(V==="innerHTML"||V==="cssText")}).reduce(function(V,$){var pe=s[$]===void 0?$:$+'="'+$v(s[$],y)+'"';return V?V+" "+pe:pe},""),R=s.innerHTML||s.cssText||"",U=tB.indexOf(h)===-1;return b+"<"+h+' data-rh="true" '+A+(U?"/>":">"+R+"</"+h+">")},"")}(e,n,l)}}}},r1=function(e){var n=e.baseTag,l=e.bodyAttributes,h=e.encode,m=e.htmlAttributes,y=e.noscriptTags,b=e.styleTags,s=e.title,A=s===void 0?"":s,R=e.titleAttributes,U=e.linkTags,V=e.metaTags,$=e.scriptTags,pe={toComponent:function(){},toString:function(){return""}};if(e.prioritizeSeoTags){var Y=function(K){var Ce=K.linkTags,ee=K.scriptTags,ne=K.encode,ce=Vv(K.metaTags,XO),se=Vv(Ce,ZO),De=Vv(ee,HO);return{priorityMethods:{toComponent:function(){return[].concat(Qg(Zt.META,ce.priority),Qg(Zt.LINK,se.priority),Qg(Zt.SCRIPT,De.priority))},toString:function(){return Oo(Zt.META,ce.priority,ne)+" "+Oo(Zt.LINK,se.priority,ne)+" "+Oo(Zt.SCRIPT,De.priority,ne)}},metaTags:ce.default,linkTags:se.default,scriptTags:De.default}}(e);pe=Y.priorityMethods,U=Y.linkTags,V=Y.metaTags,$=Y.scriptTags}return{priority:pe,base:Oo(Zt.BASE,n,h),bodyAttributes:Oo("bodyAttributes",l,h),htmlAttributes:Oo("htmlAttributes",m,h),link:Oo(Zt.LINK,U,h),meta:Oo(Zt.META,V,h),noscript:Oo(Zt.NOSCRIPT,y,h),script:Oo(Zt.SCRIPT,$,h),style:Oo(Zt.STYLE,b,h),title:Oo(Zt.TITLE,{title:A,titleAttributes:R},h)}},Pg=[],i1=function(e,n){var l=this;n===void 0&&(n=typeof document<"u"),this.instances=[],this.value={setHelmet:function(h){l.context.helmet=h},helmetInstances:{get:function(){return l.canUseDOM?Pg:l.instances},add:function(h){(l.canUseDOM?Pg:l.instances).push(h)},remove:function(h){var m=(l.canUseDOM?Pg:l.instances).indexOf(h);(l.canUseDOM?Pg:l.instances).splice(m,1)}}},this.context=e,this.canUseDOM=n,n||(e.helmet=r1({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},jM=zr.createContext({}),nB=yn.shape({setHelmet:yn.func,helmetInstances:yn.shape({get:yn.func,add:yn.func,remove:yn.func})}),rB=typeof document<"u",Ac=function(e){function n(l){var h;return(h=e.call(this,l)||this).helmetData=new i1(h.props.context,n.canUseDOM),h}return _w(n,e),n.prototype.render=function(){return zr.createElement(jM.Provider,{value:this.helmetData.value},this.props.children)},n}(Te.Component);Ac.canUseDOM=rB,Ac.propTypes={context:yn.shape({helmet:yn.shape()}),children:yn.node.isRequired},Ac.defaultProps={context:{}},Ac.displayName="HelmetProvider";var Nu=function(e,n){var l,h=document.head||document.querySelector(Zt.HEAD),m=h.querySelectorAll(e+"[data-rh]"),y=[].slice.call(m),b=[];return n&&n.length&&n.forEach(function(s){var A=document.createElement(e);for(var R in s)Object.prototype.hasOwnProperty.call(s,R)&&(R==="innerHTML"?A.innerHTML=s.innerHTML:R==="cssText"?A.styleSheet?A.styleSheet.cssText=s.cssText:A.appendChild(document.createTextNode(s.cssText)):A.setAttribute(R,s[R]===void 0?"":s[R]));A.setAttribute("data-rh","true"),y.some(function(U,V){return l=V,A.isEqualNode(U)})?y.splice(l,1):b.push(A)}),y.forEach(function(s){return s.parentNode.removeChild(s)}),b.forEach(function(s){return h.appendChild(s)}),{oldTags:y,newTags:b}},Gv=function(e,n){var l=document.getElementsByTagName(e)[0];if(l){for(var h=l.getAttribute("data-rh"),m=h?h.split(","):[],y=[].concat(m),b=Object.keys(n),s=0;s<b.length;s+=1){var A=b[s],R=n[A]||"";l.getAttribute(A)!==R&&l.setAttribute(A,R),m.indexOf(A)===-1&&m.push(A);var U=y.indexOf(A);U!==-1&&y.splice(U,1)}for(var V=y.length-1;V>=0;V-=1)l.removeAttribute(y[V]);m.length===y.length?l.removeAttribute("data-rh"):l.getAttribute("data-rh")!==b.join(",")&&l.setAttribute("data-rh",b.join(","))}},iS=function(e,n){var l=e.baseTag,h=e.htmlAttributes,m=e.linkTags,y=e.metaTags,b=e.noscriptTags,s=e.onChangeClientState,A=e.scriptTags,R=e.styleTags,U=e.title,V=e.titleAttributes;Gv(Zt.BODY,e.bodyAttributes),Gv(Zt.HTML,h),function(K,Ce){K!==void 0&&document.title!==K&&(document.title=NM(K)),Gv(Zt.TITLE,Ce)}(U,V);var $={baseTag:Nu(Zt.BASE,l),linkTags:Nu(Zt.LINK,m),metaTags:Nu(Zt.META,y),noscriptTags:Nu(Zt.NOSCRIPT,b),scriptTags:Nu(Zt.SCRIPT,A),styleTags:Nu(Zt.STYLE,R)},pe={},Y={};Object.keys($).forEach(function(K){var Ce=$[K],ee=Ce.newTags,ne=Ce.oldTags;ee.length&&(pe[K]=ee),ne.length&&(Y[K]=$[K].oldTags)}),n&&n(),s(e,pe,Y)},Dp=null,z_=function(e){function n(){for(var h,m=arguments.length,y=new Array(m),b=0;b<m;b++)y[b]=arguments[b];return(h=e.call.apply(e,[this].concat(y))||this).rendered=!1,h}_w(n,e);var l=n.prototype;return l.shouldComponentUpdate=function(h){return!WO(h,this.props)},l.componentDidUpdate=function(){this.emitChange()},l.componentWillUnmount=function(){this.props.context.helmetInstances.remove(this),this.emitChange()},l.emitChange=function(){var h,m,y=this.props.context,b=y.setHelmet,s=null,A=(h=y.helmetInstances.get().map(function(R){var U=Ir({},R.props);return delete U.context,U}),{baseTag:QO(["href"],h),bodyAttributes:Uv("bodyAttributes",h),defer:gh(h,"defer"),encode:gh(h,"encodeSpecialCharacters"),htmlAttributes:Uv("htmlAttributes",h),linkTags:Rp(Zt.LINK,["rel","href"],h),metaTags:Rp(Zt.META,["name","charset","http-equiv","property","itemprop"],h),noscriptTags:Rp(Zt.NOSCRIPT,["innerHTML"],h),onChangeClientState:JO(h),scriptTags:Rp(Zt.SCRIPT,["src","innerHTML"],h),styleTags:Rp(Zt.STYLE,["cssText"],h),title:YO(h),titleAttributes:Uv("titleAttributes",h),prioritizeSeoTags:eB(h,"prioritizeSeoTags")});Ac.canUseDOM?(m=A,Dp&&cancelAnimationFrame(Dp),m.defer?Dp=requestAnimationFrame(function(){iS(m,function(){Dp=null})}):(iS(m),Dp=null)):r1&&(s=r1(A)),b(s)},l.init=function(){this.rendered||(this.rendered=!0,this.props.context.helmetInstances.add(this),this.emitChange())},l.render=function(){return this.init(),null},n}(Te.Component);z_.propTypes={context:nB.isRequired},z_.displayName="HelmetDispatcher";var iB=["children"],oB=["children"],tf=function(e){function n(){return e.apply(this,arguments)||this}_w(n,e);var l=n.prototype;return l.shouldComponentUpdate=function(h){return!VO(tS(this.props,"helmetData"),tS(h,"helmetData"))},l.mapNestedChildrenToProps=function(h,m){if(!m)return null;switch(h.type){case Zt.SCRIPT:case Zt.NOSCRIPT:return{innerHTML:m};case Zt.STYLE:return{cssText:m};default:throw new Error("<"+h.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")}},l.flattenArrayTypeChildren=function(h){var m,y=h.child,b=h.arrayTypeChildren;return Ir({},b,((m={})[y.type]=[].concat(b[y.type]||[],[Ir({},h.newChildProps,this.mapNestedChildrenToProps(y,h.nestedChildren))]),m))},l.mapObjectTypeChildren=function(h){var m,y,b=h.child,s=h.newProps,A=h.newChildProps,R=h.nestedChildren;switch(b.type){case Zt.TITLE:return Ir({},s,((m={})[b.type]=R,m.titleAttributes=Ir({},A),m));case Zt.BODY:return Ir({},s,{bodyAttributes:Ir({},A)});case Zt.HTML:return Ir({},s,{htmlAttributes:Ir({},A)});default:return Ir({},s,((y={})[b.type]=Ir({},A),y))}},l.mapArrayTypeChildrenToProps=function(h,m){var y=Ir({},m);return Object.keys(h).forEach(function(b){var s;y=Ir({},y,((s={})[b]=h[b],s))}),y},l.warnOnInvalidChildren=function(h,m){return JT(eS.some(function(y){return h.type===y}),typeof h.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":"Only elements types "+eS.join(", ")+" are allowed. Helmet does not support rendering <"+h.type+"> elements. Refer to our API for more information."),JT(!m||typeof m=="string"||Array.isArray(m)&&!m.some(function(y){return typeof y!="string"}),"Helmet expects a string as a child of <"+h.type+">. Did you forget to wrap your children in braces? ( <"+h.type+">{``}</"+h.type+"> ) Refer to our API for more information."),!0},l.mapChildrenToProps=function(h,m){var y=this,b={};return zr.Children.forEach(h,function(s){if(s&&s.props){var A=s.props,R=A.children,U=QT(A,iB),V=Object.keys(U).reduce(function(pe,Y){return pe[KO[Y]||Y]=U[Y],pe},{}),$=s.type;switch(typeof $=="symbol"?$=$.toString():y.warnOnInvalidChildren(s,R),$){case Zt.FRAGMENT:m=y.mapChildrenToProps(R,m);break;case Zt.LINK:case Zt.META:case Zt.NOSCRIPT:case Zt.SCRIPT:case Zt.STYLE:b=y.flattenArrayTypeChildren({child:s,arrayTypeChildren:b,newChildProps:V,nestedChildren:R});break;default:m=y.mapObjectTypeChildren({child:s,newProps:m,newChildProps:V,nestedChildren:R})}}}),this.mapArrayTypeChildrenToProps(b,m)},l.render=function(){var h=this.props,m=h.children,y=QT(h,oB),b=Ir({},y),s=y.helmetData;return m&&(b=this.mapChildrenToProps(m,b)),!s||s instanceof i1||(s=new i1(s.context,s.instances)),s?zr.createElement(z_,Ir({},b,{context:s.value,helmetData:void 0})):zr.createElement(jM.Consumer,null,function(A){return zr.createElement(z_,Ir({},b,{context:A}))})},n}(Te.Component);tf.propTypes={base:yn.object,bodyAttributes:yn.object,children:yn.oneOfType([yn.arrayOf(yn.node),yn.node]),defaultTitle:yn.string,defer:yn.bool,encodeSpecialCharacters:yn.bool,htmlAttributes:yn.object,link:yn.arrayOf(yn.object),meta:yn.arrayOf(yn.object),noscript:yn.arrayOf(yn.object),onChangeClientState:yn.func,script:yn.arrayOf(yn.object),style:yn.arrayOf(yn.object),title:yn.string,titleAttributes:yn.object,titleTemplate:yn.string,prioritizeSeoTags:yn.bool,helmetData:yn.object},tf.defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1},tf.displayName="Helmet";const sB=()=>{const e=NL();return Q.jsxs(Ac,{children:[Q.jsx(tf,{children:Q.jsx("title",{children:"Natours | Exciting tours for adventurous people"})}),e!==null?Q.jsx(PO,{children:e.data.map(n=>Q.jsx(kO,{cardData:n},n.name))}):null]})},UM=()=>{const{dispatchAuth:e}=Aa();return async()=>{const l=await Bf.get("http://localhost:3001/api/v1/users/refreshToken",{withCredentials:!0});return e({type:"updateAcessToken",payload:{user:l.data.data.user,accessToken:l.data.data.accessToken}}),l.data.data.accessToken}},aB=()=>{const e=UM(),n=Fh(),l=Ca(),{auth:h}=Aa();return Te.useEffect(()=>{const m=da.interceptors.request.use(b=>(b.headers.authorization||(b.headers.authorization=`Bearer ${h==null?void 0:h.accessToken}`),b),b=>Promise.reject(b)),y=da.interceptors.response.use(b=>b,async b=>{var A,R;console.log(b);const s=b==null?void 0:b.config;if(((A=b==null?void 0:b.response)==null?void 0:A.status)===500&&!(s!=null&&s.sent)){s.sent=!0;try{const U=await e();return console.log(U),s.headers.Authorization=`Bearer ${U}`,da(s)}catch(U){console.log(U)}}return((R=b==null?void 0:b.response)==null?void 0:R.status)===404&&!(s!=null&&s.sent)&&(s.sent=!0,n("/error",{state:{from:l},replace:!0})),Promise.reject(b)});return()=>{da.interceptors.request.eject(m),da.interceptors.response.eject(y)}},[h,e]),da},zg=({label:e,text:n,icon:l})=>Q.jsxs("div",{className:"overview-box__detail",children:[Q.jsx("svg",{className:"overview-box__icon",children:Q.jsx("use",{xlinkHref:`/img/icons.svg#icon-${l}`})}),Q.jsx("span",{className:"overview-box__label",children:e}),Q.jsx("span",{className:"overview-box__text",children:n})]});var VM="https://js.stripe.com/v3",lB=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,oS="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",cB=function(){for(var n=document.querySelectorAll('script[src^="'.concat(VM,'"]')),l=0;l<n.length;l++){var h=n[l];if(lB.test(h.src))return h}return null},uB=function(n){var l=n&&!n.advancedFraudSignals?"?advancedFraudSignals=false":"",h=document.createElement("script");h.src="".concat(VM).concat(l);var m=document.head||document.body;if(!m)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return m.appendChild(h),h},hB=function(n,l){!n||!n._registerWrapper||n._registerWrapper({name:"stripe-js",version:"2.1.0",startTime:l})},Rg=null,dB=function(n){return Rg!==null||(Rg=new Promise(function(l,h){if(typeof window>"u"||typeof document>"u"){l(null);return}if(window.Stripe&&n&&console.warn(oS),window.Stripe){l(window.Stripe);return}try{var m=cB();m&&n?console.warn(oS):m||(m=uB(n)),m.addEventListener("load",function(){window.Stripe?l(window.Stripe):h(new Error("Stripe.js not available"))}),m.addEventListener("error",function(){h(new Error("Failed to load Stripe.js"))})}catch(y){h(y);return}})),Rg},pB=function(n,l,h){if(n===null)return null;var m=n.apply(void 0,l);return hB(m,h),m},$M=Promise.resolve().then(function(){return dB(null)}),GM=!1;$M.catch(function(e){GM||console.warn(e)});var fB=function(){for(var n=arguments.length,l=new Array(n),h=0;h<n;h++)l[h]=arguments[h];GM=!0;var m=Date.now();return $M.then(function(y){return pB(y,l,m)})};const mB=({tourSlug:e})=>{const n=fB("pk_test_51NdC5EHCvtfDFvkAkxHMrlR9m6k4aql9MGOz9q3sZYDVTk7s8IVESGgVN1roxMJTSAWohsTEzcOsycx4Jw89Bh1E00oldyCqyA"),[l,h]=Te.useState(null),[m,y]=Te.useState(!1),b=async()=>{y(!0);try{const s=await AO(e),A=await n;console.log(s);const{error:R}=await A.redirectToCheckout({sessionId:s.data.id});R&&h(R.message)}catch(s){console.log(s),h(s.message)}y(!1)};return l&&alert(l),Q.jsx(Q.Fragment,{children:Q.jsx("button",{className:"btn btn--green span-all-rows",onClick:b,disabled:m,children:m?"Processing":"Book tour now!"})})};var qM={exports:{}};(function(e,n){(function(l,h){e.exports=h()})(hz,function(){var l,h,m;function y(s,A){if(!l)l=A;else if(!h)h=A;else{var R="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",U={};l(U),m=A(U),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}y(["exports"],function(s){var A=typeof self<"u"?self:{},R="2.15.0";let U;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(U==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{U={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):r}catch{U=r}}return U},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const r=new URL(V.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$={supported:!1,testSupport:function(r){!K&&Y&&(Ce?ee(r):pe=r)}};let pe,Y,K=!1,Ce=!1;function ee(r){const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Y),r.isContextLost())return;$.supported=!0}catch{}r.deleteTexture(t),K=!0}A.document&&(Y=A.document.createElement("img"),Y.onload=function(){pe&&ee(pe),pe=null,Ce=!0},Y.onerror=function(){K=!0,pe=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ne="01";function ce(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var se=De;function De(r,t,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=i,this.p2y=a}De.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var u=this.sampleCurveX(i)-r;if(Math.abs(u)<t)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=u/p}var g=0,v=1;for(i=r,a=0;a<20&&(u=this.sampleCurveX(i),!(Math.abs(u-r)<t));a++)r>u?g=i:v=i,i=.5*(v-g)+g;return i},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var He=ce(se),Be=ut;function ut(r,t){this.x=r,this.y=t}ut.prototype={clone:function(){return new ut(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,i=r.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),i=Math.sin(r),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround:function(r,t){var i=Math.cos(r),a=Math.sin(r),u=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ut.convert=function(r){return r instanceof ut?r:Array.isArray(r)?new ut(r[0],r[1]):r};var Ie=ce(Be);const Je=Math.PI/180,Rt=180/Math.PI;function ht(r){return r*Je}function Ht(r){return r*Rt}const Rn=[[0,0],[1,0],[1,1],[0,1]];function Bt(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,i=t*r;return 4*(r<.5?i:3*(r-t)+i-.75)}function rn(r,t,i,a){const u=new He(r,t,i,a);return function(p){return u.solve(p)}}const vn=rn(.25,.1,.25,1);function qe(r,t,i){return Math.min(i,Math.max(t,r))}function St(r,t,i){return(i=qe((i-r)/(t-r),0,1))*i*(3-2*i)}function bt(r,t,i){const a=i-t,u=((r-t)%a+a)%a+t;return u===t?i:u}function Kt(r,t,i){if(!r.length)return i(null,[]);let a=r.length;const u=new Array(r.length);let p=null;r.forEach((g,v)=>{t(g,(w,E)=>{w&&(p=w),u[v]=E,--a==0&&i(p,u)})})}function xn(r){const t=[];for(const i in r)t.push(r[i]);return t}function En(r,...t){for(const i of t)for(const a in i)r[a]=i[a];return r}let Qt=1;function cr(){return Qt++}function Qn(){return function r(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Rr(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function ai(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Ar(r,t){r.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function xo(r,t){return r.indexOf(t,r.length-t.length)!==-1}function Xt(r,t,i){const a={};for(const u in r)a[u]=t.call(i||this,r[u],u,r);return a}function wo(r,t,i){const a={};for(const u in r)t.call(i||this,r[u],u,r)&&(a[u]=r[u]);return a}function Gr(r){return Array.isArray(r)?r.map(Gr):typeof r=="object"&&r?Xt(r,Gr):r}const Wo={};function gn(r){Wo[r]||(typeof console<"u"&&console.warn(r),Wo[r]=!0)}function qr(r,t,i){return(i.y-r.y)*(t.x-r.x)>(t.y-r.y)*(i.x-r.x)}function bo(r){let t=0;for(let i,a,u=0,p=r.length,g=p-1;u<p;g=u++)i=r[u],a=r[g],t+=(a.x-i.x)*(i.y+a.y);return t}function Qr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Mr(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,u,p)=>{const g=u||p;return t[a]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let Dr=null;function Ii(r){if(Dr==null){const t=r.navigator?r.navigator.userAgent:null;Dr=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Dr}function Eo(r){try{const t=A[r];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function ki(r,t){return[r[4*t],r[4*t+1],r[4*t+2],r[4*t+3]]}const Pi="mapbox-tiles";let zi=500,no=50,Lr,fi;function Vt(){try{return A.caches}catch{}}function Ri(){Vt()&&!Lr&&(Lr=A.caches.open(Pi))}function To(r){const t=r.indexOf("?");if(t<0)return r;const i=function(u){const p=u.indexOf("?");return p>0?u.slice(p+1).split("&"):[]}(r),a=i.filter(u=>{const p=u.split("=");return p[0]==="language"||p[0]==="worldview"});return a.length?`${r.slice(0,t)}?${a.join("&")}`:r.slice(0,t)}let ro=1/0;const So={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(So);class Fe extends Error{constructor(t,i,a){i===401&&we(a)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ve=Qr()?()=>self.worker&&self.worker.referrer:()=>(A.location.protocol==="blob:"?A.parent:A).location.href,at=function(r,t){if(!(/^file:/.test(i=r.url)||/^file:/.test(Ve())&&!/^\w+:/.test(i))){if(A.fetch&&A.Request&&A.AbortController&&A.Request.prototype.hasOwnProperty("signal"))return function(a,u){const p=new A.AbortController,g=new A.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Ve(),referrerPolicy:a.referrerPolicy,signal:p.signal});let v=!1,w=!1;const E=(C=g.url).indexOf("sku=")>0&&we(C);var C;a.type==="json"&&g.headers.set("Accept","application/json");const I=(D,L,F)=>{if(w)return;if(D&&D.message!=="SecurityError"&&gn(D.toString()),L&&F)return k(L);const q=Date.now();A.fetch(g).then(re=>{if(re.ok){const de=E?re.clone():null;return k(re,de,q)}return u(new Fe(re.statusText,re.status,a.url))}).catch(re=>{re.name!=="AbortError"&&u(new Error(`${re.message} ${a.url}`))})},k=(D,L,F)=>{(a.type==="arrayBuffer"?D.arrayBuffer():a.type==="json"?D.json():D.text()).then(q=>{w||(L&&F&&function(re,de,oe){if(Ri(),!Lr)return;const he={status:de.status,statusText:de.statusText,headers:new A.Headers};de.headers.forEach((Re,Me)=>he.headers.set(Me,Re));const me=Mr(de.headers.get("Cache-Control")||"");if(me["no-store"])return;me["max-age"]&&he.headers.set("Expires",new Date(oe+1e3*me["max-age"]).toUTCString());const fe=he.headers.get("Expires");fe&&(new Date(fe).getTime()-oe<42e4||function(Re,Me){if(fi===void 0)try{new Response(new ReadableStream),fi=!0}catch{fi=!1}fi?Me(Re.body):Re.blob().then(Me)}(de,Re=>{const Me=new A.Response(Re,he);Ri(),Lr&&Lr.then(Ue=>Ue.put(To(re.url),Me)).catch(Ue=>gn(Ue.message))}))}(g,L,F),v=!0,u(null,q,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(q=>{w||u(new Error(q.message))})};return E?function(D,L){if(Ri(),!Lr)return L(null);const F=To(D.url);Lr.then(q=>{q.match(F).then(re=>{const de=function(oe){if(!oe)return!1;const he=new Date(oe.headers.get("Expires")||0),me=Mr(oe.headers.get("Cache-Control")||"");return he>Date.now()&&!me["no-cache"]}(re);q.delete(F),de&&q.put(F,re.clone()),L(null,re,de)}).catch(L)}).catch(L)}(g,I):I(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(r,t);if(Qr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t,void 0,!0)}var i;return function(a,u){const p=new A.XMLHttpRequest;p.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in a.headers)p.setRequestHeader(g,a.headers[g]);return a.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=a.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(a.type==="json")try{g=JSON.parse(p.response)}catch(v){return u(v)}u(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new Fe(p.statusText,p.status,a.url))},p.send(a.body),{cancel:()=>p.abort()}}(r,t)},Et=function(r,t){return at(En(r,{type:"arrayBuffer"}),t)};function $t(r){const t=A.document.createElement("a");return t.href=r,t.protocol===A.document.location.protocol&&t.host===A.document.location.host}const ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let N,j;N=[],j=0;const H=function(r,t){if($.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),j>=V.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return N.push(p),p}j++;let i=!1;const a=()=>{if(!i)for(i=!0,j--;N.length&&j<V.MAX_PARALLEL_IMAGE_REQUESTS;){const p=N.shift(),{requestParameters:g,callback:v,cancelled:w}=p;w||(p.cancel=H(g,v).cancel)}},u=Et(r,(p,g,v,w)=>{a(),p?t(p):g&&(A.createImageBitmap?function(E,C){const I=new A.Blob([new Uint8Array(E)],{type:"image/png"});A.createImageBitmap(I).then(k=>{C(null,k)}).catch(k=>{C(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,C)=>t(E,C,v,w)):function(E,C){const I=new A.Image,k=A.URL;I.onload=()=>{C(null,I),k.revokeObjectURL(I.src),I.onload=null,A.requestAnimationFrame(()=>{I.src=ie})},I.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new A.Blob([new Uint8Array(E)],{type:"image/png"});I.src=E.byteLength?k.createObjectURL(D):ie}(g,(E,C)=>t(E,C,v,w)))});return{cancel:()=>{u.cancel(),a()}}},ue="NO_ACCESS_TOKEN";function ye(r){return r.indexOf("mapbox:")===0}function we(r){return V.API_URL_REGEX.test(r)}function be(r){return V.API_CDN_URL_REGEX.test(r)}function ge(r){return V.API_STYLE_REGEX.test(r)&&!ze(r)}function ze(r){return V.API_SPRITE_REGEX.test(r)}const et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ct(r){const t=r.match(et);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function tt(r){const t=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${t}`}const zt="mapbox.eventData";function Dt(r){if(!r)return null;const t=r.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(A.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Lt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=Dt(V.ACCESS_TOKEN);let a="";return a=i&&i.u?A.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(+("0x"+p)))):V.ACCESS_TOKEN||"",t?`${zt}.${t}:${a}`:`${zt}:${a}`}fetchEventData(){const t=Eo("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{const u=A.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const p=A.localStorage.getItem(a);p&&(this.anonId=p)}catch{gn("Unable to read from LocalStorage")}}saveEventData(){const t=Eo("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{A.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&A.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{gn("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,a,u){if(!V.EVENTS_URL)return;const p=ct(V.EVENTS_URL);p.params.push(`access_token=${u||V.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString()},v=i?En(g,i):g,w={url:tt(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,C){return at(En(E,{method:"POST"}),C)}(w,E=>{this.pendingRequest=null,a(E),this.saveEventData(),this.processRequests(u)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const Gt=new class extends Lt{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,t){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(r)&&r.some(i=>ye(i)||we(i))&&this.queueRequest(Date.now(),t)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Dt(V.ACCESS_TOKEN),i=t?t.u:V.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;ai(this.anonId)||(this.anonId=Qn(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(u),v=(u-this.eventData.lastSuccess)/864e5;a=a||v>=1||v<-1||p.getDate()!==g.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:ne,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},r):this.processRequests()}},Yt=Gt.postTurnstileEvent.bind(Gt),Dn=new class extends Lt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,t,i,a){this.skuToken=t,this.errorCb=a,V.EVENTS_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(ue)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ai(this.anonId)||(this.anonId=Qn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:ne,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},r))}},Ft=Dn.postMapLoadEvent.bind(Dn),Vn=new class extends Lt{constructor(){super("gljs.performance")}postPerformanceEvent(r,t){V.EVENTS_URL&&(r||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),a=function(u){const p=A.performance.getEntriesByType("resource"),g=A.performance.getEntriesByType("mark"),v=function(k){const D={};if(k){for(const L in k)if(L!=="other")for(const F of k[L]){const q=`${L}ResolveRangeMin`,re=`${L}ResolveRangeMax`,de=`${L}RequestCount`,oe=`${L}RequestCachedCount`;D[q]=Math.min(D[q]||1/0,F.startTime),D[re]=Math.max(D[re]||-1/0,F.responseEnd);const he=me=>{D[me]===void 0&&(D[me]=0),++D[me]};F.transferSize!==void 0&&F.transferSize===0&&he(oe),he(de)}}return D}(function(k,D){const L={};if(k)for(const F of k){const q=D(F);L[q]===void 0&&(L[q]=[]),L[q].push(F)}return L}(p,Uf)),w=A.devicePixelRatio,E=A.navigator.connection||A.navigator.mozConnection||A.navigator.webkitConnection,C={counters:[],metadata:[],attributes:[]},I=(k,D,L)=>{L!=null&&k.push({name:D,value:L.toString()})};for(const k in v)I(C.counters,k,v[k]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(I(C.counters,"interactionRangeMin",u.interactionRange[0]),I(C.counters,"interactionRangeMax",u.interactionRange[1])),g)for(const k of Object.keys(Zo)){const D=Zo[k],L=g.find(F=>F.name===D);L&&I(C.counters,D,L.startTime)}return I(C.counters,"visibilityHidden",u.visibilityHidden),I(C.attributes,"style",function(k){if(k)for(const D of k){const L=D.name.split("?")[0];if(ge(L)){const F=L.split("/").slice(-2);if(F.length===2)return`mapbox://styles/${F[0]}/${F[1]}`}}}(p)),I(C.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),I(C.attributes,"fogEnabled",u.fogEnabled?"true":"false"),I(C.attributes,"projection",u.projection),I(C.attributes,"zoom",u.zoom),I(C.metadata,"devicePixelRatio",w),I(C.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),I(C.metadata,"navigatorUserAgent",A.navigator.userAgent),I(C.metadata,"screenWidth",A.screen.width),I(C.metadata,"screenHeight",A.screen.height),I(C.metadata,"windowWidth",A.innerWidth),I(C.metadata,"windowHeight",A.innerHeight),I(C.metadata,"mapWidth",u.width/w),I(C.metadata,"mapHeight",u.height/w),I(C.metadata,"webglRenderer",u.renderer),I(C.metadata,"webglVendor",u.vendor),I(C.metadata,"sdkVersion",R),I(C.metadata,"sdkIdentifier","mapbox-gl-js"),C}(i);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(t,a,()=>{},r)}},Ln=Vn.postPerformanceEvent.bind(Vn),mi=new class extends Lt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,t,i,a){if(!V.API_URL||!V.SESSION_PATH)return;const u=ct(V.API_URL+V.SESSION_PATH);u.params.push(`sku=${t||""}`),u.params.push(`access_token=${a||V.ACCESS_TOKEN||""}`);const p={url:tt(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,v){return at(En(g,{method:"GET"}),v)}(p,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(r,t,i,a){this.skuToken=t,this.errorCb=a,V.SESSION_PATH&&V.API_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(ue)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},r)}},an=mi.getSessionAPI.bind(mi),ur=new Set,Zo={create:"create",load:"load",fullLoad:"fullLoad"},Vh={mark(r){A.performance.mark(r)},measure(r,t,i){A.performance.measure(r,t,i)}};function Uf(r){const t=r.name.split("?")[0];return be(t)&&t.includes("mapbox-gl.js")?"javascript":be(t)&&t.includes("mapbox-gl.css")?"css":function(i){return V.API_FONTS_REGEX.test(i)}(t)?"fontRange":ze(t)?"sprite":ge(t)?"style":function(i){return V.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}const pn=A.performance;function $h(r){const t=r?r.url.toString():void 0;return pn.getEntriesByName(t)}let zl,Gh,Uc,Co;const Ho={now:()=>Uc!==void 0?Uc:A.performance.now(),setNow(r){Uc=r},restoreNow(){Uc=void 0},frame(r){const t=A.requestAnimationFrame(r);return{cancel:()=>A.cancelAnimationFrame(t)}},getImageData(r,t=0){const{width:i,height:a}=r;Co||(Co=A.document.createElement("canvas"));const u=Co.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Co.width||a>Co.height)&&(Co.width=i,Co.height=a),u.clearRect(-t,-t,i+2*t,a+2*t),u.drawImage(r,0,0,i,a),u.getImageData(-t,-t,i+2*t,a+2*t)},resolveURL:r=>(zl||(zl=A.document.createElement("a")),zl.href=r,zl.href),get devicePixelRatio(){return A.devicePixelRatio},get prefersReducedMotion(){return!!A.matchMedia&&(Gh==null&&(Gh=A.matchMedia("(prefers-reduced-motion: reduce)")),Gh.matches)}};function qh(r,t,i){i[r]&&i[r].indexOf(t)!==-1||(i[r]=i[r]||[],i[r].push(t))}function Wh(r,t,i){if(i&&i[r]){const a=i[r].indexOf(t);a!==-1&&i[r].splice(a,1)}}class qs{constructor(t,i={}){En(this,i),this.type=t}}class Xo extends qs{constructor(t,i={}){super("error",En({error:t},i))}}class Rl{on(t,i){return this._listeners=this._listeners||{},qh(t,i,this._listeners),this}off(t,i){return Wh(t,i,this._listeners),Wh(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},qh(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new qs(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of u)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of p)Wh(a,v,this._oneTimeListeners),v.call(this,t);const g=this._eventedParent;g&&(En(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Xo&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ko(r,...t){for(const i of t)for(const a in i)r[a]=i[a];return r}function hr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Or(r){if(Array.isArray(r))return r.map(Or);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const i in r)t[i]=Or(r[i]);return t}return hr(r)}class Vf extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var Ao=Vf;class Zh{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,u]of i)this.bindings[a]=u}concat(t){return new Zh(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var $f=Zh;const za={kind:"null"},_t={kind:"number"},on={kind:"string"},en={kind:"boolean"},Di={kind:"color"},io={kind:"object"},tn={kind:"value"},Li={kind:"collator"},Dl={kind:"formatted"},Ws={kind:"resolvedImage"};function Ui(r,t){return{kind:"array",itemType:r,N:t}}function Hn(r){if(r.kind==="array"){const t=Hn(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const Gf=[za,_t,on,en,Di,Dl,io,Ui(tn),Ws];function Yo(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Yo(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const i of Gf)if(!Yo(i,t))return null}}return`Expected ${Hn(r)} but found ${Hn(t)} instead.`}function Ll(r,t){return t.some(i=>i.kind===r.kind)}function Ol(r,t){return t.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}var Hh,qf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Bl(r){return(r=Math.round(r))<0?0:r>255?255:r}function Fl(r){return Bl(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function Vc(r){return(t=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:t>1?1:t;var t}function Ra(r,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?r+(t-r)*i*6:2*i<1?t:3*i<2?r+(t-r)*(2/3-i)*6:r}try{Hh={}.parseCSSColor=function(r){var t,i=r.replace(/ /g,"").toLowerCase();if(i in qf)return qf[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var a=i.indexOf("("),u=i.indexOf(")");if(a!==-1&&u+1===i.length){var p=i.substr(0,a),g=i.substr(a+1,u-(a+1)).split(","),v=1;switch(p){case"rgba":if(g.length!==4)return null;v=Vc(g.pop());case"rgb":return g.length!==3?null:[Fl(g[0]),Fl(g[1]),Fl(g[2]),v];case"hsla":if(g.length!==4)return null;v=Vc(g.pop());case"hsl":if(g.length!==3)return null;var w=(parseFloat(g[0])%360+360)%360/360,E=Vc(g[1]),C=Vc(g[2]),I=C<=.5?C*(E+1):C+E-C*E,k=2*C-I;return[Bl(255*Ra(k,I,w+1/3)),Bl(255*Ra(k,I,w)),Bl(255*Ra(k,I,w-1/3)),v];default:return null}}return null}}catch{}class gi{constructor(t,i,a,u=1){this.r=t,this.g=i,this.b=a,this.a=u}static parse(t){if(!t)return;if(t instanceof gi)return t;if(typeof t!="string")return;const i=Hh(t);return i?new gi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,a,u]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(a)},${u})`}toArray(){const{r:t,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*t/u,255*i/u,255*a/u,u]}toArray01(){const{r:t,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[t/u,i/u,a/u,u]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:a,a:u}=this;return[t,i,a,u]}}gi.black=new gi(0,0,0,1),gi.white=new gi(1,1,1,1),gi.transparent=new gi(0,0,0,0),gi.red=new gi(1,0,0,1),gi.blue=new gi(0,0,1,1);var ir=gi;class Xh{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kh{constructor(t,i,a,u,p){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=a,this.fontStack=u,this.textColor=p}}class _i{constructor(t){this.sections=t}static fromString(t){return new _i([new Kh(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof _i?t:_i.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.name]);continue}t.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(a)}return t}}class Vi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Vi({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Wf(r,t,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,i,a]:[r,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof ir||r instanceof Xh||r instanceof _i||r instanceof Vi)return!0;if(Array.isArray(r)){for(const t of r)if(!Nl(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Nl(r[t]))return!1;return!0}return!1}function er(r){if(r===null)return za;if(typeof r=="string")return on;if(typeof r=="boolean")return en;if(typeof r=="number")return _t;if(r instanceof ir)return Di;if(r instanceof Xh)return Li;if(r instanceof _i)return Dl;if(r instanceof Vi)return Ws;if(Array.isArray(r)){const t=r.length;let i;for(const a of r){const u=er(a);if(i){if(i===u)continue;i=tn;break}i=u}return Ui(i||tn,t)}return io}function jl(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof ir||r instanceof _i||r instanceof Vi?r.toString():JSON.stringify(r)}class Yh{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Nl(t[1]))return i.error("invalid value");const a=t[1];let u=er(a);const p=i.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Yh(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ir?["rgba"].concat(this.value.toArray()):this.value instanceof _i?this.value.serialize():this.value}}var Zs=Yh,Wr=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const Jh={string:on,number:_t,boolean:en,object:io};class Qh{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,u=1;const p=t[0];if(p==="array"){let v,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in Jh)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Jh[E],u++}else v=tn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=t[2],u++}a=Ui(v,w)}else a=Jh[p];const g=[];for(;u<t.length;u++){const v=i.parse(t[u],u,tn);if(!v)return null;g.push(v)}return new Qh(a,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!Yo(this.type,er(a)))return a;if(i===this.args.length-1)throw new Wr(`Expected value to be of type ${Hn(this.type)}, but found ${Hn(er(a))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const a=t.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const u=t.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(a=>a.serialize()))}}var Jo=Qh;class bs{constructor(t){this.type=Dl,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let g=1;g<=t.length-1;++g){const v=t[g];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=i.parse(v["font-scale"],1,_t),!w))return null;let E=null;if(v["text-font"]&&(E=i.parse(v["text-font"],1,Ui(on)),!E))return null;let C=null;if(v["text-color"]&&(C=i.parse(v["text-color"],1,Di),!C))return null;const I=u[u.length-1];I.scale=w,I.font=E,I.textColor=C}else{const w=i.parse(t[g],1,tn);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new bs(u)}evaluate(t){return new _i(this.sections.map(i=>{const a=i.content.evaluate(t);return er(a)===Ws?new Kh("",a,null,null,null):new Kh(jl(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),t.push(a)}return t}}class $c{constructor(t){this.type=Ws,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,on);return a?new $c(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=Vi.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Py={"to-boolean":en,"to-color":Di,"to-number":_t,"to-string":on};class ed{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const u=Py[a],p=[];for(let g=1;g<t.length;g++){const v=i.parse(t[g],g,tn);if(!v)return null;p.push(v)}return new ed(u,p)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,a;for(const u of this.args){if(i=u.evaluate(t),a=null,i instanceof ir)return i;if(typeof i=="string"){const p=t.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Wf(i[0],i[1],i[2],i[3]),!a))return new ir(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Wr(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Wr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?_i.fromString(jl(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Vi.fromString(jl(this.args[0].evaluate(t))):jl(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new bs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $c(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Da=ed;const Mo=["Unknown","Point","LineString","Polygon"];var td=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Mo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-r[0])+this.featureDistanceData.bearing[1]*(a*t-r[1])}return 0}parseColor(r){let t=this._parseColorCache[r];return t||(t=this._parseColorCache[r]=ir.parse(r)),t}};class Hs{constructor(t,i,a,u){this.name=t,this.type=i,this._evaluate=a,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const a=t[0],u=Hs.definitions[a];if(!u)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=g.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,C]of v){w=new ad(i.registry,i.path,null,i.scope);const I=[];let k=!1;for(let D=1;D<t.length;D++){const L=t[D],F=Array.isArray(E)?E[D-1]:E.type,q=w.parse(L,1+I.length,F);if(!q){k=!0;break}I.push(q)}if(!k)if(Array.isArray(E)&&E.length!==I.length)w.error(`Expected ${E.length} arguments, but found ${I.length} instead.`);else{for(let D=0;D<I.length;D++){const L=Array.isArray(E)?E[D]:E.type,F=I[D];w.concat(D+1).checkSubtype(L,F.type)}if(w.errors.length===0)return new Hs(a,p,C,I)}}if(v.length===1)i.errors.push(...w.errors);else{const E=(v.length?v:g).map(([I])=>{return k=I,Array.isArray(k)?`(${k.map(Hn).join(", ")})`:`(${Hn(k.type)}...)`;var k}).join(" | "),C=[];for(let I=1;I<t.length;I++){const k=i.parse(t[I],1+C.length);if(!k)return null;C.push(Hn(k.type))}i.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(t,i){Hs.definitions=i;for(const a in i)t[a]=Hs}}var Qo=Hs;class Ul{constructor(t,i,a){this.type=Li,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const u=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,en);if(!u)return null;const p=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,en);if(!p)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,on),!g)?null:new Ul(u,p,g)}evaluate(t){return new Xh(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const es=8192;function Gc(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function La(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Vl(r,t){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(i*u*es),Math.round(a*u*es)]}function Zf(r,t,i){const a=r[0]-t[0],u=r[1]-t[1],p=r[0]-i[0],g=r[1]-i[1];return a*g-p*u==0&&a*p<=0&&u*g<=0}function qc(r,t){let i=!1;for(let g=0,v=t.length;g<v;g++){const w=t[g];for(let E=0,C=w.length;E<C-1;E++){if(Zf(r,w[E],w[E+1]))return!1;(u=w[E])[1]>(a=r)[1]!=(p=w[E+1])[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]&&(i=!i)}}var a,u,p;return i}function nd(r,t){for(let i=0;i<t.length;i++)if(qc(r,t[i]))return!0;return!1}function rd(r,t,i,a){const u=a[0]-i[0],p=a[1]-i[1],g=(r[0]-i[0])*p-u*(r[1]-i[1]),v=(t[0]-i[0])*p-u*(t[1]-i[1]);return g>0&&v<0||g<0&&v>0}function Oa(r,t,i){for(const E of i)for(let C=0;C<E.length-1;++C)if((v=[(g=E[C+1])[0]-(p=E[C])[0],g[1]-p[1]])[0]*(w=[(u=t)[0]-(a=r)[0],u[1]-a[1]])[1]-v[1]*w[0]!=0&&rd(a,u,p,g)&&rd(p,g,a,u))return!0;var a,u,p,g,v,w;return!1}function fn(r,t){for(let i=0;i<r.length;++i)if(!qc(r[i],t))return!1;for(let i=0;i<r.length-1;++i)if(Oa(r[i],r[i+1],t))return!1;return!0}function zy(r,t){for(let i=0;i<t.length;i++)if(fn(r,t[i]))return!0;return!1}function id(r,t,i){const a=[];for(let u=0;u<r.length;u++){const p=[];for(let g=0;g<r[u].length;g++){const v=Vl(r[u][g],i);Gc(t,v),p.push(v)}a.push(p)}return a}function Hf(r,t,i){const a=[];for(let u=0;u<r.length;u++){const p=id(r[u],t,i);a.push(p)}return a}function od(r,t,i,a){if(r[0]<i[0]||r[0]>i[2]){const u=.5*a;let p=r[0]-i[0]>u?-a:i[0]-r[0]>u?a:0;p===0&&(p=r[0]-i[2]>u?-a:i[2]-r[0]>u?a:0),r[0]+=p}Gc(t,r)}function Xf(r,t,i,a){const u=Math.pow(2,a.z)*es,p=[a.x*es,a.y*es],g=[];if(!r)return g;for(const v of r)for(const w of v){const E=[w.x+p[0],w.y+p[1]];od(E,t,i,u),g.push(E)}return g}function sd(r,t,i,a){const u=Math.pow(2,a.z)*es,p=[a.x*es,a.y*es],g=[];if(!r)return g;for(const w of r){const E=[];for(const C of w){const I=[C.x+p[0],C.y+p[1]];Gc(t,I),E.push(I)}g.push(E)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of g)for(const E of w)od(E,t,i,u)}var v;return g}class Ba{constructor(t,i){this.type=en,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Nl(t[1])){const a=t[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const p=a.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ba(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ba(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ba(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const v=id(a.coordinates,p,g),w=Xf(i.geometry(),u,p,g);if(!La(u,p))return!1;for(const E of w)if(!qc(E,v))return!1}if(a.type==="MultiPolygon"){const v=Hf(a.coordinates,p,g),w=Xf(i.geometry(),u,p,g);if(!La(u,p))return!1;for(const E of w)if(!nd(E,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const v=id(a.coordinates,p,g),w=sd(i.geometry(),u,p,g);if(!La(u,p))return!1;for(const E of w)if(!fn(E,v))return!1}if(a.type==="MultiPolygon"){const v=Hf(a.coordinates,p,g),w=sd(i.geometry(),u,p,g);if(!La(u,p))return!1;for(const E of w)if(!zy(E,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wc=Ba;function Fa(r){if(r instanceof Qo&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Wc)return!1;let t=!0;return r.eachChild(i=>{t&&!Fa(i)&&(t=!1)}),t}function ts(r){if(r instanceof Qo&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(i=>{t&&!ts(i)&&(t=!1)}),t}function Xs(r,t){if(r instanceof Qo&&t.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(a=>{i&&!Xs(a,t)&&(i=!1)}),i}class Zc{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new Zc(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Kf=Zc;class $l{constructor(t,i=[],a,u=new $f,p=[]){this.registry=t,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=p,this.expectedType=a}parse(t,i,a,u,p={}){return i?this.concat(i,a,u)._parse(t,p):this._parse(t,p)}_parse(t,i){function a(u,p,g){return g==="assert"?new Jo(p,[u]):g==="coerce"?new Da(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let g=p.parse(t,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,w=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(v,w))return null}else g=a(g,v,i.typeAnnotation||"coerce");else g=a(g,v,i.typeAnnotation||"assert")}if(!(g instanceof Zs)&&g.type.kind!=="resolvedImage"&&ld(g)){const v=new td;try{g=new Zs(g.type,g.evaluate(v))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const u=typeof t=="number"?this.path.concat(t):this.path,p=a?this.scope.concat(a):this.scope;return new $l(this.registry,u,i||null,p,this.errors)}error(t,...i){const a=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ao(a,t))}checkSubtype(t,i){const a=Yo(t,i);return a&&this.error(a),a}}var ad=$l;function ld(r){if(r instanceof Kf)return ld(r.boundExpression);if(r instanceof Qo&&r.name==="error"||r instanceof Ul||r instanceof Wc)return!1;const t=r instanceof Da||r instanceof Jo;let i=!0;return r.eachChild(a=>{i=t?i&&ld(a):i&&a instanceof Zs}),!!i&&Fa(r)&&Xs(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Hc(r,t){const i=r.length-1;let a,u,p=0,g=i,v=0;for(;p<=g;)if(v=Math.floor((p+g)/2),a=r[v],u=r[v+1],a<=t){if(v===i||t<u)return v;p=v+1}else{if(!(a>t))throw new Wr("Input is not a number.");g=v-1}return 0}class Xc{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of a)this.labels.push(u),this.outputs.push(p)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,_t);if(!a)return null;const u=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<t.length;g+=2){const v=g===1?-1/0:t[g],w=t[g+1],E=g,C=g+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const I=i.parse(w,C,p);if(!I)return null;p=p||I.type,u.push([v,I])}return new Xc(p,a,u)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const u=this.input.evaluate(t);if(u<=i[0])return a[0].evaluate(t);const p=i.length;return u>=i[p-1]?a[p-1].evaluate(t):a[Hc(i,u)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var cd=Xc;function ln(r,t,i){return r*(1-i)+t*i}var Gl=Object.freeze({__proto__:null,array:function(r,t,i){return r.map((a,u)=>ln(a,t[u],i))},color:function(r,t,i){return new ir(ln(r.r,t.r,i),ln(r.g,t.g,i),ln(r.b,t.b,i),ln(r.a,t.a,i))},number:ln});const Yf=.95047,ud=1.08883,Jf=4/29,Ks=6/29,hd=3*Ks*Ks,Ry=Ks*Ks*Ks,Dy=Math.PI/180,Ly=180/Math.PI;function dd(r){return r>Ry?Math.pow(r,1/3):r/hd+Jf}function pd(r){return r>Ks?r*r*r:hd*(r-Jf)}function fd(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Kc(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Qf(r){const t=Kc(r.r),i=Kc(r.g),a=Kc(r.b),u=dd((.4124564*t+.3575761*i+.1804375*a)/Yf),p=dd((.2126729*t+.7151522*i+.072175*a)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-dd((.0193339*t+.119192*i+.9503041*a)/ud)),alpha:r.a}}function em(r){let t=(r.l+16)/116,i=isNaN(r.a)?t:t+r.a/500,a=isNaN(r.b)?t:t-r.b/200;return t=1*pd(t),i=Yf*pd(i),a=ud*pd(a),new ir(fd(3.2404542*i-1.5371385*t-.4985314*a),fd(-.969266*i+1.8760108*t+.041556*a),fd(.0556434*i-.2040259*t+1.0572252*a),r.alpha)}function Oy(r,t,i){const a=t-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const ql={forward:Qf,reverse:em,interpolate:function(r,t,i){return{l:ln(r.l,t.l,i),a:ln(r.a,t.a,i),b:ln(r.b,t.b,i),alpha:ln(r.alpha,t.alpha,i)}}},Na={forward:function(r){const{l:t,a:i,b:a}=Qf(r),u=Math.atan2(a,i)*Ly;return{h:u<0?u+360:u,c:Math.sqrt(i*i+a*a),l:t,alpha:r.a}},reverse:function(r){const t=r.h*Dy,i=r.c;return em({l:r.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:r.alpha})},interpolate:function(r,t,i){return{h:Oy(r.h,t.h,i),c:ln(r.c,t.c,i),l:ln(r.l,t.l,i),alpha:ln(r.alpha,t.alpha,i)}}};var md=Object.freeze({__proto__:null,hcl:Na,lab:ql});class Wl{constructor(t,i,a,u,p){this.type=t,this.operator=i,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,i,a,u){let p=0;if(t.name==="exponential")p=gd(i,t.base,a,u);else if(t.name==="linear")p=gd(i,1,a,u);else if(t.name==="cubic-bezier"){const g=t.controlPoints;p=new He(g[0],g[1],g[2],g[3]).solve(gd(i,1,a,u))}return p}static parse(t,i){let[a,u,p,...g]=t;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,_t),!p)return null;const v=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=Di:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<g.length;E+=2){const C=g[E],I=g[E+1],k=E+3,D=E+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const L=i.parse(I,D,w);if(!L)return null;w=w||L.type,v.push([C,L])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Wl(w,a,u,p,v):i.error(`Type ${Hn(w)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const u=this.input.evaluate(t);if(u<=i[0])return a[0].evaluate(t);const p=i.length;if(u>=i[p-1])return a[p-1].evaluate(t);const g=Hc(i,u),v=Wl.interpolationFactor(this.interpolation,u,i[g],i[g+1]),w=a[g].evaluate(t),E=a[g+1].evaluate(t);return this.operator==="interpolate"?Gl[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?Na.reverse(Na.interpolate(Na.forward(w),Na.forward(E),v)):ql.reverse(ql.interpolate(ql.forward(w),ql.forward(E),v))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function gd(r,t,i,a){const u=a-i,p=r-i;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}var Io=Wl;class Yc{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let a=null;const u=i.expectedType;u&&u.kind!=="value"&&(a=u);const p=[];for(const v of t.slice(1)){const w=i.parse(v,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,p.push(w)}const g=u&&p.some(v=>Yo(u,v.type));return new Yc(g?tn:a,p)}evaluate(t){let i,a=null,u=0;for(const p of this.args){if(u++,a=p.evaluate(t),a&&a instanceof Vi&&!a.available&&(i||(i=a),a=null,u===this.args.length))return i;if(a!==null)break}return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var _d=Yc;class Jc{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let p=1;p<t.length-1;p+=2){const g=t[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=i.parse(t[p+1],p+1);if(!v)return null;a.push([g,v])}const u=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return u?new Jc(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,a]of this.bindings)t.push(i,a.serialize());return t.push(this.result.serialize()),t}}var tm=Jc;class yd{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,_t),u=i.parse(t[2],2,Ui(i.expectedType||tn));return a&&u?new yd(u.type.itemType,a,u):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new Wr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Wr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Wr(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var By=yd;class vd{constructor(t,i){this.type=en,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,tn),u=i.parse(t[2],2,tn);return a&&u?Ll(a.type,[en,on,_t,za,tn])?new vd(a,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(a==null)return!1;if(!Ol(i,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(er(i))} instead.`);if(!Ol(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Hn(er(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Qc=vd;class Zl{constructor(t,i,a){this.type=_t,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,tn),u=i.parse(t[2],2,tn);if(!a||!u)return null;if(!Ll(a.type,[en,on,_t,za,tn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(a.type)} instead`);if(t.length===4){const p=i.parse(t[3],3,_t);return p?new Zl(a,u,p):null}return new Zl(a,u)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Ol(i,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(er(i))} instead.`);if(!Ol(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Hn(er(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(t);return a.indexOf(i,u)}return a.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nm=Zl;class xd{constructor(t,i,a,u,p,g){this.inputType=t,this.type=i,this.input=a,this.cases=u,this.outputs=p,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const p={},g=[];for(let E=2;E<t.length-1;E+=2){let C=t[E];const I=t[E+1];Array.isArray(C)||(C=[C]);const k=i.concat(E);if(C.length===0)return k.error("Expected at least one branch label.");for(const L of C){if(typeof L!="number"&&typeof L!="string")return k.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return k.error("Numeric branch labels must be integer values.");if(a){if(k.checkSubtype(a,er(L)))return null}else a=er(L);if(p[String(L)]!==void 0)return k.error("Branch labels must be unique.");p[String(L)]=g.length}const D=i.parse(I,E,u);if(!D)return null;u=u||D.type,g.push(D)}const v=i.parse(t[1],1,tn);if(!v)return null;const w=i.parse(t[t.length-1],t.length-1,u);return w?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new xd(a,u,v,p,g,w):null}evaluate(t){const i=this.input.evaluate(t);return(er(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],u={};for(const g of i){const v=u[this.cases[g]];v===void 0?(u[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[v][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,v]of a)t.push(v.length===1?p(v[0]):v.map(p)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var Fy=xd;class wd{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const u=[];for(let g=1;g<t.length-1;g+=2){const v=i.parse(t[g],g,en);if(!v)return null;const w=i.parse(t[g+1],g+1,a);if(!w)return null;u.push([v,w]),a=a||w.type}const p=i.parse(t[t.length-1],t.length-1,a);return p?new wd(a,u,p):null}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var rm=wd;class Hl{constructor(t,i,a,u){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=u}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,tn),u=i.parse(t[2],2,_t);if(!a||!u)return null;if(!Ll(a.type,[Ui(tn),on,tn]))return i.error(`Expected first argument to be of type array or string, but found ${Hn(a.type)} instead`);if(t.length===4){const p=i.parse(t[3],3,_t);return p?new Hl(a.type,a,u,p):null}return new Hl(a.type,a,u)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!Ol(i,["string","array"]))throw new Wr(`Expected first argument to be of type array or string, but found ${Hn(er(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(t);return i.slice(a,u)}return i.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var im=Hl;function eu(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function om(r,t,i,a){return a.compare(t,i)===0}function ja(r,t,i){const a=r!=="=="&&r!=="!=";return class WM{constructor(p,g,v){this.type=en,this.lhs=p,this.rhs=g,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const v=p[0];let w=g.parse(p[1],1,tn);if(!w)return null;if(!eu(v,w.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Hn(w.type)}'.`);let E=g.parse(p[2],2,tn);if(!E)return null;if(!eu(v,E.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Hn(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Hn(w.type)}' and '${Hn(E.type)}'.`);a&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new Jo(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new Jo(w.type,[E])));let C=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(p[3],3,Li),!C)return null}return new WM(w,E,C)}evaluate(p){const g=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const w=er(g),E=er(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Wr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=er(g),E=er(v);if(w.kind!=="string"||E.kind!=="string")return t(p,g,v)}return this.collator?i(p,g,v,this.collator.evaluate(p)):t(p,g,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const Ny=ja("==",function(r,t,i){return t===i},om),jy=ja("!=",function(r,t,i){return t!==i},function(r,t,i,a){return!om(0,t,i,a)}),Uy=ja("<",function(r,t,i){return t<i},function(r,t,i,a){return a.compare(t,i)<0}),Vy=ja(">",function(r,t,i){return t>i},function(r,t,i,a){return a.compare(t,i)>0}),$y=ja("<=",function(r,t,i){return t<=i},function(r,t,i,a){return a.compare(t,i)<=0}),sm=ja(">=",function(r,t,i){return t>=i},function(r,t,i,a){return a.compare(t,i)>=0});class tu{constructor(t,i,a,u,p,g){this.type=on,this.number=t,this.locale=i,this.currency=a,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,_t);if(!a)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parse(u.locale,1,on),!p))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,on),!g))return null;let v=null;if(u.unit&&(v=i.parse(u.unit,1,on),!v))return null;let w=null;if(u["min-fraction-digits"]&&(w=i.parse(u["min-fraction-digits"],1,_t),!w))return null;let E=null;return u["max-fraction-digits"]&&(E=i.parse(u["max-fraction-digits"],1,_t),!E)?null:new tu(a,p,g,v,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Ua{constructor(t){this.type=_t,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Hn(a.type)} instead.`):new Ua(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Wr(`Expected value to be of type string or array, but found ${Hn(er(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}const am={"==":Ny,"!=":jy,">":Vy,"<":Uy,">=":sm,"<=":$y,array:Jo,at:By,boolean:Jo,case:rm,coalesce:_d,collator:Ul,format:bs,image:$c,in:Qc,"index-of":nm,interpolate:Io,"interpolate-hcl":Io,"interpolate-lab":Io,length:Ua,let:tm,literal:Zs,match:Fy,number:Jo,"number-format":tu,object:Jo,slice:im,step:cd,string:Jo,"to-boolean":Da,"to-color":Da,"to-number":Da,"to-string":Da,var:Kf,within:Wc};function lm(r,[t,i,a,u]){t=t.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const p=u?u.evaluate(r):1,g=Wf(t,i,a,p);if(g)throw new Wr(g);return new ir(t/255*p,i/255*p,a/255*p,p)}function ns(r,t){return r in t}function nu(r,t){const i=t[r];return i===void 0?null:i}function $i(r){return{type:r}}Qo.register(am,{error:[{kind:"error"},[on],(r,[t])=>{throw new Wr(t.evaluate(r))}],typeof:[on,[tn],(r,[t])=>Hn(er(t.evaluate(r)))],"to-rgba":[Ui(_t,4),[Di],(r,[t])=>t.evaluate(r).toArray()],rgb:[Di,[_t,_t,_t],lm],rgba:[Di,[_t,_t,_t,_t],lm],has:{type:en,overloads:[[[on],(r,[t])=>ns(t.evaluate(r),r.properties())],[[on,io],(r,[t,i])=>ns(t.evaluate(r),i.evaluate(r))]]},get:{type:tn,overloads:[[[on],(r,[t])=>nu(t.evaluate(r),r.properties())],[[on,io],(r,[t,i])=>nu(t.evaluate(r),i.evaluate(r))]]},"feature-state":[tn,[on],(r,[t])=>nu(t.evaluate(r),r.featureState||{})],properties:[io,[],r=>r.properties()],"geometry-type":[on,[],r=>r.geometryType()],id:[tn,[],r=>r.id()],zoom:[_t,[],r=>r.globals.zoom],pitch:[_t,[],r=>r.globals.pitch||0],"distance-from-center":[_t,[],r=>r.distanceFromCenter()],"heatmap-density":[_t,[],r=>r.globals.heatmapDensity||0],"line-progress":[_t,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[_t,[],r=>r.globals.skyRadialProgress||0],accumulated:[tn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[_t,$i(_t),(r,t)=>{let i=0;for(const a of t)i+=a.evaluate(r);return i}],"*":[_t,$i(_t),(r,t)=>{let i=1;for(const a of t)i*=a.evaluate(r);return i}],"-":{type:_t,overloads:[[[_t,_t],(r,[t,i])=>t.evaluate(r)-i.evaluate(r)],[[_t],(r,[t])=>-t.evaluate(r)]]},"/":[_t,[_t,_t],(r,[t,i])=>t.evaluate(r)/i.evaluate(r)],"%":[_t,[_t,_t],(r,[t,i])=>t.evaluate(r)%i.evaluate(r)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(r,[t,i])=>Math.pow(t.evaluate(r),i.evaluate(r))],sqrt:[_t,[_t],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[_t,[_t],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[_t,[_t],(r,[t])=>Math.log(t.evaluate(r))],log2:[_t,[_t],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[_t,[_t],(r,[t])=>Math.sin(t.evaluate(r))],cos:[_t,[_t],(r,[t])=>Math.cos(t.evaluate(r))],tan:[_t,[_t],(r,[t])=>Math.tan(t.evaluate(r))],asin:[_t,[_t],(r,[t])=>Math.asin(t.evaluate(r))],acos:[_t,[_t],(r,[t])=>Math.acos(t.evaluate(r))],atan:[_t,[_t],(r,[t])=>Math.atan(t.evaluate(r))],min:[_t,$i(_t),(r,t)=>Math.min(...t.map(i=>i.evaluate(r)))],max:[_t,$i(_t),(r,t)=>Math.max(...t.map(i=>i.evaluate(r)))],abs:[_t,[_t],(r,[t])=>Math.abs(t.evaluate(r))],round:[_t,[_t],(r,[t])=>{const i=t.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[_t,[_t],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[_t,[_t],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[en,[on,tn],(r,[t,i])=>r.properties()[t.value]===i.value],"filter-id-==":[en,[tn],(r,[t])=>r.id()===t.value],"filter-type-==":[en,[on],(r,[t])=>r.geometryType()===t.value],"filter-<":[en,[on,tn],(r,[t,i])=>{const a=r.properties()[t.value],u=i.value;return typeof a==typeof u&&a<u}],"filter-id-<":[en,[tn],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[en,[on,tn],(r,[t,i])=>{const a=r.properties()[t.value],u=i.value;return typeof a==typeof u&&a>u}],"filter-id->":[en,[tn],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[en,[on,tn],(r,[t,i])=>{const a=r.properties()[t.value],u=i.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[en,[tn],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[en,[on,tn],(r,[t,i])=>{const a=r.properties()[t.value],u=i.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[en,[tn],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[en,[tn],(r,[t])=>t.value in r.properties()],"filter-has-id":[en,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[en,[Ui(on)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[en,[Ui(tn)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[en,[on,Ui(tn)],(r,[t,i])=>i.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[en,[on,Ui(tn)],(r,[t,i])=>function(a,u,p,g){for(;p<=g;){const v=p+g>>1;if(u[v]===a)return!0;u[v]>a?g=v-1:p=v+1}return!1}(r.properties()[t.value],i.value,0,i.value.length-1)],all:{type:en,overloads:[[[en,en],(r,[t,i])=>t.evaluate(r)&&i.evaluate(r)],[$i(en),(r,t)=>{for(const i of t)if(!i.evaluate(r))return!1;return!0}]]},any:{type:en,overloads:[[[en,en],(r,[t,i])=>t.evaluate(r)||i.evaluate(r)],[$i(en),(r,t)=>{for(const i of t)if(i.evaluate(r))return!0;return!1}]]},"!":[en,[en],(r,[t])=>!t.evaluate(r)],"is-supported-script":[en,[on],(r,[t])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(t.evaluate(r))}],upcase:[on,[on],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[on,[on],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[on,$i(tn),(r,t)=>t.map(i=>jl(i.evaluate(r))).join("")],"resolved-locale":[on,[Li],(r,[t])=>t.evaluate(r).resolvedLocale()]});var Xl=am;function cm(r){return{result:"success",value:r}}function Ys(r){return{result:"error",value:r}}function Va(r){return r["property-type"]==="data-driven"}function ru(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function iu(r){return!!r.expression&&r.expression.interpolated}function cn(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Kl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function um(r){return r}function ou(r,t){const i=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",u=a||!(a||r.property!==void 0),p=r.type||(iu(t)?"exponential":"interval");if(i&&((r=Ko({},r)).stops&&(r.stops=r.stops.map(E=>[E[0],ir.parse(E[1])])),r.default=ir.parse(r.default?r.default:t.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!md[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let g,v,w;if(p==="exponential")g=rs;else if(p==="interval")g=su;else if(p==="categorical"){g=hm,v=Object.create(null);for(const E of r.stops)v[E[0]]=E[1];w=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=dm}if(a){const E={},C=[];for(let D=0;D<r.stops.length;D++){const L=r.stops[D],F=L[0].zoom;E[F]===void 0&&(E[F]={zoom:F,type:r.type,property:r.property,default:r.default,stops:[]},C.push(F)),E[F].stops.push([L[0].value,L[1]])}const I=[];for(const D of C)I.push([E[D].zoom,ou(E[D],t)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Io.interpolationFactor.bind(void 0,k),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},L)=>rs({stops:I,base:r.base},t,D).evaluate(D,L)}}if(u){const E=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Io.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(C=>C[0]),evaluate:({zoom:C})=>g(r,t,C,v,w)}}return{kind:"source",evaluate(E,C){const I=C&&C.properties?C.properties[r.property]:void 0;return I===void 0?$a(r.default,t.default):g(r,t,I,v,w)}}}function $a(r,t,i){return r!==void 0?r:t!==void 0?t:i!==void 0?i:void 0}function hm(r,t,i,a,u){return $a(typeof i===u?a[i]:void 0,r.default,t.default)}function su(r,t,i){if(cn(i)!=="number")return $a(r.default,t.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const u=Hc(r.stops.map(p=>p[0]),i);return r.stops[u][1]}function rs(r,t,i){const a=r.base!==void 0?r.base:1;if(cn(i)!=="number")return $a(r.default,t.default);const u=r.stops.length;if(u===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[u-1][0])return r.stops[u-1][1];const p=Hc(r.stops.map(C=>C[0]),i),g=function(C,I,k,D){const L=D-k,F=C-k;return L===0?0:I===1?F/L:(Math.pow(I,F)-1)/(Math.pow(I,L)-1)}(i,a,r.stops[p][0],r.stops[p+1][0]),v=r.stops[p][1],w=r.stops[p+1][1];let E=Gl[t.type]||um;if(r.colorSpace&&r.colorSpace!=="rgb"){const C=md[r.colorSpace];E=(I,k)=>C.reverse(C.interpolate(C.forward(I),C.forward(k),g))}return typeof v.evaluate=="function"?{evaluate(...C){const I=v.evaluate.apply(void 0,C),k=w.evaluate.apply(void 0,C);if(I!==void 0&&k!==void 0)return E(I,k,g)}}:E(v,w,g)}function dm(r,t,i){return t.type==="color"?i=ir.parse(i):t.type==="formatted"?i=_i.fromString(i.toString()):t.type==="resolvedImage"?i=Vi.fromString(i.toString()):cn(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),$a(i,r.default,t.default)}class au{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new td,this._defaultValue=i?function(a){return a.type==="color"&&(Kl(a.default)||Array.isArray(a.default))?new ir(0,0,0,0):a.type==="color"?ir.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,u,p,g,v,w){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,u,p,g,v,w){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Ga(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Xl}function qa(r,t){const i=new ad(Xl,[],t?function(u){const p={color:Di,string:on,number:_t,enum:on,boolean:en,formatted:Dl,resolvedImage:Ws};return u.type==="array"?Ui(p[u.value]||tn,u.length):p[u.type]}(t):void 0),a=i.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?cm(new au(a,t)):Ys(i.errors)}class bd{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!ts(i.expression)}evaluateWithoutErrorHandling(t,i,a,u,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,u,p,g)}evaluate(t,i,a,u,p,g){return this._styleExpression.evaluate(t,i,a,u,p,g)}}class Yl{constructor(t,i,a,u){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!ts(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,i,a,u,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,u,p,g)}evaluate(t,i,a,u,p,g){return this._styleExpression.evaluate(t,i,a,u,p,g)}interpolationFactor(t,i,a){return this.interpolationType?Io.interpolationFactor(this.interpolationType,t,i,a):0}}function Jl(r,t){if((r=qa(r,t)).result==="error")return r;const i=r.value.expression,a=Fa(i);if(!a&&!Va(t))return Ys([new Ao("","data expressions not supported")]);const u=Xs(i,["zoom","pitch","distance-from-center"]);if(!u&&!ru(t))return Ys([new Ao("","zoom expressions not supported")]);const p=cu(i);return p||u?p instanceof Ao?Ys([p]):p instanceof Io&&!iu(t)?Ys([new Ao("",'"interpolate" expressions cannot be used with this property')]):cm(p?new Yl(a?"camera":"composite",r.value,p.labels,p instanceof Io?p.interpolation:void 0):new bd(a?"constant":"source",r.value)):Ys([new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lu{constructor(t,i){this._parameters=t,this._specification=i,Ko(this,ou(this._parameters,this._specification))}static deserialize(t){return new lu(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function cu(r){let t=null;if(r instanceof tm)t=cu(r.result);else if(r instanceof _d){for(const i of r.args)if(t=cu(i),t)break}else(r instanceof cd||r instanceof Io)&&r.input instanceof Qo&&r.input.name==="zoom"&&(t=r);return t instanceof Ao||r.eachChild(i=>{const a=cu(i);a instanceof Ao?t=a:!t&&a?t=new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Ao("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class yt{constructor(t,i,a,u){this.message=(t?`${t}: `:"")+a,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function oo(r){const t=r.key,i=r.value,a=r.valueSpec||{},u=r.objectElementValidators||{},p=r.style,g=r.styleSpec;let v=[];const w=cn(i);if(w!=="object")return[new yt(t,i,`object expected, ${w} found`)];for(const E in i){const C=E.split(".")[0];let I;u[C]?I=u[C]:a[C]?I=ei:u["*"]?I=u["*"]:a["*"]&&(I=ei),I?v=v.concat(I({key:(t&&`${t}.`)+E,value:i[E],valueSpec:a[C]||a["*"],style:p,styleSpec:g,object:i,objectKey:E},i)):v.push(new yt(t,i[E],`unknown property "${E}"`))}for(const E in a)u[E]||a[E].required&&a[E].default===void 0&&i[E]===void 0&&v.push(new yt(t,i,`missing required property "${E}"`));return v}function pm(r){const t=r.value,i=r.valueSpec,a=r.style,u=r.styleSpec,p=r.key,g=r.arrayElementValidator||ei;if(cn(t)!=="array")return[new yt(p,t,`array expected, ${cn(t)} found`)];if(i.length&&t.length!==i.length)return[new yt(p,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new yt(p,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let v={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(v.function=i.function),cn(i.value)==="object"&&(v=i.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(g({array:t,arrayIndex:E,value:t[E],valueSpec:v,style:a,styleSpec:u,key:`${p}[${E}]`}));return w}function Ql(r){const t=r.key,i=r.value,a=r.valueSpec;let u=cn(i);if(u==="number"&&i!=i&&(u="NaN"),u!=="number")return[new yt(t,i,`number expected, ${u} found`)];if("minimum"in a){let p=a.minimum;if(cn(a.minimum)==="array"&&(p=a.minimum[r.arrayIndex]),i<p)return[new yt(t,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in a){let p=a.maximum;if(cn(a.maximum)==="array"&&(p=a.maximum[r.arrayIndex]),i>p)return[new yt(t,i,`${i} is greater than the maximum value ${p}`)]}return[]}function ec(r){const t=r.valueSpec,i=hr(r.value.type);let a,u,p,g={};const v=i!=="categorical"&&r.value.property===void 0,w=!v,E=cn(r.value.stops)==="array"&&cn(r.value.stops[0])==="array"&&cn(r.value.stops[0][0])==="object",C=oo({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(D){if(i==="identity")return[new yt(D.key,D.value,'identity function may not have a "stops" property')];let L=[];const F=D.value;return L=L.concat(pm({key:D.key,value:F,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:I})),cn(F)==="array"&&F.length===0&&L.push(new yt(D.key,F,"array must have at least one stop")),L},default:function(D){return ei({key:D.key,value:D.value,valueSpec:t,style:D.style,styleSpec:D.styleSpec})}}});return i==="identity"&&v&&C.push(new yt(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||C.push(new yt(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!iu(r.valueSpec)&&C.push(new yt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(w&&!Va(r.valueSpec)?C.push(new yt(r.key,r.value,"property functions not supported")):v&&!ru(r.valueSpec)&&C.push(new yt(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!E||r.value.property!==void 0||C.push(new yt(r.key,r.value,'"property" property is required')),C;function I(D){let L=[];const F=D.value,q=D.key;if(cn(F)!=="array")return[new yt(q,F,`array expected, ${cn(F)} found`)];if(F.length!==2)return[new yt(q,F,`array length 2 expected, length ${F.length} found`)];if(E){if(cn(F[0])!=="object")return[new yt(q,F,`object expected, ${cn(F[0])} found`)];if(F[0].zoom===void 0)return[new yt(q,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new yt(q,F,"object stop key must have value")];const re=hr(F[0].zoom);if(typeof re!="number")return[new yt(q,F[0].zoom,"stop zoom values must be numbers")];if(p&&p>re)return[new yt(q,F[0].zoom,"stop zoom values must appear in ascending order")];re!==p&&(p=re,u=void 0,g={}),L=L.concat(oo({key:`${q}[0]`,value:F[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:Ql,value:k}}))}else L=L.concat(k({key:`${q}[0]`,value:F[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},F));return Ga(Or(F[1]))?L.concat([new yt(`${q}[1]`,F[1],"expressions are not allowed in function stops.")]):L.concat(ei({key:`${q}[1]`,value:F[1],valueSpec:t,style:D.style,styleSpec:D.styleSpec}))}function k(D,L){const F=cn(D.value),q=hr(D.value),re=D.value!==null?D.value:L;if(a){if(F!==a)return[new yt(D.key,re,`${F} stop domain type must match previous stop domain type ${a}`)]}else a=F;if(F!=="number"&&F!=="string"&&F!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new yt(D.key,re,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&i!=="categorical"){let de=`number expected, ${F} found`;return Va(t)&&i===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(D.key,re,de)]}return i!=="categorical"||F!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?i!=="categorical"&&F==="number"&&typeof q=="number"&&typeof u=="number"&&u!==void 0&&q<u?[new yt(D.key,re,"stop domain values must appear in ascending order")]:(u=q,i==="categorical"&&q in g?[new yt(D.key,re,"stop domain values must be unique")]:(g[q]=!0,[])):[new yt(D.key,re,`integer expected, found ${String(q)}`)]}}function Br(r){const t=(r.expressionContext==="property"?Jl:qa)(Or(r.value),r.valueSpec);if(t.result==="error")return t.value.map(a=>new yt(`${r.key}${a.key}`,r.value,a.message));const i=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new yt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!ts(i))return[new yt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return tc(i,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Xs(i,["zoom","feature-state"]))return[new yt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Fa(i))return[new yt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tc(r,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const u of t.valueSpec.expression.parameters)i.delete(u);if(i.size===0)return[];const a=[];return r instanceof Qo&&i.has(r.name)?[new yt(t.key,t.value,`["${r.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(r.eachChild(u=>{a.push(...tc(u,t))}),a)}function uu(r){const t=r.key,i=r.value,a=r.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(hr(i))===-1&&u.push(new yt(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(hr(i))===-1&&u.push(new yt(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function Ed(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Ed(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function hu(r,t="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ed(r)||(r=Za(r));const i=r;let a=!0;try{a=function(E){if(!Wa(E))return E;let C=Or(E);return du(C),C=fm(C),C}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const u=je[`filter_${t}`],p=qa(a,u);let g=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,C,I)=>p.value.evaluate(E,C,{},I);let v=null,w=null;if(a!==i){const E=qa(i,u);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));v=(C,I,k,D,L)=>E.value.evaluate(C,I,{},k,void 0,void 0,D,L),w=!Fa(E.value.expression)}return{filter:g,dynamicFilter:v||void 0,needGeometry:mm(a),needFeature:!!w}}function fm(r){if(!Array.isArray(r))return r;const t=function(i){if(Td.has(i[0])){for(let a=1;a<i.length;a++)if(Wa(i[a]))return!0}return i}(r);return t===!0?t:t.map(i=>fm(i))}function du(r){let t=!1;const i=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)t=t||Wa(r[a]),i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="match"){t=t||Wa(r[1]);for(let a=2;a<r.length-1;a+=2)i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="step"){t=t||Wa(r[1]);for(let a=1;a<r.length-1;a+=2)i.push(r[a+1])}t&&(r.length=0,r.push("any",...i));for(let a=1;a<r.length;a++)du(r[a])}function Wa(r){if(!Array.isArray(r))return!1;if((t=r[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<r.length;i++)if(Wa(r[i]))return!0;return!1}const Td=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gy(r,t){return r<t?-1:r>t?1:0}function mm(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let t=1;t<r.length;t++)if(mm(r[t]))return!0;return!1}function Za(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Sd(r[1],r[2],"=="):t==="!="?pu(Sd(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Sd(r[1],r[2],t):t==="any"?(i=r.slice(1),["any"].concat(i.map(Za))):t==="all"?["all"].concat(r.slice(1).map(Za)):t==="none"?["all"].concat(r.slice(1).map(Za).map(pu)):t==="in"?Cd(r[1],r.slice(2)):t==="!in"?pu(Cd(r[1],r.slice(2))):t==="has"?Ad(r[1]):t==="!has"?pu(Ad(r[1])):t!=="within"||r;var i}function Sd(r,t,i){switch(r){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,r,t]}}function Cd(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Gy)]]:["filter-in-small",r,["literal",t]]}}function Ad(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function pu(r){return["!",r]}function nc(r){return Ed(Or(r.value))?Br(Ko({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):rc(r)}function rc(r){const t=r.value,i=r.key;if(cn(t)!=="array")return[new yt(i,t,`array expected, ${cn(t)} found`)];const a=r.styleSpec;let u,p=[];if(t.length<1)return[new yt(i,t,"filter array must have at least 1 element")];switch(p=p.concat(uu({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),hr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&hr(t[1])==="$type"&&p.push(new yt(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new yt(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=cn(t[1]),u!=="string"&&p.push(new yt(`${i}[1]`,t[1],`string expected, ${u} found`)));for(let g=2;g<t.length;g++)u=cn(t[g]),hr(t[1])==="$type"?p=p.concat(uu({key:`${i}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new yt(`${i}[${g}]`,t[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)p=p.concat(rc({key:`${i}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=cn(t[1]),t.length!==2?p.push(new yt(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new yt(`${i}[1]`,t[1],`string expected, ${u} found`));break;case"within":u=cn(t[1]),t.length!==2?p.push(new yt(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="object"&&p.push(new yt(`${i}[1]`,t[1],`object expected, ${u} found`))}return p}function Md(r,t){const i=r.key,a=r.style,u=r.styleSpec,p=r.value,g=r.objectKey,v=u[`${t}_${r.layerType}`];if(!v)return[];const w=g.match(/^(.*)-transition$/);if(t==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return ei({key:i,value:p,valueSpec:u.transition,style:a,styleSpec:u});const E=r.valueSpec||v[g];if(!E)return[new yt(i,p,`unknown property "${g}"`)];let C;if(cn(p)==="string"&&Va(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(p))){const k=`\`{ "type": "identity", "property": ${C?JSON.stringify(C[1]):'"_"'} }\``;return[new yt(i,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: ${k}.`)]}const I=[];return r.layerType==="symbol"&&(g==="text-field"&&a&&!a.glyphs&&I.push(new yt(i,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&Kl(Or(p))&&hr(p.type)==="identity"&&I.push(new yt(i,p,'"text-font" does not support identity functions'))),I.concat(ei({key:r.key,value:p,valueSpec:E,style:a,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:g}))}function gm(r){return Md(r,"paint")}function Id(r){return Md(r,"layout")}function _m(r){let t=[];const i=r.value,a=r.key,u=r.style,p=r.styleSpec;i.type||i.ref||t.push(new yt(a,i,'either "type" or "ref" is required'));let g=hr(i.type);const v=hr(i.ref);if(i.id){const w=hr(i.id);for(let E=0;E<r.arrayIndex;E++){const C=u.layers[E];hr(C.id)===w&&t.push(new yt(a,i.id,`duplicate layer id "${i.id}", previously used at line ${C.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&t.push(new yt(a,i[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{hr(E.id)===v&&(w=E)}),w?w.ref?t.push(new yt(a,i.ref,"ref cannot reference another ref layer")):g=hr(w.type):typeof v=="string"&&t.push(new yt(a,i.ref,`ref layer "${v}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const w=u.sources&&u.sources[i.source],E=w&&hr(w.type);w?E==="vector"&&g==="raster"?t.push(new yt(a,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&g!=="raster"?t.push(new yt(a,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&g!=="hillshade"?t.push(new yt(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||t.push(new yt(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new yt(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new yt(a,i.source,`source "${i.source}" not found`))}else t.push(new yt(a,i,'missing required property "source"'));return t=t.concat(oo({key:a,value:i,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ei({key:`${a}.type`,value:i.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,object:i,objectKey:"type"}),filter:w=>nc(Ko({layerType:g},w)),layout:w=>oo({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Id(Ko({layerType:g},E))}}),paint:w=>oo({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>gm(Ko({layerType:g},E))}})}})),t}function Es(r){const t=r.value,i=r.key,a=cn(t);return a!=="string"?[new yt(i,t,`string expected, ${a} found`)]:[]}const ym={promoteId:function({key:r,value:t}){if(cn(t)==="string")return Es({key:r,value:t});{const i=[];for(const a in t)i.push(...Es({key:`${r}.${a}`,value:t[a]}));return i}}};function vm(r){const t=r.value,i=r.key,a=r.styleSpec,u=r.style;if(!t.type)return[new yt(i,t,'"type" is required')];const p=hr(t.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=oo({key:i,value:t,valueSpec:a[`source_${p.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:ym}),g;case"geojson":if(g=oo({key:i,value:t,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:ym}),t.cluster)for(const v in t.clusterProperties){const[w,E]=t.clusterProperties[v],C=typeof w=="string"?[w,["accumulated"],["get",v]]:w;g.push(...Br({key:`${i}.${v}.map`,value:E,expressionContext:"cluster-map"})),g.push(...Br({key:`${i}.${v}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return g;case"video":return oo({key:i,value:t,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return oo({key:i,value:t,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new yt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uu({key:`${i}.type`,value:t.type,valueSpec:{values:qy(a)},style:u,styleSpec:a})}}function qy(r){return r.source.reduce((t,i)=>{const a=r[i];return a.type.type==="enum"&&(t=t.concat(Object.keys(a.type.values))),t},[])}function xm(r){const t=r.value,i=r.styleSpec,a=i.light,u=r.style;let p=[];const g=cn(t);if(t===void 0)return p;if(g!=="object")return p=p.concat([new yt("light",t,`object expected, ${g} found`)]),p;for(const v in t){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&a[w[1]]&&a[w[1]].transition?ei({key:v,value:t[v],valueSpec:i.transition,style:u,styleSpec:i}):a[v]?ei({key:v,value:t[v],valueSpec:a[v],style:u,styleSpec:i}):[new yt(v,t[v],`unknown property "${v}"`)])}return p}function kd(r){const t=r.value,i=r.key,a=r.style,u=r.styleSpec,p=u.terrain;let g=[];const v=cn(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new yt("terrain",t,`object expected, ${v} found`)]),g;for(const w in t){const E=w.match(/^(.*)-transition$/);g=g.concat(E&&p[E[1]]&&p[E[1]].transition?ei({key:w,value:t[w],valueSpec:u.transition,style:a,styleSpec:u}):p[w]?ei({key:w,value:t[w],valueSpec:p[w],style:a,styleSpec:u}):[new yt(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=a.sources&&a.sources[t.source],E=w&&hr(w.type);w?E!=="raster-dem"&&g.push(new yt(i,t.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):g.push(new yt(i,t.source,`source "${t.source}" not found`))}else g.push(new yt(i,t,'terrain is missing required property "source"'));return g}function wm(r){const t=r.value,i=r.style,a=r.styleSpec,u=a.fog;let p=[];const g=cn(t);if(t===void 0)return p;if(g!=="object")return p=p.concat([new yt("fog",t,`object expected, ${g} found`)]),p;for(const v in t){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&u[w[1]]&&u[w[1]].transition?ei({key:v,value:t[v],valueSpec:a.transition,style:i,styleSpec:a}):u[v]?ei({key:v,value:t[v],valueSpec:u[v],style:i,styleSpec:a}):[new yt(v,t[v],`unknown property "${v}"`)])}return p}const bm={"*":()=>[],array:pm,boolean:function(r){const t=r.value,i=r.key,a=cn(t);return a!=="boolean"?[new yt(i,t,`boolean expected, ${a} found`)]:[]},number:Ql,color:function(r){const t=r.key,i=r.value,a=cn(i);return a!=="string"?[new yt(t,i,`color expected, ${a} found`)]:Hh(i)===null?[new yt(t,i,`color expected, "${i}" found`)]:[]},enum:uu,filter:nc,function:ec,layer:_m,object:oo,source:vm,light:xm,terrain:kd,fog:wm,string:Es,formatted:function(r){return Es(r).length===0?[]:Br(r)},resolvedImage:function(r){return Es(r).length===0?[]:Br(r)},projection:function(r){const t=r.value,i=r.styleSpec,a=i.projection,u=r.style;let p=[];const g=cn(t);if(g==="object")for(const v in t)p=p.concat(ei({key:v,value:t[v],valueSpec:a[v],style:u,styleSpec:i}));else g!=="string"&&(p=p.concat([new yt("projection",t,`object or string expected, ${g} found`)]));return p}};function ei(r){const t=r.value,i=r.valueSpec,a=r.styleSpec;return i.expression&&Kl(hr(t))?ec(r):i.expression&&Ga(Or(t))?Br(r):i.type&&bm[i.type]?bm[i.type](r):oo(Ko({},r,{valueSpec:i.type?a[i.type]:i}))}function Wy(r){const t=r.value,i=r.key,a=Es(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new yt(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new yt(i,t,'"glyphs" url must include a "{range}" token'))),a}function Em(r,t=je){return Gi(ei({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,objectElementValidators:{glyphs:Wy,"*":()=>[]}}))}const Zy=r=>Gi(gm(r)),Hy=r=>Gi(Id(r));function Gi(r){return r.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function Tm(r,t){let i=!1;if(t&&t.length)for(const a of t)r.fire(new Xo(new Error(a.message))),i=!0;return i}var Xy=ko,so=3;function ko(r,t,i){var a=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var u=new Int32Array(this.arrayBuffer);r=u[0],this.d=(t=u[1])+2*(i=u[2]);for(var p=0;p<this.d*this.d;p++){var g=u[so+p],v=u[so+p+1];a.push(g===v?null:u.subarray(g,v))}var w=u[so+a.length+1];this.keys=u.subarray(u[so+a.length],w),this.bboxes=u.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var E=0;E<this.d*this.d;E++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=r,this.padding=i,this.scale=t/r,this.uid=0;var C=i/t*r;this.min=-C,this.max=r+C}ko.prototype.insert=function(r,t,i,a,u){this._forEachCell(t,i,a,u,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(r,t,i,a,u,p){this.cells[u].push(p)},ko.prototype.query=function(r,t,i,a,u){var p=this.min,g=this.max;if(r<=p&&t<=p&&g<=i&&g<=a&&!u)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(r,t,i,a,this._queryCell,v,{},u),v},ko.prototype._queryCell=function(r,t,i,a,u,p,g,v){var w=this.cells[u];if(w!==null)for(var E=this.keys,C=this.bboxes,I=0;I<w.length;I++){var k=w[I];if(g[k]===void 0){var D=4*k;(v?v(C[D+0],C[D+1],C[D+2],C[D+3]):r<=C[D+2]&&t<=C[D+3]&&i>=C[D+0]&&a>=C[D+1])?(g[k]=!0,p.push(E[k])):g[k]=!1}}},ko.prototype._forEachCell=function(r,t,i,a,u,p,g,v){for(var w=this._convertToCellCoord(r),E=this._convertToCellCoord(t),C=this._convertToCellCoord(i),I=this._convertToCellCoord(a),k=w;k<=C;k++)for(var D=E;D<=I;D++){var L=this.d*D+k;if((!v||v(this._convertFromCellCoord(k),this._convertFromCellCoord(D),this._convertFromCellCoord(k+1),this._convertFromCellCoord(D+1)))&&u.call(this,r,t,i,a,L,p,g,v))return}},ko.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,t=so+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var u=new Int32Array(t+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=t,g=0;g<r.length;g++){var v=r[g];u[so+g]=p,u.set(v,p),p+=v.length}return u[so+r.length]=p,u.set(this.keys,p),u[so+r.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};var Js=ce(Xy);const fu={};function vt(r,t,i={}){Object.defineProperty(r,"_classRegistryKey",{value:t,writeable:!1}),fu[t]={klass:r,omit:i.omit||[]}}vt(Object,"Object"),Js.serialize=function(r,t){const i=r.toArrayBuffer();return t&&t.push(i),{buffer:i}},Js.deserialize=function(r){return new Js(r.buffer)},Object.defineProperty(Js,"name",{value:"Grid"}),vt(Js,"Grid"),vt(ir,"Color"),vt(Error,"Error"),vt(Fe,"AJAXError"),vt(Vi,"ResolvedImage"),vt(lu,"StylePropertyFunction"),vt(au,"StyleExpression",{omit:["_evaluator"]}),vt(Yl,"ZoomDependentExpression"),vt(bd,"ZoomConstantExpression"),vt(Qo,"CompoundExpression",{omit:["_evaluate"]});for(const r in Xl)fu[Xl[r]._classRegistryKey]||vt(Xl[r],`Expression${r}`);function Pd(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function zd(r){return A.ImageBitmap&&r instanceof A.ImageBitmap}function Ha(r,t){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Pd(r)||zd(r))return t&&t.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return t&&t.push(i.buffer),i}if(r instanceof A.ImageData)return t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(Ha(a,t));return i}if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=i.serialize?i.serialize(r,t):{};if(!i.serialize){for(const p in r)r.hasOwnProperty(p)&&(fu[a].omit.indexOf(p)>=0||(u[p]=Ha(r[p],t)));r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof r)}function Qs(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Pd(r)||zd(r)||ArrayBuffer.isView(r)||r instanceof A.ImageData)return r;if(Array.isArray(r))return r.map(Qs);if(typeof r=="object"){const t=r.$name||"Object",{klass:i}=fu[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const u of Object.keys(r))u!=="$name"&&(a[u]=Qs(r[u]));return a}throw new Error("can't deserialize object of type "+typeof r)}const gt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Rd(r){for(const t of r)if(Dd(t.charCodeAt(0)))return!0;return!1}function Ky(r){for(const t of r)if(!Sm(t.charCodeAt(0)))return!1;return!0}function Sm(r){return!(gt.Arabic(r)||gt["Arabic Supplement"](r)||gt["Arabic Extended-A"](r)||gt["Arabic Presentation Forms-A"](r)||gt["Arabic Presentation Forms-B"](r))}function Dd(r){return!(r!==746&&r!==747&&(r<4352||!(gt["Bopomofo Extended"](r)||gt.Bopomofo(r)||gt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||gt["CJK Compatibility Ideographs"](r)||gt["CJK Compatibility"](r)||gt["CJK Radicals Supplement"](r)||gt["CJK Strokes"](r)||!(!gt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||gt["CJK Unified Ideographs Extension A"](r)||gt["CJK Unified Ideographs"](r)||gt["Enclosed CJK Letters and Months"](r)||gt["Hangul Compatibility Jamo"](r)||gt["Hangul Jamo Extended-A"](r)||gt["Hangul Jamo Extended-B"](r)||gt["Hangul Jamo"](r)||gt["Hangul Syllables"](r)||gt.Hiragana(r)||gt["Ideographic Description Characters"](r)||gt.Kanbun(r)||gt["Kangxi Radicals"](r)||gt["Katakana Phonetic Extensions"](r)||gt.Katakana(r)&&r!==12540||!(!gt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!gt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||gt["Unified Canadian Aboriginal Syllabics"](r)||gt["Unified Canadian Aboriginal Syllabics Extended"](r)||gt["Vertical Forms"](r)||gt["Yijing Hexagram Symbols"](r)||gt["Yi Syllables"](r)||gt["Yi Radicals"](r))))}function Cm(r){return!(Dd(r)||function(t){return!!(gt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||gt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||gt["Letterlike Symbols"](t)||gt["Number Forms"](t)||gt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||gt["Control Pictures"](t)&&t!==9251||gt["Optical Character Recognition"](t)||gt["Enclosed Alphanumerics"](t)||gt["Geometric Shapes"](t)||gt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||gt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||gt["CJK Symbols and Punctuation"](t)||gt.Katakana(t)||gt["Private Use Area"](t)||gt["CJK Compatibility Forms"](t)||gt["Small Form Variants"](t)||gt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}function Am(r){return r>=1424&&r<=2303||gt["Arabic Presentation Forms-A"](r)||gt["Arabic Presentation Forms-B"](r)}function Yy(r,t){return!(!t&&Am(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||gt.Khmer(r))}function Jy(r){for(const t of r)if(Am(t.charCodeAt(0)))return!0;return!1}const Ld="deferred",Od="loading",Bd="loaded";let Xa=null,d="unavailable",o=null;const c=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(d="error"),Xa&&Xa(r)};function f(){_.fire(new qs("pluginStateChange",{pluginStatus:d,pluginURL:o}))}const _=new Rl,x=function(){return d},T=function(){if(d!==Ld||!o)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=Od,f(),o&&Et({url:o},r=>{r?c(r):(d=Bd,f())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===Bd||S.applyArabicShaping!=null,isLoading:()=>d===Od,setState(r){d=r.pluginStatus,o=r.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>o};class M{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(i,a){for(const u of i)if(!Yy(u.charCodeAt(0),a))return!1;return!0}(t,S.isLoaded())}}class z{constructor(t,i){this.property=t,this.value=i,this.expression=function(a,u){if(Kl(a))return new lu(a,u);if(Ga(a)){const p=Jl(a,u);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=a;return typeof a=="string"&&u.type==="color"&&(p=ir.parse(a)),{kind:"constant",evaluate:()=>p}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class P{constructor(t){this.property=t,this.value=new z(t,void 0)}transitioned(t,i){return new G(this.property,this.value,i,En({},t.transition,this.transition),t.now)}untransitioned(){return new G(this.property,this.value,null,{},0)}}class O{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Gr(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new P(this._values[t].property)),this._values[t].value=new z(this._values[t].property,i===null?void 0:Gr(i))}getTransition(t){return Gr(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new P(this._values[t].property)),this._values[t].transition=Gr(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const u=this.getTransition(i);u!==void 0&&(t[`${i}-transition`]=u)}return t}transitioned(t,i){const a=new Z(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(t,i._values[u]);return a}untransitioned(){const t=new Z(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class G{constructor(t,i,a,u,p){const g=u.delay||0,v=u.duration||0;p=p||0,this.property=t,this.value=i,this.begin=p+g,this.end=this.begin+v,t.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const u=t.now||0,p=this.value.possiblyEvaluate(t,i,a),g=this.prior;if(g){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return g.possiblyEvaluate(t,i,a);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,a),p,Bt(v))}}return p}}class Z{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const u=new te(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,i,a);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class J{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Gr(this._values[t].value)}setValue(t,i){this._values[t]=new z(this._values[t].property,i===null?void 0:Gr(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const u=new te(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,i,a);return u}}class X{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,u){return this.property.evaluate(this.value,this.parameters,t,i,a,u)}}class te{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class B{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,a){const u=Gl[this.specification.type];return u?u(t,i,a):t}}class W{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,u){return new X(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,u)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new X(this,{kind:"constant",value:void 0},t.parameters);const u=Gl[this.specification.type];return u?new X(this,{kind:"constant",value:u(t.value.value,i.value.value,a)},t.parameters):t}evaluate(t,i,a,u,p,g){return t.kind==="constant"?t.value:t.evaluate(i,a,u,p,g)}}class ae{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,u){return!!t.expression.evaluate(i,null,{},a,u)}interpolate(){return!1}}class le{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new M(0,{});for(const a in t){const u=t[a];u.specification.overridable&&this.overridableProperties.push(a);const p=this.defaultPropertyValues[a]=new z(u,void 0),g=this.defaultTransitionablePropertyValues[a]=new P(u);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate(i)}}}function _e(r,t){return 256*(r=qe(Math.floor(r),0,255))+qe(Math.floor(t),0,255)}vt(W,"DataDrivenProperty"),vt(B,"DataConstantProperty"),vt(ae,"ColorRampProperty");const xe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ve{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Se{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ee(r,t=1){let i=0,a=0;return{members:r.map(u=>{const p=xe[u.type].BYTES_PER_ELEMENT,g=i=Pe(i,Math.max(t,p)),v=u.components||1;return a=Math.max(a,p),i+=p*v,{name:u.name,type:u.type,components:v,offset:g}}),size:Pe(i,Math.max(a,t)),alignment:t}}function Pe(r,t){return Math.ceil(r/t)*t}class nt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const u=2*t;return this.int16[u+0]=i,this.int16[u+1]=a,t}}nt.prototype.bytesPerElement=4,vt(nt,"StructArrayLayout2i4");class Ae extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,i,a)}emplace(t,i,a,u){const p=3*t;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=u,t}}Ae.prototype.bytesPerElement=6,vt(Ae,"StructArrayLayout3i6");class Ge extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,a,u)}emplace(t,i,a,u,p){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=u,this.int16[g+3]=p,t}}Ge.prototype.bytesPerElement=8,vt(Ge,"StructArrayLayout4i8");class Le extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,a,u,p,g,v)}emplace(t,i,a,u,p,g,v,w){const E=6*t,C=12*t,I=3*t;return this.int16[E+0]=i,this.int16[E+1]=a,this.uint8[C+4]=u,this.uint8[C+5]=p,this.uint8[C+6]=g,this.uint8[C+7]=v,this.float32[I+2]=w,t}}Le.prototype.bytesPerElement=12,vt(Le,"StructArrayLayout2i4ub1f12");class Qe extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,a,u)}emplace(t,i,a,u,p){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=u,this.float32[g+3]=p,t}}Qe.prototype.bytesPerElement=16,vt(Qe,"StructArrayLayout4f16");class ke extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,u,p)}emplace(t,i,a,u,p,g){const v=6*t,w=3*t;return this.uint16[v+0]=i,this.uint16[v+1]=a,this.uint16[v+2]=u,this.uint16[v+3]=p,this.float32[w+2]=g,t}}ke.prototype.bytesPerElement=12,vt(ke,"StructArrayLayout4ui1f12");class $e extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,a,u)}emplace(t,i,a,u,p){const g=4*t;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=u,this.uint16[g+3]=p,t}}$e.prototype.bytesPerElement=8,vt($e,"StructArrayLayout4ui8");class it extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,u,p,g)}emplace(t,i,a,u,p,g,v){const w=6*t;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+3]=p,this.int16[w+4]=g,this.int16[w+5]=v,t}}it.prototype.bytesPerElement=12,vt(it,"StructArrayLayout6i12");class Xe extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g,v,w,E,C,I,k){const D=this.length;return this.resize(D+1),this.emplace(D,t,i,a,u,p,g,v,w,E,C,I,k)}emplace(t,i,a,u,p,g,v,w,E,C,I,k,D){const L=12*t;return this.int16[L+0]=i,this.int16[L+1]=a,this.int16[L+2]=u,this.int16[L+3]=p,this.uint16[L+4]=g,this.uint16[L+5]=v,this.uint16[L+6]=w,this.uint16[L+7]=E,this.int16[L+8]=C,this.int16[L+9]=I,this.int16[L+10]=k,this.int16[L+11]=D,t}}Xe.prototype.bytesPerElement=24,vt(Xe,"StructArrayLayout4i4ui4i24");class ot extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,u,p,g)}emplace(t,i,a,u,p,g,v){const w=10*t,E=5*t;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=u,this.float32[E+2]=p,this.float32[E+3]=g,this.float32[E+4]=v,t}}ot.prototype.bytesPerElement=20,vt(ot,"StructArrayLayout3i3f20");class Ct extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Ct.prototype.bytesPerElement=4,vt(Ct,"StructArrayLayout1ul4");class Ot extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g,v,w,E,C,I,k,D){const L=this.length;return this.resize(L+1),this.emplace(L,t,i,a,u,p,g,v,w,E,C,I,k,D)}emplace(t,i,a,u,p,g,v,w,E,C,I,k,D,L){const F=20*t,q=10*t;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=p,this.int16[F+4]=g,this.float32[q+3]=v,this.float32[q+4]=w,this.float32[q+5]=E,this.float32[q+6]=C,this.int16[F+14]=I,this.uint32[q+8]=k,this.uint16[F+18]=D,this.uint16[F+19]=L,t}}Ot.prototype.bytesPerElement=40,vt(Ot,"StructArrayLayout5i4f1i1ul2ui40");class xt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,a,u,p,g,v)}emplace(t,i,a,u,p,g,v,w){const E=8*t;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=u,this.int16[E+4]=p,this.int16[E+5]=g,this.int16[E+6]=v,this.int16[E+7]=w,t}}xt.prototype.bytesPerElement=16,vt(xt,"StructArrayLayout3i2i2i16");class kt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,u,p)}emplace(t,i,a,u,p,g){const v=4*t,w=8*t;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=u,this.int16[w+6]=p,this.int16[w+7]=g,t}}kt.prototype.bytesPerElement=16,vt(kt,"StructArrayLayout2f1f2i16");class nn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,a,u)}emplace(t,i,a,u,p){const g=12*t,v=3*t;return this.uint8[g+0]=i,this.uint8[g+1]=a,this.float32[v+1]=u,this.float32[v+2]=p,t}}nn.prototype.bytesPerElement=12,vt(nn,"StructArrayLayout2ub2f12");class Jt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,i,a)}emplace(t,i,a,u){const p=3*t;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=u,t}}Jt.prototype.bytesPerElement=12,vt(Jt,"StructArrayLayout3f12");class Tt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,i,a)}emplace(t,i,a,u){const p=3*t;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=u,t}}Tt.prototype.bytesPerElement=6,vt(Tt,"StructArrayLayout3ui6");class _n extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q,re,de,oe,he,me){const fe=this.length;return this.resize(fe+1),this.emplace(fe,t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q,re,de,oe,he,me)}emplace(t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q,re,de,oe,he,me,fe){const Re=30*t,Me=15*t,Ue=60*t;return this.int16[Re+0]=i,this.int16[Re+1]=a,this.int16[Re+2]=u,this.float32[Me+2]=p,this.float32[Me+3]=g,this.uint16[Re+8]=v,this.uint16[Re+9]=w,this.uint32[Me+5]=E,this.uint32[Me+6]=C,this.uint32[Me+7]=I,this.uint16[Re+16]=k,this.uint16[Re+17]=D,this.uint16[Re+18]=L,this.float32[Me+10]=F,this.float32[Me+11]=q,this.uint8[Ue+48]=re,this.uint8[Ue+49]=de,this.uint8[Ue+50]=oe,this.uint32[Me+13]=he,this.int16[Re+28]=me,this.uint8[Ue+58]=fe,t}}_n.prototype.bytesPerElement=60,vt(_n,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Tn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q,re,de,oe,he,me,fe,Re,Me,Ue,rt,Oe,We,Ze,Ke){const st=this.length;return this.resize(st+1),this.emplace(st,t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q,re,de,oe,he,me,fe,Re,Me,Ue,rt,Oe,We,Ze,Ke)}emplace(t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q,re,de,oe,he,me,fe,Re,Me,Ue,rt,Oe,We,Ze,Ke,st){const Ne=38*t,pt=19*t;return this.int16[Ne+0]=i,this.int16[Ne+1]=a,this.int16[Ne+2]=u,this.float32[pt+2]=p,this.float32[pt+3]=g,this.int16[Ne+8]=v,this.int16[Ne+9]=w,this.int16[Ne+10]=E,this.int16[Ne+11]=C,this.int16[Ne+12]=I,this.int16[Ne+13]=k,this.uint16[Ne+14]=D,this.uint16[Ne+15]=L,this.uint16[Ne+16]=F,this.uint16[Ne+17]=q,this.uint16[Ne+18]=re,this.uint16[Ne+19]=de,this.uint16[Ne+20]=oe,this.uint16[Ne+21]=he,this.uint16[Ne+22]=me,this.uint16[Ne+23]=fe,this.uint16[Ne+24]=Re,this.uint16[Ne+25]=Me,this.uint16[Ne+26]=Ue,this.uint16[Ne+27]=rt,this.uint16[Ne+28]=Oe,this.uint32[pt+15]=We,this.float32[pt+16]=Ze,this.float32[pt+17]=Ke,this.float32[pt+18]=st,t}}Tn.prototype.bytesPerElement=76,vt(Tn,"StructArrayLayout3i2f6i15ui1ul3f76");class Sn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Sn.prototype.bytesPerElement=4,vt(Sn,"StructArrayLayout1f4");class Cn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,u,p)}emplace(t,i,a,u,p,g){const v=5*t;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=g,t}}Cn.prototype.bytesPerElement=20,vt(Cn,"StructArrayLayout5f20");class ti extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,a,u)}emplace(t,i,a,u,p){const g=6*t;return this.uint32[3*t+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=u,this.uint16[g+4]=p,t}}ti.prototype.bytesPerElement=12,vt(ti,"StructArrayLayout1ul3ui12");class Fr extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const u=2*t;return this.uint16[u+0]=i,this.uint16[u+1]=a,t}}Fr.prototype.bytesPerElement=4,vt(Fr,"StructArrayLayout2ui4");class qi extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}qi.prototype.bytesPerElement=2,vt(qi,"StructArrayLayout1ui2");class Po extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const u=2*t;return this.float32[u+0]=i,this.float32[u+1]=a,t}}Po.prototype.bytesPerElement=8,vt(Po,"StructArrayLayout2f8");class Xn extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xn.prototype.size=40;class An extends Ot{get(t){return new Xn(this,t)}}vt(An,"CollisionBoxArray");class hn extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}hn.prototype.size=60;class dr extends _n{get(t){return new hn(this,t)}}vt(dr,"PlacedSymbolArray");class li extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}li.prototype.size=76;class qn extends Tn{get(t){return new li(this,t)}}vt(qn,"SymbolInstanceArray");class yi extends Sn{getoffsetX(t){return this.float32[1*t+0]}}vt(yi,"GlyphOffsetArray");class mu extends nt{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}vt(mu,"SymbolLineVertexArray");class ea extends ve{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ea.prototype.size=12;class ic extends ti{get(t){return new ea(this,t)}}vt(ic,"FeatureIndexArray");class is extends Fr{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}vt(is,"FillExtrusionCentroidArray");const Ts=Ee([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ta=Ee([{name:"a_dash",components:4,type:"Uint16"}]);var gu={exports:{}},oc={exports:{}};oc.exports=function(r,t){var i,a,u,p,g,v,w,E;for(a=r.length-(i=3&r.length),u=t,g=3432918353,v=461845907,E=0;E<a;)w=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,u=27492+(65535&(p=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&r.charCodeAt(E+2))<<16;case 2:w^=(255&r.charCodeAt(E+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&r.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return u^=r.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Fd=oc.exports,jw={exports:{}};jw.exports=function(r,t){for(var i,a=r.length,u=t^a,p=0;a>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(p)|(255&r.charCodeAt(++p))<<8|(255&r.charCodeAt(++p))<<16|(255&r.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++p;switch(a){case 3:u^=(255&r.charCodeAt(p+2))<<16;case 2:u^=(255&r.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&r.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Uw=Fd,OI=jw.exports;gu.exports=Uw,gu.exports.murmur3=Uw,gu.exports.murmur2=OI;var Qy=ce(gu.exports);class Mm{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,u){this.ids.push(Vw(t)),this.positions.push(i,a,u)}getPositions(t){const i=Vw(t);let a=0,u=this.ids.length-1;for(;a<u;){const g=a+u>>1;this.ids[g]>=i?u=g:a=g+1}const p=[];for(;this.ids[a]===i;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(t,i){const a=new Float64Array(t.ids),u=new Uint32Array(t.positions);return e0(a,u,0,a.length-1),i&&i.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(t){const i=new Mm;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Vw(r){const t=+r;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Qy(String(r))}function e0(r,t,i,a){for(;i<a;){const u=r[i+a>>1];let p=i-1,g=a+1;for(;;){do p++;while(r[p]<u);do g--;while(r[g]>u);if(p>=g)break;Im(r,p,g),Im(t,3*p,3*g),Im(t,3*p+1,3*g+1),Im(t,3*p+2,3*g+2)}g-i<a-g?(e0(r,t,i,g),i=g+1):(e0(r,t,g+1,a),a=g)}}function Im(r,t,i){const a=r[t];r[t]=r[i],r[i]=a}vt(Mm,"FeaturePositionMap");class na{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class km extends na{constructor(t){super(t),this.current=0}set(t,i,a){this.fetchUniformLocation(t,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class $w extends na{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,a){this.fetchUniformLocation(t,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Gw extends na{constructor(t){super(t),this.current=ir.transparent}set(t,i,a){this.fetchUniformLocation(t,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const BI=new Float32Array(16),FI=new Float32Array(9),NI=new Float32Array(4);function t0(r){return[_e(255*r.r,255*r.g),_e(255*r.b,255*r.a)]}class Nd{constructor(t,i,a){this.value=t,this.uniformNames=i.map(u=>`u_${u}`),this.type=a}setUniform(t,i,a,u,p){i.set(t,p,u.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new Gw(t):new km(t)}}class _u{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,a,u,p){const g=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(t,p,g)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new $w(t):new km(t)}}class ra{constructor(t,i,a,u){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,i,a,u,p,g){const v=this.paintVertexArray.length,w=this.expression.evaluate(new M(0),i,{},p,u,g);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,i,a,u,p){const g=this.expression.evaluate({zoom:0},a,u,void 0,p);this._setPaintValue(t,i,g)}_setPaintValue(t,i,a){if(this.type==="color"){const u=t0(a);for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class os{constructor(t,i,a,u,p,g){this.expression=t,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,a,u,p,g){const v=this.expression.evaluate(new M(this.zoom),i,{},p,u,g),w=this.expression.evaluate(new M(this.zoom+1),i,{},p,u,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,v,w)}updatePaintArray(t,i,a,u,p){const g=this.expression.evaluate({zoom:this.zoom},a,u,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,p);this._setPaintValue(t,i,g,v)}_setPaintValue(t,i,a,u){if(this.type==="color"){const p=t0(a),g=t0(u);for(let v=t;v<i;v++)this.paintVertexArray.emplace(v,p[0],p[1],g[0],g[1])}else{for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,a,u,p){const g=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,v=qe(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(t,p,v)}getBinding(t,i){return new km(t)}}class Ka{constructor(t,i,a,u,p){this.expression=t,this.layerId=p,this.paintVertexAttributes=(a==="array"?ta:Ts).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new u}populatePaintArray(t,i,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(u,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,u,p,g){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,i,a,u){if(!u||!a)return;const p=u[a];if(!p)return;const{tl:g,br:v,pixelRatio:w}=p;for(let E=t;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],v[0],v[1],w)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ya{constructor(t,i,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!a(p))continue;const g=t.paint.get(p);if(!(g instanceof X&&Va(g.property.specification)))continue;const v=UI(p,t.type),w=g.value,E=g.property.specification.type,C=!!g.property.useIntegerZoom,I=p==="line-dasharray"||p.endsWith("pattern"),k=p==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||k)if(w.kind==="source"||k||I){const D=qw(p,E,"source");this.binders[p]=I?new Ka(w,v,E,D,t.id):new ra(w,v,E,D),u.push(`/a_${p}`)}else{const D=qw(p,E,"composite");this.binders[p]=new os(w,v,E,C,i,D),u.push(`/z_${p}`)}else this.binders[p]=I?new _u(w.value,v):new Nd(w.value,v,E),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof ra||i instanceof os?i.maxValue:0}populatePaintArrays(t,i,a,u,p,g){for(const v in this.binders){const w=this.binders[v];(w instanceof ra||w instanceof os||w instanceof Ka)&&w.populatePaintArray(t,i,a,u,p,g)}}setConstantPatternPositions(t){for(const i in this.binders){const a=this.binders[i];a instanceof _u&&a.setConstantPatternPositions(t)}}updatePaintArrays(t,i,a,u,p,g){let v=!1;for(const w in t){const E=i.getPositions(w);for(const C of E){const I=a.feature(C.index);for(const k in this.binders){const D=this.binders[k];if((D instanceof ra||D instanceof os||D instanceof Ka)&&D.expression.isStateDependent===!0){const L=u.paint.get(k);D.expression=L.value,D.updatePaintArray(C.start,C.end,I,t[w],p,g),v=!0}}}}return v}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Nd||a instanceof _u)&&t.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof ra||a instanceof os||a instanceof Ka)for(let u=0;u<a.paintVertexAttributes.length;u++)t.push(a.paintVertexAttributes[u].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Nd||a instanceof _u||a instanceof os)for(const u of a.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Nd||u instanceof _u||u instanceof os)for(const p of u.uniformNames)i.push({name:p,property:a,binding:u.getBinding(t,p)})}return i}setUniforms(t,i,a,u,p){for(const{name:g,property:v,binding:w}of a)this.binders[v].setUniform(t,w,p,u.get(v),g)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof ra||i instanceof os||i instanceof Ka)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof ra||a instanceof os||a instanceof Ka)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof ra||i instanceof os||i instanceof Ka)&&i.destroy()}}}class sc{constructor(t,i,a=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Ya(u,i,a);this.needsUpload=!1,this._featureMap=new Mm,this._bufferOffset=0}populatePaintArrays(t,i,a,u,p,g,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,i,u,p,g,v);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,u,p){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,i,g,u,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const jI={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function UI(r,t){return jI[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}const VI={"line-pattern":{source:ke,composite:ke},"fill-pattern":{source:ke,composite:ke},"fill-extrusion-pattern":{source:ke,composite:ke},"line-dasharray":{source:$e,composite:$e}},$I={color:{source:Po,composite:Qe},number:{source:Sn,composite:Po}};function qw(r,t,i){const a=VI[r];return a&&a[i]||$I[t][i]}vt(Nd,"ConstantBinder"),vt(_u,"PatternConstantBinder"),vt(ra,"SourceExpressionBinder"),vt(Ka,"PatternCompositeBinder"),vt(os,"CompositeExpressionBinder"),vt(Ya,"ProgramConfiguration",{omit:["_buffers"]}),vt(sc,"ProgramConfigurationSet");const Ww="-transition";class ss extends Rl{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new J(i.layout)),i.paint)){this._transitionablePaint=new O(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new te(i.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(Hy,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return xo(t,Ww)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Zy,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(xo(t,Ww))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.value.isDataDriven(),g=u.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const v=this._transitionablePaint._values[t].value,w=v.isDataDriven(),E=xo(t,"pattern")||t==="line-dasharray";return w||p||E||this._handleOverridablePaintPropertyUpdate(t,g,v)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),wo(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,u,p={}){return(!p||p.validate!==!1)&&Tm(this,t.call(Em,{key:i,layerType:this.type,objectKey:a,value:u,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof X&&Va(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=hu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const GI=Ee([{name:"a_pos",components:2,type:"Int16"}],4),qI=Ee([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class pr{constructor(t=[]){this.segments=t}prepareSegment(t,i,a,u){let p=this.segments[this.segments.length-1];return t>pr.MAX_VERTEX_ARRAY_LENGTH&&gn(`Max vertices per segment is ${pr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>pr.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,u){return new pr([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}pr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vt(pr,"SegmentVector");var It=8192;class Ja{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Mn?new Mn(t.lng,t.lat):Mn.convert(t),this}setSouthWest(t){return this._sw=t instanceof Mn?new Mn(t.lng,t.lat):Mn.convert(t),this}extend(t){const i=this._sw,a=this._ne;let u,p;if(t instanceof Mn)u=t,p=t;else{if(!(t instanceof Ja))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ja.convert(t)):this.extend(Mn.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Mn.convert(t)):this;if(u=t._sw,p=t._ne,!u||!p)return this}return i||a?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new Mn(u.lng,u.lat),this._ne=new Mn(p.lng,p.lat)),this}getCenter(){return new Mn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Mn(this.getWest(),this.getNorth())}getSouthEast(){return new Mn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:a}=Mn.convert(t);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(t){return!t||t instanceof Ja?t:new Ja(t)}}var Pm=1e-6,Wi=typeof Float32Array<"u"?Float32Array:Array;function Zw(){var r=new Wi(9);return Wi!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Hw(r,t,i){var a=t[0],u=t[1],p=t[2],g=t[3],v=t[4],w=t[5],E=t[6],C=t[7],I=t[8],k=i[0],D=i[1],L=i[2],F=i[3],q=i[4],re=i[5],de=i[6],oe=i[7],he=i[8];return r[0]=k*a+D*g+L*E,r[1]=k*u+D*v+L*C,r[2]=k*p+D*w+L*I,r[3]=F*a+q*g+re*E,r[4]=F*u+q*v+re*C,r[5]=F*p+q*w+re*I,r[6]=de*a+oe*g+he*E,r[7]=de*u+oe*v+he*C,r[8]=de*p+oe*w+he*I,r}function as(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function n0(r,t){var i=t[0],a=t[1],u=t[2],p=t[3],g=t[4],v=t[5],w=t[6],E=t[7],C=t[8],I=t[9],k=t[10],D=t[11],L=t[12],F=t[13],q=t[14],re=t[15],de=i*v-a*g,oe=i*w-u*g,he=i*E-p*g,me=a*w-u*v,fe=a*E-p*v,Re=u*E-p*w,Me=C*F-I*L,Ue=C*q-k*L,rt=C*re-D*L,Oe=I*q-k*F,We=I*re-D*F,Ze=k*re-D*q,Ke=de*Ze-oe*We+he*Oe+me*rt-fe*Ue+Re*Me;return Ke?(r[0]=(v*Ze-w*We+E*Oe)*(Ke=1/Ke),r[1]=(u*We-a*Ze-p*Oe)*Ke,r[2]=(F*Re-q*fe+re*me)*Ke,r[3]=(k*fe-I*Re-D*me)*Ke,r[4]=(w*rt-g*Ze-E*Ue)*Ke,r[5]=(i*Ze-u*rt+p*Ue)*Ke,r[6]=(q*he-L*Re-re*oe)*Ke,r[7]=(C*Re-k*he+D*oe)*Ke,r[8]=(g*We-v*rt+E*Me)*Ke,r[9]=(a*rt-i*We-p*Me)*Ke,r[10]=(L*fe-F*he+re*de)*Ke,r[11]=(I*he-C*fe-D*de)*Ke,r[12]=(v*Ue-g*Oe-w*Me)*Ke,r[13]=(i*Oe-a*Ue+u*Me)*Ke,r[14]=(F*oe-L*me-q*de)*Ke,r[15]=(C*me-I*oe+k*de)*Ke,r):null}function ac(r,t,i){var a=t[0],u=t[1],p=t[2],g=t[3],v=t[4],w=t[5],E=t[6],C=t[7],I=t[8],k=t[9],D=t[10],L=t[11],F=t[12],q=t[13],re=t[14],de=t[15],oe=i[0],he=i[1],me=i[2],fe=i[3];return r[0]=oe*a+he*v+me*I+fe*F,r[1]=oe*u+he*w+me*k+fe*q,r[2]=oe*p+he*E+me*D+fe*re,r[3]=oe*g+he*C+me*L+fe*de,r[4]=(oe=i[4])*a+(he=i[5])*v+(me=i[6])*I+(fe=i[7])*F,r[5]=oe*u+he*w+me*k+fe*q,r[6]=oe*p+he*E+me*D+fe*re,r[7]=oe*g+he*C+me*L+fe*de,r[8]=(oe=i[8])*a+(he=i[9])*v+(me=i[10])*I+(fe=i[11])*F,r[9]=oe*u+he*w+me*k+fe*q,r[10]=oe*p+he*E+me*D+fe*re,r[11]=oe*g+he*C+me*L+fe*de,r[12]=(oe=i[12])*a+(he=i[13])*v+(me=i[14])*I+(fe=i[15])*F,r[13]=oe*u+he*w+me*k+fe*q,r[14]=oe*p+he*E+me*D+fe*re,r[15]=oe*g+he*C+me*L+fe*de,r}function jd(r,t,i){var a,u,p,g,v,w,E,C,I,k,D,L,F=i[0],q=i[1],re=i[2];return t===r?(r[12]=t[0]*F+t[4]*q+t[8]*re+t[12],r[13]=t[1]*F+t[5]*q+t[9]*re+t[13],r[14]=t[2]*F+t[6]*q+t[10]*re+t[14],r[15]=t[3]*F+t[7]*q+t[11]*re+t[15]):(u=t[1],p=t[2],g=t[3],v=t[4],w=t[5],E=t[6],C=t[7],I=t[8],k=t[9],D=t[10],L=t[11],r[0]=a=t[0],r[1]=u,r[2]=p,r[3]=g,r[4]=v,r[5]=w,r[6]=E,r[7]=C,r[8]=I,r[9]=k,r[10]=D,r[11]=L,r[12]=a*F+v*q+I*re+t[12],r[13]=u*F+w*q+k*re+t[13],r[14]=p*F+E*q+D*re+t[14],r[15]=g*F+C*q+L*re+t[15]),r}function lc(r,t,i){var a=i[0],u=i[1],p=i[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*u,r[5]=t[5]*u,r[6]=t[6]*u,r[7]=t[7]*u,r[8]=t[8]*p,r[9]=t[9]*p,r[10]=t[10]*p,r[11]=t[11]*p,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function r0(r,t,i){var a=Math.sin(i),u=Math.cos(i),p=t[4],g=t[5],v=t[6],w=t[7],E=t[8],C=t[9],I=t[10],k=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=p*u+E*a,r[5]=g*u+C*a,r[6]=v*u+I*a,r[7]=w*u+k*a,r[8]=E*u-p*a,r[9]=C*u-g*a,r[10]=I*u-v*a,r[11]=k*u-w*a,r}function zm(r,t,i){var a=Math.sin(i),u=Math.cos(i),p=t[0],g=t[1],v=t[2],w=t[3],E=t[8],C=t[9],I=t[10],k=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=p*u-E*a,r[1]=g*u-C*a,r[2]=v*u-I*a,r[3]=w*u-k*a,r[8]=p*a+E*u,r[9]=g*a+C*u,r[10]=v*a+I*u,r[11]=w*a+k*u,r}function Xw(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Kw(r,t,i){var a,u,p,g=i[0],v=i[1],w=i[2],E=Math.hypot(g,v,w);return E<Pm?null:(g*=E=1/E,v*=E,w*=E,a=Math.sin(t),u=Math.cos(t),r[0]=g*g*(p=1-u)+u,r[1]=v*g*p+w*a,r[2]=w*g*p-v*a,r[3]=0,r[4]=g*v*p-w*a,r[5]=v*v*p+u,r[6]=w*v*p+g*a,r[7]=0,r[8]=g*w*p+v*a,r[9]=v*w*p-g*a,r[10]=w*w*p+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var WI=ac;function i0(){var r=new Wi(3);return Wi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Yw(r){var t=new Wi(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function Ud(r){return Math.hypot(r[0],r[1],r[2])}function yu(r,t,i){var a=new Wi(3);return a[0]=r,a[1]=t,a[2]=i,a}function ia(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r}function o0(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r}function Jw(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r}function Vd(r,t,i){return r[0]=Math.min(t[0],i[0]),r[1]=Math.min(t[1],i[1]),r[2]=Math.min(t[2],i[2]),r}function $d(r,t,i){return r[0]=Math.max(t[0],i[0]),r[1]=Math.max(t[1],i[1]),r[2]=Math.max(t[2],i[2]),r}function ao(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r}function Gd(r,t,i,a){return r[0]=t[0]+i[0]*a,r[1]=t[1]+i[1]*a,r[2]=t[2]+i[2]*a,r}function vi(r,t){var i=t[0],a=t[1],u=t[2],p=i*i+a*a+u*u;return p>0&&(p=1/Math.sqrt(p)),r[0]=t[0]*p,r[1]=t[1]*p,r[2]=t[2]*p,r}function zo(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function s0(r,t,i){var a=t[0],u=t[1],p=t[2],g=i[0],v=i[1],w=i[2];return r[0]=u*w-p*v,r[1]=p*g-a*w,r[2]=a*v-u*g,r}function or(r,t,i){var a=t[0],u=t[1],p=t[2],g=i[3]*a+i[7]*u+i[11]*p+i[15];return r[0]=(i[0]*a+i[4]*u+i[8]*p+i[12])/(g=g||1),r[1]=(i[1]*a+i[5]*u+i[9]*p+i[13])/g,r[2]=(i[2]*a+i[6]*u+i[10]*p+i[14])/g,r}function Qw(r,t,i){var a=i[0],u=i[1],p=i[2],g=t[0],v=t[1],w=t[2],E=u*w-p*v,C=p*g-a*w,I=a*v-u*g,k=u*I-p*C,D=p*E-a*I,L=a*C-u*E,F=2*i[3];return C*=F,I*=F,D*=2,L*=2,r[0]=g+(E*=F)+(k*=2),r[1]=v+C+D,r[2]=w+I+L,r}var qd,ls=o0,ZI=Jw,HI=Ud;function eb(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r}function tb(r,t){var i=t[0],a=t[1],u=t[2],p=t[3],g=i*i+a*a+u*u+p*p;return g>0&&(g=1/Math.sqrt(g)),r[0]=i*g,r[1]=a*g,r[2]=u*g,r[3]=p*g,r}function cc(r,t,i){var a=t[0],u=t[1],p=t[2],g=t[3];return r[0]=i[0]*a+i[4]*u+i[8]*p+i[12]*g,r[1]=i[1]*a+i[5]*u+i[9]*p+i[13]*g,r[2]=i[2]*a+i[6]*u+i[10]*p+i[14]*g,r[3]=i[3]*a+i[7]*u+i[11]*p+i[15]*g,r}function nb(){var r=new Wi(4);return Wi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function rb(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function ib(r,t,i){i*=.5;var a=t[0],u=t[1],p=t[2],g=t[3],v=Math.sin(i),w=Math.cos(i);return r[0]=a*w+g*v,r[1]=u*w+p*v,r[2]=p*w-u*v,r[3]=g*w-a*v,r}function ob(r,t,i){i*=.5;var a=t[0],u=t[1],p=t[2],g=t[3],v=Math.sin(i),w=Math.cos(i);return r[0]=a*w-p*v,r[1]=u*w+g*v,r[2]=p*w+a*v,r[3]=g*w-u*v,r}i0(),qd=new Wi(4),Wi!=Float32Array&&(qd[0]=0,qd[1]=0,qd[2]=0,qd[3]=0);var XI=tb;i0(),yu(1,0,0),yu(0,1,0),nb(),nb(),Zw();const KI=Ee([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:sb}=KI,ab=Ee([{name:"a_pos_3",components:3,type:"Int16"}]);var Wd=Ee([{name:"a_pos",type:"Int16",components:2}]);class a0{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,a){const u=zo(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/u;return a[0]=this.pos[0]+this.dir[0]*p,a[1]=this.pos[1]+this.dir[1]*p,a[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(t,i,a){if(function(D,L){var F=D[0],q=D[1],re=D[2],de=L[0],oe=L[1],he=L[2];return Math.abs(F-de)<=Pm*Math.max(1,Math.abs(F),Math.abs(de))&&Math.abs(q-oe)<=Pm*Math.max(1,Math.abs(q),Math.abs(oe))&&Math.abs(re-he)<=Pm*Math.max(1,Math.abs(re),Math.abs(he))}(this.pos,t)||i===0)return a[0]=a[1]=a[2]=0,!1;const[u,p,g]=this.dir,v=this.pos[0]-t[0],w=this.pos[1]-t[1],E=this.pos[2]-t[2],C=u*u+p*p+g*g,I=2*(v*u+w*p+E*g),k=I*I-4*C*(v*v+w*w+E*E-i*i);if(k<0){const D=Math.max(-I/2,0),L=v+u*D,F=w+p*D,q=E+g*D,re=Math.hypot(L,F,q);return a[0]=L*i/re,a[1]=F*i/re,a[2]=q*i/re,!1}{const D=(-I-Math.sqrt(k))/(2*C);if(D<0){const L=Math.hypot(v,w,E);return a[0]=v*i/L,a[1]=w*i/L,a[2]=E*i/L,!1}return a[0]=v+u*D,a[1]=w+p*D,a[2]=E+g*D,!0}}}class l0{constructor(t,i,a,u,p){this.TL=t,this.TR=i,this.BR=a,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(t,i,a){const u=[-1,1,1],p=[1,1,1],g=[1,-1,1],v=[-1,-1,1],w=or(u,u,t),E=or(p,p,t),C=or(g,g,t),I=or(v,v,t);return new l0(w,E,C,I,i/a)}}class c0{constructor(t,i){this.points=t,this.planes=i}static fromInvProjectionMatrix(t,i,a,u){const p=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=cc([],w,t),C=1/E[3]/i*p;return function(I,k,D){return I[0]=k[0]*D[0],I[1]=k[1]*D[1],I[2]=k[2]*D[2],I[3]=k[3]*D[3],I}(E,E,[C,C,u?1/E[3]:C,C])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=vi([],s0([],ls([],g[w[0]],g[w[1]]),ls([],g[w[2]],g[w[1]]))),C=-zo(E,g[w[1]]);return E.concat(C)});return new c0(g,v)}}class xi{static fromPoints(t){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of t)Vd(i,i,u),$d(a,a,u);return new xi(i,a)}static applyTransform(t,i){const a=t.getCorners();for(let u=0;u<a.length;++u)or(a[u],a[u],i);return xi.fromPoints(a)}constructor(t,i){this.min=t,this.max=i,this.center=ao([],ia([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],a=Yw(this.min),u=Yw(this.max);for(let p=0;p<i.length;p++)a[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new xi(a,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){const i=this.getCorners();let a=!0;for(let u=0;u<t.planes.length;u++){const p=t.planes[u];let g=0;for(let v=0;v<i.length;v++)g+=zo(p,i[v])+p[3]>=0;if(g===0)return 0;g!==i.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v=0;v<t.points.length;v++){const w=t.points[v][u]-this.min[u];p=Math.min(p,w),g=Math.max(g,w)}if(g<0||p>this.max[u]-this.min[u])return 0}return 1}}const u0=5,lb=6,Ss=It/Math.PI/2,YI=16383,uc=64,Zd=[uc,32,16],Ro=-Ss,Do=Ss,JI=[new xi([Ro,Ro,Ro],[Do,Do,Do]),new xi([Ro,Ro,Ro],[0,0,Do]),new xi([0,Ro,Ro],[Do,0,Do]),new xi([Ro,0,Ro],[0,Do,Do]),new xi([0,0,Ro],[Do,Do,Do])];function Rm(r){return r*Ss/Kd}function cb(r,t,i,a=!0){const u=ao([],r._camera.position,r.worldSize),p=[t,i,1,1];cc(p,p,r.pixelMatrixInverse),eb(p,p,1/p[3]);const g=vi([],ls([],p,u)),v=r.globeMatrix,w=[v[12],v[13],v[14]],E=ls([],w,u),C=Ud(E),I=vi([],E),k=r.worldSize/(2*Math.PI),D=zo(I,g),L=Math.asin(k/C);if(L<Math.acos(D)){if(!a)return null;const rt=[],Oe=[];ao(rt,g,C/D),vi(Oe,ls(Oe,rt,E)),vi(g,ia(g,E,ao(g,Oe,Math.tan(L)*C)))}const F=[];new a0(u,g).closestPointOnSphere(w,k,F);const q=vi([],ki(v,0)),re=vi([],ki(v,1)),de=vi([],ki(v,2)),oe=zo(q,F),he=zo(re,F),me=zo(de,F),fe=Ht(Math.asin(-he/k));let Re=Ht(Math.atan2(oe,me));Re=r.center.lng+function(rt,Oe){const We=(Oe-rt+180)%360-180;return We<-180?We+360:We}(r.center.lng,Re);const Me=As(Re),Ue=qe(Ms(fe),0,1);return new bu(Me,Ue)}class QI{constructor(t,i,a){this.a=ls([],t,a),this.b=ls([],i,a),this.center=a;const u=vi([],this.a),p=vi([],this.b);this.angle=Math.acos(zo(u,p))}}function h0(r,t){if(r.angle===0)return null;let i;return i=r.a[t]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[t]/r.a[t]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(a,u,p,g){const v=Math.sin(p);return a*(Math.sin((1-g)*p)/v)+u*(Math.sin(g*p)/v)}(r.a[t],r.b[t],r.angle,qe(i,0,1))+r.center[t]}function Cs(r){if(r.z<=1)return JI[r.z+2*r.y+r.x];const t=d0(Dm(r));return xi.fromPoints(t)}function hc(r,t,i){return ao(r,r,1-i),Gd(r,r,t,i)}function ub(r,t){const i=wu(t.zoom);if(i===0)return Cs(r);const a=Dm(r),u=d0(a),p=As(a.getWest())*t.worldSize,g=As(a.getEast())*t.worldSize,v=Ms(a.getNorth())*t.worldSize,w=Ms(a.getSouth())*t.worldSize,E=[p,v,0],C=[g,v,0],I=[p,w,0],k=[g,w,0],D=n0([],t.globeMatrix);return or(E,E,D),or(C,C,D),or(I,I,D),or(k,k,D),u[0]=hc(u[0],I,i),u[1]=hc(u[1],k,i),u[2]=hc(u[2],C,i),u[3]=hc(u[3],E,i),xi.fromPoints(u)}function hb(r,t,i){for(const a of r)or(a,a,t),ao(a,a,i)}function ek(r,t,i){const a=t/r.worldSize,u=r.globeMatrix;if(i.z<=1){const Me=Cs(i).getCorners();return hb(Me,u,a),xi.fromPoints(Me)}const p=Dm(i),g=d0(p);hb(g,u,a);const v=Number.MAX_VALUE,w=[-v,-v,-v],E=[v,v,v];if(p.contains(r.center)){for(const rt of g)Vd(E,E,rt),$d(w,w,rt);w[2]=0;const Me=r.point,Ue=[Me.x*a,Me.y*a,0];return Vd(E,E,Ue),$d(w,w,Ue),new xi(E,w)}const C=[u[12]*a,u[13]*a,u[14]*a],I=p.getCenter(),k=qe(r.center.lat,-ri,ri),D=qe(I.lat,-ri,ri),L=As(r.center.lng),F=Ms(k);let q=L-As(I.lng);const re=F-Ms(D);q>.5?q-=1:q<-.5&&(q+=1);let de=0;Math.abs(q)>Math.abs(re)?de=q>=0?1:3:(de=re>=0?0:2,Gd(C,C,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(ht(re>=0?p.getSouth():p.getNorth()))*Ss));const oe=g[de],he=g[(de+1)%4],me=new QI(oe,he,C),fe=[h0(me,0)||oe[0],h0(me,1)||oe[1],h0(me,2)||oe[2]],Re=wu(r.zoom);if(Re>0){const Me=function({x:rt,y:Oe,z:We},Ze,Ke,st,Ne){const pt=1/(1<<We);let wt=rt*pt,mt=wt+pt,Nt=Oe*pt,lt=Nt+pt,At=0;const jt=(wt+mt)/2-st;return jt>.5?At=-1:jt<-.5&&(At=1),wt=((wt+At)*Ze-(st*=Ze))*Ke+st,mt=((mt+At)*Ze-st)*Ke+st,Nt=(Nt*Ze-(Ne*=Ze))*Ke+Ne,lt=(lt*Ze-Ne)*Ke+Ne,[[wt,lt,0],[mt,lt,0],[mt,Nt,0],[wt,Nt,0]]}(i,t,r._pixelsPerMercatorPixel,L,F);for(let rt=0;rt<g.length;rt++)hc(g[rt],Me[rt],Re);const Ue=ia([],Me[de],Me[(de+1)%4]);ao(Ue,Ue,.5),hc(fe,Ue,Re)}for(const Me of g)Vd(E,E,Me),$d(w,w,Me);return E[2]=Math.min(oe[2],he[2]),Vd(E,E,fe),$d(w,w,fe),new xi(E,w)}function Dm({x:r,y:t,z:i}){const a=1/(1<<i),u=new Mn(lo(r*a),ni((t+1)*a)),p=new Mn(lo((r+1)*a),ni(t*a));return new Ja(u,p)}function d0(r){const t=ht(r.getNorth()),i=ht(r.getSouth()),a=Math.cos(t),u=Math.cos(i),p=Math.sin(t),g=Math.sin(i),v=r.getWest(),w=r.getEast();return[vu(u,g,v),vu(u,g,w),vu(a,p,w),vu(a,p,v)]}function vu(r,t,i,a=Ss){return i=ht(i),[r*Math.sin(i)*a,-t*a,r*Math.cos(i)*a]}function xu(r,t,i){return vu(Math.cos(ht(r)),Math.sin(ht(r)),t,i)}function Hd(r,t,i,a){const u=1<<i.z,p=(r/It+i.x)/u;return xu(ni((t/It+i.y)/u),lo(p),a)}function Lm({min:r,max:t}){return YI/Math.max(t[0]-r[0],t[1]-r[1],t[2]-r[2])}const db=new Float64Array(16);function Xd(r){const t=Lm(r),i=Xw(db,[t,t,t]);return jd(i,i,((a=[])[0]=-(u=r.min)[0],a[1]=-u[1],a[2]=-u[2],a));var a,u}function p0(r){const t=(a=r.min,(i=db)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const u=1/Lm(r);return lc(t,t,[u,u,u])}function pb(r,t,i,a,u){const p=function(w){const E=It/(2*Math.PI);return w/(2*Math.PI)/E}(i),g=[r,t,-i/(2*Math.PI)],v=as(new Float64Array(16));return jd(v,v,g),lc(v,v,[p,p,p]),r0(v,v,ht(-u)),zm(v,v,ht(-a)),v}function wu(r){return St(u0,lb,r)}function fb(r,t){const i=xu(t.lat,t.lng),a=function(L){const F=xu(L._center.lat,L._center.lng);let q=s0([],yu(0,1,0),F);const re=Kw([],-L.angle,F);q=or(q,q,re),Kw(re,-L._pitch,q);const de=vi([],F);return ao(de,de,Rm(L.cameraToCenterDistance/L.pixelsPerMeter)),or(de,de,re),ia([],F,de)}(r);return g=(u=o0([],a,i))[0],v=u[1],w=u[2],E=(p=i)[0],C=p[1],I=p[2],D=(k=Math.sqrt(g*g+v*v+w*w)*Math.sqrt(E*E+C*C+I*I))&&zo(u,p)/k,Math.acos(Math.min(Math.max(D,-1),1));var u,p,g,v,w,E,C,I,k,D}function f0(r,t){return fb(r,t)>Math.PI/2*1.01}const mb=ht(85),tk=Math.cos(mb),nk=Math.sin(mb),Kd=63710088e-1,gb=2*Math.PI*Kd;class Qa{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qa(bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,u=t.lat*i,p=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((t.lng-this.lng)*i);return Kd*Math.acos(Math.min(p,1))}toBounds(t=0){const i=360*t/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Ja(new Qa(this.lng-a,this.lat-i),new Qa(this.lng+a,this.lat+i))}toEcef(t){const i=Rm(t);return xu(this.lat,this.lng,Ss+i)}static convert(t){if(t instanceof Qa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Qa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Qa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Mn=Qa;function m0(r){return gb*Math.cos(r*Math.PI/180)}function As(r){return(180+r)/360}function Ms(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function cs(r,t){return r/m0(t)}function lo(r){return 360*r-180}function ni(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function _b(r,t){return r*m0(ni(t))}const ri=85.051129;function yb(r){return 1/Math.cos(r*Math.PI/180)}class bu{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=Mn.convert(t);return new bu(As(a.lng),Ms(a.lat),cs(i,a.lat))}toLngLat(){return new Mn(lo(this.x),ni(this.y))}toAltitude(){return _b(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gb*yb(ni(this.y))}}function g0(r,t,i,a,u,p,g,v,w){const E=(t+a)/2,C=(i+u)/2,I=new Ie(E,C);v(I),function(k,D,L,F,q,re){const de=L-q,oe=F-re;return Math.abs((F-D)*de-(L-k)*oe)/Math.hypot(de,oe)}(I.x,I.y,p.x,p.y,g.x,g.y)>=w?(g0(r,t,i,E,C,p,I,v,w),g0(r,E,C,a,u,I,g,v,w)):r.push(g)}function vb(r,t,i){let a=r[0],u=a.x,p=a.y;t(a);const g=[a];for(let v=1;v<r.length;v++){const w=r[v],{x:E,y:C}=w;t(w),g0(g,u,p,E,C,a,w,t,i),u=E,p=C,a=w}return g}function _0(r,t,i,a){if(a(t,i)){const u=t.add(i)._mult(.5);_0(r,t,u,a),_0(r,u,i,a)}else r.push(i)}function rk(r,t){let i=r[0];const a=[i];for(let u=1;u<r.length;u++){const p=r[u];_0(a,i,p,t),i=p}return a}const y0=Math.pow(2,14)-1,xb=-y0-1;function ik(r,t){const i=Math.round(r.x*t),a=Math.round(r.y*t);return r.x=qe(i,xb,y0),r.y=qe(a,xb,y0),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&gn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function oa(r,t,i){const a=r.loadGeometry(),u=r.extent,p=It/u;if(t&&i&&i.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:v,x:w,y:E,projection:C}=i,I=k=>{const D=lo((t.x+k.x/u)/g),L=ni((t.y+k.y/u)/g),F=C.project(D,L);k.x=(F.x*v-w)*u,k.y=(F.y*v-E)*u};for(let k=0;k<a.length;k++)if(r.type!==1)a[k]=vb(a[k],I,1);else{const D=[];for(const L of a[k])L.x<0||L.x>=u||L.y<0||L.y>=u||(I(L),D.push(L));a[k]=D}}for(const g of a)for(const v of g)ik(v,p);return a}function dc(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?oa(r):[]}}function Om(r,t,i,a,u){r.emplaceBack(2*t+(a+1)/2,2*i+(u+1)/2)}function Bm(r,t,i){r.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class v0{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new nt,this.indexArray=new Tt,this.segments=new pr,this.programConfigurations=new sc(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a,u){const p=this.layers[0],g=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:I,sourceLayerIndex:k}of t){const D=this.layers[0]._featureFilter.needGeometry,L=dc(E,D);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),L,a))continue;const F=v?v.evaluate(L,{},a):void 0,q={id:C,properties:E.properties,type:E.type,sourceLayerIndex:k,index:I,geometry:D?L.geometry:oa(E,a,u),patterns:{},sortKey:F};g.push(q)}v&&g.sort((E,C)=>E.sortKey-C.sortKey);let w=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new it,w=u.projection);for(const E of g){const{geometry:C,index:I,sourceLayerIndex:k}=E,D=t[I].feature;this.addFeature(E,C,I,i.availableImages,a,w),i.featureIndex.insert(D,C,I,k,this.index)}}update(t,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,GI.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,qI.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,a,u,p,g){for(const v of i)for(const w of v){const E=w.x,C=w.y;if(E<0||E>=It||C<0||C>=It)continue;if(g){const D=g.projectTilePoint(E,C,p),L=g.upVector(p,E,C),F=this.globeExtVertexArray;Bm(F,D,L),Bm(F,D,L),Bm(F,D,L),Bm(F,D,L)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),k=I.vertexLength;Om(this.layoutVertexArray,E,C,-1,-1),Om(this.layoutVertexArray,E,C,1,-1),Om(this.layoutVertexArray,E,C,1,1),Om(this.layoutVertexArray,E,C,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},u,p)}}function wb(r,t){for(let i=0;i<r.length;i++)if(pc(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(pc(r,t[i]))return!0;return!!x0(r,t)}function ok(r,t,i){return!!pc(r,t)||!!w0(t,r,i)}function bb(r,t){if(r.length===1)return Tb(t,r[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let u=0;u<a.length;u++)if(pc(r,a[u]))return!0}for(let i=0;i<r.length;i++)if(Tb(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(x0(r,t[i]))return!0;return!1}function sk(r,t,i){if(r.length>1){if(x0(r,t))return!0;for(let a=0;a<t.length;a++)if(w0(t[a],r,i))return!0}for(let a=0;a<r.length;a++)if(w0(r[a],t,i))return!0;return!1}function x0(r,t){if(r.length===0||t.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],u=r[i+1];for(let p=0;p<t.length-1;p++)if(ak(a,u,t[p],t[p+1]))return!0}return!1}function ak(r,t,i,a){return qr(r,i,a)!==qr(t,i,a)&&qr(r,t,i)!==qr(r,t,a)}function w0(r,t,i){const a=i*i;if(t.length===1)return r.distSqr(t[0])<a;for(let u=1;u<t.length;u++)if(Eb(r,t[u-1],t[u])<a)return!0;return!1}function Eb(r,t,i){const a=t.distSqr(i);if(a===0)return r.distSqr(t);const u=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/a;return r.distSqr(u<0?t:u>1?i:i.sub(t)._mult(u)._add(t))}function Tb(r,t){let i,a,u,p=!1;for(let g=0;g<r.length;g++){i=r[g];for(let v=0,w=i.length-1;v<i.length;w=v++)a=i[v],u=i[w],a.y>t.y!=u.y>t.y&&t.x<(u.x-a.x)*(t.y-a.y)/(u.y-a.y)+a.x&&(p=!p)}return p}function pc(r,t){let i=!1;for(let a=0,u=r.length-1;a<r.length;u=a++){const p=r[a],g=r[u];p.y>t.y!=g.y>t.y&&t.x<(g.x-p.x)*(t.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function Sb(r,t,i,a,u){for(const g of r)if(t<=g.x&&i<=g.y&&a>=g.x&&u>=g.y)return!0;const p=[new Ie(t,i),new Ie(t,u),new Ie(a,u),new Ie(a,i)];if(r.length>2){for(const g of p)if(pc(r,g))return!0}for(let g=0;g<r.length-1;g++)if(lk(r[g],r[g+1],p))return!0;return!1}function lk(r,t,i){const a=i[0],u=i[2];if(r.x<a.x&&t.x<a.x||r.x>u.x&&t.x>u.x||r.y<a.y&&t.y<a.y||r.y>u.y&&t.y>u.y)return!1;const p=qr(r,t,i[0]);return p!==qr(r,t,i[1])||p!==qr(r,t,i[2])||p!==qr(r,t,i[3])}function Eu(r,t,i){const a=t.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(r)}function Fm(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Cb(r,t,i,a,u){if(!t[0]&&!t[1])return r;const p=Ie.convert(t)._mult(u);i==="viewport"&&p._rotate(-a);const g=[];for(let v=0;v<r.length;v++)g.push(r[v].sub(p));return g}function Ab(r,t,i,a){const u=Ie.convert(r)._mult(a);return t==="viewport"&&u._rotate(-i),u}vt(v0,"CircleBucket",{omit:["layers"]});const ck=new le({"circle-sort-key":new W(je.layout_circle["circle-sort-key"])});var uk={paint:new le({"circle-radius":new W(je.paint_circle["circle-radius"]),"circle-color":new W(je.paint_circle["circle-color"]),"circle-blur":new W(je.paint_circle["circle-blur"]),"circle-opacity":new W(je.paint_circle["circle-opacity"]),"circle-translate":new B(je.paint_circle["circle-translate"]),"circle-translate-anchor":new B(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new B(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new B(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new W(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new W(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new W(je.paint_circle["circle-stroke-opacity"])}),layout:ck};function Mb(r,t,i,a,u,p,g,v,w){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(w*=r.pixelToTileUnitsFactor);const E=r.tileID.canonical,C=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const I of t)for(const k of I){const D=k.add(v),L=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(D.x,D.y,!0):0,F=i.projection.projectTilePoint(D.x,D.y,E);if(L>0){const oe=i.projection.upVector(E,D.x,D.y);F.x+=oe[0]*C*L,F.y+=oe[1]*C*L,F.z+=oe[2]*C*L}const q=p?D:hk(F.x,F.y,F.z,a),re=p?r.tilespaceRays.map(oe=>pk(oe,L)):r.queryGeometry.screenGeometry,de=cc([],[F.x,F.y,F.z,1],a);if(!g&&p?w*=de[3]/i.cameraToCenterDistance:g&&!p&&(w*=i.cameraToCenterDistance/de[3]),p){const oe=ni((k.y/It+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(oe,1)/cs(1,oe)}if(ok(re,q,w))return!0}return!1}function hk(r,t,i,a){const u=cc([],[r,t,i,1],a);return new Ie(u[0]/u[3],u[1]/u[3])}const Ib=yu(0,0,0),dk=yu(0,0,1);function pk(r,t){const i=i0();return Ib[2]=t,r.intersectsPlane(Ib,dk,i),new Ie(i[0],i[1])}class kb extends v0{}function Pb(r,{width:t,height:i},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*i*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(t*i*a);return r.width=t,r.height=i,r.data=u,r}function zb(r,t,i){const{width:a,height:u}=t;a===r.width&&u===r.height||(b0(r,t,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,u)},i),r.width=a,r.height=u,r.data=t.data)}function b0(r,t,i,a,u,p){if(u.width===0||u.height===0)return t;if(u.width>r.width||u.height>r.height||i.x>r.width-u.width||i.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||a.x>t.width-u.width||a.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,v=t.data;for(let w=0;w<u.height;w++){const E=((i.y+w)*r.width+i.x)*p,C=((a.y+w)*t.width+a.x)*p;for(let I=0;I<u.width*p;I++)v[C+I]=g[E+I]}return t}vt(kb,"HeatmapBucket",{omit:["layers"]});class sa{constructor(t,i){Pb(this,t,1,i)}resize(t){zb(this,new sa(t),1)}clone(){return new sa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,u,p){b0(t,i,a,u,p,1)}}class Zi{constructor(t,i){Pb(this,t,4,i)}resize(t){zb(this,new Zi(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Zi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,u,p){b0(t,i,a,u,p,4)}}vt(sa,"AlphaImage"),vt(Zi,"RGBAImage");var fk={paint:new le({"heatmap-radius":new W(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new W(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new B(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ae(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new B(je.paint_heatmap["heatmap-opacity"])})};function E0(r){const t={},i=r.resolution||256,a=r.clips?r.clips.length:1,u=r.image||new Zi({width:i,height:a}),p=(g,v,w)=>{t[r.evaluationKey]=w;const E=r.expression.evaluate(t);u.data[g+v+0]=Math.floor(255*E.r/E.a),u.data[g+v+1]=Math.floor(255*E.g/E.a),u.data[g+v+2]=Math.floor(255*E.b/E.a),u.data[g+v+3]=Math.floor(255*E.a)};if(r.clips)for(let g=0,v=0;g<a;++g,v+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const C=w/(i-1),{start:I,end:k}=r.clips[g];p(v,E,I*(1-C)+k*C)}else for(let g=0,v=0;g<i;g++,v+=4)p(0,v,g/(i-1));return u}var mk={paint:new le({"hillshade-illumination-direction":new B(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new B(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new B(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new B(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new B(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new B(je.paint_hillshade["hillshade-accent-color"])})};const gk=Ee([{name:"a_pos",components:2,type:"Int16"}],4),{members:_k}=gk;var T0={exports:{}};function Nm(r,t,i){i=i||2;var a,u,p,g,v,w,E,C=t&&t.length,I=C?t[0]*i:r.length,k=Rb(r,0,I,i,!0),D=[];if(!k||k.next===k.prev)return D;if(C&&(k=function(F,q,re,de){var oe,he,me,fe=[];for(oe=0,he=q.length;oe<he;oe++)(me=Rb(F,q[oe]*de,oe<he-1?q[oe+1]*de:F.length,de,!1))===me.next&&(me.steiner=!0),fe.push(Sk(me));for(fe.sort(bk),oe=0;oe<fe.length;oe++)re=Ek(fe[oe],re);return re}(r,t,k,i)),r.length>80*i){a=p=r[0],u=g=r[1];for(var L=i;L<I;L+=i)(v=r[L])<a&&(a=v),(w=r[L+1])<u&&(u=w),v>p&&(p=v),w>g&&(g=w);E=(E=Math.max(p-a,g-u))!==0?32767/E:0}return Yd(k,D,i,a,u,E,0),D}function Rb(r,t,i,a,u){var p,g;if(u===A0(r,t,i,a)>0)for(p=t;p<i;p+=a)g=Ob(p,r[p],r[p+1],g);else for(p=i-a;p>=t;p-=a)g=Ob(p,r[p],r[p+1],g);return g&&jm(g,g.next)&&(Qd(g),g=g.next),g}function fc(r,t){if(!r)return r;t||(t=r);var i,a=r;do if(i=!1,a.steiner||!jm(a,a.next)&&fr(a.prev,a,a.next)!==0)a=a.next;else{if(Qd(a),(a=t=a.prev)===a.next)break;i=!0}while(i||a!==t);return t}function Yd(r,t,i,a,u,p,g){if(r){!g&&p&&function(C,I,k,D){var L=C;do L.z===0&&(L.z=S0(L.x,L.y,I,k,D)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==C);L.prevZ.nextZ=null,L.prevZ=null,function(F){var q,re,de,oe,he,me,fe,Re,Me=1;do{for(re=F,F=null,he=null,me=0;re;){for(me++,de=re,fe=0,q=0;q<Me&&(fe++,de=de.nextZ);q++);for(Re=Me;fe>0||Re>0&&de;)fe!==0&&(Re===0||!de||re.z<=de.z)?(oe=re,re=re.nextZ,fe--):(oe=de,de=de.nextZ,Re--),he?he.nextZ=oe:F=oe,oe.prevZ=he,he=oe;re=de}he.nextZ=null,Me*=2}while(me>1)}(L)}(r,a,u,p);for(var v,w,E=r;r.prev!==r.next;)if(v=r.prev,w=r.next,p?vk(r,a,u,p):yk(r))t.push(v.i/i|0),t.push(r.i/i|0),t.push(w.i/i|0),Qd(r),r=w.next,E=w.next;else if((r=w)===E){g?g===1?Yd(r=xk(fc(r),t,i),t,i,a,u,p,2):g===2&&wk(r,t,i,a,u,p):Yd(fc(r),t,i,a,u,p,1);break}}}function yk(r){var t=r.prev,i=r,a=r.next;if(fr(t,i,a)>=0)return!1;for(var u=t.x,p=i.x,g=a.x,v=t.y,w=i.y,E=a.y,C=u<p?u<g?u:g:p<g?p:g,I=v<w?v<E?v:E:w<E?w:E,k=u>p?u>g?u:g:p>g?p:g,D=v>w?v>E?v:E:w>E?w:E,L=a.next;L!==t;){if(L.x>=C&&L.x<=k&&L.y>=I&&L.y<=D&&Tu(u,v,p,w,g,E,L.x,L.y)&&fr(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function vk(r,t,i,a){var u=r.prev,p=r,g=r.next;if(fr(u,p,g)>=0)return!1;for(var v=u.x,w=p.x,E=g.x,C=u.y,I=p.y,k=g.y,D=v<w?v<E?v:E:w<E?w:E,L=C<I?C<k?C:k:I<k?I:k,F=v>w?v>E?v:E:w>E?w:E,q=C>I?C>k?C:k:I>k?I:k,re=S0(D,L,t,i,a),de=S0(F,q,t,i,a),oe=r.prevZ,he=r.nextZ;oe&&oe.z>=re&&he&&he.z<=de;){if(oe.x>=D&&oe.x<=F&&oe.y>=L&&oe.y<=q&&oe!==u&&oe!==g&&Tu(v,C,w,I,E,k,oe.x,oe.y)&&fr(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,he.x>=D&&he.x<=F&&he.y>=L&&he.y<=q&&he!==u&&he!==g&&Tu(v,C,w,I,E,k,he.x,he.y)&&fr(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=D&&oe.x<=F&&oe.y>=L&&oe.y<=q&&oe!==u&&oe!==g&&Tu(v,C,w,I,E,k,oe.x,oe.y)&&fr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;he&&he.z<=de;){if(he.x>=D&&he.x<=F&&he.y>=L&&he.y<=q&&he!==u&&he!==g&&Tu(v,C,w,I,E,k,he.x,he.y)&&fr(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function xk(r,t,i){var a=r;do{var u=a.prev,p=a.next.next;!jm(u,p)&&Db(u,a,a.next,p)&&Jd(u,p)&&Jd(p,u)&&(t.push(u.i/i|0),t.push(a.i/i|0),t.push(p.i/i|0),Qd(a),Qd(a.next),a=r=p),a=a.next}while(a!==r);return fc(a)}function wk(r,t,i,a,u,p){var g=r;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&Ck(g,v)){var w=Lb(g,v);return g=fc(g,g.next),w=fc(w,w.next),Yd(g,t,i,a,u,p,0),void Yd(w,t,i,a,u,p,0)}v=v.next}g=g.next}while(g!==r)}function bk(r,t){return r.x-t.x}function Ek(r,t){var i=function(u,p){var g,v=p,w=u.x,E=u.y,C=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var I=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(I<=w&&I>C&&(C=I,g=v.x<v.next.x?v:v.next,I===w))return g}v=v.next}while(v!==p);if(!g)return null;var k,D=g,L=g.x,F=g.y,q=1/0;v=g;do w>=v.x&&v.x>=L&&w!==v.x&&Tu(E<F?w:C,E,L,F,E<F?C:w,E,v.x,v.y)&&(k=Math.abs(E-v.y)/(w-v.x),Jd(v,u)&&(k<q||k===q&&(v.x>g.x||v.x===g.x&&Tk(g,v)))&&(g=v,q=k)),v=v.next;while(v!==D);return g}(r,t);if(!i)return t;var a=Lb(i,r);return fc(a,a.next),fc(i,i.next)}function Tk(r,t){return fr(r.prev,r,t.prev)<0&&fr(t.next,r,r.next)<0}function S0(r,t,i,a,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Sk(r){var t=r,i=r;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==r);return i}function Tu(r,t,i,a,u,p,g,v){return(u-g)*(t-v)>=(r-g)*(p-v)&&(r-g)*(a-v)>=(i-g)*(t-v)&&(i-g)*(p-v)>=(u-g)*(a-v)}function Ck(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(i,a){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==a.i&&u.next.i!==a.i&&Db(u,u.next,i,a))return!0;u=u.next}while(u!==i);return!1}(r,t)&&(Jd(r,t)&&Jd(t,r)&&function(i,a){var u=i,p=!1,g=(i.x+a.x)/2,v=(i.y+a.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&g<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==i);return p}(r,t)&&(fr(r.prev,r,t.prev)||fr(r,t.prev,t))||jm(r,t)&&fr(r.prev,r,r.next)>0&&fr(t.prev,t,t.next)>0)}function fr(r,t,i){return(t.y-r.y)*(i.x-t.x)-(t.x-r.x)*(i.y-t.y)}function jm(r,t){return r.x===t.x&&r.y===t.y}function Db(r,t,i,a){var u=Vm(fr(r,t,i)),p=Vm(fr(r,t,a)),g=Vm(fr(i,a,r)),v=Vm(fr(i,a,t));return u!==p&&g!==v||!(u!==0||!Um(r,i,t))||!(p!==0||!Um(r,a,t))||!(g!==0||!Um(i,r,a))||!(v!==0||!Um(i,t,a))}function Um(r,t,i){return t.x<=Math.max(r.x,i.x)&&t.x>=Math.min(r.x,i.x)&&t.y<=Math.max(r.y,i.y)&&t.y>=Math.min(r.y,i.y)}function Vm(r){return r>0?1:r<0?-1:0}function Jd(r,t){return fr(r.prev,r,r.next)<0?fr(r,t,r.next)>=0&&fr(r,r.prev,t)>=0:fr(r,t,r.prev)<0||fr(r,r.next,t)<0}function Lb(r,t){var i=new C0(r.i,r.x,r.y),a=new C0(t.i,t.x,t.y),u=r.next,p=t.prev;return r.next=t,t.prev=r,i.next=u,u.prev=i,a.next=i,i.prev=a,p.next=a,a.prev=p,a}function Ob(r,t,i,a){var u=new C0(r,t,i);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Qd(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function C0(r,t,i){this.i=r,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A0(r,t,i,a){for(var u=0,p=t,g=i-a;p<i;p+=a)u+=(r[g]-r[p])*(r[p+1]+r[g+1]),g=p;return u}T0.exports=Nm,T0.exports.default=Nm,Nm.deviation=function(r,t,i,a){var u=t&&t.length,p=Math.abs(A0(r,0,u?t[0]*i:r.length,i));if(u)for(var g=0,v=t.length;g<v;g++)p-=Math.abs(A0(r,t[g]*i,g<v-1?t[g+1]*i:r.length,i));var w=0;for(g=0;g<a.length;g+=3){var E=a[g]*i,C=a[g+1]*i,I=a[g+2]*i;w+=Math.abs((r[E]-r[I])*(r[C+1]-r[E+1])-(r[E]-r[C])*(r[I+1]-r[E+1]))}return p===0&&w===0?0:Math.abs((w-p)/p)},Nm.flatten=function(r){for(var t=r[0][0].length,i={vertices:[],holes:[],dimensions:t},a=0,u=0;u<r.length;u++){for(var p=0;p<r[u].length;p++)for(var g=0;g<t;g++)i.vertices.push(r[u][p][g]);u>0&&i.holes.push(a+=r[u-1].length)}return i};var M0=ce(T0.exports);function Ak(r,t,i,a,u){Bb(r,t,i||0,a||r.length-1,u||Mk)}function Bb(r,t,i,a,u){for(;a>i;){if(a-i>600){var p=a-i+1,g=t-i+1,v=Math.log(p),w=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*w*(p-w)/p)*(g-p/2<0?-1:1);Bb(r,t,Math.max(i,Math.floor(t-g*w/p+E)),Math.min(a,Math.floor(t+(p-g)*w/p+E)),u)}var C=r[t],I=i,k=a;for(ep(r,i,t),u(r[a],C)>0&&ep(r,i,a);I<k;){for(ep(r,I,k),I++,k--;u(r[I],C)<0;)I++;for(;u(r[k],C)>0;)k--}u(r[i],C)===0?ep(r,i,k):ep(r,++k,a),k<=t&&(i=k+1),t<=k&&(a=k-1)}}function ep(r,t,i){var a=r[t];r[t]=r[i],r[i]=a}function Mk(r,t){return r<t?-1:r>t?1:0}function I0(r,t){const i=r.length;if(i<=1)return[r];const a=[];let u,p;for(let g=0;g<i;g++){const v=bo(r[g]);v!==0&&(r[g].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(u&&a.push(u),u=[r[g]]):u.push(r[g]))}if(u&&a.push(u),t>1)for(let g=0;g<a.length;g++)a[g].length<=t||(Ak(a[g],t,1,a[g].length-1,Ik),a[g]=a[g].slice(0,t));return a}function Ik(r,t){return t.area-r.area}function k0(r,t,i){const a=i.patternDependencies;let u=!1;for(const p of t){const g=p.paint.get(`${r}-pattern`);g.isConstant()||(u=!0);const v=g.constantOr(null);v&&(u=!0,a[v]=!0)}return u}function P0(r,t,i,a,u){const p=u.patternDependencies;for(const g of t){const v=g.paint.get(`${r}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:a},i,{},u.availableImages);w=w&&w.name?w.name:w,p[w]=!0,i.patterns[g.id]=w}}return i}class $m{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new nt,this.indexArray=new Tt,this.indexArray2=new Fr,this.programConfigurations=new sc(t.layers,t.zoom),this.segments=new pr,this.segments2=new pr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,a,u){this.hasPattern=k0("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:C}of t){const I=this.layers[0]._featureFilter.needGeometry,k=dc(v,I);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),k,a))continue;const D=p?p.evaluate(k,{},a,i.availableImages):void 0,L={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:E,geometry:I?k.geometry:oa(v,a,u),patterns:{},sortKey:D};g.push(L)}p&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:E,sourceLayerIndex:C}=v;if(this.hasPattern){const I=P0("fill",this.layers,v,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(v,w,E,a,{},i.availableImages);i.featureIndex.insert(t[E].feature,w,E,C,this.index)}}update(t,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,u)}addFeatures(t,i,a,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_k),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,u,p,g=[]){for(const v of I0(i,500)){let w=0;for(const L of v)w+=L.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),C=E.vertexLength,I=[],k=[];for(const L of v){if(L.length===0)continue;L!==v[0]&&k.push(I.length/2);const F=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),q=F.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(q+L.length-1,q),I.push(L[0].x),I.push(L[0].y);for(let re=1;re<L.length;re++)this.layoutVertexArray.emplaceBack(L[re].x,L[re].y),this.indexArray2.emplaceBack(q+re-1,q+re),I.push(L[re].x),I.push(L[re].y);F.vertexLength+=L.length,F.primitiveLength+=L.length}const D=M0(I,k);for(let L=0;L<D.length;L+=3)this.indexArray.emplaceBack(C+D[L],C+D[L+1],C+D[L+2]);E.vertexLength+=w,E.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,g,u)}}vt($m,"FillBucket",{omit:["layers","patternFeatures"]});const kk=new le({"fill-sort-key":new W(je.layout_fill["fill-sort-key"])});var Pk={paint:new le({"fill-antialias":new B(je.paint_fill["fill-antialias"]),"fill-opacity":new W(je.paint_fill["fill-opacity"]),"fill-color":new W(je.paint_fill["fill-color"]),"fill-outline-color":new W(je.paint_fill["fill-outline-color"]),"fill-translate":new B(je.paint_fill["fill-translate"]),"fill-translate-anchor":new B(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new W(je.paint_fill["fill-pattern"])}),layout:kk};const zk=Ee([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rk=Ee([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Dk=Ee([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Lk}=zk;var Gm={},Ok=Be,Fb=Su;function Su(r,t,i,a,u){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=u,r.readFields(Bk,this,t)}function Bk(r,t,i){r==1?t.id=i.readVarint():r==2?function(a,u){for(var p=a.readVarint()+a.pos;a.pos<p;){var g=u._keys[a.readVarint()],v=u._values[a.readVarint()];u.properties[g]=v}}(i,t):r==3?t.type=i.readVarint():r==4&&(t._geometry=i.pos)}function Fk(r){for(var t,i,a=0,u=0,p=r.length,g=p-1;u<p;g=u++)a+=((i=r[g]).x-(t=r[u]).x)*(t.y+i.y);return a}Su.types=["Unknown","Point","LineString","Polygon"],Su.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,i=r.readVarint()+r.pos,a=1,u=0,p=0,g=0,v=[];r.pos<i;){if(u<=0){var w=r.readVarint();a=7&w,u=w>>3}if(u--,a===1||a===2)p+=r.readSVarint(),g+=r.readSVarint(),a===1&&(t&&v.push(t),t=[]),t.push(new Ok(p,g));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Su.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,i=1,a=0,u=0,p=0,g=1/0,v=-1/0,w=1/0,E=-1/0;r.pos<t;){if(a<=0){var C=r.readVarint();i=7&C,a=C>>3}if(a--,i===1||i===2)(u+=r.readSVarint())<g&&(g=u),u>v&&(v=u),(p+=r.readSVarint())<w&&(w=p),p>E&&(E=p);else if(i!==7)throw new Error("unknown command "+i)}return[g,w,v,E]},Su.prototype.toGeoJSON=function(r,t,i){var a,u,p=this.extent*Math.pow(2,i),g=this.extent*r,v=this.extent*t,w=this.loadGeometry(),E=Su.types[this.type];function C(D){for(var L=0;L<D.length;L++){var F=D[L];D[L]=[360*(F.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<w.length;a++)I[a]=w[a][0];C(w=I);break;case 2:for(a=0;a<w.length;a++)C(w[a]);break;case 3:for(w=function(D){var L=D.length;if(L<=1)return[D];for(var F,q,re=[],de=0;de<L;de++){var oe=Fk(D[de]);oe!==0&&(q===void 0&&(q=oe<0),q===oe<0?(F&&re.push(F),F=[D[de]]):F.push(D[de]))}return F&&re.push(F),re}(w),a=0;a<w.length;a++)for(u=0;u<w[a].length;u++)C(w[a][u])}w.length===1?w=w[0]:E="Multi"+E;var k={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Nk=Fb,Nb=jb;function jb(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(jk,this,t),this.length=this._features.length}function jk(r,t,i){r===15?t.version=i.readVarint():r===1?t.name=i.readString():r===5?t.extent=i.readVarint():r===2?t._features.push(i.pos):r===3?t._keys.push(i.readString()):r===4&&t._values.push(function(a){for(var u=null,p=a.readVarint()+a.pos;a.pos<p;){var g=a.readVarint()>>3;u=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return u}(i))}jb.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new Nk(this._pbf,t,this.extent,this._keys,this._values)};var Uk=Nb;function Vk(r,t,i){if(r===3){var a=new Uk(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}var z0=Gm.VectorTile=function(r,t){this.layers=r.readFields(Vk,{},t)},qm=Gm.VectorTileFeature=Fb;function Wm(r,t,i,a){const u=[],p=a===0?(g,v,w,E,C,I)=>{g.push(new Ie(I,w+(I-v)/(E-v)*(C-w)))}:(g,v,w,E,C,I)=>{g.push(new Ie(v+(I-w)/(C-w)*(E-v),I))};for(const g of r){const v=[];for(const w of g){if(w.length<=2)continue;const E=[];for(let k=0;k<w.length-1;k++){const D=w[k].x,L=w[k].y,F=w[k+1].x,q=w[k+1].y,re=a===0?D:L,de=a===0?F:q;re<t?de>t&&p(E,D,L,F,q,t):re>i?de<i&&p(E,D,L,F,q,i):E.push(w[k]),de<t&&re>=t&&p(E,D,L,F,q,t),de>i&&re<=i&&p(E,D,L,F,q,i)}let C=w[w.length-1];const I=a===0?C.x:C.y;I>=t&&I<=i&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),v.push(E))}v.length&&u.push(v)}return u}Gm.VectorTileLayer=Nb;const $k=qm.types,Gk=Math.pow(2,13);function tp(r,t,i,a,u,p,g,v){r.emplaceBack((t<<1)+g,(i<<1)+p,(Math.floor(a*Gk)<<1)+u,Math.round(v))}function np(r,t,i){r.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Ub{constructor(){this.acc=new Ie(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ie(t.x,t.y),this.max=new Ie(t.x,t.y))}append(t,i){this.currentPolyCount.edges++,this.acc._add(t);const a=this.min,u=this.max;t.x<a.x?a.x=t.x:t.x>u.x&&(u.x=t.x),t.y<a.y?a.y=t.y:t.y>u.y&&(u.y=t.y),((t.x===0||t.x===It)&&t.x===i.x)!=((t.y===0||t.y===It)&&t.y===i.y)&&this.processBorderOverlap(t,i),i.x<0!=t.x<0&&this.addBorderIntersection(0,ln(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>It!=t.x>It&&this.addBorderIntersection(1,ln(i.y,t.y,(It-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,ln(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>It!=t.y>It&&this.addBorderIntersection(3,ln(i.x,t.x,(It-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[t];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const a=t.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,t.y)}else{const a=t.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,t.x)}}centroid(){const t=this.polyCount.reduce((i,a)=>i+a.edges,0);return t!==0?this.acc.div(t)._round():new Ie(0,0)}span(){return new Ie(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0)}}class rp{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new Ge,this.centroidVertexArray=new is,this.indexArray=new Tt,this.programConfigurations=new sc(t.layers,t.zoom),this.segments=new pr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=t.enableTerrain}populate(t,i,a,u){this.features=[],this.hasPattern=k0("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/It/(1<<p.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:v,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,C=dc(p,E);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),C,a))continue;const I={id:g,sourceLayerIndex:w,index:v,geometry:E?C.geometry:oa(p,a,u),properties:p.properties,type:p.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(P0("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,v,a,{},i.availableImages,u),i.featureIndex.insert(p,I.geometry,v,w,this.index,k)}this.sortBorders()}addFeatures(t,i,a,u,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,i,a,u,p)}this.sortBorders()}update(t,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Lk),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Dk.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Rk.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,u,p,g,v){const w=[new Ie(0,0),new Ie(It,It)],E=v.projection,C=E.name==="globe",I=this.enableTerrain&&!C?new Ub:null,k=$k[t.type]==="Polygon";C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new it);const D=I0(i,500);for(let re=D.length-1;re>=0;re--){const de=D[re];(de.length===0||(L=de[0]).every(oe=>oe.x<=0)||L.every(oe=>oe.x>=It)||L.every(oe=>oe.y<=0)||L.every(oe=>oe.y>=It))&&D.splice(re,1)}var L;let F;if(C)F=Hb(D,w,u);else{F=[];for(const re of D)F.push({polygon:re,bounds:w})}const q=k?this.edgeRadius:0;for(const{polygon:re,bounds:de}of F){let oe=0,he=0;for(const fe of re)k&&!fe[0].equals(fe[fe.length-1])&&fe.push(fe[0]),he+=k?fe.length-1:fe.length;const me=this.segments.prepareSegment((k?5:4)*he,this.layoutVertexArray,this.indexArray);if(k){const fe=[],Re=[];oe=me.vertexLength;for(const Ue of re){let rt,Oe;Ue.length&&Ue!==re[0]&&Re.push(fe.length/2),rt=Ue[1].sub(Ue[0])._perp()._unit();for(let We=1;We<Ue.length;We++){const Ze=Ue[We],Ke=Ue[We===Ue.length-1?1:We+1];let{x:st,y:Ne}=Ze;if(q){Oe=Ke.sub(Ze)._perp()._unit();const pt=rt.add(Oe)._unit(),wt=q*Math.min(4,1/(rt.x*pt.x+rt.y*pt.y));st+=wt*pt.x,Ne+=wt*pt.y,rt=Oe}tp(this.layoutVertexArray,st,Ne,0,0,1,1,0),me.vertexLength++,fe.push(Ze.x,Ze.y),C&&np(this.layoutVertexExtArray,E.projectTilePoint(st,Ne,u),E.upVector(u,st,Ne))}}const Me=M0(fe,Re);for(let Ue=0;Ue<Me.length;Ue+=3)this.indexArray.emplaceBack(oe+Me[Ue],oe+Me[Ue+2],oe+Me[Ue+1]),me.primitiveLength++}for(const fe of re){I&&fe.length&&I.startRing(fe[0]);let Re,Me,Ue,rt=fe.length>4&&qb(fe[fe.length-2],fe[0],fe[1]),Oe=q?qk(fe[fe.length-2],fe[0],fe[1],q):0;Me=fe[1].sub(fe[0])._perp()._unit();let We=!0;for(let Ze=1,Ke=0;Ze<fe.length;Ze++){let st=fe[Ze-1],Ne=fe[Ze];const pt=fe[Ze===fe.length-1?1:Ze+1];if(I&&k&&I.currentPolyCount.top++,Gb(Ne,st,de)){q&&(Me=pt.sub(Ne)._perp()._unit(),We=!We);continue}I&&I.append(Ne,st);const wt=Ne.sub(st)._perp(),mt=wt.x/(Math.abs(wt.x)+Math.abs(wt.y)),Nt=wt.y>0?1:0,lt=st.dist(Ne);if(Ke+lt>32768&&(Ke=0),q){Ue=pt.sub(Ne)._perp()._unit();let Ut=$b(st,Ne,pt,Vb(Me,Ue),q);isNaN(Ut)&&(Ut=0);const Pt=Ne.sub(st)._unit();st=st.add(Pt.mult(Oe))._round(),Ne=Ne.add(Pt.mult(-Ut))._round(),Oe=Ut,Me=Ue}const At=me.vertexLength,jt=fe.length>4&&qb(st,Ne,pt);let un=Wb(Ke,rt,We);if(tp(this.layoutVertexArray,st.x,st.y,mt,Nt,0,0,un),tp(this.layoutVertexArray,st.x,st.y,mt,Nt,0,1,un),Ke+=lt,un=Wb(Ke,jt,!We),rt=jt,tp(this.layoutVertexArray,Ne.x,Ne.y,mt,Nt,0,0,un),tp(this.layoutVertexArray,Ne.x,Ne.y,mt,Nt,0,1,un),me.vertexLength+=4,this.indexArray.emplaceBack(At+0,At+1,At+2),this.indexArray.emplaceBack(At+1,At+3,At+2),me.primitiveLength+=2,q){const Ut=oe+(Ze===1?fe.length-2:Ze-2),Pt=Ze===1?oe:Ut+1;if(this.indexArray.emplaceBack(At+1,Ut,At+3),this.indexArray.emplaceBack(Ut,Pt,At+3),me.primitiveLength+=2,Re===void 0&&(Re=At),!Gb(pt,fe[Ze],de)){const $n=Ze===fe.length-1?Re:me.vertexLength;this.indexArray.emplaceBack(At+2,At+3,$n),this.indexArray.emplaceBack(At+3,$n+1,$n),this.indexArray.emplaceBack(At+3,Pt,$n+1),me.primitiveLength+=3}We=!We}if(C){const Ut=this.layoutVertexExtArray,Pt=E.projectTilePoint(st.x,st.y,u),$n=E.projectTilePoint(Ne.x,Ne.y,u),qt=E.upVector(u,st.x,st.y),Wt=E.upVector(u,Ne.x,Ne.y);np(Ut,Pt,qt),np(Ut,Pt,qt),np(Ut,$n,Wt),np(Ut,$n,Wt)}}k&&(oe+=fe.length-1)}}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const re=I.borders,de=this.featuresOnBorder.push(I)-1;for(let oe=0;oe<4;oe++)re[oe][0]!==Number.MAX_VALUE&&this.borders[oe].push(de)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,g,u)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((i,a)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[a].borders[t][0])}encodeCentroid(t,i,a=!0){let u,p;if(t)if(t.y!==0){const v=i.span()._mult(this.tileToMeter);u=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else u=Math.ceil(7*(t.x+450)),p=0;else u=0,p=+a;let g=a?this.centroidVertexArray.length:i.vertexArrayOffset;for(const v of i.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(g++,u,p);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,u,p)}}}function Vb(r,t){const i=r.add(t)._unit();return r.x*i.x+r.y*i.y}function qk(r,t,i,a){const u=t.sub(r)._perp()._unit(),p=i.sub(t)._perp()._unit();return $b(r,t,i,Vb(u,p),a)}function $b(r,t,i,a,u){const p=Math.sqrt(1-a*a);return Math.min(r.dist(t)/3,t.dist(i)/3,u*p/a)}function Gb(r,t,i){return r.x<i[0].x&&t.x<i[0].x||r.x>i[1].x&&t.x>i[1].x||r.y<i[0].y&&t.y<i[0].y||r.y>i[1].y&&t.y>i[1].y}function qb(r,t,i){if(r.x<0||r.x>=It||t.x<0||t.x>=It||i.x<0||i.x>=It)return!1;const a=i.sub(t),u=a.perp(),p=r.sub(t);return(a.x*p.x+a.y*p.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function Wb(r,t,i){const a=t?2|r:-3&r;return i?1|a:-2&a}function Zb(){const r=Math.PI/32,t=Math.tan(r),i=Kd;return i*Math.sqrt(1+2*t*t)-i}function Hb(r,t,i){const a=1<<i.z,u=lo(i.x/a),p=lo((i.x+1)/a),g=ni(i.y/a),v=ni((i.y+1)/a);return function(w,E,C,I,k=0,D){const L=[];if(!w.length||!C||!I)return L;const F=(fe,Re)=>{for(const Me of fe)L.push({polygon:Me,bounds:Re})},q=Math.ceil(Math.log2(C)),re=Math.ceil(Math.log2(I)),de=q-re,oe=[];for(let fe=0;fe<Math.abs(de);fe++)oe.push(de>0?0:1);for(let fe=0;fe<Math.min(q,re);fe++)oe.push(0),oe.push(1);let he=w;if(he=Wm(he,E[0].y-k,E[1].y+k,1),he=Wm(he,E[0].x-k,E[1].x+k,0),!he.length)return L;const me=[];for(oe.length?me.push({polygons:he,bounds:E,depth:0}):F(he,E);me.length;){const fe=me.pop(),Re=fe.depth,Me=oe[Re],Ue=fe.bounds[0],rt=fe.bounds[1],Oe=Me===0?Ue.x:Ue.y,We=Me===0?rt.x:rt.y,Ze=D?D(Me,Oe,We):.5*(Oe+We),Ke=Wm(fe.polygons,Oe-k,Ze+k,Me),st=Wm(fe.polygons,Ze-k,We+k,Me);if(Ke.length){const Ne=[Ue,new Ie(Me===0?Ze:rt.x,Me===1?Ze:rt.y)];oe.length>Re+1?me.push({polygons:Ke,bounds:Ne,depth:Re+1}):F(Ke,Ne)}if(st.length){const Ne=[new Ie(Me===0?Ze:Ue.x,Me===1?Ze:Ue.y),rt];oe.length>Re+1?me.push({polygons:st,bounds:Ne,depth:Re+1}):F(st,Ne)}}return L}(r,t,Math.ceil((p-u)/11.25),Math.ceil((g-v)/11.25),1,(w,E,C)=>{if(w===0)return .5*(E+C);{const I=ni((i.y+E/It)/a);return(Ms(.5*(ni((i.y+C/It)/a)+I))*a-i.y)*It}})}vt(rp,"FillExtrusionBucket",{omit:["layers","features"]}),vt(Ub,"PartMetadata");const Wk=new le({"fill-extrusion-edge-radius":new B(je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Zk={paint:new le({"fill-extrusion-opacity":new B(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new W(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new B(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new B(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new W(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new W(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new W(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new B(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new B(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new B(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new B(je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Wk};function Xb(r,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Zm{constructor(t,i,a){this.z=t,this.x=i,this.y=a,this.key=ip(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const a=function(p,g,v){var w=Xb(256*p,256*(g=Math.pow(2,v)-g-1),v),E=Xb(256*(p+1),256*(g+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),u=function(p,g,v){let w,E="";for(let C=p;C>0;C--)w=1<<C-1,E+=(g&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kb{constructor(t,i){this.wrap=t,this.canonical=i,this.key=ip(t,i.z,i.z,i.x,i.y)}}class wi{constructor(t,i,a,u,p){this.overscaledZ=t,this.wrap=i,this.canonical=new Zm(a,+u,+p),this.key=i===0&&t===a?this.canonical.key:ip(i,t,a,u,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new wi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wi(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return ip(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-t;return ip(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new wi(i,this.wrap,i,a,u),new wi(i,this.wrap,i,a+1,u),new wi(i,this.wrap,i,a,u+1),new wi(i,this.wrap,i,a+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new wi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ip(r,t,i,a,u){const p=1<<Math.min(i,22);let g=p*(u%p)+a%p;return r&&i<22&&(g+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*g+i)+(t-i)}vt(Zm,"CanonicalTileID"),vt(wi,"OverscaledTileID",{omit:["projMatrix"]});class Cu extends Ie{constructor(t,i,a){super(t,i),this.z=a}}function op(r,t){return r.x*t.x+r.y*t.y}function Yb(r,t){if(r.length===1){let i=0;const a=t[i++];let u;for(;!u||a.equals(u);)if(u=t[i++],!u)return 1/0;for(;i<t.length;i++){const p=t[i],g=r[0],v=u.sub(a),w=p.sub(a),E=g.sub(a),C=op(v,v),I=op(v,w),k=op(w,w),D=op(E,v),L=op(E,w),F=C*k-I*I,q=(k*D-I*L)/F,re=(C*L-I*D)/F,de=a.z*(1-q-re)+u.z*q+p.z*re;if(isFinite(de))return de}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}function Jb(r,t,i,a,u,p,g,v){const w=g*u.getElevationAt(r,t,!0,!0),E=p[0]!==0,C=E?p[1]===0?g*(p[0]/7-450):g*function(I,k,D){const L=Math.floor(k[0]/8),F=Math.floor(k[1]/8),q=10*(k[0]-8*L),re=10*(k[1]-8*F),de=I.getElevationAt(L,F,!0,!0),oe=I.getMeterToDEM(D),he=Math.floor(.5*(q*oe-1)),me=Math.floor(.5*(re*oe-1)),fe=I.tileCoordToPixel(L,F),Re=2*he+1,Me=2*me+1,Ue=function(st,Ne,pt,wt,mt){return[st.getElevationAtPixel(Ne,pt,!0),st.getElevationAtPixel(Ne+mt,pt,!0),st.getElevationAtPixel(Ne,pt+mt,!0),st.getElevationAtPixel(Ne+wt,pt+mt,!0)]}(I,fe.x-he,fe.y-me,Re,Me),rt=Math.abs(Ue[0]-Ue[1]),Oe=Math.abs(Ue[2]-Ue[3]),We=Math.abs(Ue[0]-Ue[2])+Math.abs(Ue[1]-Ue[3]),Ze=Math.min(.25,.5*oe*(rt+Oe)/Re),Ke=Math.min(.25,.5*oe*We/Me);return de+Math.max(Ze*q,Ke*re)}(u,p,v):w;return{base:w+(i===0)?-1:i,top:E?Math.max(C+a,w+i+2):w+a}}const Hk=Ee([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Xk}=Hk,Kk=Ee([{name:"a_packed",components:4,type:"Float32"}]),{members:Yk}=Kk,Jk=qm.types,Qk=Math.cos(Math.PI/180*37.5);class Hm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Le,this.layoutVertexArray2=new Qe,this.indexArray=new Tt,this.programConfigurations=new sc(t.layers,t.zoom),this.segments=new pr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a,u){this.hasPattern=k0("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:C,id:I,index:k,sourceLayerIndex:D}of t){const L=this.layers[0]._featureFilter.needGeometry,F=dc(C,L);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),F,a))continue;const q=p?p.evaluate(F,{},a):void 0,re={id:I,properties:C.properties,type:C.type,sourceLayerIndex:D,index:k,geometry:L?F.geometry:oa(C,a,u),patterns:{},sortKey:q};g.push(re)}p&&g.sort((C,I)=>C.sortKey-I.sortKey);const{lineAtlas:v,featureIndex:w}=i,E=this.addConstantDashes(v);for(const C of g){const{geometry:I,index:k,sourceLayerIndex:D}=C;if(E&&this.addFeatureDashes(C,v),this.hasPattern){const L=P0("line",this.layers,C,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(C,I,k,a,v.positions,i.availableImages);w.insert(t[k].feature,I,k,D,this.index)}}addConstantDashes(t){let i=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,v=u.value;if(!v)continue;t.addDash(v,g)}}return i}addFeatureDashes(t,i){const a=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let v,w;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:a},t);w=g.kind==="constant"?g.value:g.evaluate({zoom:a},t),i.addDash(v,w),t.patterns[u.id]=i.getKey(v,w)}}update(t,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,u)}addFeatures(t,i,a,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Yk)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xk),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,u,p,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),E=v.get("line-cap").evaluate(t,{}),C=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of i)this.addLine(k,t,w,E,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,g,u)}addLine(t,i,a,u,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Jk[i.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(v?3:2))return;a==="bevel"&&(p=1.05);const C=this.overscaling<=16?15*It/(512*this.overscaling):0,I=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let k,D,L,F,q;this.e1=this.e2=-1,v&&(k=t[w-2],q=t[E].sub(k)._unit()._perp());for(let re=E;re<w;re++){if(L=re===w-1?v?t[E+1]:void 0:t[re+1],L&&t[re].equals(L))continue;q&&(F=q),k&&(D=k),k=t[re],q=L?L.sub(k)._unit()._perp():F,F=F||q;let de=F.add(q);de.x===0&&de.y===0||de._unit();const oe=F.x*q.x+F.y*q.y,he=de.x*q.x+de.y*q.y,me=he!==0?1/he:1/0,fe=2*Math.sqrt(2-2*he),Re=he<Qk&&D&&L,Me=F.x*q.y-F.y*q.x>0;if(Re&&re>E){const Oe=k.dist(D);if(Oe>2*C){const We=k.sub(k.sub(D)._mult(C/Oe)._round());this.updateDistance(D,We),this.addCurrentVertex(We,F,0,0,I),D=We}}const Ue=D&&L;let rt=Ue?a:v?"butt":u;if(Ue&&rt==="round"&&(me<g?rt="miter":me<=2&&(rt="fakeround")),rt==="miter"&&me>p&&(rt="bevel"),rt==="bevel"&&(me>2&&(rt="flipbevel"),me<p&&(rt="miter")),D&&this.updateDistance(D,k),rt==="miter")de._mult(me),this.addCurrentVertex(k,de,0,0,I);else if(rt==="flipbevel"){if(me>100)de=q.mult(-1);else{const Oe=me*F.add(q).mag()/F.sub(q).mag();de._perp()._mult(Oe*(Me?-1:1))}this.addCurrentVertex(k,de,0,0,I),this.addCurrentVertex(k,de.mult(-1),0,0,I)}else if(rt==="bevel"||rt==="fakeround"){const Oe=-Math.sqrt(me*me-1),We=Me?Oe:0,Ze=Me?0:Oe;if(D&&this.addCurrentVertex(k,F,We,Ze,I),rt==="fakeround"){const Ke=Math.round(180*fe/Math.PI/20);for(let st=1;st<Ke;st++){let Ne=st/Ke;if(Ne!==.5){const wt=Ne-.5;Ne+=Ne*wt*(Ne-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*wt*wt+(.848013+oe*(.215638*oe-1.06021)))}const pt=q.sub(F)._mult(Ne)._add(F)._unit()._mult(Me?-1:1);this.addHalfVertex(k,pt.x,pt.y,!1,Me,0,I)}}L&&this.addCurrentVertex(k,q,-We,-Ze,I)}else if(rt==="butt")this.addCurrentVertex(k,de,0,0,I);else if(rt==="square"){const Oe=D?1:-1;D||this.addCurrentVertex(k,de,Oe,Oe,I),this.addCurrentVertex(k,de,0,0,I),D&&this.addCurrentVertex(k,de,Oe,Oe,I)}else rt==="round"&&(D&&(this.addCurrentVertex(k,F,0,0,I),this.addCurrentVertex(k,F,1,1,I,!0)),L&&(this.addCurrentVertex(k,q,-1,-1,I,!0),this.addCurrentVertex(k,q,0,0,I)));if(Re&&re<w-1){const Oe=k.dist(L);if(Oe>2*C){const We=k.add(L.sub(k)._mult(C/Oe)._round());this.updateDistance(k,We),this.addCurrentVertex(We,q,0,0,I),k=We}}}}addCurrentVertex(t,i,a,u,p,g=!1){const v=i.y*u-i.x,w=-i.y-i.x*u;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,g,!1,a,p),this.addHalfVertex(t,v,w,g,!0,-u,p)}addHalfVertex({x:t,y:i},a,u,p,g,v,w){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}vt(Hm,"LineBucket",{omit:["layers","patternFeatures"]});const eP=new le({"line-cap":new W(je.layout_line["line-cap"]),"line-join":new W(je.layout_line["line-join"]),"line-miter-limit":new B(je.layout_line["line-miter-limit"]),"line-round-limit":new B(je.layout_line["line-round-limit"]),"line-sort-key":new W(je.layout_line["line-sort-key"])});var Qb={paint:new le({"line-opacity":new W(je.paint_line["line-opacity"]),"line-color":new W(je.paint_line["line-color"]),"line-translate":new B(je.paint_line["line-translate"]),"line-translate-anchor":new B(je.paint_line["line-translate-anchor"]),"line-width":new W(je.paint_line["line-width"]),"line-gap-width":new W(je.paint_line["line-gap-width"]),"line-offset":new W(je.paint_line["line-offset"]),"line-blur":new W(je.paint_line["line-blur"]),"line-dasharray":new W(je.paint_line["line-dasharray"]),"line-pattern":new W(je.paint_line["line-pattern"]),"line-gradient":new ae(je.paint_line["line-gradient"]),"line-trim-offset":new B(je.paint_line["line-trim-offset"])}),layout:eP};const e2=new class extends W{possiblyEvaluate(r,t){return t=new M(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(r,t)}evaluate(r,t,i,a){return t=En({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(r,t,i,a)}}(Qb.paint.properties["line-width"].specification);function t2(r,t){return t>0?t+2*r:r}e2.useIntegerZoom=!0;const tP=Ee([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nP=Ee([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),rP=Ee([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ee([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const iP=Ee([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),oP=Ee([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const n2=Ee([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sP=Ee([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ee([{name:"triangle",components:3,type:"Uint16"}]),Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ee([{type:"Float32",name:"offsetX"}]),Ee([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Zr=24;const us=128;function R0(r,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new M(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=i;let p=0;for(;p<a.length&&a[p]<=r;)p++;p=Math.max(0,p-1);let g=p;for(;g<a.length&&a[g]<r+1;)g++;g=Math.min(a.length-1,g);const v=a[p],w=a[g];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:w,minSize:i.evaluate(new M(v)),maxSize:i.evaluate(new M(w)),interpolationType:u}}}function Xm(r,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:u}){return r.kind==="source"?a/us:r.kind==="composite"?ln(a/us,u/us,i):t}function Au(r,t){let i=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:g}=r,v=u?qe(Io.interpolationFactor(u,t,p,g),0,1):0;r.kind==="camera"?a=ln(r.minSize,r.maxSize,v):i=v}return{uSizeT:i,uSize:a}}var aP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:us,evaluateSizeForFeature:Xm,evaluateSizeForZoom:Au,getSizeData:R0});function lP(r,t,i){return r.sections.forEach(a=>{a.text=function(u,p,g){const v=p.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),S.applyArabicShaping&&(u=S.applyArabicShaping(u)),u}(a.text,t,i)}),r}const sp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function cP(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function uP(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}var r2=On,i2=function(r,t,i,a,u){var p,g,v=8*u-a-1,w=(1<<v)-1,E=w>>1,C=-7,I=i?u-1:0,k=i?-1:1,D=r[t+I];for(I+=k,p=D&(1<<-C)-1,D>>=-C,C+=v;C>0;p=256*p+r[t+I],I+=k,C-=8);for(g=p&(1<<-C)-1,p>>=-C,C+=a;C>0;g=256*g+r[t+I],I+=k,C-=8);if(p===0)p=1-E;else{if(p===w)return g?NaN:1/0*(D?-1:1);g+=Math.pow(2,a),p-=E}return(D?-1:1)*g*Math.pow(2,p-a)},o2=function(r,t,i,a,u,p){var g,v,w,E=8*p-u-1,C=(1<<E)-1,I=C>>1,k=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=a?0:p-1,L=a?1:-1,F=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,g=C):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+I>=1?k/w:k*Math.pow(2,1-I))*w>=2&&(g++,w/=2),g+I>=C?(v=0,g=C):g+I>=1?(v=(t*w-1)*Math.pow(2,u),g+=I):(v=t*Math.pow(2,I-1)*Math.pow(2,u),g=0));u>=8;r[i+D]=255&v,D+=L,v/=256,u-=8);for(g=g<<u|v,E+=u;E>0;r[i+D]=255&g,D+=L,g/=256,E-=8);r[i+D-L]|=128*F};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function On(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}On.Varint=0,On.Fixed64=1,On.Bytes=2,On.Fixed32=5;var D0=4294967296,s2=1/D0,a2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function aa(r){return r.type===On.Bytes?r.readVarint()+r.pos:r.pos+1}function Mu(r,t,i){return i?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function l2(r,t,i){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(var u=i.pos-1;u>=r;u--)i.buf[u+a]=i.buf[u]}function hP(r,t){for(var i=0;i<r.length;i++)t.writeVarint(r[i])}function dP(r,t){for(var i=0;i<r.length;i++)t.writeSVarint(r[i])}function pP(r,t){for(var i=0;i<r.length;i++)t.writeFloat(r[i])}function fP(r,t){for(var i=0;i<r.length;i++)t.writeDouble(r[i])}function mP(r,t){for(var i=0;i<r.length;i++)t.writeBoolean(r[i])}function gP(r,t){for(var i=0;i<r.length;i++)t.writeFixed32(r[i])}function _P(r,t){for(var i=0;i<r.length;i++)t.writeSFixed32(r[i])}function yP(r,t){for(var i=0;i<r.length;i++)t.writeFixed64(r[i])}function vP(r,t){for(var i=0;i<r.length;i++)t.writeSFixed64(r[i])}function Km(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function Iu(r,t,i){r[i]=t,r[i+1]=t>>>8,r[i+2]=t>>>16,r[i+3]=t>>>24}function c2(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}On.prototype={destroy:function(){this.buf=null},readFields:function(r,t,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),u=a>>3,p=this.pos;this.type=7&a,r(u,t,this),this.pos===p&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Km(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=c2(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Km(this.buf,this.pos)+Km(this.buf,this.pos+4)*D0;return this.pos+=8,r},readSFixed64:function(){var r=Km(this.buf,this.pos)+c2(this.buf,this.pos+4)*D0;return this.pos+=8,r},readFloat:function(){var r=i2(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=i2(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,i,a=this.buf;return t=127&(i=a[this.pos++]),i<128?t:(t|=(127&(i=a[this.pos++]))<<7,i<128?t:(t|=(127&(i=a[this.pos++]))<<14,i<128?t:(t|=(127&(i=a[this.pos++]))<<21,i<128?t:function(u,p,g){var v,w,E=g.buf;if(v=(112&(w=E[g.pos++]))>>4,w<128||(v|=(127&(w=E[g.pos++]))<<3,w<128)||(v|=(127&(w=E[g.pos++]))<<10,w<128)||(v|=(127&(w=E[g.pos++]))<<17,w<128)||(v|=(127&(w=E[g.pos++]))<<24,w<128)||(v|=(1&(w=E[g.pos++]))<<31,w<128))return Mu(u,v,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&a2?function(i,a,u){return a2.decode(i.subarray(a,u))}(this.buf,t,r):function(i,a,u){for(var p="",g=a;g<u;){var v,w,E,C=i[g],I=null,k=C>239?4:C>223?3:C>191?2:1;if(g+k>u)break;k===1?C<128&&(I=C):k===2?(192&(v=i[g+1]))==128&&(I=(31&C)<<6|63&v)<=127&&(I=null):k===3?(w=i[g+2],(192&(v=i[g+1]))==128&&(192&w)==128&&((I=(15&C)<<12|(63&v)<<6|63&w)<=2047||I>=55296&&I<=57343)&&(I=null)):k===4&&(w=i[g+2],E=i[g+3],(192&(v=i[g+1]))==128&&(192&w)==128&&(192&E)==128&&((I=(15&C)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,k=1):I>65535&&(I-=65536,p+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),p+=String.fromCharCode(I),g+=k}return p}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==On.Bytes)return r.push(this.readVarint(t));var i=aa(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==On.Bytes)return r.push(this.readSVarint());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==On.Bytes)return r.push(this.readBoolean());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==On.Bytes)return r.push(this.readFloat());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==On.Bytes)return r.push(this.readDouble());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==On.Bytes)return r.push(this.readFixed32());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==On.Bytes)return r.push(this.readSFixed32());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==On.Bytes)return r.push(this.readFixed64());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==On.Bytes)return r.push(this.readSFixed64());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===On.Varint)for(;this.buf[this.pos++]>127;);else if(t===On.Bytes)this.pos=this.readVarint()+this.pos;else if(t===On.Fixed32)this.pos+=4;else{if(t!==On.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Iu(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Iu(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Iu(this.buf,-1&r,this.pos),Iu(this.buf,Math.floor(r*s2),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Iu(this.buf,-1&r,this.pos),Iu(this.buf,Math.floor(r*s2),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,i){var a,u;if(t>=0?(a=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(p,g,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(a,0,i),function(p,g){var v=(7&p)<<4;g.buf[g.pos++]|=v|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(u,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(a,u,p){for(var g,v,w=0;w<u.length;w++){if((g=u.charCodeAt(w))>55295&&g<57344){if(!v){g>56319||w+1===u.length?(a[p++]=239,a[p++]=191,a[p++]=189):v=g;continue}if(g<56320){a[p++]=239,a[p++]=191,a[p++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(a[p++]=239,a[p++]=191,a[p++]=189,v=null);g<128?a[p++]=g:(g<2048?a[p++]=g>>6|192:(g<65536?a[p++]=g>>12|224:(a[p++]=g>>18|240,a[p++]=g>>12&63|128),a[p++]=g>>6&63|128),a[p++]=63&g|128)}return p}(this.buf,r,this.pos);var i=this.pos-t;i>=128&&l2(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),o2(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),o2(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,t){this.pos++;var i=this.pos;r(t,this);var a=this.pos-i;a>=128&&l2(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,i){this.writeTag(r,On.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,hP,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,dP,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,mP,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,pP,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,fP,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,gP,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,_P,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,yP,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,vP,t)},writeBytesField:function(r,t){this.writeTag(r,On.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,On.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,On.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,On.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,On.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,On.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,On.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,On.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,On.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,On.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var Ym=ce(r2);const L0=3;function xP(r,t,i){t.glyphs=[],r===1&&i.readMessage(wP,t)}function wP(r,t,i){if(r===3){const{id:a,bitmap:u,width:p,height:g,left:v,top:w,advance:E}=i.readMessage(bP,{});t.glyphs.push({id:a,bitmap:new sa({width:p+2*L0,height:g+2*L0},u),metrics:{width:p,height:g,left:v,top:w,advance:E}})}else r===4?t.ascender=i.readSVarint():r===5&&(t.descender=i.readSVarint())}function bP(r,t,i){r===1?t.id=i.readVarint():r===2?t.bitmap=i.readBytes():r===3?t.width=i.readVarint():r===4?t.height=i.readVarint():r===5?t.left=i.readSVarint():r===6?t.top=i.readSVarint():r===7&&(t.advance=i.readVarint())}const u2=L0;function O0(r){let t=0,i=0;for(const g of r)t+=g.w*g.h,i=Math.max(i,g.w);r.sort((g,v)=>v.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let u=0,p=0;for(const g of r)for(let v=a.length-1;v>=0;v--){const w=a[v];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,p=Math.max(p,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===w.w&&g.h===w.h){const E=a.pop();v<a.length&&(a[v]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(a.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}const Oi=1;class B0{constructor(t,{pixelRatio:i,version:a,stretchX:u,stretchY:p,content:g}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=u,this.stretchY=p,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+Oi,this.paddedRect.y+Oi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Oi,this.paddedRect.y+this.paddedRect.h-Oi]}get displaySize(){return[(this.paddedRect.w-2*Oi)/this.pixelRatio,(this.paddedRect.h-2*Oi)/this.pixelRatio]}}class h2{constructor(t,i){const a={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,a,p),this.addImages(i,u,p);const{w:g,h:v}=O0(p),w=new Zi({width:g||1,height:v||1});for(const E in t){const C=t[E],I=a[E].paddedRect;Zi.copy(C.data,w,{x:0,y:0},{x:I.x+Oi,y:I.y+Oi},C.data)}for(const E in i){const C=i[E],I=u[E].paddedRect,k=I.x+Oi,D=I.y+Oi,L=C.data.width,F=C.data.height;Zi.copy(C.data,w,{x:0,y:0},{x:k,y:D},C.data),Zi.copy(C.data,w,{x:0,y:F-1},{x:k,y:D-1},{width:L,height:1}),Zi.copy(C.data,w,{x:0,y:0},{x:k,y:D+F},{width:L,height:1}),Zi.copy(C.data,w,{x:L-1,y:0},{x:k-1,y:D},{width:1,height:F}),Zi.copy(C.data,w,{x:0,y:0},{x:k+L,y:D},{width:1,height:F})}this.image=w,this.iconPositions=a,this.patternPositions=u}addImages(t,i,a){for(const u in t){const p=t[u],g={x:0,y:0,w:p.data.width+2*Oi,h:p.data.height+2*Oi};a.push(g),i[u]=new B0(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[u,p]=t.tl;a.update(i.data,void 0,{x:u,y:p})}}vt(B0,"ImagePosition"),vt(h2,"ImageAtlas");const co={horizontal:1,vertical:2,horizontalOnly:3},d2=-17;class ap{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const a=new ap;return a.scale=t||1,a.fontStack=i,a}static forImage(t){const i=new ap;return i.imageName=t,i}}class ku{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new ku;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?a.addImageSection(p):a.addTextSection(p,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(i,a){let u="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,v=i.charCodeAt(p-1)||null;u+=!a&&(g&&Cm(g)&&!sp[i[p+1]]||v&&Cm(v)&&!sp[i[p-1]])||!sp[i[p]]?i[p]:sp[i[p]]}return u}(this.text,t)}trim(){let t=0;for(let a=0;a<this.text.length&&Jm[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Jm[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new ku;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(ap.forText(t.scale,t.fontStack||i));const a=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void gn("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(ap.forImage(i)),this.sectionIndex.push(this.sections.length-1)):gn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function F0(r,t,i,a,u,p,g,v,w,E,C,I,k,D,L){const F=ku.fromFeature(r,u);I===co.vertical&&F.verticalizePunctuation(k);let q=[];const re=function(fe,Re,Me,Ue,rt,Oe){if(!fe)return[];const We=[],Ze=function(pt,wt,mt,Nt,lt,At){let jt=0;for(let un=0;un<pt.length();un++){const Ut=pt.getSection(un);jt+=p2(pt.getCharCode(un),Ut,Nt,lt,wt,At)}return jt/Math.max(1,Math.ceil(jt/mt))}(fe,Re,Me,Ue,rt,Oe),Ke=fe.text.indexOf("​")>=0;let st=0;for(let pt=0;pt<fe.length();pt++){const wt=fe.getSection(pt),mt=fe.getCharCode(pt);if(Jm[mt]||(st+=p2(mt,wt,Ue,rt,Re,Oe)),pt<fe.length()-1){const Nt=!((Ne=mt)<11904||!(gt["Bopomofo Extended"](Ne)||gt.Bopomofo(Ne)||gt["CJK Compatibility Forms"](Ne)||gt["CJK Compatibility Ideographs"](Ne)||gt["CJK Compatibility"](Ne)||gt["CJK Radicals Supplement"](Ne)||gt["CJK Strokes"](Ne)||gt["CJK Symbols and Punctuation"](Ne)||gt["CJK Unified Ideographs Extension A"](Ne)||gt["CJK Unified Ideographs"](Ne)||gt["Enclosed CJK Letters and Months"](Ne)||gt["Halfwidth and Fullwidth Forms"](Ne)||gt.Hiragana(Ne)||gt["Ideographic Description Characters"](Ne)||gt["Kangxi Radicals"](Ne)||gt["Katakana Phonetic Extensions"](Ne)||gt.Katakana(Ne)||gt["Vertical Forms"](Ne)||gt["Yi Radicals"](Ne)||gt["Yi Syllables"](Ne)));(EP[mt]||Nt||wt.imageName)&&We.push(m2(pt+1,st,Ze,We,TP(mt,fe.getCharCode(pt+1),Nt&&Ke),!1))}}var Ne;return g2(m2(fe.length(),st,Ze,We,0,!0))}(F,E,p,t,a,D),{processBidirectionalText:de,processStyledBidirectionalText:oe}=S;if(de&&F.sections.length===1){const fe=de(F.toString(),re);for(const Re of fe){const Me=new ku;Me.text=Re,Me.sections=F.sections;for(let Ue=0;Ue<Re.length;Ue++)Me.sectionIndex.push(0);q.push(Me)}}else if(oe){const fe=oe(F.text,F.sectionIndex,re);for(const Re of fe){const Me=new ku;Me.text=Re[0],Me.sectionIndex=Re[1],Me.sections=F.sections,q.push(Me)}}else q=function(fe,Re){const Me=[],Ue=fe.text;let rt=0;for(const Oe of Re)Me.push(fe.substring(rt,Oe)),rt=Oe;return rt<Ue.length&&Me.push(fe.substring(rt,Ue.length)),Me}(F,re);const he=[],me={positionedLines:he,text:F.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,Re,Me,Ue,rt,Oe,We,Ze,Ke,st,Ne,pt){let wt=0,mt=0,Nt=0;const lt=Ze==="right"?1:Ze==="left"?0:.5;let At=!1;for(const qt of rt){const Wt=qt.getSections();for(const In of Wt){if(In.imageName)continue;const Bn=Re[In.fontStack];if(Bn&&(At=Bn.ascender!==void 0&&Bn.descender!==void 0,!At))break}if(!At)break}let jt=0;for(const qt of rt){qt.trim();const Wt=qt.getMaxScale(),In=(Wt-1)*Zr,Bn={positionedGlyphs:[],lineOffset:0};fe.positionedLines[jt]=Bn;const Fn=Bn.positionedGlyphs;let kn=0;if(!qt.length()){mt+=Oe,++jt;continue}let Kn=0,tr=0;for(let Pn=0;Pn<qt.length();Pn++){const br=qt.getSection(Pn),gr=qt.getSectionIndex(Pn),Yn=qt.getCharCode(Pn);let dn=br.scale,_r=null,Nn=null,bi=null,yr=Zr,Hr=0;const Nr=!(Ke===co.horizontal||!Ne&&!Dd(Yn)||Ne&&(Jm[Yn]||(un=Yn,gt.Arabic(un)||gt["Arabic Supplement"](un)||gt["Arabic Extended-A"](un)||gt["Arabic Presentation Forms-A"](un)||gt["Arabic Presentation Forms-B"](un))));if(br.imageName){const Ei=Ue[br.imageName];if(!Ei)continue;bi=br.imageName,fe.iconsInText=fe.iconsInText||!0,Nn=Ei.paddedRect;const jr=Ei.displaySize;dn=dn*Zr/pt,_r={width:jr[0],height:jr[1],left:Oi,top:-u2,advance:Nr?jr[1]:jr[0],localGlyph:!1},Hr=At?-_r.height*dn:d2+Wt*Zr-jr[1]*dn,yr=_r.advance;const ps=(Nr?jr[0]:jr[1])*dn-Zr*Wt;ps>0&&ps>kn&&(kn=ps)}else{const Ei=Me[br.fontStack];if(!Ei)continue;Ei[Yn]&&(Nn=Ei[Yn]);const jr=Re[br.fontStack];if(!jr)continue;const ps=jr.glyphs[Yn];if(!ps)continue;if(_r=ps.metrics,yr=Yn!==8203?Zr:0,At){const Bu=jr.ascender!==void 0?Math.abs(jr.ascender):0,_p=jr.descender!==void 0?Math.abs(jr.descender):0,yp=(Bu+_p)*dn;Kn<yp&&(Kn=yp,tr=(Bu-_p)/2*dn),Hr=-Bu*dn}else Hr=d2+(Wt-dn)*Zr}Nr?(fe.verticalizable=!0,Fn.push({glyph:Yn,imageName:bi,x:wt,y:mt+Hr,vertical:Nr,scale:dn,localGlyph:_r.localGlyph,fontStack:br.fontStack,sectionIndex:gr,metrics:_r,rect:Nn}),wt+=yr*dn+st):(Fn.push({glyph:Yn,imageName:bi,x:wt,y:mt+Hr,vertical:Nr,scale:dn,localGlyph:_r.localGlyph,fontStack:br.fontStack,sectionIndex:gr,metrics:_r,rect:Nn}),wt+=_r.advance*dn+st)}Fn.length!==0&&(Nt=Math.max(wt-st,Nt),At?_2(Fn,lt,kn,tr,Oe*Wt/2):_2(Fn,lt,kn,0,Oe/2)),wt=0;const mr=Oe*Wt+kn;Bn.lineOffset=Math.max(kn,In),mt+=mr,++jt}var un;const Ut=mt,{horizontalAlign:Pt,verticalAlign:$n}=N0(We);(function(qt,Wt,In,Bn,Fn,kn){const Kn=(Wt-In)*Fn,tr=-kn*Bn;for(const mr of qt)for(const Pn of mr.positionedGlyphs)Pn.x+=Kn,Pn.y+=tr})(fe.positionedLines,lt,Pt,$n,Nt,Ut),fe.top+=-$n*Ut,fe.bottom=fe.top+Ut,fe.left+=-Pt*Nt,fe.right=fe.left+Nt,fe.hasBaseline=At}(me,t,i,a,q,g,v,w,I,E,k,L),!function(fe){for(const Re of fe)if(Re.positionedGlyphs.length!==0)return!1;return!0}(he)&&me}const Jm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},EP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function p2(r,t,i,a,u,p){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*Zr/p+u:0}{const g=i[t.fontStack],v=g&&g.glyphs[r];return v?v.metrics.advance*t.scale+u:0}}function f2(r,t,i,a){const u=Math.pow(r-t,2);return a?r<t?u/2:2*u:u+Math.abs(i)*i}function TP(r,t,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function m2(r,t,i,a,u,p){let g=null,v=f2(t,i,u,p);for(const w of a){const E=f2(t-w.x,i,u,p)+w.badness;E<=v&&(g=w,v=E)}return{index:r,x:t,priorBreak:g,badness:v}}function g2(r){return r?g2(r.priorBreak).concat(r.index):[]}function N0(r){let t=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function _2(r,t,i,a,u){if(!(t||i||a||u))return;const p=r.length-1,g=r[p],v=(g.x+g.metrics.advance*g.scale)*t;for(let w=0;w<=p;w++)r[w].x-=v,r[w].y+=i+a+u}function SP(r,t,i){const{horizontalAlign:a,verticalAlign:u}=N0(i),p=t[0]-r.displaySize[0]*a,g=t[1]-r.displaySize[1]*u;return{image:r,top:g,bottom:g+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function y2(r,t,i,a,u,p){const g=r.image;let v;if(g.content){const q=g.content,re=g.pixelRatio||1;v=[q[0]/re,q[1]/re,g.displaySize[0]-q[2]/re,g.displaySize[1]-q[3]/re]}const w=t.left*p,E=t.right*p;let C,I,k,D;i==="width"||i==="both"?(D=u[0]+w-a[3],I=u[0]+E+a[1]):(D=u[0]+(w+E-g.displaySize[0])/2,I=D+g.displaySize[0]);const L=t.top*p,F=t.bottom*p;return i==="height"||i==="both"?(C=u[1]+L-a[0],k=u[1]+F+a[2]):(C=u[1]+(L+F-g.displaySize[1])/2,k=C+g.displaySize[1]),{image:g,top:C,right:I,bottom:k,left:D,collisionPadding:v}}class la extends Ie{constructor(t,i,a,u,p){super(t,i),this.angle=u,this.z=a,p!==void 0&&(this.segment=p)}clone(){return new la(this.x,this.y,this.z,this.angle,this.segment)}}function v2(r,t,i,a,u){if(t.segment===void 0)return!0;let p=t,g=t.segment+1,v=0;for(;v>-i/2;){if(g--,g<0)return!1;v-=r[g].dist(p),p=r[g]}v+=r[g].dist(r[g+1]),g++;const w=[];let E=0;for(;v<i/2;){const C=r[g],I=r[g+1];if(!I)return!1;let k=r[g-1].angleTo(C)-C.angleTo(I);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:k}),E+=k;v-w[0].distance>a;)E-=w.shift().angleDelta;if(E>u)return!1;g++,v+=C.dist(I)}return!0}function x2(r){let t=0;for(let i=0;i<r.length-1;i++)t+=r[i].dist(r[i+1]);return t}function w2(r,t,i){return r?.6*t*i:0}function b2(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function CP(r,t,i,a,u,p){const g=w2(i,u,p),v=b2(i,a)*p;let w=0;const E=x2(r)/2;for(let C=0;C<r.length-1;C++){const I=r[C],k=r[C+1],D=I.dist(k);if(w+D>E){const L=(E-w)/D,F=ln(I.x,k.x,L),q=ln(I.y,k.y,L),re=new la(F,q,0,k.angleTo(I),C);return!g||v2(r,re,v,g,t)?re:void 0}w+=D}}function AP(r,t,i,a,u,p,g,v,w){const E=w2(a,p,g),C=b2(a,u),I=C*g,k=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return t-I<t/4&&(t=I+t/4),E2(r,k?t/2*v%t:(C/2+2*p)*g*v%t,t,E,i,I,k,!1,w)}function E2(r,t,i,a,u,p,g,v,w){const E=p/2,C=x2(r);let I=0,k=t-i,D=[];for(let L=0;L<r.length-1;L++){const F=r[L],q=r[L+1],re=F.dist(q),de=q.angleTo(F);for(;k+i<I+re;){k+=i;const oe=(k-I)/re,he=ln(F.x,q.x,oe),me=ln(F.y,q.y,oe);if(he>=0&&he<w&&me>=0&&me<w&&k-E>=0&&k+E<=C){const fe=new la(he,me,0,de,L);fe._round(),a&&!v2(r,fe,p,a,u)||D.push(fe)}}I+=re}return v||D.length||g||(D=E2(r,I/2,i,a,u,p,g,!0,w)),D}function T2(r,t,i,a,u){const p=[];for(let g=0;g<r.length;g++){const v=r[g];let w;for(let E=0;E<v.length-1;E++){let C=v[E],I=v[E+1];C.x<t&&I.x<t||(C.x<t?C=new Ie(t,C.y+(t-C.x)/(I.x-C.x)*(I.y-C.y))._round():I.x<t&&(I=new Ie(t,C.y+(t-C.x)/(I.x-C.x)*(I.y-C.y))._round()),C.y<i&&I.y<i||(C.y<i?C=new Ie(C.x+(i-C.y)/(I.y-C.y)*(I.x-C.x),i)._round():I.y<i&&(I=new Ie(C.x+(i-C.y)/(I.y-C.y)*(I.x-C.x),i)._round()),C.x>=a&&I.x>=a||(C.x>=a?C=new Ie(a,C.y+(a-C.x)/(I.x-C.x)*(I.y-C.y))._round():I.x>=a&&(I=new Ie(a,C.y+(a-C.x)/(I.x-C.x)*(I.y-C.y))._round()),C.y>=u&&I.y>=u||(C.y>=u?C=new Ie(C.x+(u-C.y)/(I.y-C.y)*(I.x-C.x),u)._round():I.y>=u&&(I=new Ie(C.x+(u-C.y)/(I.y-C.y)*(I.x-C.x),u)._round()),w&&C.equals(w[w.length-1])||(w=[C],p.push(w)),w.push(I)))))}}return p}vt(la,"Anchor");const lp=1e20;function S2(r,t,i,a,u,p,g,v,w){for(let E=t;E<t+a;E++)C2(r,i*p+E,p,u,g,v,w);for(let E=i;E<i+u;E++)C2(r,E*p+t,1,a,g,v,w)}function C2(r,t,i,a,u,p,g){p[0]=0,g[0]=-lp,g[1]=lp,u[0]=r[t];for(let v=1,w=0,E=0;v<a;v++){u[v]=r[t+v*i];const C=v*v;do{const I=p[w];E=(u[v]-u[I]+C-I*I)/(v-I)/2}while(E<=g[w]&&--w>-1);w++,p[w]=v,g[w]=E,g[w+1]=lp}for(let v=0,w=0;v<a;v++){for(;g[w+1]<v;)w++;const E=p[w],C=v-E;r[t+v*i]=u[E]+C*C}}const hs=2,j0={none:0,ideographs:1,all:2};class Pu{constructor(t,i,a){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const a=[];for(const u in t)for(const p of t[u])a.push({stack:u,id:p});Kt(a,({stack:u,id:p},g)=>{let v=this.entries[u];v||(v=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[p];if(w!==void 0)return void g(null,{stack:u,id:p,glyph:w});if(w=this._tinySDF(v,u,p),w)return v.glyphs[p]=w,void g(null,{stack:u,id:p,glyph:w});const E=Math.floor(p/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(v.ranges[E])return void g(null,{stack:u,id:p,glyph:w});let C=v.requests[E];C||(C=v.requests[E]=[],Pu.loadGlyphRange(u,E,this.url,this.requestManager,(I,k)=>{if(k){v.ascender=k.ascender,v.descender=k.descender;for(const D in k.glyphs)this._doesCharSupportLocalGlyph(+D)||(v.glyphs[+D]=k.glyphs[+D]);v.ranges[E]=!0}for(const D of C)D(I,k);delete v.requests[E]})),C.push((I,k)=>{I?g(I):k&&g(null,{stack:u,id:p,glyph:k.glyphs[p]||null})})},(u,p)=>{if(u)i(u);else if(p){const g={};for(const{stack:v,id:w,glyph:E}of p)g[v]===void 0&&(g[v]={}),g[v].glyphs===void 0&&(g[v].glyphs={}),g[v].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[v].ascender=this.entries[v].ascender,g[v].descender=this.entries[v].descender;i(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==j0.none&&(this.localGlyphMode===j0.all?!!this.localFontFamily:!!this.localFontFamily&&(gt["CJK Unified Ideographs"](t)||gt["Hangul Syllables"](t)||gt.Hiragana(t)||gt.Katakana(t)||gt["CJK Symbols and Punctuation"](t)))}_tinySDF(t,i,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let p=t.tinySDF;if(!p){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),p=t.tinySDF=new Pu.TinySDF({fontFamily:u,fontWeight:F,fontSize:24*hs,buffer:3*hs,radius:8*hs}),p.fontWeight=F}if(this.localGlyphs[p.fontWeight][a])return this.localGlyphs[p.fontWeight][a];const g=String.fromCharCode(a),{data:v,width:w,height:E,glyphWidth:C,glyphHeight:I,glyphLeft:k,glyphTop:D,glyphAdvance:L}=p.draw(g);return this.localGlyphs[p.fontWeight][a]={id:a,bitmap:new sa({width:w,height:E},v),metrics:{width:C/hs,height:I/hs,left:k/hs,top:D/hs-27,advance:L/hs,localGlyph:!0}}}}Pu.loadGlyphRange=function(r,t,i,a,u){const p=256*t,g=p+255,v=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${p}-${g}`),So.Glyphs);Et(v,(w,E)=>{if(w)u(w);else if(E){const C={},I=function(k){return new Ym(k).readFields(xP,{})}(E);for(const k of I.glyphs)C[k.id]=k;u(null,{glyphs:C,ascender:I.ascender,descender:I.descender})}})},Pu.TinySDF=class{constructor({fontSize:r=24,buffer:t=3,radius:i=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=i;const v=this.size=r+4*t,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${p} ${r}px ${u}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(r){const t=document.createElement("canvas");return t.width=t.height=r,t}draw(r){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(r),g=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),w=Math.min(this.size-this.buffer,g+Math.ceil(a)),E=v+2*this.buffer,C=w+2*this.buffer,I=Math.max(E*C,0),k=new Uint8ClampedArray(I),D={data:k,width:E,height:C,glyphWidth:v,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(v===0||w===0)return D;const{ctx:L,buffer:F,gridInner:q,gridOuter:re}=this;L.clearRect(F,F,v,w),L.fillText(r,F,F+g);const de=L.getImageData(F,F,v,w);re.fill(lp,0,I),q.fill(0,0,I);for(let oe=0;oe<w;oe++)for(let he=0;he<v;he++){const me=de.data[4*(oe*v+he)+3]/255;if(me===0)continue;const fe=(oe+F)*E+he+F;if(me===1)re[fe]=0,q[fe]=lp;else{const Re=.5-me;re[fe]=Re>0?Re*Re:0,q[fe]=Re<0?Re*Re:0}}S2(re,0,0,E,C,E,this.f,this.v,this.z),S2(q,F,F,v,w,E,this.f,this.v,this.z);for(let oe=0;oe<I;oe++){const he=Math.sqrt(re[oe])-Math.sqrt(q[oe]);k[oe]=Math.round(255-255*(he/this.radius+this.cutoff))}return D}};const zu=Oi;function A2(r,t,i,a){const u=[],p=r.image,g=p.pixelRatio,v=p.paddedRect.w-2*zu,w=p.paddedRect.h-2*zu,E=r.right-r.left,C=r.bottom-r.top,I=p.stretchX||[[0,v]],k=p.stretchY||[[0,w]],D=(Oe,We)=>Oe+We[1]-We[0],L=I.reduce(D,0),F=k.reduce(D,0),q=v-L,re=w-F;let de=0,oe=L,he=0,me=F,fe=0,Re=q,Me=0,Ue=re;if(p.content&&a){const Oe=p.content;de=Qm(I,0,Oe[0]),he=Qm(k,0,Oe[1]),oe=Qm(I,Oe[0],Oe[2]),me=Qm(k,Oe[1],Oe[3]),fe=Oe[0]-de,Me=Oe[1]-he,Re=Oe[2]-Oe[0]-oe,Ue=Oe[3]-Oe[1]-me}const rt=(Oe,We,Ze,Ke)=>{const st=eg(Oe.stretch-de,oe,E,r.left),Ne=tg(Oe.fixed-fe,Re,Oe.stretch,L),pt=eg(We.stretch-he,me,C,r.top),wt=tg(We.fixed-Me,Ue,We.stretch,F),mt=eg(Ze.stretch-de,oe,E,r.left),Nt=tg(Ze.fixed-fe,Re,Ze.stretch,L),lt=eg(Ke.stretch-he,me,C,r.top),At=tg(Ke.fixed-Me,Ue,Ke.stretch,F),jt=new Ie(st,pt),un=new Ie(mt,pt),Ut=new Ie(mt,lt),Pt=new Ie(st,lt),$n=new Ie(Ne/g,wt/g),qt=new Ie(Nt/g,At/g),Wt=t*Math.PI/180;if(Wt){const Fn=Math.sin(Wt),kn=Math.cos(Wt),Kn=[kn,-Fn,Fn,kn];jt._matMult(Kn),un._matMult(Kn),Pt._matMult(Kn),Ut._matMult(Kn)}const In=Oe.stretch+Oe.fixed,Bn=We.stretch+We.fixed;return{tl:jt,tr:un,bl:Pt,br:Ut,tex:{x:p.paddedRect.x+zu+In,y:p.paddedRect.y+zu+Bn,w:Ze.stretch+Ze.fixed-In,h:Ke.stretch+Ke.fixed-Bn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$n,pixelOffsetBR:qt,minFontScaleX:Re/g/E,minFontScaleY:Ue/g/C,isSDF:i}};if(a&&(p.stretchX||p.stretchY)){const Oe=M2(I,q,L),We=M2(k,re,F);for(let Ze=0;Ze<Oe.length-1;Ze++){const Ke=Oe[Ze],st=Oe[Ze+1];for(let Ne=0;Ne<We.length-1;Ne++)u.push(rt(Ke,We[Ne],st,We[Ne+1]))}}else u.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return u}function Qm(r,t,i){let a=0;for(const u of r)a+=Math.max(t,Math.min(i,u[1]))-Math.max(t,Math.min(i,u[0]));return a}function M2(r,t,i){const a=[{fixed:-zu,stretch:0}];for(const[u,p]of r){const g=a[a.length-1];a.push({fixed:u-g.stretch,stretch:g.stretch}),a.push({fixed:u-g.stretch,stretch:g.stretch+(p-u)})}return a.push({fixed:t+zu,stretch:i}),a}function eg(r,t,i,a){return r/t*i+a}function tg(r,t,i,a){return r-t*i/a}function MP(r,t,i,a){const u=t+r.positionedLines[a].lineOffset;return a===0?i+u/2:i+(u+(t+r.positionedLines[a-1].lineOffset))/2}class IP{constructor(t=[],i=kP){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,u=i[t];for(;t>0;){const p=t-1>>1,g=i[p];if(a(u,g)>=0)break;i[t]=g,t=p}i[t]=u}_down(t){const{data:i,compare:a}=this,u=this.length>>1,p=i[t];for(;t<u;){let g=1+(t<<1),v=i[g];const w=g+1;if(w<this.length&&a(i[w],v)<0&&(g=w,v=i[w]),a(v,p)>=0)break;i[t]=v,t=g}i[t]=p}}function kP(r,t){return r<t?-1:r>t?1:0}function PP(r,t=1,i=!1){let a=1/0,u=1/0,p=-1/0,g=-1/0;const v=r[0];for(let D=0;D<v.length;D++){const L=v[D];(!D||L.x<a)&&(a=L.x),(!D||L.y<u)&&(u=L.y),(!D||L.x>p)&&(p=L.x),(!D||L.y>g)&&(g=L.y)}const w=Math.min(p-a,g-u);let E=w/2;const C=new IP([],zP);if(w===0)return new Ie(a,u);for(let D=a;D<p;D+=w)for(let L=u;L<g;L+=w)C.push(new Ru(D+E,L+E,E,r));let I=function(D){let L=0,F=0,q=0;const re=D[0];for(let de=0,oe=re.length,he=oe-1;de<oe;he=de++){const me=re[de],fe=re[he],Re=me.x*fe.y-fe.x*me.y;F+=(me.x+fe.x)*Re,q+=(me.y+fe.y)*Re,L+=3*Re}return new Ru(F/L,q/L,0,D)}(r),k=C.length;for(;C.length;){const D=C.pop();(D.d>I.d||!I.d)&&(I=D,i&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,k)),D.max-I.d<=t||(E=D.h/2,C.push(new Ru(D.p.x-E,D.p.y-E,E,r)),C.push(new Ru(D.p.x+E,D.p.y-E,E,r)),C.push(new Ru(D.p.x-E,D.p.y+E,E,r)),C.push(new Ru(D.p.x+E,D.p.y+E,E,r)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${I.d}`)),I.p}function zP(r,t){return t.max-r.max}class Ru{constructor(t,i,a,u){this.p=new Ie(t,i),this.h=a,this.d=function(p,g){let v=!1,w=1/0;for(let E=0;E<g.length;E++){const C=g[E];for(let I=0,k=C.length,D=k-1;I<k;D=I++){const L=C[I],F=C[D];L.y>p.y!=F.y>p.y&&p.x<(F.x-L.x)*(p.y-L.y)/(F.y-L.y)+L.x&&(v=!v),w=Math.min(w,Eb(p,L,F))}}return(v?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Du=7,U0=Number.POSITIVE_INFINITY,RP=Math.sqrt(2);function I2(r,[t,i]){let a=0,u=0;if(i===U0){t<0&&(t=0);const p=t/RP;switch(r){case"top-right":case"top-left":u=p-Du;break;case"bottom-right":case"bottom-left":u=-p+Du;break;case"bottom":u=-t+Du;break;case"top":u=t-Du}switch(r){case"top-right":case"bottom-right":a=-p;break;case"top-left":case"bottom-left":a=p;break;case"left":a=t;break;case"right":a=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),r){case"top-right":case"top-left":case"top":u=i-Du;break;case"bottom-right":case"bottom-left":case"bottom":u=-i+Du}switch(r){case"top-right":case"bottom-right":case"right":a=-t;break;case"top-left":case"bottom-left":case"left":a=t}}return[a,u]}function DP(r,t,i,a,u,p,g,v,w,E){r.createArrays(),r.tilePixelRatio=It/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const C=r.layers[0].layout,I=r.layers[0]._unevaluatedLayout._values,k={};if(r.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=r.textSizeData;k.compositeTextSizes=[I["text-size"].possiblyEvaluate(new M(F),v),I["text-size"].possiblyEvaluate(new M(q),v)]}if(r.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=r.iconSizeData;k.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new M(F),v),I["icon-size"].possiblyEvaluate(new M(q),v)]}k.layoutTextSize=I["text-size"].possiblyEvaluate(new M(w+1),v),k.layoutIconSize=I["icon-size"].possiblyEvaluate(new M(w+1),v),k.textMaxSize=I["text-size"].possiblyEvaluate(new M(18),v);const D=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",L=C.get("text-size");for(const F of r.features){const q=C.get("text-font").evaluate(F,{},v).join(","),re=L.evaluate(F,{},v),de=k.layoutTextSize.evaluate(F,{},v),oe=(k.layoutIconSize.evaluate(F,{},v),{horizontal:{},vertical:void 0}),he=F.text;let me,fe=[0,0];if(he){const Ue=he.toString(),rt=C.get("text-letter-spacing").evaluate(F,{},v)*Zr,Oe=C.get("text-line-height").evaluate(F,{},v)*Zr,We=Ky(Ue)?rt:0,Ze=C.get("text-anchor").evaluate(F,{},v),Ke=C.get("text-variable-anchor");if(!Ke){const mt=C.get("text-radial-offset").evaluate(F,{},v);fe=mt?I2(Ze,[mt*Zr,U0]):C.get("text-offset").evaluate(F,{},v).map(Nt=>Nt*Zr)}let st=D?"center":C.get("text-justify").evaluate(F,{},v);const Ne=C.get("symbol-placement")==="point",pt=Ne?C.get("text-max-width").evaluate(F,{},v)*Zr:1/0,wt=mt=>{r.allowVerticalPlacement&&Rd(Ue)&&(oe.vertical=F0(he,t,i,u,q,pt,Oe,Ze,mt,We,fe,co.vertical,!0,de,re))};if(!D&&Ke){const mt=st==="auto"?Ke.map(lt=>V0(lt)):[st];let Nt=!1;for(let lt=0;lt<mt.length;lt++){const At=mt[lt];if(!oe.horizontal[At])if(Nt)oe.horizontal[At]=oe.horizontal[0];else{const jt=F0(he,t,i,u,q,pt,Oe,"center",At,We,fe,co.horizontal,!1,de,re);jt&&(oe.horizontal[At]=jt,Nt=jt.positionedLines.length===1)}}wt("left")}else{if(st==="auto"&&(st=V0(Ze)),Ne||C.get("text-writing-mode").indexOf("horizontal")>=0||!Rd(Ue)){const mt=F0(he,t,i,u,q,pt,Oe,Ze,st,We,fe,co.horizontal,!1,de,re);mt&&(oe.horizontal[st]=mt)}wt(Ne?"left":st)}}let Re=!1;if(F.icon&&F.icon.name){const Ue=a[F.icon.name];Ue&&(me=SP(u[F.icon.name],C.get("icon-offset").evaluate(F,{},v),C.get("icon-anchor").evaluate(F,{},v)),Re=Ue.sdf,r.sdfIcons===void 0?r.sdfIcons=Ue.sdf:r.sdfIcons!==Ue.sdf&&gn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ue.pixelRatio!==r.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Me=P2(oe.horizontal)||oe.vertical;r.iconsInText||(r.iconsInText=!!Me&&Me.iconsInText),(Me||me)&&LP(r,F,oe,me,a,k,de,0,fe,Re,g,v,E)}p&&r.generateCollisionDebugBuffers(w,r.collisionBoxArray)}function V0(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LP(r,t,i,a,u,p,g,v,w,E,C,I,k){let D=p.textMaxSize.evaluate(t,{},I);D===void 0&&(D=g);const L=r.layers[0].layout,F=L.get("icon-offset").evaluate(t,{},I),q=P2(i.horizontal)||i.vertical,re=k.name==="globe",de=Zr,oe=g/de,he=r.tilePixelRatio*D/de,me=(Ze=r.overscaling,r.zoom>18&&Ze>2&&(Ze>>=1),Math.max(It/(512*Ze),1)*L.get("symbol-spacing")),fe=L.get("text-padding")*r.tilePixelRatio,Re=L.get("icon-padding")*r.tilePixelRatio,Me=ht(L.get("text-max-angle")),Ue=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",rt=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Oe=L.get("symbol-placement"),We=me/2;var Ze;const Ke=L.get("icon-text-fit");let st;a&&Ke!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(st=y2(a,i.vertical,Ke,L.get("icon-text-fit-padding"),F,oe)),q&&(a=y2(a,q,Ke,L.get("icon-text-fit-padding"),F,oe)));const Ne=(pt,wt,mt)=>{if(wt.x<0||wt.x>=It||wt.y<0||wt.y>=It)return;let Nt=null;if(re){const{x:lt,y:At,z:jt}=k.projectTilePoint(wt.x,wt.y,mt);Nt={anchor:new la(lt,At,jt,0,void 0),up:k.upVector(mt,wt.x,wt.y)}}(function(lt,At,jt,un,Ut,Pt,$n,qt,Wt,In,Bn,Fn,kn,Kn,tr,mr,Pn,br,gr,Yn,dn,_r,Nn,bi,yr){const Hr=lt.addToLineVertexArray(At,un);let Nr,Ei,jr,ps,Bu,_p,yp,uE=0,hE=0,dE=0,pE=0,rv=-1,iv=-1;const zs={};let fE=Qy("");const _c=jt?jt.anchor:At;let ov=0,sv=0;if(Wt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ov,sv]=Wt.layout.get("text-offset").evaluate(dn,{},yr).map(Hi=>Hi*Zr):(ov=Wt.layout.get("text-radial-offset").evaluate(dn,{},yr)*Zr,sv=U0),lt.allowVerticalPlacement&&Ut.vertical){const Hi=Ut.vertical;if(tr)_p=$0(Hi),qt&&(yp=$0(qt));else{const Xi=Wt.layout.get("text-rotate").evaluate(dn,{},yr)+90;jr=ng(In,_c,At,Bn,Fn,kn,Hi,Kn,Xi,mr),qt&&(ps=ng(In,_c,At,Bn,Fn,kn,qt,br,Xi))}}if(Pt){const Hi=Wt.layout.get("icon-rotate").evaluate(dn,{},yr),Xi=Wt.layout.get("icon-text-fit")!=="none",vp=A2(Pt,Hi,Nn,Xi),lv=qt?A2(qt,Hi,Nn,Xi):void 0;Ei=ng(In,_c,At,Bn,Fn,kn,Pt,br,Hi),uE=4*vp.length;const mE=lt.iconSizeData;let yc=null;mE.kind==="source"?(yc=[us*Wt.layout.get("icon-size").evaluate(dn,{},yr)],yc[0]>el&&gn(`${lt.layerIds[0]}: Value for "icon-size" is >= ${cp}. Reduce your "icon-size".`)):mE.kind==="composite"&&(yc=[us*_r.compositeIconSizes[0].evaluate(dn,{},yr),us*_r.compositeIconSizes[1].evaluate(dn,{},yr)],(yc[0]>el||yc[1]>el)&&gn(`${lt.layerIds[0]}: Value for "icon-size" is >= ${cp}. Reduce your "icon-size".`)),lt.addSymbols(lt.icon,vp,yc,Yn,gr,dn,!1,jt,At,Hr.lineStartIndex,Hr.lineLength,-1,bi,yr),rv=lt.icon.placedSymbolArray.length-1,lv&&(hE=4*lv.length,lt.addSymbols(lt.icon,lv,yc,Yn,gr,dn,co.vertical,jt,At,Hr.lineStartIndex,Hr.lineLength,-1,bi,yr),iv=lt.icon.placedSymbolArray.length-1)}for(const Hi in Ut.horizontal){const Xi=Ut.horizontal[Hi];Nr||(fE=Qy(Xi.text),tr?Bu=$0(Xi):Nr=ng(In,_c,At,Bn,Fn,kn,Xi,Kn,Wt.layout.get("text-rotate").evaluate(dn,{},yr),mr));const vp=Xi.positionedLines.length===1;if(dE+=k2(lt,jt,At,Xi,$n,Wt,tr,dn,mr,Hr,Ut.vertical?co.horizontal:co.horizontalOnly,vp?Object.keys(Ut.horizontal):[Hi],zs,rv,_r,bi,yr),vp)break}Ut.vertical&&(pE+=k2(lt,jt,At,Ut.vertical,$n,Wt,tr,dn,mr,Hr,co.vertical,["vertical"],zs,iv,_r,bi,yr));let sl=-1;const av=(Hi,Xi)=>Hi?Math.max(Hi,Xi):Xi;sl=av(Bu,sl),sl=av(_p,sl),sl=av(yp,sl);const cz=sl>-1?1:0;lt.glyphOffsetArray.length>=nl.MAX_GLYPHS&&gn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dn.sortKey!==void 0&&lt.addToSortKeyRanges(lt.symbolInstances.length,dn.sortKey),lt.symbolInstances.emplaceBack(_c.x,_c.y,_c.z,At.x,At.y,zs.right>=0?zs.right:-1,zs.center>=0?zs.center:-1,zs.left>=0?zs.left:-1,zs.vertical>=0?zs.vertical:-1,rv,iv,fE,Nr!==void 0?Nr:lt.collisionBoxArray.length,Nr!==void 0?Nr+1:lt.collisionBoxArray.length,jr!==void 0?jr:lt.collisionBoxArray.length,jr!==void 0?jr+1:lt.collisionBoxArray.length,Ei!==void 0?Ei:lt.collisionBoxArray.length,Ei!==void 0?Ei+1:lt.collisionBoxArray.length,ps||lt.collisionBoxArray.length,ps?ps+1:lt.collisionBoxArray.length,Bn,dE,pE,uE,hE,cz,0,ov,sv,sl)})(r,wt,Nt,pt,i,a,u,st,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,fe,Ue,w,0,Re,rt,F,t,p,E,C,I)};if(Oe==="line")for(const pt of T2(t.geometry,0,0,It,It)){const wt=AP(pt,me,Me,i.vertical||q,a,de,he,r.overscaling,It);for(const mt of wt)q&&OP(r,q.text,We,mt)||Ne(pt,mt,I)}else if(Oe==="line-center"){for(const pt of t.geometry)if(pt.length>1){const wt=CP(pt,Me,i.vertical||q,a,de,he);wt&&Ne(pt,wt,I)}}else if(t.type==="Polygon")for(const pt of I0(t.geometry,0)){const wt=PP(pt,16);Ne(pt[0],new la(wt.x,wt.y,0,0,void 0),I)}else if(t.type==="LineString")for(const pt of t.geometry)Ne(pt,new la(pt[0].x,pt[0].y,0,0,void 0),I);else if(t.type==="Point")for(const pt of t.geometry)for(const wt of pt)Ne([wt],new la(wt.x,wt.y,0,0,void 0),I)}const cp=255,el=cp*us;function k2(r,t,i,a,u,p,g,v,w,E,C,I,k,D,L,F,q){const re=function(he,me,fe,Re,Me,Ue,rt,Oe){const We=[];if(me.positionedLines.length===0)return We;const Ze=Re.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,Ke=function(mt){const Nt=mt[0],lt=mt[1],At=Nt*lt;return At>0?[Nt,-lt]:At<0?[-Nt,lt]:Nt===0?[lt,Nt]:[lt,-Nt]}(fe);let st=Math.abs(me.top-me.bottom);for(const mt of me.positionedLines)st-=mt.lineOffset;const Ne=me.positionedLines.length,pt=st/Ne;let wt=me.top-fe[1];for(let mt=0;mt<Ne;++mt){const Nt=me.positionedLines[mt];wt=MP(me,pt,wt,mt);for(const lt of Nt.positionedGlyphs){if(!lt.rect)continue;const At=lt.rect||{};let jt=u2+1,un=!0,Ut=1,Pt=0;if(lt.imageName){const Nn=rt[lt.imageName];if(!Nn)continue;if(Nn.sdf){gn("SDF images are not supported in formatted text and will be ignored.");continue}un=!1,Ut=Nn.pixelRatio,jt=Oi/Ut}const $n=(Me||Oe)&&lt.vertical,qt=lt.metrics.advance*lt.scale/2,Wt=lt.metrics,In=lt.rect;if(In===null)continue;Oe&&me.verticalizable&&(Pt=lt.imageName?qt-lt.metrics.width*lt.scale/2:0);const Bn=Me?[lt.x+qt,lt.y]:[0,0];let Fn=[0,0],kn=[0,0],Kn=!1;Me||($n?(kn=[lt.x+qt+Ke[0],lt.y+Ke[1]-Pt],Kn=!0):Fn=[lt.x+qt+fe[0],lt.y+fe[1]-Pt]);const tr=In.w*lt.scale/(Ut*(lt.localGlyph?hs:1)),mr=In.h*lt.scale/(Ut*(lt.localGlyph?hs:1));let Pn,br,gr,Yn;if($n){const Nn=lt.y-wt,bi=new Ie(-qt,qt-Nn),yr=-Math.PI/2,Hr=new Ie(...kn);Pn=new Ie(-qt+Fn[0],Fn[1]),Pn._rotateAround(yr,bi)._add(Hr),Pn.x+=-Nn+qt,Pn.y-=(Wt.left-jt)*lt.scale;const Nr=lt.imageName?Wt.advance*lt.scale:Zr*lt.scale,Ei=String.fromCharCode(lt.glyph);cP(Ei)?Pn.x+=(1-jt)*lt.scale:uP(Ei)?Pn.x+=Nr-Wt.height*lt.scale+(-jt-1)*lt.scale:Pn.x+=lt.imageName||Wt.width+2*jt===In.w&&Wt.height+2*jt===In.h?(Nr-mr)/2:(Nr-(Wt.height+2*jt)*lt.scale)/2,br=new Ie(Pn.x,Pn.y-tr),gr=new Ie(Pn.x+mr,Pn.y),Yn=new Ie(Pn.x+mr,Pn.y-tr)}else{const Nn=(Wt.left-jt)*lt.scale-qt+Fn[0],bi=(-Wt.top-jt)*lt.scale+Fn[1],yr=Nn+tr,Hr=bi+mr;Pn=new Ie(Nn,bi),br=new Ie(yr,bi),gr=new Ie(Nn,Hr),Yn=new Ie(yr,Hr)}if(Ze){let Nn;Nn=Me?new Ie(0,0):Kn?new Ie(Ke[0],Ke[1]):new Ie(fe[0],fe[1]),Pn._rotateAround(Ze,Nn),br._rotateAround(Ze,Nn),gr._rotateAround(Ze,Nn),Yn._rotateAround(Ze,Nn)}const dn=new Ie(0,0),_r=new Ie(0,0);We.push({tl:Pn,tr:br,bl:gr,br:Yn,tex:At,writingMode:me.writingMode,glyphOffset:Bn,sectionIndex:lt.sectionIndex,isSDF:un,pixelOffsetTL:dn,pixelOffsetBR:_r,minFontScaleX:0,minFontScaleY:0})}}return We}(0,a,w,p,g,v,u,r.allowVerticalPlacement),de=r.textSizeData;let oe=null;de.kind==="source"?(oe=[us*p.layout.get("text-size").evaluate(v,{},q)],oe[0]>el&&gn(`${r.layerIds[0]}: Value for "text-size" is >= ${cp}. Reduce your "text-size".`)):de.kind==="composite"&&(oe=[us*L.compositeTextSizes[0].evaluate(v,{},q),us*L.compositeTextSizes[1].evaluate(v,{},q)],(oe[0]>el||oe[1]>el)&&gn(`${r.layerIds[0]}: Value for "text-size" is >= ${cp}. Reduce your "text-size".`)),r.addSymbols(r.text,re,oe,w,g,v,C,t,i,E.lineStartIndex,E.lineLength,D,F,q);for(const he of I)k[he]=r.text.placedSymbolArray.length-1;return 4*re.length}function P2(r){for(const t in r)return r[t];return null}function ng(r,t,i,a,u,p,g,v,w,E){let C=g.top,I=g.bottom,k=g.left,D=g.right;const L=g.collisionPadding;if(L&&(k-=L[0],C-=L[1],D+=L[2],I+=L[3]),w){const F=new Ie(k,C),q=new Ie(D,C),re=new Ie(k,I),de=new Ie(D,I),oe=ht(w);let he=new Ie(0,0);E&&(he=new Ie(E[0],E[1])),F._rotateAround(oe,he),q._rotateAround(oe,he),re._rotateAround(oe,he),de._rotateAround(oe,he),k=Math.min(F.x,q.x,re.x,de.x),D=Math.max(F.x,q.x,re.x,de.x),C=Math.min(F.y,q.y,re.y,de.y),I=Math.max(F.y,q.y,re.y,de.y)}return r.emplaceBack(t.x,t.y,t.z,i.x,i.y,k,C,D,I,v,a,u,p),r.length-1}function $0(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const t=r.bottom-r.top;return t>0?Math.max(10,t):null}function OP(r,t,i,a){const u=r.compareText;if(t in u){const p=u[t];for(let g=p.length-1;g>=0;g--)if(a.dist(p[g])<i)return!0}else u[t]=[];return u[t].push(a),!1}function z2(r,t){const i=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*t:0,u=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01)),g=Math.sin(r._pitch)*p+u;return Math.min(1.01*g,u*(1/r._horizonShift))}function mc(r,t){if(!t.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:t};const i=Math.pow(2,-r.z),a=r.x*i,u=(r.x+1)*i,p=r.y*i,g=(r.y+1)*i,v=lo(a),w=lo(u),E=ni(p),C=ni(g),I=t.project(v,E),k=t.project(w,E),D=t.project(w,C),L=t.project(v,C);let F=Math.min(I.x,k.x,D.x,L.x),q=Math.min(I.y,k.y,D.y,L.y),re=Math.max(I.x,k.x,D.x,L.x),de=Math.max(I.y,k.y,D.y,L.y);const oe=i/16;function he(fe,Re,Me,Ue,rt,Oe){const We=(Me+rt)/2,Ze=(Ue+Oe)/2,Ke=t.project(lo(We),ni(Ze)),st=Math.max(0,F-Ke.x,q-Ke.y,Ke.x-re,Ke.y-de);F=Math.min(F,Ke.x),re=Math.max(re,Ke.x),q=Math.min(q,Ke.y),de=Math.max(de,Ke.y),st>oe&&(he(fe,Ke,Me,Ue,We,Ze),he(Ke,Re,We,Ze,rt,Oe))}he(I,k,a,p,u,p),he(k,D,u,p,u,g),he(D,L,u,g,a,g),he(L,I,a,g,a,p),F-=oe,q-=oe,re+=oe,de+=oe;const me=1/Math.max(re-F,de-q);return{scale:me,x:F*me,y:q*me,x2:re*me,y2:de*me,projection:t}}const BP=as(new Float32Array(16));class tl{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new Mn(0,0)}projectTilePoint(t,i,a){return{x:t,y:i,z:0}}locationPoint(t,i,a=!0){return t._coordinatePoint(t.locationCoordinate(i),a)}pixelsPerMeter(t,i){return cs(1,t)*i}pixelSpaceConversion(t,i,a){return 1}farthestPixelDistance(t){return z2(t,t.pixelsPerMeter)}pointCoordinate(t,i,a,u){const p=t.horizonLineFromTop(!1),g=new Ie(i,Math.max(p,a));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,u))}pointCoordinate3D(t,i,a){const u=new Ie(i,a);if(t.elevation)return t.elevation.pointCoordinate(u);{const p=this.pointCoordinate(t,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const a=t.horizonLineFromTop();return i.y<a}createInversionMatrix(t,i){return BP}createTileMatrix(t,i,a){let u,p,g;const v=a.canonical,w=as(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=mc(v,this);u=1,p=E.x+a.wrap*E.scale,g=E.y,lc(w,w,[u/E.scale,u/E.scale,t.pixelsPerMeter/i])}else u=i/t.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*a.wrap)*u,g=v.y*u;return jd(w,w,[p,g,0]),lc(w,w,[u/It,u/It,1]),w}upVector(t,i,a){return[0,0,1]}upVectorScale(t,i,a){return{metersToTile:1}}}class FP extends tl{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,a]=this.parallels=t.parallels||[29.5,45.5],u=Math.sin(ht(i));this.n=(u+Math.sin(ht(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:a,c:u,r0:p}=this,g=ht(t-this.center[0]),v=ht(i),w=Math.sqrt(u-2*a*Math.sin(v))/a;return{x:w*Math.sin(g*a),y:w*Math.cos(g*a)-p,z:0}}unproject(t,i){const{n:a,c:u,r0:p}=this,g=p+i;let v=Math.atan2(t,Math.abs(g))*Math.sign(g);g*a<0&&(v-=Math.PI*Math.sign(t)*Math.sign(g));const w=ht(this.center[0])*a;v=bt(v,-Math.PI-w,Math.PI-w);const E=qe(Ht(v/a)+this.center[0],-180,180),C=Math.asin(qe((u-(t*t+g*g)*a*a)/(2*a),-1,1)),I=qe(Ht(C),-ri,ri);return new Mn(E,I)}}const up=1.340264,hp=-.081106,dp=893e-6,pp=.003796,rg=Math.sqrt(3)/2;class NP extends tl{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const a=Math.asin(rg*Math.sin(i)),u=a*a,p=u*u*u;return{x:.5*(t*Math.cos(a)/(rg*(up+3*hp*u+p*(7*dp+9*pp*u)))/Math.PI+.5),y:1-.5*(a*(up+hp*u+p*(dp+pp*u))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=a*a,p=u*u*u;for(let C,I,k,D=0;D<12&&(I=a*(up+hp*u+p*(dp+pp*u))-i,k=up+3*hp*u+p*(7*dp+9*pp*u),C=I/k,a=qe(a-C,-Math.PI/3,Math.PI/3),u=a*a,p=u*u*u,!(Math.abs(C)<1e-12));++D);const g=rg*t*(up+3*hp*u+p*(7*dp+9*pp*u))/Math.cos(a),v=Math.asin(Math.sin(a)/rg),w=qe(180*g/Math.PI,-180,180),E=qe(180*v/Math.PI,-ri,ri);return new Mn(w,E)}}class jP extends tl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const a=360*(t-.5),u=qe(360*(.5-i),-ri,ri);return new Mn(a,u)}}const Lu=Math.PI/2;function ig(r){return Math.tan((Lu+r)/2)}class UP extends tl{constructor(t){super(t),this.center=t.center||[0,30];const[i,a]=this.parallels=t.parallels||[30,30];let u=ht(i),p=ht(a);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const g=Math.cos(u),v=ig(u);this.n=u===p?Math.sin(u):Math.log(g/Math.cos(p))/Math.log(ig(p)/v),this.f=g*Math.pow(ig(u),this.n)/this.n}project(t,i){i=ht(i),this.southernCenter&&(i=-i),t=ht(t-this.center[0]);const a=1e-6,{n:u,f:p}=this;p>0?i<-Lu+a&&(i=-Lu+a):i>Lu-a&&(i=Lu-a);const g=p/Math.pow(ig(i),u);let v=g*Math.sin(u*t),w=p-g*Math.cos(u*t);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:u}=this,p=u-i,g=Math.sign(p),v=Math.sign(a)*Math.sqrt(t*t+p*p);let w=Math.atan2(t,Math.abs(p))*g;p*a<0&&(w-=Math.PI*Math.sign(t)*g);const E=qe(Ht(w/a)+this.center[0],-180,180),C=qe(Ht(2*Math.atan(Math.pow(u/v,1/a))-Lu),-ri,ri);return new Mn(E,this.southernCenter?-C:C)}}class R2 extends tl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:As(t),y:Ms(i),z:0}}unproject(t,i){const a=lo(t),u=ni(i);return new Mn(a,u)}}const D2=ht(ri);class VP extends tl{project(t,i){const a=(i=ht(i))*i,u=a*a;return{x:.5*((t=ht(t))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=25,p=0,g=a*a;do{g=a*a;const E=g*g;p=(a*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),a=qe(a-p,-D2,D2)}while(Math.abs(p)>1e-6&&--u>0);g=a*a;const v=qe(Ht(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=Ht(a);return new Mn(v,w)}}const L2=ht(ri);class $P extends tl{project(t,i){i=ht(i),t=ht(t);const a=Math.cos(i),u=2/Math.PI,p=Math.acos(a*Math.cos(t/2)),g=Math.sin(p)/p,v=.5*(t*u+2*a*Math.sin(t/2)/g)||0,w=.5*(i+Math.sin(i)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(t,i){let a=t=(2*t-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let v=0,w=0;do{const E=Math.cos(u),C=Math.sin(u),I=2*C*E,k=C*C,D=E*E,L=Math.cos(a/2),F=Math.sin(a/2),q=2*L*F,re=F*F,de=1-D*L*L,oe=de?1/de:0,he=de?Math.acos(E*L)*Math.sqrt(1/de):0,me=.5*(2*he*E*F+2*a/Math.PI)-t,fe=.5*(he*C+u)-i,Re=.5*oe*(D*re+he*E*L*k)+1/Math.PI,Me=oe*(q*I/4-he*C*F),Ue=.125*oe*(I*F-he*C*D*q),rt=.5*oe*(k*L+he*re*E)+.5,Oe=Me*Ue-rt*Re;v=(fe*Me-me*rt)/Oe,w=(me*Ue-fe*Re)/Oe,a=qe(a-v,-Math.PI,Math.PI),u=qe(u-w,-L2,L2)}while((Math.abs(v)>g||Math.abs(w)>g)&&--p>0);return new Mn(Ht(a),Ht(u))}}class O2 extends tl{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ht(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:a,cosPhi:u}=this;return{x:ht(t)*u*a+.5,y:-Math.sin(ht(i))/u*a+.5,z:0}}unproject(t,i){const{scale:a,cosPhi:u}=this,p=-(i-.5)/a,g=qe(Ht((t-.5)/a)/u,-180,180),v=Math.asin(qe(p*u,-1,1)),w=qe(Ht(v),-ri,ri);return new Mn(g,w)}}class GP extends R2{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,a){const u=Hd(t,i,a);return or(u,u,Xd(Cs(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(t,i){const a=xu(i.lat,i.lng),u=vi([],a),p=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;Gd(a,a,u,cs(1,0)*It*p);const g=as(new Float64Array(16));return ac(g,t.pixelMatrix,t.globeMatrix),or(a,a,g),new Ie(a[0],a[1])}pixelsPerMeter(t,i){return cs(1,0)*i}pixelSpaceConversion(t,i,a){const u=cs(1,t)*i,p=ln(cs(1,45)*i,u,a);return this.pixelsPerMeter(t,i)/p}createTileMatrix(t,i,a){const u=p0(Cs(a.canonical));return ac(new Float64Array(16),t.globeMatrix,u)}createInversionMatrix(t,i){const{center:a}=t,u=Xd(Cs(i));return zm(u,u,ht(a.lng)),r0(u,u,ht(a.lat)),lc(u,u,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(t,i,a,u){return cb(t,i,a,!0)||new bu(0,0)}pointCoordinate3D(t,i,a){const u=this.pointCoordinate(t,i,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(t,i){return!cb(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(u,p){const g=u.cameraToCenterDistance,v=u._centerAltitude*p,w=u._camera,E=u._camera.forward(),C=ia([],ao([],E,-g),[0,0,v]),I=u.worldSize/(2*Math.PI),k=[0,0,-I],D=u.width/u.height,L=Math.tan(u.fovAboveCenter),F=ao([],w.up(),L),q=ao([],w.right(),L*D),re=vi([],ia([],ia([],E,F),q)),de=[];let oe;if(new a0(C,re).closestPointOnSphere(k,I,de)){const he=ia([],de,k),me=ls([],he,C);oe=Math.cos(u.fovAboveCenter)*Ud(me)}else{const he=ls([],C,k),me=ls([],k,C);vi(me,me);const fe=Ud(he)-I;oe=Math.sqrt(fe*(fe+2*I));const Re=Math.acos(oe/(I+fe))-Math.acos(zo(E,me));oe*=Math.cos(Re)}return 1.01*oe}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),a=wu(t.zoom);if(a>0){const u=z2(t,cs(1,t.center.lat)*t.worldSize),p=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ln(i,u+p*(1-Math.cos(g)),Math.pow(a,10))}return i}upVector(t,i,a){return Hd(i,a,t,1)}upVectorScale(t){return{metersToTile:Rm(Lm(Cs(t)))}}}function B2(r){const t=r.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(r.name){case"mercator":return new R2(r);case"equirectangular":return new jP(r);case"naturalEarth":return new VP(r);case"equalEarth":return new NP(r);case"winkelTripel":return new $P(r);case"albers":return i?new O2(r):new FP(r);case"lambertConformalConic":return i?new O2(r):new UP(r);case"globe":return new GP(r)}throw new Error(`Invalid projection name: ${r.name}`)}const qP=qm.types,WP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function og(r,t,i,a,u,p,g,v,w,E,C,I,k){const D=v?Math.min(el,Math.round(v[0])):0,L=v?Math.min(el,Math.round(v[1])):0;r.emplaceBack(t,i,Math.round(32*a),Math.round(32*u),p,g,(D<<1)+(w?1:0),L,16*E,16*C,256*I,256*k)}function sg(r,t,i,a,u,p,g){r.emplaceBack(t,i,a,u,p,g)}function ag(r,t,i,a,u){r.emplaceBack(t,i,a,u),r.emplaceBack(t,i,a,u),r.emplaceBack(t,i,a,u),r.emplaceBack(t,i,a,u)}function ZP(r){for(const t of r.sections)if(Jy(t.text))return!0;return!1}class G0{constructor(t){this.layoutVertexArray=new Xe,this.indexArray=new Tt,this.programConfigurations=t,this.segments=new pr,this.dynamicLayoutVertexArray=new Qe,this.opacityVertexArray=new Ct,this.placedSymbolArray=new dr,this.globeExtVertexArray=new ot}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tP.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,rP.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,WP,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,nP.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}vt(G0,"SymbolBuffers");class q0{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new pr,this.collisionVertexArray=new nn,this.collisionVertexArrayExt=new Jt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,iP.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,oP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}vt(q0,"CollisionBuffers");class nl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=as([]),this.placementViewportMatrix=as([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=R0(this.zoom,i["text-size"]),this.iconSizeData=R0(this.zoom,i["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>co[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new G0(new sc(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new G0(new sc(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new yi,this.lineVertexArray=new mu,this.symbolInstances=new qn}calculateGlyphDependencies(t,i,a,u,p){for(let g=0;g<t.length;g++)if(i[t.charCodeAt(g)]=!0,u&&p){const v=sp[t.charAt(g)];v&&(i[v.charCodeAt(0)]=!0)}}populate(t,i,a,u){const p=this.layers[0],g=p.layout,v=this.projection.name==="globe",w=g.get("text-font"),E=g.get("text-field"),C=g.get("icon-image"),I=(E.value.kind!=="constant"||E.value.value instanceof _i&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),k=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,D=g.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const L=i.iconDependencies,F=i.glyphDependencies,q=i.availableImages,re=new M(this.zoom);for(const{feature:de,id:oe,index:he,sourceLayerIndex:me}of t){const fe=p._featureFilter.needGeometry,Re=dc(de,fe);if(!p._featureFilter.filter(re,Re,a))continue;if(fe||(Re.geometry=oa(de,a,u)),v&&de.type!==1&&a.z<=5){const Oe=Re.geometry,We=.98078528056,Ze=(Ke,st)=>zo(Hd(Ke.x,Ke.y,a,1),Hd(st.x,st.y,a,1))<We;for(let Ke=0;Ke<Oe.length;Ke++)Oe[Ke]=rk(Oe[Ke],Ze)}let Me,Ue;if(I){const Oe=p.getValueAndResolveTokens("text-field",Re,a,q),We=_i.factory(Oe);ZP(We)&&(this.hasRTLText=!0),(!this.hasRTLText||x()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Me=lP(We,p,Re))}if(k){const Oe=p.getValueAndResolveTokens("icon-image",Re,a,q);Ue=Oe instanceof Vi?Oe:Vi.fromString(Oe)}if(!Me&&!Ue)continue;const rt=this.sortFeaturesByKey?D.evaluate(Re,{},a):void 0;if(this.features.push({id:oe,text:Me,icon:Ue,index:he,sourceLayerIndex:me,geometry:Re.geometry,properties:de.properties,type:qP[de.type],sortKey:rt}),Ue&&(L[Ue.name]=!0),Me){const Oe=w.evaluate(Re,{},a).join(","),We=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(co.vertical)>=0;for(const Ze of Me.sections)if(Ze.image)L[Ze.image.name]=!0;else{const Ke=Rd(Me.toString()),st=Ze.fontStack||Oe,Ne=F[st]=F[st]||{};this.calculateGlyphDependencies(Ze.text,Ne,We,this.allowVerticalPlacement,Ke)}}}g.get("symbol-placement")==="line"&&(this.features=function(de){const oe={},he={},me=[];let fe=0;function Re(Oe){me.push(de[Oe]),fe++}function Me(Oe,We,Ze){const Ke=he[Oe];return delete he[Oe],he[We]=Ke,me[Ke].geometry[0].pop(),me[Ke].geometry[0]=me[Ke].geometry[0].concat(Ze[0]),Ke}function Ue(Oe,We,Ze){const Ke=oe[We];return delete oe[We],oe[Oe]=Ke,me[Ke].geometry[0].shift(),me[Ke].geometry[0]=Ze[0].concat(me[Ke].geometry[0]),Ke}function rt(Oe,We,Ze){const Ke=Ze?We[0][We[0].length-1]:We[0][0];return`${Oe}:${Ke.x}:${Ke.y}`}for(let Oe=0;Oe<de.length;Oe++){const We=de[Oe],Ze=We.geometry,Ke=We.text?We.text.toString():null;if(!Ke){Re(Oe);continue}const st=rt(Ke,Ze),Ne=rt(Ke,Ze,!0);if(st in he&&Ne in oe&&he[st]!==oe[Ne]){const pt=Ue(st,Ne,Ze),wt=Me(st,Ne,me[pt].geometry);delete oe[st],delete he[Ne],he[rt(Ke,me[wt].geometry,!0)]=wt,me[pt].geometry=null}else st in he?Me(st,Ne,Ze):Ne in oe?Ue(st,Ne,Ze):(Re(Oe),oe[st]=fe-1,he[Ne]=fe-1)}return me.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,oe)=>de.sortKey-oe.sortKey)}update(t,i,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=B2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,u,p,g,v,w,E,C,I,k,D,L){const F=t.indexArray,q=t.layoutVertexArray,re=t.globeExtVertexArray,de=t.segments.prepareSegment(4*i.length,q,F,this.canOverlap?g.sortKey:void 0),oe=this.glyphOffsetArray.length,he=de.vertexLength,me=this.allowVerticalPlacement&&v===co.vertical?Math.PI/2:0,fe=g.text&&g.text.sections;for(let Me=0;Me<i.length;Me++){const{tl:Ue,tr:rt,bl:Oe,br:We,tex:Ze,pixelOffsetTL:Ke,pixelOffsetBR:st,minFontScaleX:Ne,minFontScaleY:pt,glyphOffset:wt,isSDF:mt,sectionIndex:Nt}=i[Me],lt=de.vertexLength,At=wt[1];if(og(q,E.x,E.y,Ue.x,At+Ue.y,Ze.x,Ze.y,a,mt,Ke.x,Ke.y,Ne,pt),og(q,E.x,E.y,rt.x,At+rt.y,Ze.x+Ze.w,Ze.y,a,mt,st.x,Ke.y,Ne,pt),og(q,E.x,E.y,Oe.x,At+Oe.y,Ze.x,Ze.y+Ze.h,a,mt,Ke.x,st.y,Ne,pt),og(q,E.x,E.y,We.x,At+We.y,Ze.x+Ze.w,Ze.y+Ze.h,a,mt,st.x,st.y,Ne,pt),w){const{x:jt,y:un,z:Ut}=w.anchor,[Pt,$n,qt]=w.up;sg(re,jt,un,Ut,Pt,$n,qt),sg(re,jt,un,Ut,Pt,$n,qt),sg(re,jt,un,Ut,Pt,$n,qt),sg(re,jt,un,Ut,Pt,$n,qt),ag(t.dynamicLayoutVertexArray,jt,un,Ut,me)}else ag(t.dynamicLayoutVertexArray,E.x,E.y,E.z,me);F.emplaceBack(lt,lt+1,lt+2),F.emplaceBack(lt+1,lt+2,lt+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Me!==i.length-1&&Nt===i[Me+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,g,g.index,{},D,L,fe&&fe[Nt])}const Re=w?w.anchor:E;t.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,E.x,E.y,oe,this.glyphOffsetArray.length-oe,he,C,I,E.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],v,0,!1,0,k,0)}_commitLayoutVertex(t,i,a,u,p,g,v){t.emplaceBack(i,a,u,p,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,i,a,u,p,g,v){const w=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),E=w.vertexLength,C=v.tileAnchorX,I=v.tileAnchorY;for(let D=0;D<4;D++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(i,-t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(i,t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(i,t.padding,t.padding),a.collisionVertexArrayExt.emplaceBack(i,-t.padding,t.padding),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,C,I,new Ie(t.x1,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,C,I,new Ie(t.x2,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,C,I,new Ie(t.x2,t.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,C,I,new Ie(t.x1,t.y2)),w.vertexLength+=4;const k=a.indexArray;k.emplaceBack(E,E+1),k.emplaceBack(E+1,E+2),k.emplaceBack(E+2,E+3),k.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,a,u,p,g){for(let v=u;v<p;v++){const w=a.get(v),E=this.getSymbolInstanceTextSize(t,g,i,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,i,a,u,p,g){for(let v=u;v<p;v++){const w=a.get(v),E=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new q0(xt,n2.members,Fr),this.iconCollisionBox=new q0(xt,n2.members,Fr);const a=Au(this.iconSizeData,t),u=Au(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,i,a,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=Xm(this.textSizeData,t,p)/Zr;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,i,a){const u=this.icon.placedSymbolArray.get(a),p=Xm(this.iconSizeData,t,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,i,a){t.emplaceBack(i,-a,-a),t.emplaceBack(i,a,-a),t.emplaceBack(i,a,a),t.emplaceBack(i,-a,a)}_updateTextDebugCollisionBoxes(t,i,a,u,p,g){for(let v=u;v<p;v++){const w=a.get(v),E=this.getSymbolInstanceTextSize(t,g,i,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(t,i,a,u,p,g){for(let v=u;v<p;v++){const w=a.get(v),E=this.getSymbolInstanceIconSize(t,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Au(this.iconSizeData,t),u=Au(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,a,u,p,g,v,w,E){const C={};if(i<a){const{x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he,featureIndex:me}=t.get(i);C.textBox={x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he},C.textFeatureIndex=me}if(u<p){const{x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he,featureIndex:me}=t.get(u);C.verticalTextBox={x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he},C.verticalTextFeatureIndex=me}if(g<v){const{x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he,featureIndex:me}=t.get(g);C.iconBox={x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he},C.iconFeatureIndex=me}if(w<E){const{x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he,featureIndex:me}=t.get(w);C.verticalIconBox={x1:I,y1:k,x2:D,y2:L,padding:F,projectedAnchorX:q,projectedAnchorY:re,projectedAnchorZ:de,tileAnchorX:oe,tileAnchorY:he},C.verticalIconFeatureIndex=me}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),u=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),u=[],p=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const w=this.symbolInstances.get(v);u.push(0|Math.round(i*w.tileAnchorX+a*w.tileAnchorY)),p.push(w.featureIndex)}return g.sort((v,w)=>u[v]-u[w]||p[w]-p[v]),g}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}vt(nl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nl.MAX_GLYPHS=65535,nl.addDynamicAttributes=ag;const HP=new le({"symbol-placement":new B(je.layout_symbol["symbol-placement"]),"symbol-spacing":new B(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new B(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new W(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new B(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new B(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new B(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new B(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new B(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new W(je.layout_symbol["icon-size"]),"icon-text-fit":new B(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new B(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new W(je.layout_symbol["icon-image"]),"icon-rotate":new W(je.layout_symbol["icon-rotate"]),"icon-padding":new B(je.layout_symbol["icon-padding"]),"icon-keep-upright":new B(je.layout_symbol["icon-keep-upright"]),"icon-offset":new W(je.layout_symbol["icon-offset"]),"icon-anchor":new W(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new B(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new B(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new B(je.layout_symbol["text-rotation-alignment"]),"text-field":new W(je.layout_symbol["text-field"]),"text-font":new W(je.layout_symbol["text-font"]),"text-size":new W(je.layout_symbol["text-size"]),"text-max-width":new W(je.layout_symbol["text-max-width"]),"text-line-height":new W(je.layout_symbol["text-line-height"]),"text-letter-spacing":new W(je.layout_symbol["text-letter-spacing"]),"text-justify":new W(je.layout_symbol["text-justify"]),"text-radial-offset":new W(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new B(je.layout_symbol["text-variable-anchor"]),"text-anchor":new W(je.layout_symbol["text-anchor"]),"text-max-angle":new B(je.layout_symbol["text-max-angle"]),"text-writing-mode":new B(je.layout_symbol["text-writing-mode"]),"text-rotate":new W(je.layout_symbol["text-rotate"]),"text-padding":new B(je.layout_symbol["text-padding"]),"text-keep-upright":new B(je.layout_symbol["text-keep-upright"]),"text-transform":new W(je.layout_symbol["text-transform"]),"text-offset":new W(je.layout_symbol["text-offset"]),"text-allow-overlap":new B(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new B(je.layout_symbol["text-ignore-placement"]),"text-optional":new B(je.layout_symbol["text-optional"])});var W0={paint:new le({"icon-opacity":new W(je.paint_symbol["icon-opacity"]),"icon-color":new W(je.paint_symbol["icon-color"]),"icon-halo-color":new W(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new W(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new W(je.paint_symbol["icon-halo-blur"]),"icon-translate":new B(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new B(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new W(je.paint_symbol["text-opacity"]),"text-color":new W(je.paint_symbol["text-color"],{runtimeType:Di,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new W(je.paint_symbol["text-halo-color"]),"text-halo-width":new W(je.paint_symbol["text-halo-width"]),"text-halo-blur":new W(je.paint_symbol["text-halo-blur"]),"text-translate":new B(je.paint_symbol["text-translate"]),"text-translate-anchor":new B(je.paint_symbol["text-translate-anchor"])}),layout:HP};class F2{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:za,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vt(F2,"FormatSectionOverride",{omit:["defaultValue"]});class lg extends ss{constructor(t){super(t,W0)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const p of a)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,u){const p=this.layout.get(t).evaluate(i,{},a,u),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Ga(g.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,C)=>C in v?String(v[C]):"")}(i.properties,p)}createBucket(t){return new nl(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of W0.paint.overridableProperties){if(!lg.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new F2(i),u=new au(a,i.property.specification);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new bd("source",u):new Yl("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new X(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&lg.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),u=W0.paint.properties[i];let p=!1;const g=v=>{for(const w of v)if(u.overrides&&u.overrides.hasOverride(w))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof _i)g(a.value.value.sections);else if(a.value.kind==="source"){const v=E=>{p||(E instanceof Zs&&er(E.value)===Dl?g(E.value.sections):E instanceof bs?g(E.sections):E.eachChild(v))},w=a.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramConfiguration(t){return new Ya(this,t)}}var XP={paint:new le({"background-color":new B(je.paint_background["background-color"]),"background-pattern":new B(je.paint_background["background-pattern"]),"background-opacity":new B(je.paint_background["background-opacity"])})},KP={paint:new le({"raster-opacity":new B(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new B(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new B(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new B(je.paint_raster["raster-brightness-max"]),"raster-saturation":new B(je.paint_raster["raster-saturation"]),"raster-contrast":new B(je.paint_raster["raster-contrast"]),"raster-resampling":new B(je.paint_raster["raster-resampling"]),"raster-fade-duration":new B(je.paint_raster["raster-fade-duration"])})};class YP extends ss{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var JP={paint:new le({"sky-type":new B(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new B(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new B(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new B(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new B(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new ae(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new B(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new B(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new B(je.paint_sky["sky-opacity"])})};function Z0(r,t,i){const a=[0,0,1],u=rb([]);return ob(u,u,i?-ht(r)+Math.PI:ht(r)),ib(u,u,-ht(t)),Qw(a,a,u),vi(a,a)}const QP={circle:class extends ss{constructor(r){super(r,uk)}createBucket(r){return new v0(r)}queryRadius(r){const t=r;return Eu("circle-radius",this,t)+Eu("circle-stroke-width",this,t)+Fm(this.paint.get("circle-translate"))}queryIntersectsFeature(r,t,i,a,u,p,g,v){const w=Ab(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Mb(r,a,p,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Ya(this,r)}},heatmap:class extends ss{createBucket(r){return new kb(r)}constructor(r){super(r,fk),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=E0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Eu("heatmap-radius",this,r)}queryIntersectsFeature(r,t,i,a,u,p,g,v){const w=this.paint.get("heatmap-radius").evaluate(t,i);return Mb(r,a,p,g,v,!0,!0,new Ie(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Ya(this,r)}},hillshade:class extends ss{constructor(r){super(r,mk)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ss{constructor(r){super(r,Pk)}getProgramIds(){const r=this.paint.get("fill-pattern"),t=r&&r.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(r){return new Ya(this,r)}recalculate(r,t){super.recalculate(r,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new $m(r)}queryRadius(){return Fm(this.paint.get("fill-translate"))}queryIntersectsFeature(r,t,i,a,u,p){return!r.queryGeometry.isAboveHorizon&&bb(Cb(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends ss{constructor(r){super(r,Zk)}createBucket(r){return new rp(r)}queryRadius(){return Fm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Ya(this,r)}queryIntersectsFeature(r,t,i,a,u,p,g,v,w){const E=Ab(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(t,i),I=this.paint.get("fill-extrusion-base").evaluate(t,i),k=[0,0],D=v&&p.elevation,L=p.elevation?p.elevation.exaggeration():1,F=r.tile.getBucket(this);if(D&&F instanceof rp){const he=F.centroidVertexArray,me=w+1;me<he.length&&(k[0]=he.geta_centroid_pos0(me),k[1]=he.geta_centroid_pos1(me))}if(k[0]===0&&k[1]===1)return!1;p.projection.name==="globe"&&(a=Hb([a],[new Ie(0,0),new Ie(It,It)],r.tileID.canonical).map(he=>he.polygon).flat());const q=D?v:null,[re,de]=function(he,me,fe,Re,Me,Ue,rt,Oe,We,Ze,Ke){return he.projection.name==="globe"?function(st,Ne,pt,wt,mt,Nt,lt,At,jt,un,Ut){const Pt=[],$n=[],qt=st.projection.upVectorScale(Ut,st.center.lat,st.worldSize).metersToTile,Wt=[0,0,0,1],In=[0,0,0,1],Bn=(kn,Kn,tr,mr)=>{kn[0]=Kn,kn[1]=tr,kn[2]=mr,kn[3]=1},Fn=Zb();pt>0&&(pt+=Fn),wt+=Fn;for(const kn of Ne){const Kn=[],tr=[];for(const mr of kn){const Pn=mr.x+mt.x,br=mr.y+mt.y,gr=st.projection.projectTilePoint(Pn,br,Ut),Yn=st.projection.upVector(Ut,mr.x,mr.y);let dn=pt,_r=wt;if(lt){const Nn=Jb(Pn,br,pt,wt,lt,At,jt,un);dn+=Nn.base,_r+=Nn.top}pt!==0?Bn(Wt,gr.x+Yn[0]*qt*dn,gr.y+Yn[1]*qt*dn,gr.z+Yn[2]*qt*dn):Bn(Wt,gr.x,gr.y,gr.z),Bn(In,gr.x+Yn[0]*qt*_r,gr.y+Yn[1]*qt*_r,gr.z+Yn[2]*qt*_r),or(Wt,Wt,Nt),or(In,In,Nt),Kn.push(new Cu(Wt[0],Wt[1],Wt[2])),tr.push(new Cu(In[0],In[1],In[2]))}Pt.push(Kn),$n.push(tr)}return[Pt,$n]}(he,me,fe,Re,Me,Ue,rt,Oe,We,Ze,Ke):rt?function(st,Ne,pt,wt,mt,Nt,lt,At,jt){const un=[],Ut=[],Pt=[0,0,0,1];for(const $n of st){const qt=[],Wt=[];for(const In of $n){const Bn=In.x+wt.x,Fn=In.y+wt.y,kn=Jb(Bn,Fn,Ne,pt,Nt,lt,At,jt);Pt[0]=Bn,Pt[1]=Fn,Pt[2]=kn.base,Pt[3]=1,cc(Pt,Pt,mt),Pt[3]=Math.max(Pt[3],1e-5);const Kn=new Cu(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Pt[0]=Bn,Pt[1]=Fn,Pt[2]=kn.top,Pt[3]=1,cc(Pt,Pt,mt),Pt[3]=Math.max(Pt[3],1e-5);const tr=new Cu(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);qt.push(Kn),Wt.push(tr)}un.push(qt),Ut.push(Wt)}return[un,Ut]}(me,fe,Re,Me,Ue,rt,Oe,We,Ze):function(st,Ne,pt,wt,mt){const Nt=[],lt=[],At=mt[8]*Ne,jt=mt[9]*Ne,un=mt[10]*Ne,Ut=mt[11]*Ne,Pt=mt[8]*pt,$n=mt[9]*pt,qt=mt[10]*pt,Wt=mt[11]*pt;for(const In of st){const Bn=[],Fn=[];for(const kn of In){const Kn=kn.x+wt.x,tr=kn.y+wt.y,mr=mt[0]*Kn+mt[4]*tr+mt[12],Pn=mt[1]*Kn+mt[5]*tr+mt[13],br=mt[2]*Kn+mt[6]*tr+mt[14],gr=mt[3]*Kn+mt[7]*tr+mt[15],Yn=mr+At,dn=Pn+jt,_r=br+un,Nn=Math.max(gr+Ut,1e-5),bi=mr+Pt,yr=Pn+$n,Hr=br+qt,Nr=Math.max(gr+Wt,1e-5);Bn.push(new Cu(Yn/Nn,dn/Nn,_r/Nn)),Fn.push(new Cu(bi/Nr,yr/Nr,Hr/Nr))}Nt.push(Bn),lt.push(Fn)}return[Nt,lt]}(me,fe,Re,Me,Ue)}(p,a,I,C,E,g,q,k,L,p.center.lat,r.tileID.canonical),oe=r.queryGeometry;return function(he,me,fe){let Re=1/0;bb(fe,me)&&(Re=Yb(fe,me[0]));for(let Me=0;Me<me.length;Me++){const Ue=me[Me],rt=he[Me];for(let Oe=0;Oe<Ue.length-1;Oe++){const We=Ue[Oe],Ze=[We,Ue[Oe+1],rt[Oe+1],rt[Oe],We];wb(fe,Ze)&&(Re=Math.min(Re,Yb(fe,Ze)))}}return Re!==1/0&&Re}(re,de,oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends ss{constructor(r){super(r,Qb),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof cd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,t){super.recalculate(r,t),this.paint._values["line-floorwidth"]=e2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Hm(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new Ya(this,r)}queryRadius(r){const t=r,i=t2(Eu("line-width",this,t),Eu("line-gap-width",this,t)),a=Eu("line-offset",this,t);return i/2+Math.abs(a)+Fm(this.paint.get("line-translate"))}queryIntersectsFeature(r,t,i,a,u,p){if(r.queryGeometry.isAboveHorizon)return!1;const g=Cb(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),v=r.pixelToTileUnitsFactor/2*t2(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),w=this.paint.get("line-offset").evaluate(t,i);return w&&(a=function(E,C){const I=[],k=new Ie(0,0);for(let D=0;D<E.length;D++){const L=E[D],F=[];for(let q=0;q<L.length;q++){const re=L[q],de=L[q+1],oe=q===0?k:re.sub(L[q-1])._unit()._perp(),he=q===L.length-1?k:de.sub(re)._unit()._perp(),me=oe._add(he)._unit();me._mult(1/(me.x*he.x+me.y*he.y)),F.push(me._mult(C)._add(re))}I.push(F)}return I}(a,w*r.pixelToTileUnitsFactor)),function(E,C,I){for(let k=0;k<C.length;k++){const D=C[k];if(E.length>=3){for(let L=0;L<D.length;L++)if(pc(E,D[L]))return!0}if(sk(E,D,I))return!0}return!1}(g,a,v)}isTileClipped(){return!0}},symbol:lg,background:class extends ss{constructor(r){super(r,XP)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ss{constructor(r){super(r,KP)}getProgramIds(){return["raster"]}},sky:class extends ss{constructor(r){super(r,JP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=E0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(r,t){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,p=r.style.light,g=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&gn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Z0(g.azimuthal,90-g.polar,t):Z0(a[0],90-a[1],t)}const i=this.paint.get("sky-gradient-center");return Z0(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}}};class fp{constructor(t,i,a,u){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(i,u)}update(t,i,a){const{width:u,height:p}=t,{context:g}=this,{gl:v}=g,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:C,ImageData:I,ImageBitmap:k}=A;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!i||i.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===p){const{x:D,y:L}=a||{x:0,y:0};t instanceof w||t instanceof E||t instanceof C||t instanceof I||k&&t instanceof k?v.texSubImage2D(v.TEXTURE_2D,0,D,L,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,D,L,u,p,v.RGBA,v.UNSIGNED_BYTE,t.data)}else this.size=[u,p],t instanceof w||t instanceof E||t instanceof C||t instanceof I||k&&t instanceof k?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,u,p,0,this.format,v.UNSIGNED_BYTE,t.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(t,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),t!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?t===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:t),this.filter=t),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class ez{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class tz{constructor(){this.tasks={},this.taskQueue=[],Ar(["process"],this),this.invoker=new ez(this.process),this.nextId=0}add(t,i){const a=this.nextId++,u=function({type:p,isSymbolTile:g,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-v:p==="maybePrepare"&&g?400-v:500:200-v:100-v}(i);if(u===0){Qr();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:t,metadata:i,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Qr();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,t=u)}if(t===null)return null;const a=this.taskQueue[t];return this.taskQueue.splice(t,1),a}remove(){this.invoker.remove()}}class N2{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const nz=["tile","layer","source","sourceLayer","state"];class j2{constructor(t,i,a,u,p){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=a,this._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const i of nz)this[i]!==void 0&&(t[i]=this[i]);return t}}const Lo=32,Is=33,rl=new Uint16Array(8184);for(let r=0;r<2046;r++){let t=r+2,i=0,a=0,u=0,p=0,g=0,v=0;for(1&t?u=p=g=Lo:i=a=v=Lo;(t>>=1)>1;){const E=i+u>>1,C=a+p>>1;1&t?(u=i,p=a,i=g,a=v):(i=u,a=p,u=g,p=v),g=E,v=C}const w=4*r;rl[w+0]=i,rl[w+1]=a,rl[w+2]=u,rl[w+3]=p}const ks=new Uint16Array(2178),il=new Uint8Array(1089),cg=new Uint16Array(1089);function U2(r){return r===0?-.03125:r===32?.03125:0}var V2=Ee([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $2={type:2,extent:It,loadGeometry:()=>[[new Ie(0,0),new Ie(It+1,0),new Ie(It+1,It+1),new Ie(0,It+1),new Ie(0,0)]]};class H0{constructor(t,i,a,u,p){this.tileID=t,this.uid=cr(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<Ho.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,a){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,p){const g={};if(!p)return g;for(const v of u){const w=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>w.filter(C=>C.id===E)[0]));for(const E of w)g[E.id]=v}}return g}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof nl){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof nl&&p.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||x()!=="deferred"||T();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new An}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fp(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fp(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new fp(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,a,u,p,g,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:v,transform:g,params:p,tileTransform:this.tileTransform},t,i,a):{}}querySourceFeatures(t,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),p=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[p];if(!g)return;const v=hu(i&&i.filter),{z:w,x:E,y:C}=this.tileID.canonical,I={z:w,x:E,y:C};for(let k=0;k<g.length;k++){const D=g.feature(k);if(v.needGeometry){const q=dc(D,!0);if(!v.filter(new M(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new M(this.tileID.overscaledZ),D))continue;const L=a.getId(D,p),F=new j2(D,w,E,C,L);F.tile=I,t.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const a=Mr(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const p=this.expirationTime-i;p?this.expirationTime=a+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!i)return;const a=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],v=g.layers[0].sourceLayer||"_geojsonTileLayer",w=a[v],E=t[v];if(!w||!E||Object.keys(E).length===0)continue;if(g.update(E,w,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Hm||g instanceof $m){const I=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&I&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(I.id,this.tileID)}const C=i&&i.style&&i.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ho.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Ho.now()+t}setTexture(t,i){const a=i.context,u=a.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new fp(a,t,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(t,i){const a={};for(const u of i)a[u]=!0;this.dependencies[t]=a}hasDependency(t,i){for(const a of t){const u=this.dependencies[a];if(u){for(const p of i)if(u[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const a=oa($2,this.tileID.canonical,this.tileTransform)[0],u=new nt,p=new qi;for(let g=0;g<a.length;g++){const{x:v,y:w}=a[g];u.emplaceBack(v,w),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(u,Wd.members),this._tileDebugSegments=pr.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const a=oa($2,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const g=function(v,w){const E=mc(v,w),C=Math.pow(2,v.z);for(let q=0;q<Is;q++)for(let re=0;re<Is;re++){const de=lo((v.x+(re+U2(re))/Lo)/C),oe=ni((v.y+(q+U2(q))/Lo)/C),he=w.project(de,oe),me=q*Is+re;ks[2*me+0]=Math.round((he.x*E.scale-E.x)*It),ks[2*me+1]=Math.round((he.y*E.scale-E.y)*It)}il.fill(0),cg.fill(0);for(let q=2045;q>=0;q--){const re=4*q,de=rl[re+0],oe=rl[re+1],he=rl[re+2],me=rl[re+3],fe=de+he>>1,Re=oe+me>>1,Me=fe+Re-oe,Ue=Re+de-fe,rt=oe*Is+de,Oe=me*Is+he,We=Re*Is+fe,Ze=Math.hypot((ks[2*rt+0]+ks[2*Oe+0])/2-ks[2*We+0],(ks[2*rt+1]+ks[2*Oe+1])/2-ks[2*We+1])>=16;il[We]=il[We]||(Ze?1:0),q<1022&&(il[We]=il[We]||il[(oe+Ue>>1)*Is+(de+Me>>1)]||il[(me+Ue>>1)*Is+(he+Me>>1)])}const I=new Ge,k=new Tt;let D=0;function L(q,re){const de=re*Is+q;return cg[de]===0&&(I.emplaceBack(ks[2*de+0],ks[2*de+1],q*It/Lo,re*It/Lo),cg[de]=++D),cg[de]-1}function F(q,re,de,oe,he,me){const fe=q+de>>1,Re=re+oe>>1;if(Math.abs(q-he)+Math.abs(re-me)>1&&il[Re*Is+fe])F(he,me,q,re,fe,Re),F(de,oe,he,me,fe,Re);else{const Me=L(q,re),Ue=L(de,oe),rt=L(he,me);k.emplaceBack(Me,Ue,rt)}}return F(0,0,Lo,Lo,Lo,0),F(Lo,Lo,0,0,0,Lo),{vertices:I,indices:k}}(this.tileID.canonical,i);u=g.vertices,p=g.indices}else{u=new Ge,p=new Tt;for(const{x:v,y:w}of a)u.emplaceBack(v,w,0,0);const g=M0(u.int16,void 0,4);for(let v=0;v<g.length;v+=3)p.emplaceBack(g[v],g[v+1],g[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(u,V2.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=pr.simpleSegment(0,0,u.length,p.length)}_makeGlobeTileDebugBuffers(t,i){const a=i.projection;if(!a||a.name!=="globe"||i.freezeTileCoverage)return;const u=this.tileID.canonical,p=Xd(ub(u,i)),g=wu(i.zoom);let v;g>0&&(v=n0(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,u,i,p,v,g),this._makeGlobeTileDebugTextBuffer(t,u,i,p,v,g)}_globePoint(t,i,a,u,p,g,v){let w=Hd(t,i,a);if(g){const E=1<<a.z,C=As(u.center.lng),I=Ms(u.center.lat),k=(a.x+.5)/E-C;let D=0;k>.5?D=-1:k<-.5&&(D=1);let L=(t/It+a.x)/E+D,F=(i/It+a.y)/E;L=(L-C)*u._pixelsPerMercatorPixel+C,F=(F-I)*u._pixelsPerMercatorPixel+I;const q=[L*u.worldSize,F*u.worldSize,0];or(q,q,g),w=hc(w,q,v)}return or(w,w,p)}_makeGlobeTileDebugBorderBuffer(t,i,a,u,p,g){const v=new nt,w=new qi,E=new Ae,C=(k,D,L,F,q)=>{const re=(L-k)/(q-1),de=(F-D)/(q-1),oe=v.length;for(let he=0;he<q;he++){const me=k+he*re,fe=D+he*de;v.emplaceBack(me,fe);const Re=this._globePoint(me,fe,i,a,u,p,g);E.emplaceBack(Re[0],Re[1],Re[2]),w.emplaceBack(oe+he)}},I=It;C(0,0,I,0,16),C(I,0,I,I,16),C(I,I,0,I,16),C(0,I,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(v,Wd.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(E,ab.members),this._tileDebugSegments=pr.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(t,i,a,u,p,g){const v=It/4,w=new nt,E=new Tt,C=new Ae,I=25;E.reserve(32),w.reserve(I),C.reserve(I);const k=(D,L)=>I*D+L;for(let D=0;D<I;D++){const L=D*v;for(let F=0;F<I;F++){const q=F*v;w.emplaceBack(q,L);const re=this._globePoint(q,L,i,a,u,p,g);C.emplaceBack(re[0],re[1],re[2])}}for(let D=0;D<4;D++)for(let L=0;L<4;L++){const F=k(D,L),q=k(D,L+1),re=k(D+1,L),de=k(D+1,L+1);E.emplaceBack(F,q,re),E.emplaceBack(re,q,de)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(E),this._tileDebugTextBuffer=t.createVertexBuffer(w,Wd.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(C,ab.members),this._tileDebugTextSegments=pr.simpleSegment(0,0,I,32)}}class rz{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,a){const u=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},En(this.stateChanges[t][u],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==u&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const p in this.state[t][u])a[p]||(this.deletedStates[t][u][p]=null)}else for(const p in a)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][p]===null&&delete this.deletedStates[t][u][p]}removeFeatureState(t,i,a){if(this.deletedStates[t]===null)return;const u=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&i!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][a]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(a in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][a]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,i){const a=String(i),u=En({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][i];if(p===null)return{};for(const g in p)delete u[g]}return u}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),En(this.state[u][g],this.stateChanges[u][g]),p[g]=this.state[u][g];a[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const g in this.state[u])p[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else if(this.state[u][g])for(const v of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][v];p[g]=this.state[u][g]}a[u]=a[u]||{},En(a[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in t)t[u].setFeatureState(a,i)}}class G2{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const a=this.toIdx(t,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function q2(r,t,i,a){let u=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<r[g]||i[g]>t[g])return null}else{const v=1/a[g];let w=(r[g]-i[g])*v,E=(t[g]-i[g])*v;if(w>E){const C=w;w=E,E=C}if(w>u&&(u=w),E<p&&(p=E),u>p)return null}return u}function W2(r,t,i,a,u,p,g,v,w,E,C){const I=a-r,k=u-t,D=p-i,L=g-r,F=v-t,q=w-i,re=C[1]*q-C[2]*F,de=C[2]*L-C[0]*q,oe=C[0]*F-C[1]*L,he=I*re+k*de+D*oe;if(Math.abs(he)<1e-15)return null;const me=1/he,fe=E[0]-r,Re=E[1]-t,Me=E[2]-i,Ue=(fe*re+Re*de+Me*oe)*me;if(Ue<0||Ue>1)return null;const rt=Re*D-Me*k,Oe=Me*I-fe*D,We=fe*k-Re*I,Ze=(C[0]*rt+C[1]*Oe+C[2]*We)*me;return Ze<0||Ue+Ze>1?null:(L*rt+F*Oe+q*We)*me}function Z2(r,t,i){return(r-t)/(i-t)}function H2(r,t,i,a,u,p,g,v,w){const E=1<<i,C=p-a,I=g-u,k=(r+1)/E*C+a,D=(t+0)/E*I+u,L=(t+1)/E*I+u;v[0]=(r+0)/E*C+a,v[1]=D,w[0]=k,w[1]=L}class X2{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,C=(D,L,F,q,re)=>{const de=q?1:0,oe=(D+1)*F-de,he=L*F,me=(L+1)*F-de;re[0]=D*F,re[1]=he,re[2]=oe,re[3]=me};let I=new G2(w);const k=[];for(let D=0;D<w*w;D++){C(D%w,Math.floor(D/w),E,!1,k);const L=ol(k[0],k[1],p),F=ol(k[2],k[1],p),q=ol(k[2],k[3],p),re=ol(k[0],k[3],p);I.minimums.push(Math.min(L,F,q,re)),I.maximums.push(Math.max(L,F,q,re)),I.leaves.push(1)}for(v.push(I),w/=2;w>=1;w/=2){const D=v[v.length-1];I=new G2(w);for(let L=0;L<w*w;L++){C(L%w,Math.floor(L/w),2,!0,k);const F=D.getElevation(k[0],k[1]),q=D.getElevation(k[2],k[1]),re=D.getElevation(k[2],k[3]),de=D.getElevation(k[0],k[3]),oe=D.isLeaf(k[0],k[1]),he=D.isLeaf(k[2],k[1]),me=D.isLeaf(k[2],k[3]),fe=D.isLeaf(k[0],k[3]),Re=Math.min(F.min,q.min,re.min,de.min),Me=Math.max(F.max,q.max,re.max,de.max),Ue=oe&&he&&me&&fe;I.maximums.push(Me),I.minimums.push(Re),I.leaves.push(Me-Re<=5&&Ue?1:0)}v.push(I)}return v}(this.dem),a=i.length-1,u=i[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(t,i,a,u,p,g,v=1){return q2([t,i,-100],[a,u,this.maximums[0]*v],p,g)}raycast(t,i,a,u,p,g,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,i,a,u,p,g,v);if(w==null)return null;const E=[],C=[],I=[],k=[],D=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:L,t:F,nodex:q,nodey:re,depth:de}=D.pop();if(this.leaves[L]){H2(q,re,de,t,i,a,u,I,k);const he=1<<de,me=(q+0)/he,fe=(q+1)/he,Re=(re+0)/he,Me=(re+1)/he,Ue=ol(me,Re,this.dem)*v,rt=ol(fe,Re,this.dem)*v,Oe=ol(fe,Me,this.dem)*v,We=ol(me,Me,this.dem)*v,Ze=W2(I[0],I[1],Ue,k[0],I[1],rt,k[0],k[1],Oe,p,g),Ke=W2(k[0],k[1],Oe,I[0],k[1],We,I[0],I[1],Ue,p,g),st=Math.min(Ze!==null?Ze:Number.MAX_VALUE,Ke!==null?Ke:Number.MAX_VALUE);if(st!==Number.MAX_VALUE)return st;{const Ne=Gd([],p,g,F);if(K2(Ue,rt,We,Oe,Z2(Ne[0],I[0],k[0]),Z2(Ne[1],I[1],k[1]))>=Ne[2])return F}continue}let oe=0;for(let he=0;he<this._siblingOffset.length;he++){H2((q<<1)+this._siblingOffset[he][0],(re<<1)+this._siblingOffset[he][1],de+1,t,i,a,u,I,k),I[2]=-100,k[2]=this.maximums[this.childOffsets[L]+he]*v;const me=q2(I,k,p,g);if(me!=null){const fe=me;E[he]=fe;let Re=!1;for(let Me=0;Me<oe&&!Re;Me++)fe>=E[C[Me]]&&(C.splice(Me,0,he),Re=!0);Re||(C[oe]=he),oe++}}for(let he=0;he<oe;he++){const me=C[he];D.push({idx:this.childOffsets[L]+me,t:E[me],nodex:(q<<1)+this._siblingOffset[me][0],nodey:(re<<1)+this._siblingOffset[me][1],depth:de+1})}}return null}_addNode(t,i,a){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,a,u,p){if(t[u].isLeaf(i,a)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=u-1,v=t[g];let w=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const I=2*i+this._siblingOffset[C][0],k=2*a+this._siblingOffset[C][1],D=v.getElevation(I,k),L=v.isLeaf(I,k),F=this._addNode(D.min,D.max,L);L&&(w|=1<<C),E||(E=F)}for(let C=0;C<this._siblingOffset.length;C++)w&1<<C||this._construct(t,2*i+this._siblingOffset[C][0],2*a+this._siblingOffset[C][1],g,E+C)}}function K2(r,t,i,a,u,p){return ln(ln(r,i,p),ln(t,a,p),u)}function ol(r,t,i){const a=i.dim,u=qe(r*a-.5,0,a-1),p=qe(t*a-.5,0,a-1),g=Math.floor(u),v=Math.floor(p),w=Math.min(g+1,a-1),E=Math.min(v+1,a-1);return K2(i.get(g,v),i.get(w,v),i.get(g,E),i.get(w,E),u-g,p-v)}const Y2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function iz(r,t,i){return(256*r*256+256*t+i)/10-1e4}function oz(r,t,i){return 256*r+t+i/256-32768}class ug{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,a,u=!1,p=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return gn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,v=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let w=0;w<g;w++)v[this._idx(-1,w)]=v[this._idx(0,w)],v[this._idx(g,w)]=v[this._idx(g-1,w)],v[this._idx(w,-1)]=v[this._idx(w,0)],v[this._idx(w,g)]=v[this._idx(w,g-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(g,-1)]=v[this._idx(g-1,0)],v[this._idx(-1,g)]=v[this._idx(0,g-1)],v[this._idx(g,g)]=v[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new X2(this)}get(t,i,a=!1){a&&(t=qe(t,-1,this.dim),i=qe(i,-1,this.dim));const u=4*this._idx(t,i);return(this.encoding==="terrarium"?oz:iz)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(t){return Y2[t]}get unpackVector(){return Y2[this.encoding]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const a=[0,0,0,0],u=ug.getUnpackVector(i);let p=Math.floor((t+u[3])/u[2]);return a[2]=p%256,p=Math.floor(p/256),a[1]=p%256,p=Math.floor(p/256),a[0]=p,a}getPixels(){return new Zi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,g=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(a){case-1:g=v-1;break;case 1:v=g+1}const w=-i*this.dim,E=-a*this.dim;for(let C=g;C<v;C++)for(let I=u;I<p;I++){const k=4*this._idx(I,C),D=4*this._idx(I+w,C+E);this.pixels[k+0]=t.pixels[D+0],this.pixels[k+1]=t.pixels[D+1],this.pixels[k+2]=t.pixels[D+2],this.pixels[k+3]=t.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}vt(ug,"DEMData"),vt(X2,"DemMinMaxQuadTree",{omit:["dem"]});class sz{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,a){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:i,timeout:void 0};if(a!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},a)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const a=t.wrapped().key,u=i===void 0?0:this.data[a].indexOf(i),p=this.data[a][u];return this.data[a].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const a in this.data)for(const u of this.data[a])t(u.value)||i.push(u);for(const a of i)this.remove(a.value.tileID,a)}}class Ou{constructor(t,i,a){this.func=t,this.mask=i,this.range=a}}Ou.ReadOnly=!1,Ou.ReadWrite=!0,Ou.disabled=new Ou(519,Ou.ReadOnly,[0,1]);const X0=7680;class K0{constructor(t,i,a,u,p,g){this.test=t,this.ref=i,this.mask=a,this.fail=u,this.depthFail=p,this.pass=g}}K0.disabled=new K0({func:519,mask:0},0,0,X0,X0,X0);class Ps{constructor(t,i,a){this.blendFunction=t,this.blendColor=i,this.mask=a}}Ps.Replace=[1,0],Ps.disabled=new Ps(Ps.Replace,ir.transparent,[!1,!1,!1,!1]),Ps.unblended=new Ps(Ps.Replace,ir.transparent,[!0,!0,!0,!0]),Ps.alphaBlended=new Ps([1,771],ir.transparent,[!0,!0,!0,!0]);const Y0=1029,J0=2305;class ds{constructor(t,i,a){this.enable=t,this.mode=i,this.frontFace=a}}ds.disabled=new ds(!1,Y0,J0),ds.backCCW=new ds(!0,Y0,J0),ds.backCW=new ds(!0,Y0,2304),ds.frontCW=new ds(!0,1028,2304),ds.frontCCW=new ds(!0,1028,J0);class gc extends Rl{constructor(t,i,a){super(),this.id=t,this._onlySymbols=a,i.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new sz(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new rz,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return xn(this._tiles).map(t=>t.tileID).sort(J2).map(t=>t.key)}getRenderableIds(t){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,t)&&i.push(this._tiles[a]);return t?i.sort((a,u)=>{const p=a.tileID,g=u.tileID,v=new Ie(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new Ie(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||w.y-v.y||w.x-v.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(J2).map(a=>a.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,t,i)))}_tileLoaded(t,i,a,u){if(u)if(t.state="errored",u.status!==404)this._source.fire(new Xo(u,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Ho.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new qs("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const p=i[u];if(t.neighboringTiles&&t.neighboringTiles[p]){const g=this.getTileByID(p);a(t,g),a(g,t)}}function a(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-u.tileID.canonical.x;const v=p.tileID.canonical.y-u.tileID.canonical.y,w=Math.pow(2,u.tileID.canonical.z),E=p.tileID.key;g===0&&v===0||Math.abs(v)>1||(Math.abs(g)>1&&(Math.abs(g+w)===1?g+=w:Math.abs(g-w)===1&&(g-=w)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,g,v),u.neighboringTiles&&u.neighboringTiles[E]&&(u.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,a,u){for(const p in this._tiles){let g=this._tiles[p];if(u[p]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let v=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){u[v.key]=v;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=t.overscaledZ-1;a>=i;a--){const u=t.scaledTo(a),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const a=Math.ceil(t.width/i)+1,u=Math.ceil(t.height/i)+1,p=Math.floor(a*u*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const a={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),a[p.tileID.key]=p}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(t,i,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new wi(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(u=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(v=>this._source.hasTile(v)))):u=[];const p=this._updateRetainedTiles(u);if(Q2(this._source.type)&&u.length!==0){const v={},w={},E=Object.keys(p);for(const I of E){const k=p[I],D=this._tiles[I];if(!D||D.fadeEndTime&&D.fadeEndTime<=Ho.now())continue;const L=this.findLoadedParent(k,Math.max(k.overscaledZ-gc.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),v[L.tileID.key]=L.tileID),w[I]=k}const C=u[u.length-1].overscaledZ;for(const I in this._tiles){const k=this._tiles[I];if(p[I]||!k.hasData())continue;let D=k.tileID;for(;D.overscaledZ>C;){D=D.scaledTo(D.overscaledZ-1);const L=this._tiles[D.key];if(L&&L.hasData()&&w[D.key]){p[I]=k.tileID;break}}}for(const I in v)p[I]||(this._coveredTiles[I]=!0,p[I]=v[I])}for(const v in p)this._tiles[v].clearFadeHold();const g=function(v,w){const E=[];for(const C in v)C in w||E.push(C);return E}(this._tiles,p);for(const v of g){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const a={},u=t.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),p=t[0].overscaledZ,g=Math.max(p-gc.maxOverzooming,this._source.minzoom),v=Math.max(p+gc.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const C=this._addTile(E);i[E.key]=E,C.hasData()||u<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,u,v,i);for(const E of t){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const k=E.children(this._source.maxzoom)[0],D=this.getTile(k);if(D&&D.hasData()){i[k.key]=k;continue}}else{const k=E.children(this._source.maxzoom);if(i[k[0].key]&&i[k[1].key]&&i[k[2].key]&&i[k[3].key])continue}let I=C.wasRequested();for(let k=E.overscaledZ-1;k>=g;--k){const D=E.scaledTo(k);if(a[D.key]||(a[D.key]=!0,C=this.getTile(D),!C&&I&&(C=this._addTile(D)),C&&(i[D.key]=D,I=C.wasRequested(),C.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let a,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}i.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;u=p}for(const p of i)this._loadedParentTiles[p]=a}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const a=!!i;if(!a){const u=this.map?this.map.painter:null;i=new H0(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,a||this._source.fire(new qs("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=i.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,a){const u=[],p=this.transform;if(!p)return u;const g=p.projection.name==="globe",v=As(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(a&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(g){const I=E.tileID.canonical;if(I.z===0){const k=[Math.abs(qe(v,...mp(I,-1))-v),Math.abs(qe(v,...mp(I,1))-v)];C=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(qe(v,...mp(I,-1))-v),Math.abs(qe(v,...mp(I,0))-v),Math.abs(qe(v,...mp(I,1))-v)];C=[k.indexOf(Math.min(...k))-1]}}else C=[0];for(const I of C){const k=t.containsTile(E,p,i,I);k&&u.push(k)}}return u}getVisibleCoordinates(t){const i=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Q2(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Ho.now())return!0}return!1}setFeatureState(t,i,a){this._state.updateState(t=t||"_geojsonTileLayer",i,a)}removeFeatureState(t,i,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,a)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,a){const u=this._tiles[t];u&&u.setDependencies(i,a)}reloadTilesForDependencies(t,i){for(const a in this._tiles)this._tiles[a].hasDependency(t,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(t,i))};return void this._source.on("data",v)}const a=new Map,u=Array.isArray(t)?t:[t],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of u){const w=v.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)a.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}Kt(Array.from(a.values()),(v,w)=>{const E=new H0(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(C,E)})},i)}}function J2(r,t){const i=Math.abs(2*r.wrap)-+(r.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return r.overscaledZ-t.overscaledZ||a-i||t.canonical.y-r.canonical.y||t.canonical.x-r.canonical.x}function Q2(r){return r==="raster"||r==="image"||r==="video"||r==="custom"}function mp(r,t){const i=1<<r.z;return[r.x/i+t,(r.x+1)/i+t]}gc.maxOverzooming=10,gc.maxUnderzooming=3;class hg{constructor(t,i,a){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(t,i,a){const u=a||t.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,g=u.tileID,v=1<<i.canonical.z-g.canonical.z;return new hg(u,u.tileSize/It/v,[(i.canonical.x/v-g.canonical.x)*p.dim,(i.canonical.y/v-g.canonical.y)*p.dim])}tileCoordToPixel(t,i){const a=i*this._scale+this._offset[1],u=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(a);return new Ie(u,p)}getElevationAt(t,i,a,u){const p=t*this._scale+this._offset[0],g=i*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(g),E=this._dem;return u=!!u,a?ln(ln(E.get(v,w,u),E.get(v,w+1,u),g-w),ln(E.get(v+1,w,u),E.get(v+1,w+1,u),g-w),p-v):E.get(v,w,u)}getElevationAtPixel(t,i,a){return this._dem.get(t,i,!!a)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*cs(1,t)*this._dem.stride}}class eE{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Js(It,16,0),this.featureIndexArray=new ic,this.promoteId=i}insert(t,i,a,u,p,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,p,g);const w=this.grid;for(let E=0;E<i.length;E++){const C=i[E],I=[1/0,1/0,-1/0,-1/0];for(let k=0;k<C.length;k++){const D=C[k];I[0]=Math.min(I[0],D.x),I[1]=Math.min(I[1],D.y),I[2]=Math.max(I[2],D.x),I[3]=Math.max(I[3],D.y)}I[0]<It&&I[1]<It&&I[2]>=0&&I[3]>=0&&w.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new z0(new Ym(this.rawTileData)).layers,this.sourceLayerCoder=new N2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,a,u){this.loadVTLayers();const p=t.params||{},g=hu(p.filter),v=t.tileResult,w=t.transform,E=v.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(L,F,q,re)=>Sb(v.bufferedTilespaceGeometry,L,F,q,re));C.sort(az);let I=null;w.elevation&&C.length>0&&(I=hg.create(w.elevation,this.tileID));const k={};let D;for(let L=0;L<C.length;L++){const F=C[L];if(F===D)continue;D=F;const q=this.featureIndexArray.get(F);let re=null;this.loadMatchingFeature(k,q,g,p.layers,p.availableImages,i,a,u,(de,oe,he,me=0)=>(re||(re=oa(de,this.tileID.canonical,t.tileTransform)),oe.queryIntersectsFeature(v,de,he,re,this.z,t.transform,t.pixelPosMatrix,I,me)))}return k}loadMatchingFeature(t,i,a,u,p,g,v,w,E){const{featureIndex:C,bucketIndex:I,sourceLayerIndex:k,layoutVertexArrayOffset:D}=i,L=this.bucketLayerIDs[I];if(u&&!function(de,oe){for(let he=0;he<de.length;he++)if(oe.indexOf(de[he])>=0)return!0;return!1}(u,L))return;const F=this.sourceLayerCoder.decode(k),q=this.vtLayers[F].feature(C);if(a.needGeometry){const de=dc(q,!0);if(!a.filter(new M(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!a.filter(new M(this.tileID.overscaledZ),q))return;const re=this.getId(q,F);for(let de=0;de<L.length;de++){const oe=L[de];if(u&&u.indexOf(oe)<0)continue;const he=g[oe];if(!he)continue;let me={};re!==void 0&&w&&(me=w.getState(he.sourceLayer||"_geojsonTileLayer",re));const fe=En({},v[oe]);fe.paint=tE(fe.paint,he.paint,q,me,p),fe.layout=tE(fe.layout,he.layout,q,me,p);const Re=!E||E(q,he,me,D);if(!Re)continue;const Me=new j2(q,this.z,this.x,this.y,re);Me.layer=fe;let Ue=t[oe];Ue===void 0&&(Ue=t[oe]=[]),Ue.push({featureIndex:C,feature:Me,intersectionZ:Re})}}lookupSymbolFeatures(t,i,a,u,p,g,v,w){const E={};this.loadVTLayers();const C=hu(p);for(const I of t)this.loadMatchingFeature(E,{bucketIndex:a,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},C,g,v,w,i);return E}loadFeature(t){const{featureIndex:i,sourceLayerIndex:a}=t;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),p=this.vtFeatures[u];if(p[i])return p[i];const g=this.vtLayers[u].feature(i);return p[i]=g,g}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){let a=t.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(a=t.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function tE(r,t,i,a,u){return Xt(r,(p,g)=>{const v=t instanceof te?t.get(g):null;return v&&v.evaluate?v.evaluate(i,a,u):v})}function az(r,t){return t-r}vt(eE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class nE{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new sa({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const a=this.getKey(t,i);return this.positions[a]}trim(){const t=this.width,i=this.height=Rr(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,a){const u=[];let p=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,v=!0;u.push({left:p,right:g,isDash:v,zeroLength:t[0]===0});let w=t[0];for(let E=1;E<t.length;E++){v=!v;const C=t[E];p=w*a,w+=C,g=w*a,u.push({left:p,right:g,isDash:v,zeroLength:C===0})}return u}addRoundDash(t,i,a){const u=i/2;for(let p=-a;p<=a;p++){const g=this.width*(this.nextRow+a+p);let v=0,w=t[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++v]);const C=Math.abs(E-w.left),I=Math.abs(E-w.right),k=Math.min(C,I);let D;const L=p/a*(u+1);if(w.isDash){const F=u-Math.abs(L);D=Math.sqrt(k*k+F*F)}else D=u-Math.sqrt(k*k+L*L);this.image.data[g+E]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(t,i){for(let w=t.length-1;w>=0;--w){const E=t[w],C=t[w+1];E.zeroLength?t.splice(w,1):C&&C.isDash===E.isDash&&(C.left=E.left,t.splice(w,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const p=this.width*this.nextRow;let g=0,v=t[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++g]);const E=Math.abs(w-v.left),C=Math.abs(w-v.right),I=Math.min(E,C);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?I:-I)+i+128))}}addDash(t,i){const a=this.getKey(t,i);if(this.positions[a])return this.positions[a];const u=i==="round",p=u?7:0,g=2*p+1;if(this.nextRow+g>this.height)return gn("LineAtlas out of space"),null;t.length===0&&t.push(1);let v=0;for(let C=0;C<t.length;C++)t[C]<0&&(gn("Negative value is found in line dasharray, replacing values with 0"),t[C]=0),v+=t[C];if(v!==0){const C=this.width/v,I=this.getDashRanges(t,this.width,C);u?this.addRoundDash(I,C,p):this.addRegularDash(I,i==="square"?.5*C:0)}const w=this.nextRow+p;this.nextRow+=g;const E={tl:[w,p],br:[v,0]};return this.positions[a]=E,E}}vt(nE,"LineAtlas");const rE=1*hs;class iE{constructor(t){const i={},a=[];for(const v in t){const w=t[v],E=i[v]={};for(const C in w.glyphs){const I=w.glyphs[+C];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const k=I.metrics.localGlyph?rE:1,D={x:0,y:0,w:I.bitmap.width+2*k,h:I.bitmap.height+2*k};a.push(D),E[C]=D}}const{w:u,h:p}=O0(a),g=new sa({width:u||1,height:p||1});for(const v in t){const w=t[v];for(const E in w.glyphs){const C=w.glyphs[+E];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const I=i[v][E],k=C.metrics.localGlyph?rE:1;sa.copy(C.bitmap,g,{x:0,y:0},{x:I.x+k,y:I.y+k},C.bitmap)}}this.image=g,this.positions=i}}vt(iE,"GlyphAtlas");class lz{constructor(t){this.tileID=new wi(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=mc(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,i,a,u,p){this.status="parsing",this.data=t,this.collisionBoxArray=new An;const g=new N2(Object.keys(t.layers).sort()),v=new eE(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},E=new nE(256,256),C={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:a},I=i.familiesBySource[this.source];for(const me in I){const fe=t.layers[me];if(!fe)continue;let Re=!1,Me=!1;for(const Oe of I[me])Oe[0].type==="symbol"?Re=!0:Me=!0;if(this.isSymbolTile===!0&&!Re||this.isSymbolTile===!1&&!Me)continue;fe.version===1&&gn(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ue=g.encode(me),rt=[];for(let Oe=0;Oe<fe.length;Oe++){const We=fe.feature(Oe),Ze=v.getId(We,me);rt.push({feature:We,id:Ze,index:Oe,sourceLayerIndex:Ue})}for(const Oe of I[me]){const We=Oe[0];this.isSymbolTile!==void 0&&We.type==="symbol"!==this.isSymbolTile||We.minzoom&&this.zoom<Math.floor(We.minzoom)||We.maxzoom&&this.zoom>=We.maxzoom||We.visibility!=="none"&&(Q0(Oe,this.zoom,a),(w[We.id]=We.createBucket({index:v.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ue,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(rt,C,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Oe.map(Ze=>Ze.id)))}}let k,D,L,F;E.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=()=>{if(k)return p(k);if(D&&L&&F){const me=new iE(D),fe=new h2(L,F);for(const Re in w){const Me=w[Re];Me instanceof nl?(Q0(Me.layers,this.zoom,a),DP(Me,D,me.positions,L,fe.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Me.hasPattern&&(Me instanceof Hm||Me instanceof $m||Me instanceof rp)&&(Q0(Me.layers,this.zoom,a),Me.addFeatures(C,this.tileID.canonical,fe.patternPositions,a,this.tileTransform))}this.status="done",p(null,{buckets:xn(w).filter(Re=>!Re.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:E,imageAtlas:fe,glyphMap:this.returnDependencies?D:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?me.positions:null})}},de=Xt(C.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(de).length?u.send("getGlyphs",{uid:this.uid,stacks:de},(me,fe)=>{k||(k=me,D=fe,re())},void 0,!1,q):D={};const oe=Object.keys(C.iconDependencies);oe.length?u.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(me,fe)=>{k||(k=me,L=fe,re())},void 0,!1,q):L={};const he=Object.keys(C.patternDependencies);he.length?u.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"patterns"},(me,fe)=>{k||(k=me,F=fe,re())},void 0,!1,q):F={},re()}}function Q0(r,t,i){const a=new M(t);for(const u of r)u.recalculate(a,i)}class oE{constructor(t){this.entries={},this.scheduler=t}request(t,i,a,u){const p=this.entries[t]=this.entries[t]||{callbacks:[]};if(p.result){const[g,v]=p.result;return this.scheduler?this.scheduler.add(()=>{u(g,v)},i):u(g,v),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=a((g,v)=>{p.result=[g,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,v)},i):w(g,v);setTimeout(()=>delete this.entries[t],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==u),p.callbacks.length||(p.cancel(),delete this.entries[t]))}}}function sE(r,t,i){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},u=>{const p=Et(r.request,(g,v,w,E)=>{g?u(g):v&&u(null,{vectorTile:i?void 0:new z0(new Ym(v)),rawData:v,cacheControl:w,expires:E})});return()=>{p.cancel(),u()}},t)}const aE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ev{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=aE[15&a];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new ev(v,g,p,t)}constructor(t,i=64,a=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=aE.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return tv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,I=w.pop()||0,k=w.pop()||0;if(I-k<=v){for(let q=k;q<=I;q++){const re=g[2*q],de=g[2*q+1];re>=t&&re<=a&&de>=i&&de<=u&&E.push(p[q])}continue}const D=k+I>>1,L=g[2*D],F=g[2*D+1];L>=t&&L<=a&&F>=i&&F<=u&&E.push(p[D]),(C===0?t<=L:i<=F)&&(w.push(k),w.push(D-1),w.push(1-C)),(C===0?a>=L:u>=F)&&(w.push(D+1),w.push(I),w.push(1-C))}return E}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,v=[0,u.length-1,0],w=[],E=a*a;for(;v.length;){const C=v.pop()||0,I=v.pop()||0,k=v.pop()||0;if(I-k<=g){for(let q=k;q<=I;q++)cE(p[2*q],p[2*q+1],t,i)<=E&&w.push(u[q]);continue}const D=k+I>>1,L=p[2*D],F=p[2*D+1];cE(L,F,t,i)<=E&&w.push(u[D]),(C===0?t-a<=L:i-a<=F)&&(v.push(k),v.push(D-1),v.push(1-C)),(C===0?t+a>=L:i+a>=F)&&(v.push(D+1),v.push(I),v.push(1-C))}return w}}function tv(r,t,i,a,u,p){if(u-a<=i)return;const g=a+u>>1;lE(r,t,g,a,u,p),tv(r,t,i,a,g-1,1-p),tv(r,t,i,g+1,u,1-p)}function lE(r,t,i,a,u,p){for(;u>a;){if(u-a>600){const E=u-a+1,C=i-a+1,I=Math.log(E),k=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*k*(E-k)/E)*(C-E/2<0?-1:1);lE(r,t,i,Math.max(a,Math.floor(i-C*k/E+D)),Math.min(u,Math.floor(i+(E-C)*k/E+D)),p)}const g=t[2*i+p];let v=a,w=u;for(gp(r,t,a,i),t[2*u+p]>g&&gp(r,t,a,u);v<w;){for(gp(r,t,v,w),v++,w--;t[2*v+p]<g;)v++;for(;t[2*w+p]>g;)w--}t[2*a+p]===g?gp(r,t,a,w):(w++,gp(r,t,w,u)),w<=i&&(a=w+1),i<=w&&(u=w-1)}}function gp(r,t,i,a){nv(r,i,a),nv(t,2*i,2*a),nv(t,2*i+1,2*a+1)}function nv(r,t,i){const a=r[t];r[t]=r[i],r[i]=a}function cE(r,t,i,a){const u=r-i,p=t-a;return u*u+p*p}s.ARRAY_TYPE=Wi,s.AUTH_ERR_MSG=ue,s.Aabb=xi,s.Actor=class{constructor(r,t,i){this.target=r,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Ar(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qr()?r:A,this.scheduler=new tz}send(r,t,i,a,u=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[g]=i);const v=Ii(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:r,hasCallback:!!i,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:Ha(t,v)},v),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(r){const t=r.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(t.mustQueue||Qr()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,t),a&&a.metadata||{type:"message"})}else this.processTask(i,t)}processTask(r,t){if(t.type==="<response>"){const i=this.callbacks[r];delete this.callbacks[r],i&&(t.error?i(Qs(t.error)):i(null,Qs(t.data)))}else{const i=Ii(this.globalScope)?void 0:[],a=t.hasCallback?(p,g)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:p?Ha(p):null,data:Ha(g,i)},i)}:p=>{},u=Qs(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,u,a);else if(this.parent.getWorkerSource){const p=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,p[0],u.source)[p[1]](u,a)}else a(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Zm,s.Color=ir,s.ColorMode=Ps,s.CullFaceMode=ds,s.DEMData=ug,s.DataConstantProperty=B,s.DedupedRequest=oE,s.DepthMode=Ou,s.EXTENT=It,s.Elevation=class{isDataAvailableAtPoint(r){const t=this._source();if(this.isUsingMockSource()||!t||r.y<0||r.y>1)return!1;const i=t.getSource().maxzoom,a=1<<i,u=Math.floor(r.x),p=Math.floor((r.x-u)*a),g=Math.floor(r.y*a),v=this.findDEMTileFor(new wi(i,u,i,p,g));return!(!v||!v.dem)}getAtPointOrZero(r,t=0){return this.getAtPoint(r,t)||0}getAtPoint(r,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const a=this._source();if(!a||r.y<0||r.y>1)return t;const u=a.getSource().maxzoom,p=1<<u,g=Math.floor(r.x),v=r.x-g,w=new wi(u,g,u,Math.floor(v*p),Math.floor(r.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const C=E.dem,I=1<<E.tileID.canonical.z,k=(v*I-E.tileID.canonical.x)*C.dim,D=(r.y*I-E.tileID.canonical.y)*C.dim,L=Math.floor(k),F=Math.floor(D);return(i?this.exaggeration():1)*ln(ln(C.get(L,F),C.get(L,F+1),D-F),ln(C.get(L+1,F),C.get(L+1,F+1),D-F),k-L)}getAtTileOffset(r,t,i){const a=1<<r.canonical.z;return this.getAtPointOrZero(new bu(r.wrap+(r.canonical.x+t/It)/a,(r.canonical.y+i/It)/a))}getAtTileOffsetFunc(r,t,i,a){return u=>{const p=this.getAtTileOffset(r,u.x,u.y),g=a.upVector(r.canonical,u.x,u.y);return ao(g,g,p*a.upVectorScale(r.canonical,t,i).metersToTile),g}}getForTilePoints(r,t,i,a){if(this.isUsingMockSource())return!1;const u=hg.create(this,r,a);return!!u&&(t.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(r);if(!t||!t.dem)return null;const i=t.dem.tree,a=t.tileID,u=1<<r.canonical.z-a.canonical.z;let p=r.canonical.x/u-a.canonical.x,g=r.canonical.y/u-a.canonical.y,v=0;for(let w=0;w<r.canonical.z-a.canonical.z&&!i.leaves[v];w++){p*=2,g*=2;const E=2*Math.floor(g)+Math.floor(p);v=i.childOffsets[v]+E,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Xo,s.EvaluationParameters=M,s.Event=qs,s.Evented=Rl,s.FillExtrusionBucket=rp,s.Frustum=c0,s.FrustumCorners=l0,s.GLOBE_RADIUS=Ss,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=lb,s.GLOBE_ZOOM_THRESHOLD_MIN=u0,s.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_fillGridMeshWithLods(r,t){const i=new nt,a=new Tt,u=[],p=r+1+2,g=t[0]+1,v=t[0]+1+(1+t.length),w=(E,C,I)=>{let k=E===p-1?E-2:E===0?E:E-1;return k+=I?24575:0,[k,C]};for(let E=0;E<p;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<g;++E)for(let C=0;C<p;++C)i.emplaceBack(...w(C,E,(C===0||C===p-1)&&!0));for(let E=0;E<t.length;++E){const C=t[E];for(let I=0;I<p;++I)i.emplaceBack(...w(I,C,!0))}for(let E=0;E<t.length;++E){const C=a.length,I=t[E]+1+2,k=new Tt;for(let F=0;F<I-1;F++){const q=F===I-2,re=q?p*(v-t.length+E-F):p;for(let de=0;de<p-1;de++){const oe=F*p+de;F===0||q||de===0||de===p-2?(k.emplaceBack(oe+1,oe,oe+re),k.emplaceBack(oe+re,oe+re+1,oe+1)):(a.emplaceBack(oe+1,oe,oe+re),a.emplaceBack(oe+re,oe+re+1,oe+1))}}const D=pr.simpleSegment(0,C,i.length,a.length-C);for(let F=0;F<k.uint16.length;F+=3)a.emplaceBack(k.uint16[F],k.uint16[F+1],k.uint16[F+2]);const L=pr.simpleSegment(0,C,i.length,a.length-C);u.push({withoutSkirts:D,withSkirts:L})}return{vertices:i,indices:a,segments:u}}_createGrid(r){const t=this._fillGridMeshWithLods(uc,Zd);this._gridSegments=t.segments,this._gridBuffer=r.createVertexBuffer(t.vertices,Wd.members),this._gridIndexBuffer=r.createIndexBuffer(t.indices,!0)}_createPoles(r){const t=new Tt;for(let u=0;u<=uc;u++)t.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=r.createIndexBuffer(t,!0);const i=new Cn,a=new Cn;this._poleSegments=[];for(let u=0,p=0;u<u0;u++){const g=360/(1<<u);i.emplaceBack(0,-Ss,0,.5,0),a.emplaceBack(0,-Ss,0,.5,1);for(let v=0;v<=uc;v++){const w=v/uc,E=ln(0,g,w),[C,I,k]=vu(tk,nk,E,Ss);i.emplaceBack(C,I,k,w,0),a.emplaceBack(C,I,k,w,1)}this._poleSegments.push(pr.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,sb,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,sb,!1)}getGridBuffers(r,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,t){if(!this._wireframeSegments){const i=new Fr,a=uc,u=a+1+2,p=1;this._wireframeSegments=[];for(let g=0,v=0;g<Zd.length;g++){const w=Zd[g];for(let C=p;C<w+p;C++)for(let I=p;I<a+p;I++){const k=C*u+I;i.emplaceBack(k,k+1),i.emplaceBack(k,k+u),i.emplaceBack(k,k+u+1)}const E=w*a*3;this._wireframeSegments.push(pr.simpleSegment(0,v,(w+1)*u,E)),v+=E}this._wireframeIndexBuffer=r.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},s.GlyphManager=Pu,s.ImagePosition=B0,s.KDBush=ev,s.LivePerformanceUtils=Vh,s.LngLat=Mn,s.LngLatBounds=Ja,s.LocalGlyphMode=j0,s.MAX_MERCATOR_LATITUDE=ri,s.MercatorCoordinate=bu,s.ONE_EM=Zr,s.OverscaledTileID=wi,s.PerformanceMarkers=Zo,s.Point=Ie,s.Properties=le,s.RGBAImage=Zi,s.Ray=a0,s.RequestManager=class{constructor(r,t,i){this._transformRequestFn=r,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const r=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ne,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,t){return this._transformRequestFn&&this._transformRequestFn(r,t)||{url:r}}normalizeStyleURL(r,t){if(!ye(r))return r;const i=ct(r);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(r,t){if(!ye(r))return r;const i=ct(r);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(r,t,i,a){if(!ye(r))return r;const u=ct(r);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||t)}normalizeSpriteURL(r,t,i,a){const u=ct(r);return ye(r)?(u.path=`/styles/v1${u.path}/sprite${t}${i}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${t}${i}`,tt(u))}normalizeTileURL(r,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!ye(r))return r;const a=ct(r);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&a.authority!=="raster"&&i===512?"@2x":""}${$.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${V.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${V.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(p){for(const g of p){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(a.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(r,t){const i=ct(r);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return r;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let u=i.params;return t&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(r,t){const i=!!t&&ye(t),a=[];for(const u of r.tiles||[])we(u)?a.push(this.canonicalizeTileURL(u,i)):a.push(u);return a}_makeAPIURL(r,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=ct(V.API_URL);if(r.protocol=a.protocol,r.authority=a.authority,r.protocol==="http"){const u=r.params.indexOf("secure");u>=0&&r.params.splice(u,1)}if(a.path!=="/"&&(r.path=`${a.path}${r.path}`),!V.REQUIRE_ACCESS_TOKEN)return tt(r);if(t=t||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return r.params=r.params.filter(u=>u.indexOf("access_token")===-1),r.params.push(`access_token=${t||""}`),tt(r)}},s.ResourceType=So,s.SegmentVector=pr,s.SourceCache=gc,s.StencilMode=K0,s.StructArrayLayout1ui2=qi,s.StructArrayLayout2f1f2i16=kt,s.StructArrayLayout2i4=nt,s.StructArrayLayout2ui4=Fr,s.StructArrayLayout3f12=Jt,s.StructArrayLayout3ui6=Tt,s.StructArrayLayout4i8=Ge,s.StructArrayLayout5f20=Cn,s.Texture=fp,s.Tile=H0,s.Transitionable=O,s.Uniform1f=km,s.Uniform1i=class extends na{constructor(r){super(r),this.current=0}set(r,t,i){this.fetchUniformLocation(r,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends na{constructor(r){super(r),this.current=[0,0]}set(r,t,i){this.fetchUniformLocation(r,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},s.Uniform3f=class extends na{constructor(r){super(r),this.current=[0,0,0]}set(r,t,i){this.fetchUniformLocation(r,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},s.Uniform4f=$w,s.UniformColor=Gw,s.UniformMatrix2f=class extends na{constructor(r){super(r),this.current=NI}set(r,t,i){if(this.fetchUniformLocation(r,t)){for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},s.UniformMatrix3f=class extends na{constructor(r){super(r),this.current=FI}set(r,t,i){if(this.fetchUniformLocation(r,t)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.UniformMatrix4f=class extends na{constructor(r){super(r),this.current=BI}set(r,t,i){if(this.fetchUniformLocation(r,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},s.UnwrappedTileID=Kb,s.ValidationError=yt,s.VectorTileFeature=qm,s.VectorTileWorkerSource=class extends Rl{constructor(r,t,i,a,u){super(),this.actor=r,this.layerIndex=t,this.availableImages=i,this.loadVectorData=u||sE,this.loading={},this.loaded={},this.deduped=new oE(r.scheduler),this.isSpriteLoaded=a,this.scheduler=r.scheduler}loadTile(r,t){const i=r.uid,a=r&&r.request,u=a&&a.collectResourceTiming,p=this.loading[i]=new lz(r);p.abort=this.loadVectorData(r,(g,v)=>{const w=!this.loading[i];if(delete this.loading[i],w||g||!v)return p.status="done",w||(this.loaded[i]=p),t(g);const E=v.rawData,C={};v.expires&&(C.expires=v.expires),v.cacheControl&&(C.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new z0(new Ym(E));const I=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,D)=>{if(k||!D)return t(k);const L={};if(u){const F=$h(a);F.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(F)))}t(null,En({rawTileData:E.slice(0)},D,C,L))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(r,t){const i=this.loaded,a=r.uid,u=this;if(i&&i[a]){const p=i[a];p.showCollisionBoxes=r.showCollisionBoxes,p.enableTerrain=!!r.enableTerrain,p.projection=r.projection,p.tileTransform=mc(r.tileID.canonical,r.projection);const g=(v,w)=>{const E=p.reloadCallback;E&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,E)),t(v,w)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(r,t){const i=r.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),t()}removeTile(r,t){const i=this.loaded,a=r.uid;i&&i[a]&&delete i[a],t()}},s.WritingMode=co,s.ZoomDependentExpression=Yl,s.add=ia,s.addDynamicAttributes=ag,s.adjoint=function(r,t){var i=t[0],a=t[1],u=t[2],p=t[3],g=t[4],v=t[5],w=t[6],E=t[7],C=t[8];return r[0]=g*C-v*E,r[1]=u*E-a*C,r[2]=a*v-u*g,r[3]=v*w-p*C,r[4]=i*C-u*w,r[5]=u*p-i*v,r[6]=p*E-g*w,r[7]=a*w-i*E,r[8]=i*g-a*p,r},s.asyncAll=Kt,s.bezier=rn,s.bindAll=Ar,s.boundsAttributes=V2,s.bufferConvexPolygon=function(r,t){const i=[];for(let a=0;a<r.length;a++){const u=bt(a-1,-1,r.length-1),p=bt(a+1,-1,r.length-1),g=r[a],v=r[p],w=r[u].sub(g).unit(),E=v.sub(g).unit(),C=E.angleWithSep(w.x,w.y),I=w.add(E).unit().mult(-1*t/Math.sin(C/2));i.push(g.add(I))}return i},s.cacheEntryPossiblyAdded=function(r){ro++,ro>no&&(r.getActor().send("enforceCacheSizeLimit",zi),ro=0)},s.calculateGlobeLabelMatrix=function(r,t){const{x:i,y:a}=r.point,u=pb(i,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return ac(u,u,p0(Cs(t)))},s.calculateGlobeMatrix=function(r){const{x:t,y:i}=r.point,{lng:a,lat:u}=r._center;return pb(t,i,r.worldSize,a,u)},s.calculateGlobeMercatorMatrix=function(r){const t=r.pixelsPerMeter,i=t/cs(1,r.center.lat),a=as(new Float64Array(16));return jd(a,a,[r.point.x,r.point.y,0]),lc(a,a,[i,i,t]),Float32Array.from(a)},s.circumferenceAtLatitude=m0,s.clamp=qe,s.clearTileCache=function(r){if(!Vt())return;const t=A.caches.delete(Pi);r&&t.catch(r).then(()=>r())},s.clipLine=T2,s.clone=function(r){var t=new Wi(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},s.clone$1=Gr,s.collisionCircleLayout=sP,s.config=V,s.conjugate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r},s.create=function(){var r=new Wi(16);return Wi!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},s.create$1=Zw,s.createExpression=qa,s.createLayout=Ee,s.createStyleLayer=function(r){return r.type==="custom"?new YP(r):new QP[r.type](r)},s.cross=s0,s.degToRad=ht,s.distance=function(r,t){return Math.hypot(t[0]-r[0],t[1]-r[1],t[2]-r[2])},s.div=function(r,t,i){return r[0]=t[0]/i[0],r[1]=t[1]/i[1],r[2]=t[2]/i[2],r},s.dot=zo,s.earthRadius=Kd,s.ease=vn,s.easeCubicInOut=Bt,s.ecefToLatLng=function([r,t,i]){const a=Math.hypot(r,t,i),u=Math.atan2(r,i),p=.5*Math.PI-Math.acos(-t/a);return new Mn(Ht(u),Ht(p))},s.emitValidationErrors=Tm,s.endsWith=xo,s.enforceCacheSizeLimit=function(r){Ri(),Lr&&Lr.then(t=>{t.keys().then(i=>{for(let a=0;a<i.length-r;a++)t.delete(i[a])})})},s.evaluateSizeForFeature=Xm,s.evaluateSizeForZoom=Au,s.evaluateVariableOffset=I2,s.evented=_,s.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]},s.exactEquals$1=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]},s.exported=Ho,s.exported$1=$,s.extend=En,s.extend$1=Ko,s.fillExtrusionHeightLift=Zb,s.filterObject=wo,s.fromMat4=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},s.fromQuat=function(r,t){var i=t[0],a=t[1],u=t[2],p=t[3],g=i+i,v=a+a,w=u+u,E=i*g,C=a*g,I=a*v,k=u*g,D=u*v,L=u*w,F=p*g,q=p*v,re=p*w;return r[0]=1-I-L,r[1]=C+re,r[2]=k-q,r[3]=0,r[4]=C-re,r[5]=1-E-L,r[6]=D+F,r[7]=0,r[8]=k+q,r[9]=D-F,r[10]=1-E-I,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},s.fromRotation=function(r,t){var i=Math.sin(t),a=Math.cos(t);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.fromScaling=Xw,s.furthestTileCorner=function(r){const t=Math.round((r+45+360)%360/90)%4;return Rn[t]},s.getAABBPointSquareDist=function(r,t,i){let a=0;for(let u=0;u<2;++u){const p=i?i[u]:0;r[u]>p&&(a+=(r[u]-p)*(r[u]-p)),t[u]<p&&(a+=(p-t[u])*(p-t[u]))}return a},s.getAnchorAlignment=N0,s.getAnchorJustification=V0,s.getBounds=function(r){let t=1/0,i=1/0,a=-1/0,u=-1/0;for(const p of r)t=Math.min(t,p.x),i=Math.min(i,p.y),a=Math.max(a,p.x),u=Math.max(u,p.y);return{min:new Ie(t,i),max:new Ie(a,u)}},s.getColumn=ki,s.getDefaultExportFromCjs=ce,s.getGridMatrix=function(r,t,i,a){const u=t.getNorth(),p=t.getSouth(),g=t.getWest(),v=t.getEast(),w=1<<r.z,E=v-g,C=u-p,I=E/uc,k=-C/Zd[i],D=[0,I,0,k,0,0,u,g,0];if(r.z>0){const L=180/a;Hw(D,D,[L/E+1,0,0,0,L/C+1,0,-.5*L/I,.5*L/k,1])}return D[2]=w,D[5]=r.x,D[8]=r.y,D},s.getImage=H,s.getJSON=function(r,t){return at(En(r,{type:"json"}),t)},s.getLatitudinalLod=function(r){const t=ri-5;r=qe(r,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(ht(r))),3);return Math.round(i*(Zd.length-1))},s.getMapSessionAPI=an,s.getPerformanceMeasurement=$h,s.getProjection=B2,s.getRTLTextPluginStatus=x,s.getReferrer=Ve,s.getTilePoint=function(r,{x:t,y:i},a=0){return new Ie(((t-a)*r.scale-r.x)*It,(i*r.scale-r.y)*It)},s.getTileVec3=function(r,t,i=0){return yu(((t.x-i)*r.scale-r.x)*It,(t.y*r.scale-r.y)*It,_b(t.z,t.y))},s.getVideo=function(r,t){const i=A.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let a=0;a<r.length;a++){const u=A.document.createElement("source");$t(r[a])||(i.crossOrigin="Anonymous"),u.src=r[a],i.appendChild(u)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(r){const t=[0,0,0],i=as(new Float64Array(16));return ac(i,r.pixelMatrix,r.globeMatrix),or(t,t,i),new Ie(t[0],t[1])},s.globeDenormalizeECEF=p0,s.globeECEFOrigin=function(r,t){const i=[0,0,0];return or(i,i,Xd(Cs(t.canonical))),or(i,i,r),i},s.globeMetersToEcef=Rm,s.globeNormalizeECEF=Xd,s.globePixelsToTileUnits=function(r,t){return It/(512*Math.pow(2,r))*Lm(Cs(t))},s.globePoleMatrixForTile=function(r,t,i){const a=as(new Float64Array(16)),u=(t/(1<<r)-.5)*Math.PI*2;return zm(a,i.globeMatrix,u),Float32Array.from(a)},s.globeTileBounds=Cs,s.globeTiltAtLngLat=fb,s.globeToMercatorTransition=wu,s.globeUseCustomAntiAliasing=function(r,t,i){const a=wu(i.zoom),u=r.style.map._antialias,p=!!t.extStandardDerivatives,g=t.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return a===0&&!u&&!g&&p},s.identity=as,s.identity$1=rb,s.invert=n0,s.isFullscreen=function(){return!!A.document.fullscreenElement||!!A.document.webkitFullscreenElement},s.isLngLatBehindGlobe=f0,s.isMapAuthenticated=function(r){return ur.has(r)},s.isMapboxURL=ye,s.isSafariWithAntialiasingBug=function(r){const t=r.navigator?r.navigator.userAgent:null;return!!Ii(r)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=ni,s.latLngToECEF=xu,s.len=HI,s.length=Ud,s.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},s.lngFromMercatorX=lo,s.loadVectorTile=sE,s.makeRequest=at,s.mapValue=function(r,t,i,a,u){return qe((r-t)/(i-t)*(u-a)+a,a,u)},s.mercatorScale=yb,s.mercatorXfromLng=As,s.mercatorYfromLat=Ms,s.mercatorZfromAltitude=cs,s.mul=WI,s.mul$1=ZI,s.multiply=ac,s.multiply$1=Hw,s.multiply$2=Jw,s.nextPowerOfTwo=Rr,s.normalize=vi,s.normalize$1=XI,s.normalize$2=tb,s.number=ln,s.ortho=function(r,t,i,a,u,p,g){var v=1/(t-i),w=1/(a-u),E=1/(p-g);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(t+i)*v,r[13]=(u+a)*w,r[14]=(g+p)*E,r[15]=1,r},s.pbf=r2,s.perspective=function(r,t,i,a,u){var p,g=1/Math.tan(t/2);return r[0]=g/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0?(r[10]=(u+a)*(p=1/(a-u)),r[14]=2*u*a*p):(r[10]=-1,r[14]=-2*a),r},s.pick=function(r,t){const i={};for(let a=0;a<t.length;a++){const u=t[a];u in r&&(i[u]=r[u])}return i},s.plugin=S,s.pointGeometry=Be,s.polesInViewport=function(r){const t=as(new Float64Array(16));ac(t,r.pixelMatrix,r.globeMatrix);const i=[0,Ro,0],a=[0,Do,0];return or(i,i,t),or(a,a,t),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!f0(r,new Mn(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!f0(r,new Mn(r.center.lat,-90))]},s.polygonContainsPoint=pc,s.polygonIntersectsBox=Sb,s.polygonIntersectsPolygon=wb,s.polygonizeBounds=function(r,t,i=0,a=!0){const u=new Ie(i,i),p=r.sub(u),g=t.add(u),v=[p,new Ie(g.x,p.y),g,new Ie(p.x,g.y)];return a&&v.push(p.clone()),v},s.posAttributes=Wd,s.postMapLoadEvent=Ft,s.postPerformanceEvent=Ln,s.postTurnstileEvent=Yt,s.potpack=O0,s.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},s.radToDeg=Ht,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(r){return r({pluginStatus:d,pluginURL:o}),_.on("pluginStateChange",r),r},s.removeAuthState=function(r){ur.delete(r)},s.renderColorRamp=E0,s.resample=vb,s.rotateX=r0,s.rotateX$1=ib,s.rotateY=zm,s.rotateY$1=ob,s.rotateZ=function(r,t,i){var a=Math.sin(i),u=Math.cos(i),p=t[0],g=t[1],v=t[2],w=t[3],E=t[4],C=t[5],I=t[6],k=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=p*u+E*a,r[1]=g*u+C*a,r[2]=v*u+I*a,r[3]=w*u+k*a,r[4]=E*u-p*a,r[5]=C*u-g*a,r[6]=I*u-v*a,r[7]=k*u-w*a,r},s.rotateZ$1=function(r,t,i){i*=.5;var a=t[0],u=t[1],p=t[2],g=t[3],v=Math.sin(i),w=Math.cos(i);return r[0]=a*w+u*v,r[1]=u*w-a*v,r[2]=p*w+g*v,r[3]=g*w-p*v,r},s.scale=lc,s.scale$1=eb,s.scale$2=ao,s.scaleAndAdd=Gd,s.set=function(r,t,i,a){return r[0]=t,r[1]=i,r[2]=a,r},s.setCacheLimits=function(r,t){zi=r,no=t},s.setColumn=function(r,t,i){r[4*t+0]=i[0],r[4*t+1]=i[1],r[4*t+2]=i[2],r[4*t+3]=i[3]},s.setRTLTextPlugin=function(r,t,i=!1){if(d===Ld||d===Od||d===Bd)throw new Error("setRTLTextPlugin cannot be called multiple times.");o=Ho.resolveURL(r),d=Ld,Xa=t,f(),i||T()},s.smoothstep=St,s.spec=je,s.squaredLength=function(r){var t=r[0],i=r[1],a=r[2];return t*t+i*i+a*a},s.storeAuthState=function(r,t){t?ur.add(r):ur.delete(r)},s.sub=ls,s.subtract=o0,s.symbolSize=aP,s.tileAABB=function(r,t,i,a,u,p,g,v,w){if(w.name==="globe")return ek(r,t,new Zm(i,a,u));const E=mc({z:i,x:a,y:u},w);return new xi([(p+E.x/E.scale)*t,t*(E.y/E.scale),g],[(p+E.x2/E.scale)*t,t*(E.y2/E.scale),v])},s.tileCornersToBounds=Dm,s.tileTransform=mc,s.transformMat3=function(r,t,i){var a=t[0],u=t[1],p=t[2];return r[0]=a*i[0]+u*i[3]+p*i[6],r[1]=a*i[1]+u*i[4]+p*i[7],r[2]=a*i[2]+u*i[5]+p*i[8],r},s.transformMat4=or,s.transformMat4$1=cc,s.transformQuat=Qw,s.transitionTileAABBinECEF=ub,s.translate=jd,s.transpose=function(r,t){if(r===t){var i=t[1],a=t[2],u=t[5];r[1]=t[3],r[2]=t[6],r[3]=i,r[5]=t[7],r[6]=a,r[7]=u}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r},s.triggerPluginCompletionEvent=c,s.uniqueId=cr,s.updateGlobeVertexNormal=function(r,t,i,a,u){const p=5*t+2;r.float32[p+0]=i,r.float32[p+1]=a,r.float32[p+2]=u},s.validateCustomStyleLayer=function(r){const t=[],i=r.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},s.validateFilter=r=>Gi(nc(r)),s.validateFog=r=>Gi(wm(r)),s.validateLayer=r=>Gi(_m(r)),s.validateLight=r=>Gi(xm(r)),s.validateSource=r=>Gi(vm(r)),s.validateStyle=Em,s.validateTerrain=r=>Gi(kd(r)),s.values=xn,s.vectorTile=Gm,s.version=R,s.warnOnce=gn,s.window=A,s.wrap=bt}),y(["./shared"],function(s){function A(ie){if(typeof ie=="number"||typeof ie=="boolean"||typeof ie=="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let j="[";for(const H of ie)j+=`${A(H)},`;return`${j}]`}let N="{";for(const j of Object.keys(ie).sort())N+=`${j}:${A(ie[j])},`;return`${N}}`}function R(ie){let N="";for(const j of s.refProperties)N+=`/${A(ie[j])}`;return N}class U{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,j){for(const ue of N)this._layerConfigs[ue.id]=ue,(this._layers[ue.id]=s.createStyleLayer(ue)).compileFilter(),this.keyCache[ue.id]&&delete this.keyCache[ue.id];for(const ue of j)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const H=function(ue,ye){const we={};for(let ge=0;ge<ue.length;ge++){const ze=ye&&ye[ue[ge].id]||R(ue[ge]);ye&&(ye[ue[ge].id]=ze);let et=we[ze];et||(et=we[ze]=[]),et.push(ue[ge])}const be=[];for(const ge in we)be.push(we[ge]);return be}(s.values(this._layerConfigs),this.keyCache);for(const ue of H){const ye=ue.map(ct=>this._layers[ct.id]),we=ye[0];if(we.visibility==="none")continue;const be=we.source||"";let ge=this.familiesBySource[be];ge||(ge=this.familiesBySource[be]={});const ze=we.sourceLayer||"_geojsonTileLayer";let et=ge[ze];et||(et=ge[ze]=[]),et.push(ye)}}}class V{loadTile(N,j){const{uid:H,encoding:ue,rawImageData:ye,padding:we,buildQuadTree:be}=N,ge=s.window.ImageBitmap&&ye instanceof s.window.ImageBitmap?this.getImageData(ye,we):ye;j(null,new s.DEMData(H,ge,ue,we<1,be))}getImageData(N,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const H=this.offscreenCanvasContext.getImageData(-j,-j,N.width+2*j,N.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),H}}function $(ie,N){if(ie.length!==0){pe(ie[0],N);for(var j=1;j<ie.length;j++)pe(ie[j],!N)}}function pe(ie,N){for(var j=0,H=0,ue=0,ye=ie.length,we=ye-1;ue<ye;we=ue++){var be=(ie[ue][0]-ie[we][0])*(ie[we][1]+ie[ue][1]),ge=j+be;H+=Math.abs(j)>=Math.abs(be)?j-ge+be:be-ge+j,j=ge}j+H>=0!=!!N&&ie.reverse()}var Y=s.getDefaultExportFromCjs(function ie(N,j){var H,ue=N&&N.type;if(ue==="FeatureCollection")for(H=0;H<N.features.length;H++)ie(N.features[H],j);else if(ue==="GeometryCollection")for(H=0;H<N.geometries.length;H++)ie(N.geometries[H],j);else if(ue==="Feature")ie(N.geometry,j);else if(ue==="Polygon")$(N.coordinates,j);else if(ue==="MultiPolygon")for(H=0;H<N.coordinates.length;H++)$(N.coordinates[H],j);return N});const K=s.VectorTileFeature.prototype.toGeoJSON;var Ce={exports:{}},ee=s.pointGeometry,ne=s.vectorTile.VectorTileFeature,ce=se;function se(ie,N){this.options=N||{},this.features=ie,this.length=ie.length}function De(ie,N){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=N||4096}se.prototype.feature=function(ie){return new De(this.features[ie],this.options.extent)},De.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var N=0;N<ie.length;N++){for(var j=ie[N],H=[],ue=0;ue<j.length;ue++)H.push(new ee(j[ue][0],j[ue][1]));this.geometry.push(H)}return this.geometry},De.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,N=1/0,j=-1/0,H=1/0,ue=-1/0,ye=0;ye<ie.length;ye++)for(var we=ie[ye],be=0;be<we.length;be++){var ge=we[be];N=Math.min(N,ge.x),j=Math.max(j,ge.x),H=Math.min(H,ge.y),ue=Math.max(ue,ge.y)}return[N,H,j,ue]},De.prototype.toGeoJSON=ne.prototype.toGeoJSON;var He=s.pbf,Be=ce;function ut(ie){var N=new He;return function(j,H){for(var ue in j.layers)H.writeMessage(3,Ie,j.layers[ue])}(ie,N),N.finish()}function Ie(ie,N){var j;N.writeVarintField(15,ie.version||1),N.writeStringField(1,ie.name||""),N.writeVarintField(5,ie.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ie.length;j++)H.feature=ie.feature(j),N.writeMessage(2,Je,H);var ue=H.keys;for(j=0;j<ue.length;j++)N.writeStringField(3,ue[j]);var ye=H.values;for(j=0;j<ye.length;j++)N.writeMessage(4,Bt,ye[j])}function Je(ie,N){var j=ie.feature;j.id!==void 0&&N.writeVarintField(1,j.id),N.writeMessage(2,Rt,ie),N.writeVarintField(3,j.type),N.writeMessage(4,Rn,j)}function Rt(ie,N){var j=ie.feature,H=ie.keys,ue=ie.values,ye=ie.keycache,we=ie.valuecache;for(var be in j.properties){var ge=j.properties[be],ze=ye[be];if(ge!==null){ze===void 0&&(H.push(be),ye[be]=ze=H.length-1),N.writeVarint(ze);var et=typeof ge;et!=="string"&&et!=="boolean"&&et!=="number"&&(ge=JSON.stringify(ge));var ct=et+":"+ge,tt=we[ct];tt===void 0&&(ue.push(ge),we[ct]=tt=ue.length-1),N.writeVarint(tt)}}}function ht(ie,N){return(N<<3)+(7&ie)}function Ht(ie){return ie<<1^ie>>31}function Rn(ie,N){for(var j=ie.loadGeometry(),H=ie.type,ue=0,ye=0,we=j.length,be=0;be<we;be++){var ge=j[be],ze=1;H===1&&(ze=ge.length),N.writeVarint(ht(1,ze));for(var et=H===3?ge.length-1:ge.length,ct=0;ct<et;ct++){ct===1&&H!==1&&N.writeVarint(ht(2,et-1));var tt=ge[ct].x-ue,zt=ge[ct].y-ye;N.writeVarint(Ht(tt)),N.writeVarint(Ht(zt)),ue+=tt,ye+=zt}H===3&&N.writeVarint(ht(7,1))}}function Bt(ie,N){var j=typeof ie;j==="string"?N.writeStringField(1,ie):j==="boolean"?N.writeBooleanField(7,ie):j==="number"&&(ie%1!=0?N.writeDoubleField(3,ie):ie<0?N.writeSVarintField(6,ie):N.writeVarintField(5,ie))}Ce.exports=ut,Ce.exports.fromVectorTileJs=ut,Ce.exports.fromGeojsonVt=function(ie,N){N=N||{};var j={};for(var H in ie)j[H]=new Be(ie[H].features,N),j[H].name=H,j[H].version=N.version,j[H].extent=N.extent;return ut({layers:j})},Ce.exports.GeoJSONWrapper=Be;var rn=s.getDefaultExportFromCjs(Ce.exports);const vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},qe=Math.fround||(St=new Float32Array(1),ie=>(St[0]=+ie,St[0]));var St;const bt=3,Kt=5,xn=6;class En{constructor(N){this.options=Object.assign(Object.create(vn),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:j,minZoom:H,maxZoom:ue}=this.options;j&&console.time("total time");const ye=`prepare ${N.length} points`;j&&console.time(ye),this.points=N;const we=[];for(let ge=0;ge<N.length;ge++){const ze=N[ge];if(!ze.geometry)continue;const[et,ct]=ze.geometry.coordinates,tt=qe(Qn(et)),zt=qe(Rr(ct));we.push(tt,zt,1/0,ge,-1,1),this.options.reduce&&we.push(0)}let be=this.trees[ue+1]=this._createTree(we);j&&console.timeEnd(ye);for(let ge=ue;ge>=H;ge--){const ze=+Date.now();be=this.trees[ge]=this._createTree(this._cluster(be,ge)),j&&console.log("z%d: %d clusters in %dms",ge,be.numItems,+Date.now()-ze)}return j&&console.timeEnd("total time"),this}getClusters(N,j){let H=((N[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,N[1]));let ye=N[2]===180?180:((N[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)H=-180,ye=180;else if(H>ye){const ct=this.getClusters([H,ue,180,we],j),tt=this.getClusters([-180,ue,ye,we],j);return ct.concat(tt)}const be=this.trees[this._limitZoom(j)],ge=be.range(Qn(H),Rr(we),Qn(ye),Rr(ue)),ze=be.data,et=[];for(const ct of ge){const tt=this.stride*ct;et.push(ze[tt+Kt]>1?Qt(ze,tt,this.clusterProps):this.points[ze[tt+bt]])}return et}getChildren(N){const j=this._getOriginId(N),H=this._getOriginZoom(N),ue="No cluster with the specified id.",ye=this.trees[H];if(!ye)throw new Error(ue);const we=ye.data;if(j*this.stride>=we.length)throw new Error(ue);const be=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ge=ye.within(we[j*this.stride],we[j*this.stride+1],be),ze=[];for(const et of ge){const ct=et*this.stride;we[ct+4]===N&&ze.push(we[ct+Kt]>1?Qt(we,ct,this.clusterProps):this.points[we[ct+bt]])}if(ze.length===0)throw new Error(ue);return ze}getLeaves(N,j,H){const ue=[];return this._appendLeaves(ue,N,j=j||10,H=H||0,0),ue}getTile(N,j,H){const ue=this.trees[this._limitZoom(N)],ye=Math.pow(2,N),{extent:we,radius:be}=this.options,ge=be/we,ze=(H-ge)/ye,et=(H+1+ge)/ye,ct={features:[]};return this._addTileFeatures(ue.range((j-ge)/ye,ze,(j+1+ge)/ye,et),ue.data,j,H,ye,ct),j===0&&this._addTileFeatures(ue.range(1-ge/ye,ze,1,et),ue.data,ye,H,ye,ct),j===ye-1&&this._addTileFeatures(ue.range(0,ze,ge/ye,et),ue.data,-1,H,ye,ct),ct.features.length?ct:null}getClusterExpansionZoom(N){let j=this._getOriginZoom(N)-1;for(;j<=this.options.maxZoom;){const H=this.getChildren(N);if(j++,H.length!==1)break;N=H[0].properties.cluster_id}return j}_appendLeaves(N,j,H,ue,ye){const we=this.getChildren(j);for(const be of we){const ge=be.properties;if(ge&&ge.cluster?ye+ge.point_count<=ue?ye+=ge.point_count:ye=this._appendLeaves(N,ge.cluster_id,H,ue,ye):ye<ue?ye++:N.push(be),N.length===H)break}return ye}_createTree(N){const j=new s.KDBush(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<N.length;H+=this.stride)j.add(N[H],N[H+1]);return j.finish(),j.data=N,j}_addTileFeatures(N,j,H,ue,ye,we){for(const be of N){const ge=be*this.stride,ze=j[ge+Kt]>1;let et,ct,tt;if(ze)et=cr(j,ge,this.clusterProps),ct=j[ge],tt=j[ge+1];else{const Lt=this.points[j[ge+bt]];et=Lt.properties;const[Gt,Yt]=Lt.geometry.coordinates;ct=Qn(Gt),tt=Rr(Yt)}const zt={type:1,geometry:[[Math.round(this.options.extent*(ct*ye-H)),Math.round(this.options.extent*(tt*ye-ue))]],tags:et};let Dt;Dt=ze||this.options.generateId?j[ge+bt]:this.points[j[ge+bt]].id,Dt!==void 0&&(zt.id=Dt),we.features.push(zt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,j){const{radius:H,extent:ue,reduce:ye,minPoints:we}=this.options,be=H/(ue*Math.pow(2,j)),ge=N.data,ze=[],et=this.stride;for(let ct=0;ct<ge.length;ct+=et){if(ge[ct+2]<=j)continue;ge[ct+2]=j;const tt=ge[ct],zt=ge[ct+1],Dt=N.within(ge[ct],ge[ct+1],be),Lt=ge[ct+Kt];let Gt=Lt;for(const Yt of Dt){const Dn=Yt*et;ge[Dn+2]>j&&(Gt+=ge[Dn+Kt])}if(Gt>Lt&&Gt>=we){let Yt,Dn=tt*Lt,Ft=zt*Lt,Vn=-1;const Ln=((ct/et|0)<<5)+(j+1)+this.points.length;for(const mi of Dt){const an=mi*et;if(ge[an+2]<=j)continue;ge[an+2]=j;const ur=ge[an+Kt];Dn+=ge[an]*ur,Ft+=ge[an+1]*ur,ge[an+4]=Ln,ye&&(Yt||(Yt=this._map(ge,ct,!0),Vn=this.clusterProps.length,this.clusterProps.push(Yt)),ye(Yt,this._map(ge,an)))}ge[ct+4]=Ln,ze.push(Dn/Gt,Ft/Gt,1/0,Ln,-1,Gt),ye&&ze.push(Vn)}else{for(let Yt=0;Yt<et;Yt++)ze.push(ge[ct+Yt]);if(Gt>1)for(const Yt of Dt){const Dn=Yt*et;if(!(ge[Dn+2]<=j)){ge[Dn+2]=j;for(let Ft=0;Ft<et;Ft++)ze.push(ge[Dn+Ft])}}}}return ze}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,j,H){if(N[j+Kt]>1){const we=this.clusterProps[N[j+xn]];return H?Object.assign({},we):we}const ue=this.points[N[j+bt]].properties,ye=this.options.map(ue);return H&&ye===ue?Object.assign({},ye):ye}}function Qt(ie,N,j){return{type:"Feature",id:ie[N+bt],properties:cr(ie,N,j),geometry:{type:"Point",coordinates:[(H=ie[N],360*(H-.5)),ai(ie[N+1])]}};var H}function cr(ie,N,j){const H=ie[N+Kt],ue=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,ye=ie[N+xn],we=ye===-1?{}:Object.assign({},j[ye]);return Object.assign(we,{cluster:!0,cluster_id:ie[N+bt],point_count:H,point_count_abbreviated:ue})}function Qn(ie){return ie/360+.5}function Rr(ie){const N=Math.sin(ie*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function ai(ie){const N=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Ar(ie,N,j,H){for(var ue,ye=H,we=j-N>>1,be=j-N,ge=ie[N],ze=ie[N+1],et=ie[j],ct=ie[j+1],tt=N+3;tt<j;tt+=3){var zt=xo(ie[tt],ie[tt+1],ge,ze,et,ct);if(zt>ye)ue=tt,ye=zt;else if(zt===ye){var Dt=Math.abs(tt-we);Dt<be&&(ue=tt,be=Dt)}}ye>H&&(ue-N>3&&Ar(ie,N,ue,H),ie[ue+2]=ye,j-ue>3&&Ar(ie,ue,j,H))}function xo(ie,N,j,H,ue,ye){var we=ue-j,be=ye-H;if(we!==0||be!==0){var ge=((ie-j)*we+(N-H)*be)/(we*we+be*be);ge>1?(j=ue,H=ye):ge>0&&(j+=we*ge,H+=be*ge)}return(we=ie-j)*we+(be=N-H)*be}function Xt(ie,N,j,H){var ue={id:ie===void 0?null:ie,type:N,geometry:j,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var we=ye.geometry,be=ye.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")wo(ye,we);else if(be==="Polygon"||be==="MultiLineString")for(var ge=0;ge<we.length;ge++)wo(ye,we[ge]);else if(be==="MultiPolygon")for(ge=0;ge<we.length;ge++)for(var ze=0;ze<we[ge].length;ze++)wo(ye,we[ge][ze])}(ue),ue}function wo(ie,N){for(var j=0;j<N.length;j+=3)ie.minX=Math.min(ie.minX,N[j]),ie.minY=Math.min(ie.minY,N[j+1]),ie.maxX=Math.max(ie.maxX,N[j]),ie.maxY=Math.max(ie.maxY,N[j+1])}function Gr(ie,N,j,H){if(N.geometry){var ue=N.geometry.coordinates,ye=N.geometry.type,we=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),be=[],ge=N.id;if(j.promoteId?ge=N.properties[j.promoteId]:j.generateId&&(ge=H||0),ye==="Point")Wo(ue,be);else if(ye==="MultiPoint")for(var ze=0;ze<ue.length;ze++)Wo(ue[ze],be);else if(ye==="LineString")gn(ue,be,we,!1);else if(ye==="MultiLineString"){if(j.lineMetrics){for(ze=0;ze<ue.length;ze++)gn(ue[ze],be=[],we,!1),ie.push(Xt(ge,"LineString",be,N.properties));return}qr(ue,be,we,!1)}else if(ye==="Polygon")qr(ue,be,we,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(ze=0;ze<N.geometry.geometries.length;ze++)Gr(ie,{id:ge,geometry:N.geometry.geometries[ze],properties:N.properties},j,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ze=0;ze<ue.length;ze++){var et=[];qr(ue[ze],et,we,!0),be.push(et)}}ie.push(Xt(ge,ye,be,N.properties))}}function Wo(ie,N){N.push(bo(ie[0])),N.push(Qr(ie[1])),N.push(0)}function gn(ie,N,j,H){for(var ue,ye,we=0,be=0;be<ie.length;be++){var ge=bo(ie[be][0]),ze=Qr(ie[be][1]);N.push(ge),N.push(ze),N.push(0),be>0&&(we+=H?(ue*ze-ge*ye)/2:Math.sqrt(Math.pow(ge-ue,2)+Math.pow(ze-ye,2))),ue=ge,ye=ze}var et=N.length-3;N[2]=1,Ar(N,0,et,j),N[et+2]=1,N.size=Math.abs(we),N.start=0,N.end=N.size}function qr(ie,N,j,H){for(var ue=0;ue<ie.length;ue++){var ye=[];gn(ie[ue],ye,j,H),N.push(ye)}}function bo(ie){return ie/360+.5}function Qr(ie){var N=Math.sin(ie*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function Mr(ie,N,j,H,ue,ye,we,be){if(H/=N,ye>=(j/=N)&&we<H)return ie;if(we<j||ye>=H)return null;for(var ge=[],ze=0;ze<ie.length;ze++){var et=ie[ze],ct=et.geometry,tt=et.type,zt=ue===0?et.minX:et.minY,Dt=ue===0?et.maxX:et.maxY;if(zt>=j&&Dt<H)ge.push(et);else if(!(Dt<j||zt>=H)){var Lt=[];if(tt==="Point"||tt==="MultiPoint")Dr(ct,Lt,j,H,ue);else if(tt==="LineString")Ii(ct,Lt,j,H,ue,!1,be.lineMetrics);else if(tt==="MultiLineString")ki(ct,Lt,j,H,ue,!1);else if(tt==="Polygon")ki(ct,Lt,j,H,ue,!0);else if(tt==="MultiPolygon")for(var Gt=0;Gt<ct.length;Gt++){var Yt=[];ki(ct[Gt],Yt,j,H,ue,!0),Yt.length&&Lt.push(Yt)}if(Lt.length){if(be.lineMetrics&&tt==="LineString"){for(Gt=0;Gt<Lt.length;Gt++)ge.push(Xt(et.id,tt,Lt[Gt],et.tags));continue}tt!=="LineString"&&tt!=="MultiLineString"||(Lt.length===1?(tt="LineString",Lt=Lt[0]):tt="MultiLineString"),tt!=="Point"&&tt!=="MultiPoint"||(tt=Lt.length===3?"Point":"MultiPoint"),ge.push(Xt(et.id,tt,Lt,et.tags))}}}return ge.length?ge:null}function Dr(ie,N,j,H,ue){for(var ye=0;ye<ie.length;ye+=3){var we=ie[ye+ue];we>=j&&we<=H&&(N.push(ie[ye]),N.push(ie[ye+1]),N.push(ie[ye+2]))}}function Ii(ie,N,j,H,ue,ye,we){for(var be,ge,ze=Eo(ie),et=ue===0?zi:no,ct=ie.start,tt=0;tt<ie.length-3;tt+=3){var zt=ie[tt],Dt=ie[tt+1],Lt=ie[tt+2],Gt=ie[tt+3],Yt=ie[tt+4],Dn=ue===0?zt:Dt,Ft=ue===0?Gt:Yt,Vn=!1;we&&(be=Math.sqrt(Math.pow(zt-Gt,2)+Math.pow(Dt-Yt,2))),Dn<j?Ft>j&&(ge=et(ze,zt,Dt,Gt,Yt,j),we&&(ze.start=ct+be*ge)):Dn>H?Ft<H&&(ge=et(ze,zt,Dt,Gt,Yt,H),we&&(ze.start=ct+be*ge)):Pi(ze,zt,Dt,Lt),Ft<j&&Dn>=j&&(ge=et(ze,zt,Dt,Gt,Yt,j),Vn=!0),Ft>H&&Dn<=H&&(ge=et(ze,zt,Dt,Gt,Yt,H),Vn=!0),!ye&&Vn&&(we&&(ze.end=ct+be*ge),N.push(ze),ze=Eo(ie)),we&&(ct+=be)}var Ln=ie.length-3;zt=ie[Ln],Dt=ie[Ln+1],Lt=ie[Ln+2],(Dn=ue===0?zt:Dt)>=j&&Dn<=H&&Pi(ze,zt,Dt,Lt),Ln=ze.length-3,ye&&Ln>=3&&(ze[Ln]!==ze[0]||ze[Ln+1]!==ze[1])&&Pi(ze,ze[0],ze[1],ze[2]),ze.length&&N.push(ze)}function Eo(ie){var N=[];return N.size=ie.size,N.start=ie.start,N.end=ie.end,N}function ki(ie,N,j,H,ue,ye){for(var we=0;we<ie.length;we++)Ii(ie[we],N,j,H,ue,ye,!1)}function Pi(ie,N,j,H){ie.push(N),ie.push(j),ie.push(H)}function zi(ie,N,j,H,ue,ye){var we=(ye-N)/(H-N);return ie.push(ye),ie.push(j+(ue-j)*we),ie.push(1),we}function no(ie,N,j,H,ue,ye){var we=(ye-j)/(ue-j);return ie.push(N+(H-N)*we),ie.push(ye),ie.push(1),we}function Lr(ie,N){for(var j=[],H=0;H<ie.length;H++){var ue,ye=ie[H],we=ye.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")ue=fi(ye.geometry,N);else if(we==="MultiLineString"||we==="Polygon"){ue=[];for(var be=0;be<ye.geometry.length;be++)ue.push(fi(ye.geometry[be],N))}else if(we==="MultiPolygon")for(ue=[],be=0;be<ye.geometry.length;be++){for(var ge=[],ze=0;ze<ye.geometry[be].length;ze++)ge.push(fi(ye.geometry[be][ze],N));ue.push(ge)}j.push(Xt(ye.id,we,ue,ye.tags))}return j}function fi(ie,N){var j=[];j.size=ie.size,ie.start!==void 0&&(j.start=ie.start,j.end=ie.end);for(var H=0;H<ie.length;H+=3)j.push(ie[H]+N,ie[H+1],ie[H+2]);return j}function Vt(ie,N){if(ie.transformed)return ie;var j,H,ue,ye=1<<ie.z,we=ie.x,be=ie.y;for(j=0;j<ie.features.length;j++){var ge=ie.features[j],ze=ge.geometry,et=ge.type;if(ge.geometry=[],et===1)for(H=0;H<ze.length;H+=2)ge.geometry.push(Ri(ze[H],ze[H+1],N,ye,we,be));else for(H=0;H<ze.length;H++){var ct=[];for(ue=0;ue<ze[H].length;ue+=2)ct.push(Ri(ze[H][ue],ze[H][ue+1],N,ye,we,be));ge.geometry.push(ct)}}return ie.transformed=!0,ie}function Ri(ie,N,j,H,ue,ye){return[Math.round(j*(ie*H-ue)),Math.round(j*(N*H-ye))]}function To(ie,N,j,H,ue){for(var ye=N===ue.maxZoom?0:ue.tolerance/((1<<N)*ue.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:H,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<ie.length;be++){we.numFeatures++,ro(we,ie[be],ye,ue);var ge=ie[be].minX,ze=ie[be].minY,et=ie[be].maxX,ct=ie[be].maxY;ge<we.minX&&(we.minX=ge),ze<we.minY&&(we.minY=ze),et>we.maxX&&(we.maxX=et),ct>we.maxY&&(we.maxY=ct)}return we}function ro(ie,N,j,H){var ue=N.geometry,ye=N.type,we=[];if(ye==="Point"||ye==="MultiPoint")for(var be=0;be<ue.length;be+=3)we.push(ue[be]),we.push(ue[be+1]),ie.numPoints++,ie.numSimplified++;else if(ye==="LineString")So(we,ue,ie,j,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(be=0;be<ue.length;be++)So(we,ue[be],ie,j,ye==="Polygon",be===0);else if(ye==="MultiPolygon")for(var ge=0;ge<ue.length;ge++){var ze=ue[ge];for(be=0;be<ze.length;be++)So(we,ze[be],ie,j,!0,be===0)}if(we.length){var et=N.tags||null;if(ye==="LineString"&&H.lineMetrics){for(var ct in et={},N.tags)et[ct]=N.tags[ct];et.mapbox_clip_start=ue.start/ue.size,et.mapbox_clip_end=ue.end/ue.size}var tt={geometry:we,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:et};N.id!==null&&(tt.id=N.id),ie.features.push(tt)}}function So(ie,N,j,H,ue,ye){var we=H*H;if(H>0&&N.size<(ue?we:H))j.numPoints+=N.length/3;else{for(var be=[],ge=0;ge<N.length;ge+=3)(H===0||N[ge+2]>we)&&(j.numSimplified++,be.push(N[ge]),be.push(N[ge+1])),j.numPoints++;ue&&function(ze,et){for(var ct=0,tt=0,zt=ze.length,Dt=zt-2;tt<zt;Dt=tt,tt+=2)ct+=(ze[tt]-ze[Dt])*(ze[tt+1]+ze[Dt+1]);if(ct>0===et)for(tt=0,zt=ze.length;tt<zt/2;tt+=2){var Lt=ze[tt],Gt=ze[tt+1];ze[tt]=ze[zt-2-tt],ze[tt+1]=ze[zt-1-tt],ze[zt-2-tt]=Lt,ze[zt-1-tt]=Gt}}(be,ye),ie.push(be)}}function Fe(ie,N){var j=(N=this.options=function(ue,ye){for(var we in ye)ue[we]=ye[we];return ue}(Object.create(this.options),N)).debug;if(j&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(ue,ye){var we=[];if(ue.type==="FeatureCollection")for(var be=0;be<ue.features.length;be++)Gr(we,ue.features[be],ye,be);else Gr(we,ue.type==="Feature"?ue:{geometry:ue},ye);return we}(ie,N);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(ue,ye){var we=ye.buffer/ye.extent,be=ue,ge=Mr(ue,1,-1-we,we,0,-1,2,ye),ze=Mr(ue,1,1-we,2+we,0,-1,2,ye);return(ge||ze)&&(be=Mr(ue,1,-we,1+we,0,-1,2,ye)||[],ge&&(be=Lr(ge,1).concat(be)),ze&&(be=be.concat(Lr(ze,-1)))),be}(H,N),H.length&&this.splitTile(H,0,0,0),j&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ve(ie,N,j){return 32*((1<<ie)*j+N)+ie}function at(ie,N){const j=ie.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const H=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!H)return N(null,null);const ue=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=we.length,this._features=we}feature(we){return new class{constructor(be){this._feature=be,this.extent=s.EXTENT,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))}loadGeometry(){if(this._feature.type===1){const be=[];for(const ge of this._feature.geometry)be.push([new s.Point(ge[0],ge[1])]);return be}{const be=[];for(const ge of this._feature.geometry){const ze=[];for(const et of ge)ze.push(new s.Point(et[0],et[1]));be.push(ze)}return be}}toGeoJSON(be,ge,ze){return K.call(this,be,ge,ze)}}(this._features[we])}}(H.features);let ye=rn(ue);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),N(null,{vectorTile:ue,rawData:ye.buffer})}Fe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fe.prototype.splitTile=function(ie,N,j,H,ue,ye,we){for(var be=[ie,N,j,H],ge=this.options,ze=ge.debug;be.length;){H=be.pop(),j=be.pop(),N=be.pop(),ie=be.pop();var et=1<<N,ct=Ve(N,j,H),tt=this.tiles[ct];if(!tt&&(ze>1&&console.time("creation"),tt=this.tiles[ct]=To(ie,N,j,H,ge),this.tileCoords.push({z:N,x:j,y:H}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,j,H,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));var zt="z"+N;this.stats[zt]=(this.stats[zt]||0)+1,this.total++}if(tt.source=ie,ue){if(N===ge.maxZoom||N===ue)continue;var Dt=1<<ue-N;if(j!==Math.floor(ye/Dt)||H!==Math.floor(we/Dt))continue}else if(N===ge.indexMaxZoom||tt.numPoints<=ge.indexMaxPoints)continue;if(tt.source=null,ie.length!==0){ze>1&&console.time("clipping");var Lt,Gt,Yt,Dn,Ft,Vn,Ln=.5*ge.buffer/ge.extent,mi=.5-Ln,an=.5+Ln,ur=1+Ln;Lt=Gt=Yt=Dn=null,Ft=Mr(ie,et,j-Ln,j+an,0,tt.minX,tt.maxX,ge),Vn=Mr(ie,et,j+mi,j+ur,0,tt.minX,tt.maxX,ge),ie=null,Ft&&(Lt=Mr(Ft,et,H-Ln,H+an,1,tt.minY,tt.maxY,ge),Gt=Mr(Ft,et,H+mi,H+ur,1,tt.minY,tt.maxY,ge),Ft=null),Vn&&(Yt=Mr(Vn,et,H-Ln,H+an,1,tt.minY,tt.maxY,ge),Dn=Mr(Vn,et,H+mi,H+ur,1,tt.minY,tt.maxY,ge),Vn=null),ze>1&&console.timeEnd("clipping"),be.push(Lt||[],N+1,2*j,2*H),be.push(Gt||[],N+1,2*j,2*H+1),be.push(Yt||[],N+1,2*j+1,2*H),be.push(Dn||[],N+1,2*j+1,2*H+1)}}},Fe.prototype.getTile=function(ie,N,j){var H=this.options,ue=H.extent,ye=H.debug;if(ie<0||ie>24)return null;var we=1<<ie,be=Ve(ie,N=(N%we+we)%we,j);if(this.tiles[be])return Vt(this.tiles[be],ue);ye>1&&console.log("drilling down to z%d-%d-%d",ie,N,j);for(var ge,ze=ie,et=N,ct=j;!ge&&ze>0;)ze--,et=Math.floor(et/2),ct=Math.floor(ct/2),ge=this.tiles[Ve(ze,et,ct)];return ge&&ge.source?(ye>1&&console.log("found parent tile z%d-%d-%d",ze,et,ct),ye>1&&console.time("drilling down"),this.splitTile(ge.source,ze,et,ct,ie,N,j),ye>1&&console.timeEnd("drilling down"),this.tiles[be]?Vt(this.tiles[be],ue):null):null};class Et extends s.VectorTileWorkerSource{constructor(N,j,H,ue,ye){super(N,j,H,ue,at),ye&&(this.loadGeoJSON=ye)}loadData(N,j){const H=N&&N.request,ue=H&&H.collectResourceTiming;this.loadGeoJSON(N,(ye,we)=>{if(ye||!we)return j(ye);if(typeof we!="object")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{Y(we,!0);try{if(N.filter){const ge=s.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(et=>`${et.key}: ${et.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(et=>ge.value.evaluate({zoom:0},et))}}this._geoJSONIndex=N.cluster?new En(function({superclusterOptions:ge,clusterProperties:ze}){if(!ze||!ge)return ge;const et={},ct={},tt={accumulated:null,zoom:0},zt={properties:null},Dt=Object.keys(ze);for(const Lt of Dt){const[Gt,Yt]=ze[Lt],Dn=s.createExpression(Yt),Ft=s.createExpression(typeof Gt=="string"?[Gt,["accumulated"],["get",Lt]]:Gt);et[Lt]=Dn.value,ct[Lt]=Ft.value}return ge.map=Lt=>{zt.properties=Lt;const Gt={};for(const Yt of Dt)Gt[Yt]=et[Yt].evaluate(tt,zt);return Gt},ge.reduce=(Lt,Gt)=>{zt.properties=Gt;for(const Yt of Dt)tt.accumulated=Lt[Yt],Lt[Yt]=ct[Yt].evaluate(tt,zt)},ge}(N)).load(we.features):function(ge,ze){return new Fe(ge,ze)}(we,N.geojsonVtOptions)}catch(ge){return j(ge)}this.loaded={};const be={};if(ue){const ge=s.getPerformanceMeasurement(H);ge&&(be.resourceTiming={},be.resourceTiming[N.source]=JSON.parse(JSON.stringify(ge)))}j(null,be)}})}reloadTile(N,j){const H=this.loaded;return H&&H[N.uid]?super.reloadTile(N,j):this.loadTile(N,j)}loadGeoJSON(N,j){if(N.request)s.getJSON(N.request,j);else{if(typeof N.data!="string")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(N.data))}catch{return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(H){j(H)}}getClusterChildren(N,j){try{j(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(H){j(H)}}getClusterLeaves(N,j){try{j(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(H){j(H)}}}class $t{constructor(N){this.self=N,this.actor=new s.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Et},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,H)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=H},this.self.registerRTLTextPlugin=j=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=j.applyArabicShaping,s.plugin.processBidirectionalText=j.processBidirectionalText,s.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(N,j,H){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],H()}checkIfReady(N,j,H){H()}setReferrer(N,j){this.referrer=j}spriteLoaded(N,j){this.isSpriteLoaded[N]=j;for(const H in this.workerSources[N]){const ue=this.workerSources[N][H];for(const ye in ue)ue[ye]instanceof s.VectorTileWorkerSource&&(ue[ye].isSpriteLoaded=j,ue[ye].fire(new s.Event("isSpriteLoaded")))}}setImages(N,j,H){this.availableImages[N]=j;for(const ue in this.workerSources[N]){const ye=this.workerSources[N][ue];for(const we in ye)ye[we].availableImages=j}H()}enableTerrain(N,j,H){this.terrain=j,H()}setProjection(N,j){this.projections[N]=s.getProjection(j)}setLayers(N,j,H){this.getLayerIndex(N).replace(j),H()}updateLayers(N,j,H){this.getLayerIndex(N).update(j.layers,j.removedIds),H()}loadTile(N,j,H){const ue=this.enableTerrain?s.extend({enableTerrain:this.terrain},j):j;ue.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).loadTile(ue,H)}loadDEMTile(N,j,H){const ue=this.enableTerrain?s.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(N,j.source).loadTile(ue,H)}reloadTile(N,j,H){const ue=this.enableTerrain?s.extend({enableTerrain:this.terrain},j):j;ue.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).reloadTile(ue,H)}abortTile(N,j,H){this.getWorkerSource(N,j.type,j.source).abortTile(j,H)}removeTile(N,j,H){this.getWorkerSource(N,j.type,j.source).removeTile(j,H)}removeSource(N,j,H){if(!this.workerSources[N]||!this.workerSources[N][j.type]||!this.workerSources[N][j.type][j.source])return;const ue=this.workerSources[N][j.type][j.source];delete this.workerSources[N][j.type][j.source],ue.removeSource!==void 0?ue.removeSource(j,H):H()}loadWorkerSource(N,j,H){try{this.self.importScripts(j.url),H()}catch(ue){H(ue.toString())}}syncRTLPluginState(N,j,H){try{s.plugin.setState(j);const ue=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ue!=null){this.self.importScripts(ue);const ye=s.plugin.isParsed();H(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),ye)}}catch(ue){H(ue.toString())}}getAvailableImages(N){let j=this.availableImages[N];return j||(j=[]),j}getLayerIndex(N){let j=this.layerIndexes[N];return j||(j=this.layerIndexes[N]=new U),j}getWorkerSource(N,j,H){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][j]||(this.workerSources[N][j]={}),!this.workerSources[N][j][H]){const ue={send:(ye,we,be,ge,ze,et)=>{this.actor.send(ye,we,be,N,ze,et)},scheduler:this.actor.scheduler};this.workerSources[N][j][H]=new this.workerSourceTypes[j](ue,this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])}return this.workerSources[N][j][H]}getDEMWorkerSource(N,j){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][j]||(this.demWorkerSources[N][j]=new V),this.demWorkerSources[N][j]}enforceCacheSizeLimit(N,j){s.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(N,j,H){H(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $t(self)),$t}),y(["./shared"],function(s){function A(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let c=0;c<d.length;c++)if(!A(d[c],o[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&o!==null){if(typeof o!="object"||Object.keys(d).length!==Object.keys(o).length)return!1;for(const c in d)if(!A(d[c],o[c]))return!1;return!0}return d===o}var R=U;function U(d){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{_=new Worker(T),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(T),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===f.width}()?(V[c=o&&o.failIfMajorPerformanceCaveat]===void 0&&(V[c]=function(f){var _,x=function(T){var S=document.createElement("canvas"),M=Object.create(U.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=T,S.getContext("webgl",M)||S.getContext("experimental-webgl",M)}(f);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(c)),V[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(d)}var V={};function $(d,o,c){const f=s.window.document.createElement(d);return o!==void 0&&(f.className=o),c&&c.appendChild(f),f}function pe(d,o,c){const f=s.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(o))f.setAttributeNS(null,_,o[_]);return c&&c.appendChild(f),f}U.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Y=s.window.document&&s.window.document.documentElement.style,K=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ce;function ee(){Y&&K&&(Ce=Y[K],Y[K]="none")}function ne(){Y&&K&&(Y[K]=Ce)}function ce(d){d.preventDefault(),d.stopPropagation(),s.window.removeEventListener("click",ce,!0)}function se(){s.window.addEventListener("click",ce,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",ce,!0)},0)}function De(d,o){const c=d.getBoundingClientRect();return ut(d,c,o)}function He(d,o){const c=d.getBoundingClientRect(),f=[];for(let _=0;_<o.length;_++)f.push(ut(d,c,o[_]));return f}function Be(d){return s.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function ut(d,o,c){const f=d.offsetWidth===o.width?1:d.offsetWidth/o.width;return new s.Point((c.clientX-o.left)*f,(c.clientY-o.top)*f)}function Ie(d,o){var c=o[0],f=o[1],_=o[2],x=o[3],T=c*x-_*f;return T?(d[0]=x*(T=1/T),d[1]=-f*T,d[2]=-_*T,d[3]=c*T,d):null}function Je(d){const{userImage:o}=d;return!!(o&&o.render&&o.render())&&(d.data.replace(new Uint8Array(o.data.buffer)),!0)}class Rt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,f);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,c){this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),f=!1),f}_validateStretch(o,c){if(!o)return!0;let f=0;for(const _ of o){if(_[0]<f||_[1]<_[0]||c<_[1])return!1;f=_[1]}return!0}_validateContent(o,c){return!(o&&(o.length!==4||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){c.version=this.images[o].version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let f=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(f=!1);this.isLoaded()||f?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const f={};for(const _ of o){this.images[_]||this.fire(new s.Event("styleimagemissing",{id:_}));const x=this.images[_];x?f[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:s.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],f=this.getImage(o);if(!f)return null;if(c&&c.position.version===f.version)return c.position;if(c)c.position.version=f.version;else{const _={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new s.ImagePosition(_,f);this.patterns[o]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(o,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:c,h:f}=s.potpack(o),_=this.atlasImage;_.resize({width:c||1,height:f||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],S=T.x+1,M=T.y+1,z=this.images[x].data,P=z.width,O=z.height;s.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:M},{width:P,height:O}),s.RGBAImage.copy(z,_,{x:0,y:O-1},{x:S,y:M-1},{width:P,height:1}),s.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:M+O},{width:P,height:1}),s.RGBAImage.copy(z,_,{x:P-1,y:0},{x:S-1,y:M},{width:1,height:O}),s.RGBAImage.copy(z,_,{x:0,y:0},{x:S+P,y:M},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const f=this.images[c];Je(f)&&this.updateImage(c,f)}}}const ht=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(d,o){return function([c,f,_]){const x=s.degToRad(f+90),T=s.degToRad(_);return{x:c*Math.cos(x)*Math.sin(T),y:c*Math.sin(x)*Math.sin(T),z:c*Math.cos(T),azimuthal:f,polar:_}}(d.expression.evaluate(o))}interpolate(d,o,c){return{x:s.number(d.x,o.x,c),y:s.number(d.y,o.y,c),z:s.number(d.z,o.z,c),azimuthal:s.number(d.azimuthal,o.azimuthal,c),polar:s.number(d.polar,o.polar,c)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class Ht extends s.Evented{constructor(o){super(),this._transitionable=new s.Transitionable(ht),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(s.validateLight,o,c))for(const f in o){const _=o[f];s.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),_):this._transitionable.setValue(f,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Rn=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let Bt=class extends s.Evented{constructor(d,o){super(),this._transitionable=new s.Transitionable(Rn),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(d){for(const o in d){const c=d[o];s.endsWith(o,"-transition")?this._transitionable.setTransition(o.slice(0,-11),c):this._transitionable.setValue(o,c)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function rn(d,o,c,f){const _=s.smoothstep(45,65,c),[x,T]=vn(d,f),S=s.length(o);let M=1-Math.min(1,Math.exp((S-x)/(T-x)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*d.alpha}function vn(d,o){const c=.5/Math.tan(.5*o);return[d.range[0]+c,d.range[1]+c]}const qe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class St extends s.Evented{constructor(o,c){super(),this._transitionable=new s.Transitionable(qe),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const o=this._transform,c=o.projection.name==="globe",f=s.globeToMercatorTransition(o.zoom),_=this.properties.get("range"),x=[.5,3];return{range:c?[s.number(x[0],_[0],f),s.number(x[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(!this._validate(s.validateFog,o,c)){for(const f of Object.keys(s.spec.fog))o&&o[f]===void 0&&(o[f]=s.spec.fog[f].default);for(const f in o){const _=o[f];s.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),_):this._transitionable.setValue(f,_)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(f,_,x){const T=s.MercatorCoordinate.fromLngLat(_),S=x.elevation?x.elevation.getAtPointOrZero(T):0,M=[T.x,T.y,S];return s.transformMat4(M,M,x.mercatorFogMatrix),rn(f,M,x.pitch,x._fov)}(this.state,o,c):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?vn(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class bt{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const f=this.workerPool.acquire(this.id);for(let _=0;_<f.length;_++){const x=new bt.Actor(f[_],c,this.id);x.name=`Worker ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,f){s.asyncAll(this.actors,(_,x)=>{_.send(o,c,x)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Kt(d,o,c){return o*(s.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}bt.Actor=s.Actor;class xn{constructor(o,c,f,_){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(o,c){let f,_;if(o instanceof s.Point||typeof o[0]=="number"){const x=s.Point.convert(o);f=[x],_=c.isPointAboveHorizon(x)}else{const x=s.Point.convert(o[0]),T=s.Point.convert(o[1]);f=[x,T],_=s.polygonizeBounds(x,T).every(S=>c.isPointAboveHorizon(S))}return new xn(f,c.getCameraPoint(),_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],_=s.polygonizeBounds(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),s.bufferConvexPolygon(_,o)}bufferedCameraGeometryGlobe(o){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],_=s.polygonizeBounds(c,f,o),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>f.y))+((x.x>c.x)+(x.x>f.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(o,c,f,_=0){const x=o.queryPadding/c._pixelsPerMercatorPixel+1,T=f?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let S=o.tileID.wrap+(T.unwrapped?_:0);const M=T.polygon.map(te=>s.getTilePoint(o.tileTransform,te,S));if(!s.polygonIntersectsBox(M,0,0,s.EXTENT,s.EXTENT))return;S=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const z=this.screenGeometryMercator.polygon.map(te=>s.getTileVec3(o.tileTransform,te,S)),P=z.map(te=>new s.Point(te[0],te[1])),O=c.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),G=s.getTileVec3(o.tileTransform,O,S),Z=z.map(te=>{const B=s.sub(te,te,G);return s.normalize(B,B),new s.Ray(G,B)}),J=Kt(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:Z,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(X=s.getBounds(M),X.min.x=s.clamp(X.min.x,0,s.EXTENT),X.min.y=s.clamp(X.min.y,0,s.EXTENT),X.max.x=s.clamp(X.max.x,0,s.EXTENT),X.max.y=s.clamp(X.max.y,0,s.EXTENT),X),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:J};var X}_bufferedScreenMercator(o,c){const f=cr(o);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(o,c){const f=cr(o);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(o,c){const f=function(x,T){const S=s.multiply([],T.pixelMatrix,T.globeMatrix),M=[0,-s.GLOBE_RADIUS,0,1],z=[0,s.GLOBE_RADIUS,0,1],P=[0,0,0,1];s.transformMat4$1(M,M,S),s.transformMat4$1(z,z,S),s.transformMat4$1(P,P,S);const O=new s.Point(M[0]/M[3],M[1]/M[3]),G=new s.Point(z[0]/z[3],z[1]/z[3]),Z=s.polygonContainsPoint(x,O)&&M[3]<P[3],J=s.polygonContainsPoint(x,G)&&z[3]<P[3];if(!Z&&!J)return null;const X=function(ve,Se,Ee){for(let Pe=1;Pe<ve.length;Pe++){const nt=Qt(Se.pointCoordinate3D(ve[Pe-1]).x),Ae=Qt(Se.pointCoordinate3D(ve[Pe]).x);if(Ee<0){if(nt<Ae)return{idx:Pe,t:-nt/(Ae-1-nt)}}else if(Ae<nt)return{idx:Pe,t:(1-nt)/(Ae+1-nt)}}return null}(x,T,Z?-1:1);if(!X)return null;const{idx:te,t:B}=X;let W=te>1?En(x.slice(0,te),T):[],ae=te<x.length?En(x.slice(te),T):[];W=W.map(ve=>new s.Point(Qt(ve.x),ve.y)),ae=ae.map(ve=>new s.Point(Qt(ve.x),ve.y));const le=[...W];le.length===0&&le.push(ae[ae.length-1]);const _e=s.number(le[le.length-1].y,(ae.length===0?W[0]:ae[0]).y,B);let xe;return xe=Z?[new s.Point(0,_e),new s.Point(0,0),new s.Point(1,0),new s.Point(1,_e)]:[new s.Point(1,_e),new s.Point(1,1),new s.Point(0,1),new s.Point(0,_e)],le.push(...xe),ae.length===0?le.push(W[0]):le.push(...ae),{polygon:le.map(ve=>new s.MercatorCoordinate(ve.x,ve.y)),unwrapped:!1}}(o,c);if(f)return f;const _=function(x,T){let S=!1,M=-1/0,z=0;for(let O=0;O<x.length-1;O++)x[O].x>M&&(M=x[O].x,z=O);for(let O=0;O<x.length-1;O++){const G=(z+O)%(x.length-1),Z=x[G],J=x[G+1];Math.abs(Z.x-J.x)>.5&&(Z.x<J.x?(Z.x+=1,G===0&&(x[x.length-1].x+=1)):(J.x+=1,G+1===x.length-1&&(x[0].x+=1)),S=!0)}const P=s.mercatorXfromLng(T.center.lng);return S&&P<Math.abs(P-1)&&x.forEach(O=>{O.x-=1}),{polygon:x,unwrapped:S}}(En(o,c).map(x=>new s.Point(Qt(x.x),x.y)),c);return{polygon:_.polygon.map(x=>new s.MercatorCoordinate(x.x,x.y)),unwrapped:_.unwrapped}}}function En(d,o){return s.resample(d,c=>{const f=o.pointCoordinate3D(c);c.x=f.x,c.y=f.y},1/256)}function Qt(d){return d<0?1+d%1:d%1}function cr(d){return 100*d|0}function Qn(d,o,c,f,_){const x=function(T,S){if(T)return _(T);if(S){d.url&&S.tiles&&d.tiles&&delete d.tiles;const M=s.pick(s.extend(S,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(M.vectorLayers=S.vector_layers,M.vectorLayerIds=M.vectorLayers.map(z=>z.id)),M.tiles=o.canonicalizeTileset(M,d.url),_(null,M)}};return d.url?s.getJSON(o.transformRequest(o.normalizeSourceURL(d.url,null,c,f),s.ResourceType.Source),x):s.exported.frame(()=>x(null,d))}class Rr{constructor(o,c,f){this.bounds=s.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),f=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*c),_=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*c),T=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=f&&o.x<x&&o.y>=_&&o.y<T}}class ai{constructor(o,c,f){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ar={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xo{constructor(o,c,f,_){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let f=0;f<this.attributes.length;f++){const _=c.attributes[this.attributes[f].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,c,f){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],T=c.attributes[x.name];T!==void 0&&o.vertexAttribPointer(T,x.components,o[Ar[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wo extends Xt{getDefault(){return s.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Gr extends Xt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Wo extends Xt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class gn extends Xt{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class qr extends Xt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class bo extends Xt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Qr extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Mr extends Xt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Dr extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ii extends Xt{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Eo extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class ki extends Xt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Pi extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class zi extends Xt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class no extends Xt{getDefault(){return s.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Lr extends Xt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class fi extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Vt extends Xt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ri extends Xt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let To,ro=class extends Xt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class So extends Xt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Fe extends Xt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ve extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class at extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Et extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class $t extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ie extends Xt{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class N extends Xt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class j extends Xt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class H extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ue extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ye extends Xt{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class we extends ye{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class be extends ye{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ge extends be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ze{constructor(o,c,f,_){this.context=o,this.width=c,this.height=f;const x=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new we(o,x),_&&(this.depthAttachment=new be(o,x))}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const f=this.depthAttachment.get();f&&o.deleteRenderbuffer(f)}o.deleteFramebuffer(this.framebuffer)}}class et{constructor(o,c=!1){if(this.gl=o,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const f=o;this.extVertexArrayObject={createVertexArrayOES:f.createVertexArray.bind(o),deleteVertexArrayOES:f.deleteVertexArray.bind(o),bindVertexArrayOES:f.bindVertexArray.bind(o)}}this.clearColor=new wo(this),this.clearDepth=new Gr(this),this.clearStencil=new Wo(this),this.colorMask=new gn(this),this.depthMask=new qr(this),this.stencilMask=new bo(this),this.stencilFunc=new Qr(this),this.stencilOp=new Mr(this),this.stencilTest=new Dr(this),this.depthRange=new Ii(this),this.depthTest=new Eo(this),this.depthFunc=new ki(this),this.blend=new Pi(this),this.blendFunc=new zi(this),this.blendColor=new no(this),this.blendEquation=new Lr(this),this.cullFace=new fi(this),this.cullFaceSide=new Vt(this),this.frontFace=new Ri(this),this.program=new ro(this),this.activeTexture=new So(this),this.viewport=new Fe(this),this.bindFramebuffer=new Ve(this),this.bindRenderbuffer=new at(this),this.bindTexture=new Et(this),this.bindVertexBuffer=new $t(this),this.bindElementBuffer=new ie(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new N(this),this.pixelStoreUnpack=new j(this),this.pixelStoreUnpackPremultiplyAlpha=new H(this),this.pixelStoreUnpackFlipY=new ue(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=o.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&o.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new ai(this,o,c)}createVertexBuffer(o,c,f){return new xo(this,o,c,f)}createRenderbuffer(o,c,f){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,o,c,f),this.bindRenderbuffer.set(null),x}createFramebuffer(o,c,f){return new ze(this,o,c,f)}clear({color:o,depth:c,stencil:f}){const _=this.gl;let x=0;o&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),_.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){A(o.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ct extends s.Evented{constructor(o,c,f,_){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(c,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Qn(this._options,this.map._requestManager,c,f,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.ErrorEvent(_))):x&&(s.extend(this,x),x.bounds&&(this.tileBounds=new Rr(x.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(o,c){const f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(f,s.ResourceType.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",_,x.bind(this));else if(o.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",_,x.bind(this),void 0,!0);else{const T=s.loadVectorTile.call({deduped:this._deduped},_,(S,M)=>{S||!M?x.call(this,S):(_.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},o.actor&&o.actor.send("loadTile",_,x.bind(this),void 0,!0))},!0);o.request={cancel:T}}function x(T,S){return delete o.request,o.aborted?c(null):T&&T.status!==404?c(T):(S&&S.resourceTiming&&(o.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&o.setExpiryData(S),o.loadVectorData(S,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id})}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class tt extends s.Evented{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},c),s.extend(this,s.pick(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qn(this._options,this.map._requestManager,null,null,(c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.ErrorEvent(c)):f&&(s.extend(this,f),f.bounds&&(this.tileBounds=new Rr(f.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(f.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(c)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const f=s.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);o.request=s.getImage(this.map._requestManager.transformRequest(_,s.ResourceType.Tile),(x,T,S,M)=>(delete o.request,o.aborted?(o.state="unloaded",c(null)):x?(o.state="errored",c(x)):T?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:S,expires:M}),o.setTexture(T,this.map.painter),o.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(o,c,f){o.setTexture(c,f)}static unloadTileData(o,c){o.texture&&c.saveTileTexture(o.texture)}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function zt(d,o,c,f,_,x,T,S){const M=[d,c,_,o,f,x,1,1,1],z=[T,S,1],P=s.adjoint([],M),[O,G,Z]=s.transformMat3(z,z,s.transpose(P,P));return s.multiply$1(M,[O,0,0,0,G,0,0,0,Z],M)}class Dt extends s.Evented{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=c,this._dirty=!1}load(o,c){this._loaded=c||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(f,_)=>{if(this._imageRequest=null,this._loaded=!0,f)this.fire(new s.ErrorEvent(f));else if(_){const{HTMLImageElement:x}=s.window;this.image=_ instanceof x?s.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const c=o.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(f){let _=1/0,x=1/0,T=-1/0,S=-1/0;for(const O of f)_=Math.min(_,O.x),x=Math.min(x,O.y),T=Math.max(T,O.x),S=Math.max(S,O.y);const M=Math.max(T-_,S-x),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),P=Math.pow(2,z);return new s.CanonicalTileID(z,Math.floor((_+T)/2*P),Math.floor((x+S)/2*P))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const M in this.tiles){const z=this.tiles[M];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const c=s.tileTransform(this.tileID,this.map.transform.projection),[f,_,x,T]=this.coordinates.map(M=>{const z=c.projection.project(M[0],M[1]);return s.getTilePoint(c,z)._round()});this.perspectiveTransform=function(M,z,P,O,G,Z,J,X,te,B){const W=zt(0,0,M,0,0,z,M,z),ae=zt(P,O,G,Z,J,X,te,B);return s.multiply$1(ae,s.adjoint(W,W),ae),[ae[6]/ae[8]*M/s.EXTENT,ae[7]/ae[8]*z/s.EXTENT]}(this.width,this.height,f.x,f.y,_.x,_.y,T.x,T.y,x.x,x.y);const S=this._boundsArray=new s.StructArrayLayout4i8;S.emplaceBack(f.x,f.y,0,0),S.emplaceBack(_.x,_.y,s.EXTENT,0),S.emplaceBack(T.x,T.y,0,s.EXTENT),S.emplaceBack(x.x,x.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(S,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,c=o.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(o)}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Lt={vector:ct,raster:tt,"raster-dem":class extends tt{constructor(d,o,c,f){super(d,o,c,f),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(d,o){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,x){_&&(d.state="errored",o(_)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",o(null))}d.request=s.getImage(this.map._requestManager.transformRequest(c,s.ResourceType.Tile),function(_,x,T,S){if(delete d.request,d.aborted)d.state="unloaded",o(null);else if(_)d.state="errored",o(_);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:T,expires:S});const M=s.window.ImageBitmap&&x instanceof s.window.ImageBitmap&&(To==null&&(To=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),To),z=1-(x.width-s.prevPowerOfTwo(x.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const P=M?x:s.exported.getImageData(x,z),O={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",O,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const o=d.canonical,c=Math.pow(2,o.z),f=(o.x-1+c)%c,_=o.x===0?d.wrap-1:d.wrap,x=(o.x+1+c)%c,T=o.x+1===c?d.wrap+1:d.wrap,S={};return S[new s.OverscaledTileID(d.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},S[new s.OverscaledTileID(d.overscaledZ,T,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(S[new s.OverscaledTileID(d.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(d.overscaledZ,T,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<c&&(S[new s.OverscaledTileID(d.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(d.overscaledZ,T,o.z,x,o.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends s.Evented{constructor(d,o,c,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=o.data,this._options=s.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},o),this}getClusterChildren(d,o){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},o),this}getClusterLeaves(d,o,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:o,offset:c},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=s.extend({},this.workerOptions),o=this._data;typeof o=="string"?(d.request=this.map._requestManager.transformRequest(s.exported.resolveURL(o),s.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.ErrorEvent(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(_.resourceTiming=f.resourceTiming[this.id]),this.fire(new s.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,o){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,_)=>(delete d.request,d.unloadVectorData(),d.aborted?o(null):f?o(f):(d.loadVectorData(_,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Dt{constructor(d,o,c,f){super(d,o,c,f),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const o of d.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.ResourceType.Source).url);s.getVideo(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new s.ErrorEvent(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const o=this.video.seekable;d<o.start(0)||d>o.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,o=d.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(d,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Dt,canvas:class extends Dt{constructor(d,o,c,f){super(d,o,c,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.Evented{constructor(d,o,c,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rr(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:o,y:c,z:f}=d.canonical;return this._implementation.hasTile({x:o,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,o){const{x:c,y:f,z:_}=d.tileID.canonical,x=new s.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:_},{signal:x.signal})).then(function(T){return delete d.request,d.aborted?(d.state="unloaded",o(null)):T===void 0?(d.state="errored",o(null)):T===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",o(null)):function(S){return S instanceof s.window.ImageData||S instanceof s.window.HTMLCanvasElement||S instanceof s.window.ImageBitmap||S instanceof s.window.HTMLImageElement}(T)?(this.loadTileData(d,T),d.state="loaded",void o(null)):(d.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.code!==20&&(d.state="errored",o(T))}),d.request.cancel=()=>x.abort()}loadTileData(d,o){tt.loadTileData(d,o,this._map.painter)}unloadTileData(d){tt.unloadTileData(d,this._map.painter)}unloadTile(d,o){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:c,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:_})}o()}abortTile(d,o){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Gt=function(d,o,c,f){const _=new Lt[o.type](d,o,c,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Yt(d,o){const c=s.identity([]);return s.scale(c,c,[.5*d.width,.5*-d.height,1]),s.translate(c,c,[1,-1,0]),s.multiply(c,c,d.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(c)}function Dn(d,o,c,f,_,x,T,S=!1){const M=d.tilesIn(f,T,S);M.sort(Vn);const z=[];for(const O of M)z.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,c,d._state,O,_,x,Yt(d.transform,O.tile.tileID),S)});const P=function(O){const G={},Z={};for(const J of O){const X=J.queryResults,te=J.wrappedTileID,B=Z[te]=Z[te]||{};for(const W in X){const ae=X[W],le=B[W]=B[W]||{},_e=G[W]=G[W]||[];for(const xe of ae)le[xe.featureIndex]||(le[xe.featureIndex]=!0,_e.push(xe))}}return G}(z);for(const O in P)P[O].forEach(G=>{const Z=G.feature,J=Z.layer;J&&J.type!=="background"&&J.type!=="sky"&&(Z.source=J.source,J["source-layer"]&&(Z.sourceLayer=J["source-layer"]),Z.state=Z.id!==void 0?d.getFeatureState(J["source-layer"],Z.id):{})});return P}function Ft(d,o){const c=d.getRenderableIds().map(x=>d.getTileByID(x)),f=[],_={};for(let x=0;x<c.length;x++){const T=c[x],S=T.tileID.canonical.key;_[S]||(_[S]=!0,T.querySourceFeatures(f,o))}return f}function Vn(d,o){const c=d.tileID,f=o.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function Ln(){return Xa.workerClass!=null?new Xa.workerClass:new s.window.Worker(Xa.workerUrl)}const mi="mapboxgl_preloaded_worker_pool";class an{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<an.workerCount;)this.workers.push(new Ln);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mi]}numActive(){return Object.keys(this.active).length}}let ur;function Zo(){return ur||(ur=new an),ur}function Vh(d,o){const c={};for(const f in d)f!=="ref"&&(c[f]=d[f]);return s.refProperties.forEach(f=>{f in o&&(c[f]=o[f])}),c}function Uf(d){d=d.slice();const o=Object.create(null);for(let c=0;c<d.length;c++)o[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=Vh(d[c],o[d[c].ref]));return d}an.workerCount=2;const pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function $h(d,o,c){c.push({command:pn.addSource,args:[d,o[d]]})}function zl(d,o,c){o.push({command:pn.removeSource,args:[d]}),c[d]=!0}function Gh(d,o,c,f){zl(d,c,f),$h(d,o,c)}function Uc(d,o,c){let f;for(f in d[c])if(d[c].hasOwnProperty(f)&&f!=="data"&&!A(d[c][f],o[c][f]))return!1;for(f in o[c])if(o[c].hasOwnProperty(f)&&f!=="data"&&!A(d[c][f],o[c][f]))return!1;return!0}function Co(d,o,c,f,_,x){let T;for(T in o=o||{},d=d||{})d.hasOwnProperty(T)&&(A(d[T],o[T])||c.push({command:x,args:[f,T,o[T],_]}));for(T in o)o.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(A(d[T],o[T])||c.push({command:x,args:[f,T,o[T],_]}))}function Ho(d){return d.id}function qh(d,o){return d[o.id]=o,d}class Wh{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.clamp(o,0,1);let c=1,f=this._distances[c];const _=o*this.paddedLength+this.padding;for(;f<_&&c<this._distances.length;)f=this._distances[++c];const x=c-1,T=this._distances[x],S=f-T,M=S>0?(_-T)/S:0;return this.points[x].mult(1-M).add(this.points[c].mult(M))}}class qs{constructor(o,c,f){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(c/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,f,_,x){this._forEachCell(c,f,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(o,c,f,_){this._forEachCell(c-_,f-_,c+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(f),this.circles.push(_)}_insertBoxCell(o,c,f,_,x,T){this.boxCells[x].push(T)}_insertCircleCell(o,c,f,_,x,T){this.circleCells[x].push(T)}_query(o,c,f,_,x,T){if(f<0||o>this.width||_<0||c>this.height)return!x&&[];const S=[];if(o<=0&&c<=0&&this.width<=f&&this.height<=_){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const z=this.circles[3*M],P=this.circles[3*M+1],O=this.circles[3*M+2];S.push({key:this.circleKeys[M],x1:z-O,y1:P-O,x2:z+O,y2:P+O})}return T?S.filter(T):S}return this._forEachCell(o,c,f,_,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?S.length>0:S}_queryCircle(o,c,f,_,x){const T=o-f,S=o+f,M=c-f,z=c+f;if(S<0||T>this.width||z<0||M>this.height)return!_&&[];const P=[];return this._forEachCell(T,M,S,z,this._queryCellCircle,P,{hitTest:_,circle:{x:o,y:c,radius:f},seenUids:{box:{},circle:{}}},x),_?P.length>0:P}query(o,c,f,_,x){return this._query(o,c,f,_,!1,x)}hitTest(o,c,f,_,x){return this._query(o,c,f,_,!0,x)}hitTestCircle(o,c,f,_){return this._queryCircle(o,c,f,!0,_)}_queryCell(o,c,f,_,x,T,S,M){const z=S.seenUids,P=this.boxCells[x];if(P!==null){const G=this.bboxes;for(const Z of P)if(!z.box[Z]){z.box[Z]=!0;const J=4*Z;if(o<=G[J+2]&&c<=G[J+3]&&f>=G[J+0]&&_>=G[J+1]&&(!M||M(this.boxKeys[Z]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:G[J],y1:G[J+1],x2:G[J+2],y2:G[J+3]})}}}const O=this.circleCells[x];if(O!==null){const G=this.circles;for(const Z of O)if(!z.circle[Z]){z.circle[Z]=!0;const J=3*Z;if(this._circleAndRectCollide(G[J],G[J+1],G[J+2],o,c,f,_)&&(!M||M(this.circleKeys[Z]))){if(S.hitTest)return T.push(!0),!0;{const X=G[J],te=G[J+1],B=G[J+2];T.push({key:this.circleKeys[Z],x1:X-B,y1:te-B,x2:X+B,y2:te+B})}}}}}_queryCellCircle(o,c,f,_,x,T,S,M){const z=S.circle,P=S.seenUids,O=this.boxCells[x];if(O!==null){const Z=this.bboxes;for(const J of O)if(!P.box[J]){P.box[J]=!0;const X=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,Z[X+0],Z[X+1],Z[X+2],Z[X+3])&&(!M||M(this.boxKeys[J])))return T.push(!0),!0}}const G=this.circleCells[x];if(G!==null){const Z=this.circles;for(const J of G)if(!P.circle[J]){P.circle[J]=!0;const X=3*J;if(this._circlesCollide(Z[X],Z[X+1],Z[X+2],z.x,z.y,z.radius)&&(!M||M(this.circleKeys[J])))return T.push(!0),!0}}}_forEachCell(o,c,f,_,x,T,S,M){const z=this._convertToXCellCoord(o),P=this._convertToYCellCoord(c),O=this._convertToXCellCoord(f),G=this._convertToYCellCoord(_);for(let Z=z;Z<=O;Z++)for(let J=P;J<=G;J++)if(x.call(this,o,c,f,_,this.xCellCount*J+Z,T,S,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,f,_,x,T){const S=_-o,M=x-c,z=f+T;return z*z>S*S+M*M}_circleAndRectCollide(o,c,f,_,x,T,S){const M=(T-_)/2,z=Math.abs(o-(_+M));if(z>M+f)return!1;const P=(S-x)/2,O=Math.abs(c-(x+P));if(O>P+f)return!1;if(z<=M||O<=P)return!0;const G=z-M,Z=O-P;return G*G+Z*Z<=f*f}}const Xo={unknown:0,flipRequired:1,flipNotRequired:2},Rl=Math.tan(85*Math.PI/180);function je(d,o,c,f,_,x,T){const S=s.create();if(c)if(x.name==="globe"){const M=s.calculateGlobeLabelMatrix(_,o);s.multiply(S,S,M)}else{const M=Ie([],T);S[0]=M[0],S[1]=M[1],S[4]=M[2],S[5]=M[3],f||s.rotateZ(S,S,_.angle)}else s.multiply(S,_.labelPlaneMatrix,d);return S}function Ko(d,o,c,f,_,x,T){const S=je(d,o,c,f,_,x,T);return x.name==="globe"&&c||(S[2]=S[6]=S[10]=S[14]=0),S}function hr(d,o,c,f,_,x,T){if(c){if(x.name==="globe"){const S=je(d,o,c,f,_,x,T);return s.invert(S,S),s.multiply(S,d,S),S}{const S=s.clone(d),M=s.identity([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],s.multiply(S,S,M),f||s.rotateZ(S,S,-_.angle),S}}return _.glCoordMatrix}function Or(d,o,c,f){const _=[d,o,c,1];c?s.transformMat4$1(_,_,f):tn(_,_,f);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function Vf(d,o){return Math.min(.5+d/o*.5,1.5)}function Ao(d,o){const c=d[0]/d[3],f=d[1]/d[3];return c>=-o[0]&&c<=o[0]&&f>=-o[1]&&f<=o[1]}function Zh(d,o,c,f,_,x,T,S,M,z){const P=c.transform,O=f?d.textSizeData:d.iconSizeData,G=s.evaluateSizeForZoom(O,c.transform.zoom),Z=P.projection.name==="globe",J=[256/c.width*2+1,256/c.height*2+1],X=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;X.clear();let te=null;Z&&(te=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const B=d.lineVertexArray,W=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,ae=c.transform.width/c.transform.height;let le,_e=!1;for(let xe=0;xe<W.length;xe++){const ve=W.get(xe),{numGlyphs:Se,writingMode:Ee}=ve;if(Ee!==s.WritingMode.vertical||_e||le===s.WritingMode.horizontal||(_e=!0),le=Ee,(ve.hidden||Ee===s.WritingMode.vertical)&&!_e){io(Se,X);continue}_e=!1;const Pe=new s.Point(ve.tileAnchorX,ve.tileAnchorY);let{x:nt,y:Ae,z:Ge}=P.projection.projectTilePoint(Pe.x,Pe.y,z.canonical);if(M){const[Ot,xt,kt]=M(Pe);nt+=Ot,Ae+=xt,Ge+=kt}const Le=[nt,Ae,Ge,1];if(s.transformMat4$1(Le,Le,o),!Ao(Le,J)){io(Se,X);continue}const Qe=Vf(c.transform.cameraToCenterDistance,Le[3]),ke=s.evaluateSizeForFeature(O,G,ve),$e=T?ke/Qe:ke*Qe,it=Or(nt,Ae,Ge,_);if(it[3]<=0){io(Se,X);continue}let Xe={};const ot=T?null:M,Ct=_t(ve,$e,!1,S,o,_,x,d.glyphOffsetArray,B,X,te,it,Pe,Xe,ae,ot,P.projection,z,T);_e=Ct.useVertical,ot&&Ct.needsFlipping&&(Xe={}),(Ct.notEnoughRoom||_e||Ct.needsFlipping&&_t(ve,$e,!0,S,o,_,x,d.glyphOffsetArray,B,X,te,it,Pe,Xe,ae,ot,P.projection,z,T).notEnoughRoom)&&io(Se,X)}f?(d.text.dynamicLayoutVertexBuffer.updateData(X),te&&d.text.globeExtVertexBuffer.updateData(te)):(d.icon.dynamicLayoutVertexBuffer.updateData(X),te&&d.icon.globeExtVertexBuffer.updateData(te))}function $f(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X){const{lineStartIndex:te,glyphStartIndex:B,segment:W}=S,ae=B+S.numGlyphs,le=te+S.lineLength,_e=o.getoffsetX(B),xe=o.getoffsetX(ae-1),ve=Di(d*_e,c,f,_,x,T,W,te,le,M,z,P,O,G,!0,Z,J,X);if(!ve)return null;const Se=Di(d*xe,c,f,_,x,T,W,te,le,M,z,P,O,G,!0,Z,J,X);return Se?{first:ve,last:Se}:null}function za(d,o,c,f){return d===s.WritingMode.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:d===s.WritingMode.vertical?f>0?{needsFlipping:!0}:null:o!==Xo.unknown&&function(_,x){return _===0||Math.abs(x/_)>Rl}(c,f)?o===Xo.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function _t(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X,te,B,W){const ae=o/24,le=d.lineOffsetX*ae,_e=d.lineOffsetY*ae,{lineStartIndex:xe,glyphStartIndex:ve,numGlyphs:Se,segment:Ee,writingMode:Pe,flipState:nt}=d,Ae=xe+d.lineLength,Ge=Le=>{if(P){const[it,Xe,ot]=Le.up,Ct=z.length;s.updateGlobeVertexNormal(P,Ct+0,it,Xe,ot),s.updateGlobeVertexNormal(P,Ct+1,it,Xe,ot),s.updateGlobeVertexNormal(P,Ct+2,it,Xe,ot),s.updateGlobeVertexNormal(P,Ct+3,it,Xe,ot)}const[Qe,ke,$e]=Le.point;s.addDynamicAttributes(z,Qe,ke,$e,Le.angle)};if(Se>1){const Le=$f(ae,S,le,_e,c,O,G,d,M,x,Z,X,!1,te,B,W);if(!Le)return{notEnoughRoom:!0};if(f&&!c){let[Qe,ke,$e]=Le.first.point,[it,Xe,ot]=Le.last.point;[Qe,ke]=Or(Qe,ke,$e,T),[it,Xe]=Or(it,Xe,ot,T);const Ct=za(Pe,nt,(it-Qe)*J,Xe-ke);if(d.flipState=Ct&&Ct.needsFlipping?Xo.flipRequired:Xo.flipNotRequired,Ct)return Ct}Ge(Le.first);for(let Qe=ve+1;Qe<ve+Se-1;Qe++){const ke=Di(ae*S.getoffsetX(Qe),le,_e,c,O,G,Ee,xe,Ae,M,x,Z,X,!1,!1,te,B,W);if(!ke)return z.length-=4*(Qe-ve),{notEnoughRoom:!0};Ge(ke)}Ge(Le.last)}else{if(f&&!c){const Qe=Or(G.x,G.y,0,_),ke=xe+Ee+1,$e=new s.Point(M.getx(ke),M.gety(ke)),it=Or($e.x,$e.y,0,_),Xe=it[3]>0?it:en(G,$e,Qe,1,_,void 0,te,B.canonical),ot=za(Pe,nt,(Xe[0]-Qe[0])*J,Xe[1]-Qe[1]);if(d.flipState=ot&&ot.needsFlipping?Xo.flipRequired:Xo.flipNotRequired,ot)return ot}const Le=Di(ae*S.getoffsetX(ve),le,_e,c,O,G,Ee,xe,Ae,M,x,Z,X,!1,!1,te,B,W);if(!Le)return{notEnoughRoom:!0};Ge(Le)}return{}}function on(d,o,c,f,_){const{x,y:T,z:S}=f.projectTilePoint(d.x,d.y,o);if(!_)return Or(x,T,S,c);const[M,z,P]=_(d);return Or(x+M,T+z,S+P,c)}function en(d,o,c,f,_,x,T,S){const M=on(d.sub(o)._unit()._add(d),S,_,T,x);return s.sub(M,c,M),s.normalize(M,M),s.scaleAndAdd(M,c,M,f)}function Di(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X,te,B){const W=f?d-o:d+o;let ae=W>0?1:-1,le=0;f&&(ae*=-1,le=Math.PI),ae<0&&(le+=Math.PI);let _e=S+T+(ae>0?0:1)|0,xe=_,ve=_,Se=0,Ee=0;const Pe=Math.abs(W),nt=[],Ae=[];let Ge=x,Le=Ge;const Qe=()=>en(Le,Ge,ve,Pe-Se+1,P,G,X,te.canonical);for(;Se+Ee<=Pe;){if(_e+=ae,_e<S||_e>=M)return null;if(ve=xe,Le=Ge,nt.push(ve),Z&&Ae.push(Le),Ge=new s.Point(z.getx(_e),z.gety(_e)),xe=O[_e],!xe){const kt=on(Ge,te.canonical,P,X,G);xe=kt[3]>0?O[_e]=kt:Qe()}Se+=Ee,Ee=s.distance(ve,xe)}J&&G&&(O[_e]&&(xe=Qe(),Ee=s.distance(ve,xe)),O[_e]=xe);const ke=(Pe-Se)/Ee,$e=Ge.sub(Le)._mult(ke)._add(Le),it=s.sub([],xe,ve),Xe=s.scaleAndAdd([],ve,it,ke);let ot=[0,0,1],Ct=it[0],Ot=it[1];if(B&&(ot=X.upVector(te.canonical,$e.x,$e.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const kt=[ot[2],0,-ot[0]],nn=s.cross([],ot,kt);s.normalize(kt,kt),s.normalize(nn,nn),Ct=s.dot(it,kt),Ot=s.dot(it,nn)}if(c){const kt=s.cross([],ot,it);s.normalize(kt,kt),s.scaleAndAdd(Xe,Xe,kt,c*ae)}const xt=le+Math.atan2(Ot,Ct);return nt.push(Xe),Z&&Ae.push($e),{point:Xe,angle:xt,path:nt,tilePath:Ae,up:ot}}function io(d,o){const c=o.length,f=c+4*d;o.resize(f),o.float32.fill(-1/0,4*c,4*f)}function tn(d,o,c){const f=o[0],_=o[1];return d[0]=c[0]*f+c[4]*_+c[12],d[1]=c[1]*f+c[5]*_+c[13],d[3]=c[3]*f+c[7]*_+c[15],d}const Li=100;class Dl{constructor(o,c,f=new qs(o.width+200,o.height+200,25),_=new qs(o.width+200,o.height+200,25)){this.transform=o,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Li,this.screenBottomBoundary=o.height+Li,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,f,_,x,T,S,M){let z=f.projectedAnchorX,P=f.projectedAnchorY,O=f.projectedAnchorZ;const G=f.elevation,Z=f.tileID,J=o.getProjection();if(G&&Z){const[xe,ve,Se]=J.upVector(Z.canonical,f.tileAnchorX,f.tileAnchorY),Ee=J.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=xe*G*Ee,P+=ve*G*Ee,O+=Se*G*Ee}const X=this.projectAndGetPerspectiveRatio(S,z,P,O,f.tileID,J.name==="globe"||!!G||this.transform.pitch>0,J),te=T*X.perspectiveRatio,B=(f.x1*c+_.x-f.padding)*te+X.point.x,W=(f.y1*c+_.y-f.padding)*te+X.point.y,ae=(f.x2*c+_.x+f.padding)*te+X.point.x,le=(f.y2*c+_.y+f.padding)*te+X.point.y,_e=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(B,W,ae,le)||!x&&this.grid.hitTest(B,W,ae,le,M)||_e?{box:[],offscreen:!1,occluded:X.occluded}:{box:[B,W,ae,le],offscreen:this.isOffscreen(B,W,ae,le),occluded:!1}}placeCollisionCircles(o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X){const te=[],B=this.transform.elevation,W=o.getProjection(),ae=B?B.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,W):null,le=new s.Point(f.tileAnchorX,f.tileAnchorY);let{x:_e,y:xe,z:ve}=W.projectTilePoint(le.x,le.y,X.canonical);if(ae){const[$e,it,Xe]=ae(le);_e+=$e,xe+=it,ve+=Xe}const Se=W.name==="globe",Ee=this.projectAndGetPerspectiveRatio(S,_e,xe,ve,X,Se||!!B||this.transform.pitch>0,W),{perspectiveRatio:Pe}=Ee,nt=(O?T/Pe:T*Pe)/s.ONE_EM,Ae=Or(_e,xe,ve,M),Ge=Ee.signedDistanceFromCamera>0?$f(nt,x,f.lineOffsetX*nt,f.lineOffsetY*nt,!1,Ae,le,f,_,M,{},B&&!O?ae:null,O&&!!B,W,X,O):null;let Le=!1,Qe=!1,ke=!0;if(Ge&&!Ee.occluded){const $e=.5*Z*Pe+J,it=new s.Point(-100,-100),Xe=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),ot=new Wh,{first:Ct,last:Ot}=Ge,xt=Ct.path.length;let kt=[];for(let Tt=xt-1;Tt>=1;Tt--)kt.push(Ct.path[Tt]);for(let Tt=1;Tt<Ot.path.length;Tt++)kt.push(Ot.path[Tt]);const nn=2.5*$e;z&&(kt=kt.map(([Tt,_n,Tn],Sn)=>(ae&&!Se&&(Tn=ae(Sn<xt-1?Ct.tilePath[xt-1-Sn]:Ot.tilePath[Sn-xt+2])[2]),Or(Tt,_n,Tn,z))),kt.some(Tt=>Tt[3]<=0)&&(kt=[]));let Jt=[];if(kt.length>0){let Tt=1/0,_n=-1/0,Tn=1/0,Sn=-1/0;for(const Cn of kt)Tt=Math.min(Tt,Cn[0]),Tn=Math.min(Tn,Cn[1]),_n=Math.max(_n,Cn[0]),Sn=Math.max(Sn,Cn[1]);_n>=it.x&&Tt<=Xe.x&&Sn>=it.y&&Tn<=Xe.y&&(Jt=[kt.map(Cn=>new s.Point(Cn[0],Cn[1]))],(Tt<it.x||_n>Xe.x||Tn<it.y||Sn>Xe.y)&&(Jt=s.clipLine(Jt,it.x,it.y,Xe.x,Xe.y)))}for(const Tt of Jt){ot.reset(Tt,.25*$e);let _n=0;_n=ot.length<=.5*$e?1:Math.ceil(ot.paddedLength/nn)+1;for(let Tn=0;Tn<_n;Tn++){const Sn=Tn/Math.max(_n-1,1),Cn=ot.lerp(Sn),ti=Cn.x+Li,Fr=Cn.y+Li;te.push(ti,Fr,$e,0);const qi=ti-$e,Po=Fr-$e,Xn=ti+$e,An=Fr+$e;if(ke=ke&&this.isOffscreen(qi,Po,Xn,An),Qe=Qe||this.isInsideGrid(qi,Po,Xn,An),!c&&this.grid.hitTestCircle(ti,Fr,$e,G)&&(Le=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!P&&Le||!Qe?[]:te,offscreen:ke,collisionDetected:Le,occluded:Ee.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let f=1/0,_=1/0,x=-1/0,T=-1/0;for(const P of o){const O=new s.Point(P.x+Li,P.y+Li);f=Math.min(f,O.x),_=Math.min(_,O.y),x=Math.max(x,O.x),T=Math.max(T,O.y),c.push(O)}const S=this.grid.query(f,_,x,T).concat(this.ignoredGrid.query(f,_,x,T)),M={},z={};for(const P of S){const O=P.key;if(M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]={}),M[O.bucketInstanceId][O.featureIndex])continue;const G=[new s.Point(P.x1,P.y1),new s.Point(P.x2,P.y1),new s.Point(P.x2,P.y2),new s.Point(P.x1,P.y2)];s.polygonIntersectsPolygon(c,G)&&(M[O.bucketInstanceId][O.featureIndex]=!0,z[O.bucketInstanceId]===void 0&&(z[O.bucketInstanceId]=[]),z[O.bucketInstanceId].push(O.featureIndex))}return z}insertCollisionBox(o,c,f,_,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,f,_,x){const T=c?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:_,collisionGroupID:x};for(let M=0;M<o.length;M+=4)T.insertCircle(S,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,c,f,_,x,T,S){const M=[c,f,_,1];let z=!1;_||this.transform.pitch>0?(s.transformMat4$1(M,M,o),this.fogState&&x&&S.name!=="globe"&&(z=function(G,Z,J,X,te,B){const W=B.calculateFogTileMatrix(te),ae=[Z,J,X];return s.transformMat4(ae,ae,W),rn(G,ae,B.pitch,B._fov)}(this.fogState,c,f,_,x.toUnwrapped(),this.transform)>.9)):tn(M,M,o);const P=M[3];return{point:new s.Point((M[0]/P+1)/2*this.transform.width+Li,(-M[1]/P+1)/2*this.transform.height+Li),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/P*.5,1.5),signedDistanceFromCamera:P,occluded:T&&M[2]>P||z}}isOffscreen(o,c,f,_){return f<Li||o>=this.screenRightBoundary||_<Li||c>this.screenBottomBoundary}isInsideGrid(o,c,f,_){return f>=0&&o<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=s.identity([]);return s.translate(o,o,[-100,-100,0]),o}}function Ws(d,o,c){const f=o.createTileMatrix(d,d.worldSize,c.toUnwrapped());return s.multiply(new Float32Array(16),d.projMatrix,f)}function Ui(d,o,c){if(o.projection.name===c.projection.name)return d.projMatrix;const f=c.clone();return f.setProjection(o.projection),Ws(f,o.getProjection(),d)}function Hn(d,o,c){return o.name===c.projection.name?d.projMatrix:Ws(c,o,d)}class Gf{constructor(o,c,f,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Yo{constructor(o,c,f,_,x,T=!1){this.text=new Gf(o?o.text:null,c,f,x),this.icon=new Gf(o?o.icon:null,c,_,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ll{constructor(o,c,f,_=!1){this.text=o,this.icon=c,this.skipFade=f,this.clipped=_}}class Ol{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Hh{constructor(o,c,f,_,x){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=x}}class qf{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[o]}}function Bl(d,o,c,f,_){const{horizontalAlign:x,verticalAlign:T}=s.getAnchorAlignment(d),S=-(x-.5)*o,M=-(T-.5)*c,z=s.evaluateVariableOffset(d,f);return new s.Point(S+z[0]*_,M+z[1]*_)}function Fl(d,o,c,f,_){const x=new s.Point(d,o);return c&&x._rotate(f?_:-_),x}class Vc{constructor(o,c,f,_,x){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Dl(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new qf(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,f,_){const x=f.getBucket(c),T=f.latestFeatureIndex;if(!x||!T||c.id!==x.layerIds[0])return;const S=x.layers[0].layout,M=f.collisionBoxArray,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),P=f.tileSize/s.EXTENT,O=f.tileID.toUnwrapped();this.transform.setProjection(x.projection);const G=(Z=f.tileID,J=x.getProjection(),X=this.transform,J.name===this.projection?X.calculateProjMatrix(Z.toUnwrapped()):Ws(X,J,Z));var Z,J,X;const te=S.get("text-pitch-alignment")==="map",B=S.get("text-rotation-alignment")==="map";c.compileFilter();const W=c.dynamicFilter(),ae=c.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(f),_e=Ko(G,f.tileID.canonical,te,B,this.transform,x.getProjection(),le);let xe=null;if(te){const Ee=hr(G,f.tileID.canonical,te,B,this.transform,x.getProjection(),le);xe=s.multiply([],this.transform.labelPlaneMatrix,Ee)}let ve=null;W&&f.latestFeatureIndex&&(ve={unwrappedTileID:O,dynamicFilter:W,dynamicFilterNeedsFeature:ae,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Hh(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,f.tileID);const Se={bucket:x,layout:S,posMatrix:G,textLabelPlaneMatrix:_e,labelToScreenMatrix:xe,clippingData:ve,scale:z,textPixelRatio:P,holdingForFade:f.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const Ee of x.sortKeyRanges){const{sortKey:Pe,symbolInstanceStart:nt,symbolInstanceEnd:Ae}=Ee;o.push({sortKey:Pe,symbolInstanceStart:nt,symbolInstanceEnd:Ae,parameters:Se})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X,te,B,W){const{textOffset0:ae,textOffset1:le,crossTileID:_e}=G,xe=[ae,le],ve=Bl(o,f,_,xe,x),Se=this.collisionIndex.placeCollisionBox(J,x,c,Fl(ve.x,ve.y,T,S,this.transform.angle),O,M,z,P.predicate);if(te){const Ee=J.getSymbolInstanceIconSize(W,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,Ee,te,Fl(ve.x,ve.y,T,S,this.transform.angle),O,M,z,P.predicate).box.length===0)return}if(Se.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Ee=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:xe,width:f,height:_,anchor:o,textScale:x,prevAnchor:Ee},this.markUsedJustification(J,o,G,X),J.allowVerticalPlacement&&(this.markUsedOrientation(J,X,G),this.placedOrientations[_e]=X),{shift:ve,placedGlyphBoxes:Se}}}placeLayerBucketPart(o,c,f,_){const{bucket:x,layout:T,posMatrix:S,textLabelPlaneMatrix:M,labelToScreenMatrix:z,clippingData:P,textPixelRatio:O,holdingForFade:G,collisionBoxArray:Z,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:X,collisionGroup:te}=o.parameters,B=T.get("text-optional"),W=T.get("icon-optional"),ae=T.get("text-allow-overlap"),le=T.get("icon-allow-overlap"),_e=T.get("text-rotation-alignment")==="map",xe=T.get("text-pitch-alignment")==="map",ve=T.get("icon-text-fit")!=="none",Se=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let Ee=ae&&(le||!x.hasIconData()||W),Pe=le&&(ae||!x.hasTextData()||B);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),f&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);const nt=(Ae,Ge,Le)=>{const{crossTileID:Qe,numVerticalGlyphVertices:ke}=Ae;if(P){const Xn={zoom:this.transform.zoom,pitch:this.transform.pitch};let An=null;if(P.dynamicFilterNeedsFeature){const hn=this.retainedQueryData[x.bucketInstanceId];An=P.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:hn.bucketIndex,sourceLayerIndex:hn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(Xn,An,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new s.Point(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[Qe]=new Ll(!1,!1,!1,!0),void c.add(Qe)}if(c.has(Qe))return;if(G)return void(this.placements[Qe]=new Ll(!1,!1,!1));let $e=!1,it=!1,Xe=!0,ot=!1,Ct=!1,Ot=null,xt={box:null,offscreen:null,occluded:null},kt={box:null,offscreen:null,occluded:null},nn=null,Jt=null,Tt=null,_n=0,Tn=0,Sn=0;Le.textFeatureIndex?_n=Le.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(_n=Ae.featureIndex),Le.verticalTextFeatureIndex&&(Tn=Le.verticalTextFeatureIndex);const Cn=Xn=>{Xn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const An=this.transform.elevation;(An||Xn.elevation)&&(Xn.elevation=An?An.getAtTileOffset(Xn.tileID,Xn.tileAnchorX,Xn.tileAnchorY):0)},ti=Le.textBox;if(ti){Cn(ti);const Xn=hn=>{let dr=s.WritingMode.horizontal;if(x.allowVerticalPlacement&&!hn&&this.prevPlacement){const li=this.prevPlacement.placedOrientations[Qe];li&&(this.placedOrientations[Qe]=li,dr=li,this.markUsedOrientation(x,dr,Ae))}return dr},An=(hn,dr)=>{if(x.allowVerticalPlacement&&ke>0&&Le.verticalTextBox){for(const li of x.writingModes)if(li===s.WritingMode.vertical?(xt=dr(),kt=xt):xt=hn(),xt&&xt.box&&xt.box.length)break}else xt=hn()};if(T.get("text-variable-anchor")){let hn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]){const qn=this.prevPlacement.variableOffsets[Qe];hn.indexOf(qn.anchor)>0&&(hn=hn.filter(yi=>yi!==qn.anchor),hn.unshift(qn.anchor))}const dr=(qn,yi,mu)=>{const ea=x.getSymbolInstanceTextSize(J,Ae,this.transform.zoom,Ge),ic=(qn.x2-qn.x1)*ea+2*qn.padding,is=(qn.y2-qn.y1)*ea+2*qn.padding,Ts=ve&&!le?yi:null;Ts&&Cn(Ts);let ta={box:[],offscreen:!1,occluded:!1};const gu=ae?2*hn.length:hn.length;for(let oc=0;oc<gu;++oc){const Fd=this.attemptAnchorPlacement(hn[oc%hn.length],qn,ic,is,ea,_e,xe,O,S,te,oc>=hn.length,Ae,Ge,x,mu,Ts,J,X);if(Fd&&(ta=Fd.placedGlyphBoxes,ta&&ta.box&&ta.box.length)){$e=!0,Ot=Fd.shift;break}}return ta};An(()=>dr(ti,Le.iconBox,s.WritingMode.horizontal),()=>{const qn=Le.verticalTextBox;return qn&&Cn(qn),x.allowVerticalPlacement&&!(xt&&xt.box&&xt.box.length)&&ke>0&&qn?dr(qn,Le.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),xt&&($e=xt.box,Xe=xt.offscreen,ot=xt.occluded);const li=Xn(!(!xt||!xt.box));if(!$e&&this.prevPlacement){const qn=this.prevPlacement.variableOffsets[Qe];qn&&(this.variableOffsets[Qe]=qn,this.markUsedJustification(x,qn.anchor,Ae,li))}}else{const hn=(dr,li)=>{const qn=x.getSymbolInstanceTextSize(J,Ae,this.transform.zoom,Ge),yi=this.collisionIndex.placeCollisionBox(x,qn,dr,new s.Point(0,0),ae,O,S,te.predicate);return yi&&yi.box&&yi.box.length&&(this.markUsedOrientation(x,li,Ae),this.placedOrientations[Qe]=li),yi};An(()=>hn(ti,s.WritingMode.horizontal),()=>{const dr=Le.verticalTextBox;return x.allowVerticalPlacement&&ke>0&&dr?(Cn(dr),hn(dr,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Xn(!!(xt&&xt.box&&xt.box.length))}}if(nn=xt,$e=nn&&nn.box&&nn.box.length>0,Xe=nn&&nn.offscreen,ot=nn&&nn.occluded,Ae.useRuntimeCollisionCircles){const Xn=x.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),An=s.evaluateSizeForFeature(x.textSizeData,J,Xn),hn=T.get("text-padding");Jt=this.collisionIndex.placeCollisionCircles(x,ae,Xn,x.lineVertexArray,x.glyphOffsetArray,An,S,M,z,f,xe,te.predicate,Ae.collisionCircleDiameter*An/s.ONE_EM,hn,this.retainedQueryData[x.bucketInstanceId].tileID),$e=ae||Jt.circles.length>0&&!Jt.collisionDetected,Xe=Xe&&Jt.offscreen,ot=Jt.occluded}if(Le.iconFeatureIndex&&(Sn=Le.iconFeatureIndex),Le.iconBox){const Xn=An=>{Cn(An);const hn=ve&&Ot?Fl(Ot.x,Ot.y,_e,xe,this.transform.angle):new s.Point(0,0),dr=x.getSymbolInstanceIconSize(X,this.transform.zoom,Ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,dr,An,hn,le,O,S,te.predicate)};kt&&kt.box&&kt.box.length&&Le.verticalIconBox?(Tt=Xn(Le.verticalIconBox),it=Tt.box.length>0):(Tt=Xn(Le.iconBox),it=Tt.box.length>0),Xe=Xe&&Tt.offscreen,Ct=Tt.occluded}const Fr=B||Ae.numHorizontalGlyphVertices===0&&ke===0,qi=W||Ae.numIconVertices===0;if(Fr||qi?qi?Fr||(it=it&&$e):$e=it&&$e:it=$e=it&&$e,$e&&nn&&nn.box&&this.collisionIndex.insertCollisionBox(nn.box,T.get("text-ignore-placement"),x.bucketInstanceId,kt&&kt.box&&Tn?Tn:_n,te.ID),it&&Tt&&this.collisionIndex.insertCollisionBox(Tt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,Sn,te.ID),Jt&&($e&&this.collisionIndex.insertCollisionCircles(Jt.circles,T.get("text-ignore-placement"),x.bucketInstanceId,_n,te.ID),f)){const Xn=x.bucketInstanceId;let An=this.collisionCircleArrays[Xn];An===void 0&&(An=this.collisionCircleArrays[Xn]=new Ol);for(let hn=0;hn<Jt.circles.length;hn+=4)An.circles.push(Jt.circles[hn+0]),An.circles.push(Jt.circles[hn+1]),An.circles.push(Jt.circles[hn+2]),An.circles.push(Jt.collisionDetected?1:0)}const Po=x.projection.name!=="globe";Ee=Ee&&(Po||!ot),Pe=Pe&&(Po||!Ct),this.placements[Qe]=new Ll($e||Ee,it||Pe,Xe||x.justReloaded),c.add(Qe)};if(Se){const Ae=x.getSortedSymbolIndexes(this.transform.angle);for(let Ge=Ae.length-1;Ge>=0;--Ge){const Le=Ae[Ge];nt(x.symbolInstances.get(Le),Le,x.collisionArrays[Le])}}else for(let Ae=o.symbolInstanceStart;Ae<o.symbolInstanceEnd;Ae++)nt(x.symbolInstances.get(Ae),Ae,x.collisionArrays[Ae]);if(f&&x.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[x.bucketInstanceId];s.invert(Ae.invProjMatrix,S),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,f,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M,crossTileID:z}=f,P=s.getAnchorJustification(c),O=_===s.WritingMode.vertical?M:P==="left"?x:P==="center"?T:P==="right"?S:-1;x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=O>=0&&x!==O?0:z),T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=O>=0&&T!==O?0:z),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:z),M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=O>=0&&M!==O?0:z)}markUsedOrientation(o,c,f){const _=c===s.WritingMode.horizontal||c===s.WritingMode.horizontalOnly?c:0,x=c===s.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:z}=f,P=o.text.placedSymbolArray;T>=0&&(P.get(T).placedOrientation=_),S>=0&&(P.get(S).placedOrientation=_),M>=0&&(P.get(M).placedOrientation=_),z>=0&&(P.get(z).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const _=c?c.symbolFadeChange(o):1,x=c?c.opacities:{},T=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],P=x[M];P?(this.opacities[M]=new Yo(P,_,z.text,z.icon,null,z.clipped),f=f||z.text!==P.text.placed||z.icon!==P.icon.placed):(this.opacities[M]=new Yo(null,_,z.text,z.icon,z.skipFade,z.clipped),f=f||z.text||z.icon)}for(const M in x){const z=x[M];if(!this.opacities[M]){const P=new Yo(z,_,!1,!1);P.isHidden()||(this.opacities[M]=P,f=f||z.text.placed||z.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in S)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=S[M]);f?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const f=new Set;for(const _ of c){const x=_.getBucket(o);x&&_.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,f,_.collisionBoxArray)}}updateBucketOpacities(o,c,f){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,x=!!o.layers[0].dynamicFilter(),T=new Yo(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),P=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",Z=new Yo(null,0,S&&(M||!o.hasIconData()||_.get("icon-optional")),M&&(S||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&f&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(f);const J=(te,B,W)=>{for(let ae=0;ae<B/4;ae++)te.opacityVertexArray.emplaceBack(W)};let X=0;for(let te=0;te<o.symbolInstances.length;te++){const B=o.symbolInstances.get(te),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:ae,crossTileID:le,numIconVertices:_e}=B,xe=c.has(le);let ve=this.opacities[le];xe?ve=T:ve||(ve=Z,this.opacities[le]=ve),c.add(le);const Se=W>0||ae>0,Ee=_e>0,Pe=this.placedOrientations[le],nt=Pe===s.WritingMode.vertical,Ae=Pe===s.WritingMode.horizontal||Pe===s.WritingMode.horizontalOnly;if(!Se&&!Ee||ve.isHidden()||X++,Se){const Ge=Nl(ve.text);J(o.text,W,nt?er:Ge),J(o.text,ae,Ae?er:Ge);const Le=ve.text.isHidden(),{leftJustifiedTextSymbolIndex:Qe,centerJustifiedTextSymbolIndex:ke,rightJustifiedTextSymbolIndex:$e,verticalPlacedTextSymbolIndex:it}=B,Xe=o.text.placedSymbolArray,ot=Le||nt?1:0;Qe>=0&&(Xe.get(Qe).hidden=ot),ke>=0&&(Xe.get(ke).hidden=ot),$e>=0&&(Xe.get($e).hidden=ot),it>=0&&(Xe.get(it).hidden=Le||Ae?1:0);const Ct=this.variableOffsets[le];Ct&&this.markUsedJustification(o,Ct.anchor,B,Pe);const Ot=this.placedOrientations[le];Ot&&(this.markUsedJustification(o,"left",B,Ot),this.markUsedOrientation(o,Ot,B))}if(Ee){const Ge=Nl(ve.icon),{placedIconSymbolIndex:Le,verticalPlacedIconSymbolIndex:Qe}=B,ke=o.icon.placedSymbolArray,$e=ve.icon.isHidden()?1:0;Le>=0&&(J(o.icon,_e,nt?er:Ge),ke.get(Le).hidden=$e),Qe>=0&&(J(o.icon,B.numVerticalIconVertices,Ae?er:Ge),ke.get(Qe).hidden=$e)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ge=o.collisionArrays[te];if(Ge){let Le=new s.Point(0,0),Qe=!0;if(Ge.textBox||Ge.verticalTextBox){if(z){const $e=this.variableOffsets[le];$e?(Le=Bl($e.anchor,$e.width,$e.height,$e.textOffset,$e.textScale),P&&Le._rotate(O?this.transform.angle:-this.transform.angle)):Qe=!1}x&&(Qe=!ve.clipped),Ge.textBox&&Ra(o.textCollisionBox.collisionVertexArray,ve.text.placed,!Qe||nt,Le.x,Le.y),Ge.verticalTextBox&&Ra(o.textCollisionBox.collisionVertexArray,ve.text.placed,!Qe||Ae,Le.x,Le.y)}const ke=Qe&&!!(!Ae&&Ge.verticalIconBox);Ge.iconBox&&Ra(o.iconCollisionBox.collisionVertexArray,ve.icon.placed,ke,G?Le.x:0,G?Le.y:0),Ge.verticalIconBox&&Ra(o.iconCollisionBox.collisionVertexArray,ve.icon.placed,!ke,G?Le.x:0,G?Le.y:0)}}}if(o.fullyClipped=X===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=te.invProjMatrix,o.placementViewportMatrix=te.viewportMatrix,o.collisionCircleArray=te.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>o}setStale(){this.stale=!0}}function Ra(d,o,c,f,_){d.emplaceBack(o?1:0,c?1:0,f||0,_||0),d.emplaceBack(o?1:0,c?1:0,f||0,_||0),d.emplaceBack(o?1:0,c?1:0,f||0,_||0),d.emplaceBack(o?1:0,c?1:0,f||0,_||0)}const gi=Math.pow(2,25),ir=Math.pow(2,24),Xh=Math.pow(2,17),Kh=Math.pow(2,16),_i=Math.pow(2,9),Vi=Math.pow(2,8),Wf=Math.pow(2,1);function Nl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const o=d.placed?1:0,c=Math.floor(127*d.opacity);return c*gi+o*ir+c*Xh+o*Kh+c*_i+o*Vi+c*Wf+o}const er=0;class jl{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,f,_,x){const T=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(T,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<T.length;){const S=T[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,f,S.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Yh{constructor(o,c,f,_,x,T,S,M){this.placement=new Vc(o,x,T,S,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,c,f){const _=s.exported.now(),x=()=>{const T=s.exported.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=c[o[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new jl(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Zs=512/s.EXTENT/2;class Wr{constructor(o,c,f){this.tileID=o,this.bucketInstanceId=f,this.index=new s.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=o.canonical.x*s.EXTENT,x=o.canonical.y*s.EXTENT;for(let T=0;T<c.length;T++){const{key:S,crossTileID:M,tileAnchorX:z,tileAnchorY:P}=c.get(T),O=Math.floor((_+z)*Zs),G=Math.floor((x+P)*Zs);this.index.add(O,G),this.keys.push(S),this.crossTileIDs.push(M)}this.index.finish()}findMatches(o,c,f){const _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=Zs/Math.pow(2,c.canonical.z-this.tileID.canonical.z),T=c.canonical.x*s.EXTENT,S=c.canonical.y*s.EXTENT;for(let M=0;M<o.length;M++){const z=o.get(M);if(z.crossTileID)continue;const{key:P,tileAnchorX:O,tileAnchorY:G}=z,Z=Math.floor((T+O)*x),J=Math.floor((S+G)*x),X=this.index.range(Z-_,J-_,Z+_,J+_);for(const te of X){const B=this.crossTileIDs[te];if(this.keys[te]===P&&!f.has(B)){f.add(B),z.crossTileID=B;break}}}}}class Jh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(c!==0)for(const f in this.indexes){const _=this.indexes[f],x={};for(const T in _){const S=_[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),x[S.tileID.key]=S}this.indexes[f]=x}this.lng=o}addBucket(o,c,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const _=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>o.overscaledZ)for(const S in T){const M=T[S];M.tileID.isChildOf(o)&&M.findMatches(c.symbolInstances,o,_)}else{const S=T[o.scaledTo(Number(x)).key];S&&S.findMatches(c.symbolInstances,o,_)}}for(let x=0;x<c.symbolInstances.length;x++){const T=c.symbolInstances.get(x);T.crossTileID||(T.crossTileID=f.generate(),_.add(T.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Wr(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const f of c.crossTileIDs)this.usedCrossTileIDs[o].delete(f)}removeStaleBuckets(o){let c=!1;for(const f in this.indexes){const _=this.indexes[f];for(const x in _)o[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[x]),delete _[x],c=!0)}return c}}class Jo{constructor(){this.layerIndexes={},this.crossTileIDs=new Jh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,f,_){let x=this.layerIndexes[o.id];x===void 0&&(x=this.layerIndexes[o.id]=new Qh);let T=!1;const S={};_.name!=="globe"&&x.handleWrapJump(f);for(const M of c){const z=M.getBucket(o);z&&o.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,z,this.crossTileIDs)&&(T=!0),S[z.bucketInstanceId]=!0)}return x.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(o){const c={};o.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const bs=(d,o)=>s.emitValidationErrors(d,o&&o.filter(c=>c.identifier!=="source.canvas")),$c=s.pick(pn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Py=s.pick(pn,["setCenter","setZoom","setBearing","setPitch"]),ed={version:8,layers:[],sources:{}},Da={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Mo extends s.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new bt(Zo(),this),this.imageManager=new Rt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(o._requestManager,c.localFontFamily?s.LocalGlyphMode.all:c.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Jo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const f=this;this._rtlTextPluginCallback=Mo.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,T)=>{if(s.triggerPluginCompletionEvent(x),T&&T.every(S=>S))for(const S in f._sourceCaches){const M=f._sourceCaches[S],z=M.getSource().type;z!=="vector"&&z!=="geojson"||M.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getSource(_.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===x.id&&this._validateLayer(S)}})}loadURL(o,c={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const f=typeof c.validate=="boolean"?c.validate:!s.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken);const _=this.map._requestManager.transformRequest(o,s.ResourceType.Style);this._request=s.getJSON(_,(x,T)=>{this._request=null,x?this.fire(new s.ErrorEvent(x)):T&&this._load(T,f)})}loadJSON(o,c={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(ed,!1)}_updateLayerCount(o,c){const f=c?1:-1;o.is3D()&&(this._num3DLayers+=f),o.type==="circle"&&(this._numCircleLayers+=f),o.type==="symbol"&&(this._numSymbolLayers+=f)}_load(o,c){if(c&&bs(this,s.validateStyle(o)))return;this._loaded=!0,this.stylesheet=s.clone$1(o),this._updateMapProjection();for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const f=Uf(this.stylesheet.layers);this._order=f.map(_=>_.id),this._layers={},this._serializedLayers={};for(const _ of f){const x=s.createStyleLayer(_);x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ht(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(o){this._spriteRequest=function(c,f,_){let x,T,S;const M=s.exported.devicePixelRatio>1?"@2x":"";let z=s.getJSON(f.transformRequest(f.normalizeSpriteURL(c,M,".json"),s.ResourceType.SpriteJSON),(G,Z)=>{z=null,S||(S=G,x=Z,O())}),P=s.getImage(f.transformRequest(f.normalizeSpriteURL(c,M,".png"),s.ResourceType.SpriteImage),(G,Z)=>{P=null,S||(S=G,T=Z,O())});function O(){if(S)_(S);else if(x&&T){const G=s.exported.getImageData(T),Z={};for(const J in x){const{width:X,height:te,x:B,y:W,sdf:ae,pixelRatio:le,stretchX:_e,stretchY:xe,content:ve}=x[J],Se=new s.RGBAImage({width:X,height:te});s.RGBAImage.copy(G,Se,{x:B,y:W},{x:0,y:0},{width:X,height:te}),Z[J]={data:Se,pixelRatio:le,sdf:ae,stretchX:_e,stretchY:xe,content:ve}}_(null,Z)}}return{cancel(){z&&(z.cancel(),z=null),P&&(P.cancel(),P=null)}}}(o,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new s.ErrorEvent(c));else if(f)for(const _ in f)this.imageManager.addImage(_,f[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.getSource(o.source);if(!c)return;const f=o.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const f of o){const _=this._layers[f];_.type!=="custom"&&c.push(_.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&(typeof o.isLayerDraped=="function"?o.isLayerDraped():Da[o.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const T in this._updatedSources){const S=this._updatedSources[T];S==="reload"?this._reloadSource(T):S==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const f={};for(const _ in this._sourceCaches){const x=this._sourceCaches[_];f[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];if(x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)){const S=this._getLayerSourceCache(x);S&&(S.used=!0)}const T=this.map.painter;if(T){const S=x.getProgramIds();if(!S)continue;const M=x.getProgramConfiguration(o.zoom);for(const z of S)T.useProgram(z,M)}}for(const _ in f){const x=this._sourceCaches[_];f[_]!==x.used&&x.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),bs(this,s.validateStyle(o)))return!1;(o=s.clone$1(o)).layers=Uf(o.layers);const c=function(_,x){if(!_)return[{command:pn.setStyle,args:[x]}];let T=[];try{if(!A(_.version,x.version))return[{command:pn.setStyle,args:[x]}];A(_.center,x.center)||T.push({command:pn.setCenter,args:[x.center]}),A(_.zoom,x.zoom)||T.push({command:pn.setZoom,args:[x.zoom]}),A(_.bearing,x.bearing)||T.push({command:pn.setBearing,args:[x.bearing]}),A(_.pitch,x.pitch)||T.push({command:pn.setPitch,args:[x.pitch]}),A(_.sprite,x.sprite)||T.push({command:pn.setSprite,args:[x.sprite]}),A(_.glyphs,x.glyphs)||T.push({command:pn.setGlyphs,args:[x.glyphs]}),A(_.transition,x.transition)||T.push({command:pn.setTransition,args:[x.transition]}),A(_.light,x.light)||T.push({command:pn.setLight,args:[x.light]}),A(_.fog,x.fog)||T.push({command:pn.setFog,args:[x.fog]}),A(_.projection,x.projection)||T.push({command:pn.setProjection,args:[x.projection]});const S={},M=[];(function(O,G,Z,J){let X;for(X in G=G||{},O=O||{})O.hasOwnProperty(X)&&(G.hasOwnProperty(X)||zl(X,Z,J));for(X in G){if(!G.hasOwnProperty(X))continue;const te=G[X];O.hasOwnProperty(X)?A(O[X],te)||(O[X].type==="geojson"&&te.type==="geojson"&&Uc(O,G,X)?Z.push({command:pn.setGeoJSONSourceData,args:[X,te.data]}):Gh(X,G,Z,J)):$h(X,G,Z)}})(_.sources,x.sources,M,S);const z=[];_.layers&&_.layers.forEach(O=>{O.source&&S[O.source]?T.push({command:pn.removeLayer,args:[O.id]}):z.push(O)});let P=_.terrain;P&&S[P.source]&&(T.push({command:pn.setTerrain,args:[void 0]}),P=void 0),T=T.concat(M),A(P,x.terrain)||T.push({command:pn.setTerrain,args:[x.terrain]}),function(O,G,Z){G=G||[];const J=(O=O||[]).map(Ho),X=G.map(Ho),te=O.reduce(qh,{}),B=G.reduce(qh,{}),W=J.slice(),ae=Object.create(null);let le,_e,xe,ve,Se,Ee,Pe;for(le=0,_e=0;le<J.length;le++)xe=J[le],B.hasOwnProperty(xe)?_e++:(Z.push({command:pn.removeLayer,args:[xe]}),W.splice(W.indexOf(xe,_e),1));for(le=0,_e=0;le<X.length;le++)xe=X[X.length-1-le],W[W.length-1-le]!==xe&&(te.hasOwnProperty(xe)?(Z.push({command:pn.removeLayer,args:[xe]}),W.splice(W.lastIndexOf(xe,W.length-_e),1)):_e++,Ee=W[W.length-le],Z.push({command:pn.addLayer,args:[B[xe],Ee]}),W.splice(W.length-le,0,xe),ae[xe]=!0);for(le=0;le<X.length;le++)if(xe=X[le],ve=te[xe],Se=B[xe],!ae[xe]&&!A(ve,Se))if(A(ve.source,Se.source)&&A(ve["source-layer"],Se["source-layer"])&&A(ve.type,Se.type)){for(Pe in Co(ve.layout,Se.layout,Z,xe,null,pn.setLayoutProperty),Co(ve.paint,Se.paint,Z,xe,null,pn.setPaintProperty),A(ve.filter,Se.filter)||Z.push({command:pn.setFilter,args:[xe,Se.filter]}),A(ve.minzoom,Se.minzoom)&&A(ve.maxzoom,Se.maxzoom)||Z.push({command:pn.setLayerZoomRange,args:[xe,Se.minzoom,Se.maxzoom]}),ve)ve.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?Co(ve[Pe],Se[Pe],Z,xe,Pe.slice(6),pn.setPaintProperty):A(ve[Pe],Se[Pe])||Z.push({command:pn.setLayerProperty,args:[xe,Pe,Se[Pe]]}));for(Pe in Se)Se.hasOwnProperty(Pe)&&!ve.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?Co(ve[Pe],Se[Pe],Z,xe,Pe.slice(6),pn.setPaintProperty):A(ve[Pe],Se[Pe])||Z.push({command:pn.setLayerProperty,args:[xe,Pe,Se[Pe]]}))}else Z.push({command:pn.removeLayer,args:[xe]}),Ee=W[W.lastIndexOf(xe)+1],Z.push({command:pn.addLayer,args:[Se,Ee]})}(z,x.layers,T)}catch(S){console.warn("Unable to compute style diff:",S),T=[{command:pn.setStyle,args:[x]}]}return T}(this.serialize(),o).filter(_=>!(_.command in Py));if(c.length===0)return!1;const f=c.filter(_=>!(_.command in $c));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);return c.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,c){return this.getImage(o)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,c),this._afterImageUpdated(o),this)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,c,f={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(s.validateSource,`sources.${o}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const _=Gt(o,c,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:_.serialize(),sourceId:o}));const x=T=>{const S=(T?"symbol:":"other:")+o,M=this._sourceCaches[S]=new s.SourceCache(S,_,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[o]=M,M.style=this,M.onAdd(this.map)};x(!1),c.type!=="vector"&&c.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const c=this.getSource(o);if(!c)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(o);for(const _ of f)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getSource(o).setData(c),this._changed=!0}getSource(o){const c=this._getSourceCache(o);return c&&c.getSource()}_getSources(){const o=[];for(const c in this._otherSourceCaches){const f=this._getSourceCache(c);f&&o.push(f.getSource())}return o}addLayer(o,c,f={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(o.type==="custom"){if(bs(this,s.validateCustomStyleLayer(o)))return;x=s.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=s.clone$1(o),o=s.extend(o,{source:_})),this._validate(s.validateLayer,`layers.${_}`,o,{arrayIndex:-1},f))return;x=s.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const T=c?this._order.indexOf(c):this._order.length;if(c&&T===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const S=this._getLayerSourceCache(x);if(this._removedLayers[_]&&x.source&&S&&x.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",S.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const f=this._order.indexOf(o);this._order.splice(f,1);const _=c?this._order.indexOf(c):this._order.length;c&&_===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const f=this._order.indexOf(o);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,f){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===c&&_.maxzoom===f||(c!=null&&(_.minzoom=c),f!=null&&(_.maxzoom=f),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,c,f={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!A(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(s.validateFilter,`layers.${_.id}.filter`,c,{layerType:_.type},f)||(_.filter=s.clone$1(c),this._updateLayer(_)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const c=this.getLayer(o);return c&&s.clone$1(c.filter)}setLayoutProperty(o,c,f,_={}){this._checkLoaded();const x=this.getLayer(o);x?A(x.getLayoutProperty(c),f)||(x.setLayoutProperty(c,f,_),this._updateLayer(x)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,c){const f=this.getLayer(o);if(f)return f.getLayoutProperty(c);this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,c,f,_={}){this._checkLoaded();const x=this.getLayer(o);x?A(x.getPaintProperty(c),f)||(x.setPaintProperty(c,f,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,c){const f=this.getLayer(o);return f&&f.getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const f=o.source,_=o.sourceLayer,x=this.getSource(f);if(!x)return void this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const T=x.type;if(T==="geojson"&&_)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(f);for(const M of S)M.setFeatureState(_,o.id,c)}removeFeatureState(o,c){this._checkLoaded();const f=o.source,_=this.getSource(f);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const x=_.type,T=x==="vector"?o.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(f);for(const M of S)M.removeFeatureState(T,o.id,c)}getFeatureState(o){this._checkLoaded();const c=o.source,f=o.sourceLayer,_=this.getSource(c);if(_){if(_.type!=="vector"||f)return o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(f,o.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const c in this._sourceCaches){const f=this._sourceCaches[c].getSource();o[f.id]||(o[f.id]=f.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const c=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",c.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=T=>this._layers[T].type==="fill-extrusion",f={},_=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(c(S)){f[S]=T;for(const M of o){const z=M[S];if(z)for(const P of z)_.push(P)}}}_.sort((T,S)=>S.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(c(S))for(let M=_.length-1;M>=0;M--){const z=_[M].feature;if(f[z.layer.id]<T)break;x.push(z),_.pop()}else for(const M of o){const z=M[S];if(z)for(const P of z)x.push(P.feature)}}return x}queryRenderedFeatures(o,c,f){c&&c.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const _={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of c.layers){const z=this._layers[M];if(!z)return this.fire(new s.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const x=[];c.availableImages=this._availableImages;const T=c&&c.layers?c.layers.some(M=>{const z=this.getLayer(M);return z&&z.is3D()}):this.has3DLayers(),S=xn.createFromScreenPoints(o,f);for(const M in this._sourceCaches){const z=this._sourceCaches[M].getSource().id;c.layers&&!_[z]||x.push(Dn(this._sourceCaches[M],this._layers,this._serializedLayers,S,c,f,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(M,z,P,O,G,Z,J){const X={},te=Z.queryRenderedSymbols(O),B=[];for(const W of Object.keys(te).map(Number))B.push(J[W]);B.sort(Vn);for(const W of B){const ae=W.featureIndex.lookupSymbolFeatures(te[W.bucketInstanceId],z,W.bucketIndex,W.sourceLayerIndex,G.filter,G.layers,G.availableImages,M);for(const le in ae){const _e=X[le]=X[le]||[],xe=ae[le];xe.sort((ve,Se)=>{const Ee=W.featureSortOrder;if(Ee){const Pe=Ee.indexOf(ve.featureIndex);return Ee.indexOf(Se.featureIndex)-Pe}return Se.featureIndex-ve.featureIndex});for(const ve of xe)_e.push(ve)}}for(const W in X)X[W].forEach(ae=>{const le=ae.feature,_e=P(M[W]);if(!_e)return;const xe=_e.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=xe});return X}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,c){c&&c.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const f=this._getSourceCaches(o);let _=[];for(const x of f)_=_.concat(Ft(x,c));return _}addSourceType(o,c,f){return Mo.getSourceType(o)?f(new Error(`A source type called "${o}" already exists.`)):(Mo.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const T in o)if(!A(o[T],f[T])){_=!0;break}if(!_)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=o;if(c===1){if(typeof f.source=="object"){const _="terrain-dem-src";this.addSource(_,f.source),f=s.clone$1(f),f=s.extend(f,{source:_})}if(this._validate(s.validateTerrain,"terrain",f))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,c)}else{const _=this.terrain,x=_.get();for(const T of Object.keys(s.spec.terrain))!f.hasOwnProperty(T)&&s.spec.terrain[T].default&&(f[T]=s.spec.terrain[T].default);for(const T in f)if(!A(f[T],x[T])){_.set(f),this.stylesheet.terrain=f;const S=this._setTransitionParameters({duration:0});_.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new St(o,this.map.transform);this.stylesheet.fog=o;const f=this._setTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,f=c.get();Object.keys(o).length===0&&c.set(o);for(const _ in o)if(!A(o[_],f[_])){c.set(o),this.stylesheet.fog=o;const x=this._setTransitionParameters({duration:0});c.updateTransitions(x);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:s.exported.now(),transition:s.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(f=>this.isLayerDraped(this._layers[f])),c=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const f=this.terrain=new Bt(o,c);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,f,_,x={}){return(!x||x.validate!==!1)&&bs(this,o.call(s.validateStyle,s.extend({key:c,style:this.serialize(),value:f,styleSpec:s.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const c=this._getSourceCaches(o);for(const f of c)f.clearTiles()}_reloadSource(o){const c=this._getSourceCaches(o);for(const f of c)f.resume(),f.reload()}_reloadSources(){for(const o of this._getSources())o.reload&&o.reload()}_updateSources(o){for(const c in this._sourceCaches)this._sourceCaches[c].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,f,_,x=!1){let T=!1,S=!1;const M={};for(const z of this._order){const P=this._layers[z];if(P.type!=="symbol")continue;if(!M[P.source]){const G=this._getLayerSourceCache(P);if(!G)continue;M[P.source]=G.getRenderableIds(!0).map(Z=>G.getTileByID(Z)).sort((Z,J)=>J.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(J.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(P,M[P.source],o.center.lng,o.projection);T=T||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),o.zoom))&&(this.pauseablePlacement=new Yh(o,this._order,x,c,f,_,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const z of this._order){const P=this._layers[z];P.type==="symbol"&&this.placement.updateLayerOpacities(P,M[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,f){this.imageManager.getImages(c.icons,f),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};_(this._otherSourceCaches[c.source]),_(this._symbolSourceCaches[c.source])}getGlyphs(o,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(o,c,f){return s.makeRequest(c,f)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){const c=this._getSourceCaches(o);return c.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):c.every(f=>f.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Mo.getSourceType=function(d){return Lt[d]},Mo.setSourceType=function(d,o){Lt[d]=o},Mo.registerForPluginStateChange=s.registerForPluginStateChange;var td=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Hs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ul=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,es=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Gc={},La={};const Vl=[];Oa(td,Vl),Oa(Qo,Vl),Oa(Ul,Vl),Oa(es,Vl),Gc=fn("",Qo),La=fn(es,Ul);const Zf=fn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),qc=td,nd=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var rd={background:fn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:fn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:fn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:fn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:fn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:fn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:fn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:fn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:fn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:fn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:fn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:fn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Hs),skyboxGradient:fn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Hs),skyboxCapture:fn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Oa(d,o){const c=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of c)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const x of _)o.includes(x)||o.push(x)}}function fn(d,o){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},x=[...Vl];return Oa(d,x),Oa(o,x),{fragmentSource:d=d.replace(c,(T,S,M,z,P)=>(_[P]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${P}
varying ${M} ${z} ${P};
#else
uniform ${M} ${z} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${M} ${z} ${P} = u_${P};
#endif
`)),vertexSource:o=o.replace(c,(T,S,M,z,P)=>{const O=z==="float"?"vec2":"vec4",G=P.match(/color/)?"color":O;return _[P]?S==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${M} ${O} a_${P};
varying ${M} ${z} ${P};
#else
uniform ${M} ${z} u_${P};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${M} ${z} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${G}(a_${P}, u_${P}_t);
#else
    ${M} ${z} ${P} = u_${P};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${M} ${O} a_${P};
#else
uniform ${M} ${z} u_${P};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${M} ${z} ${P} = a_${P};
#else
    ${M} ${z} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${M} ${z} ${P} = unpack_mix_${G}(a_${P}, u_${P}_t);
#else
    ${M} ${z} ${P} = u_${P};
#endif
`}),staticAttributes:f,usedDefines:x}}class zy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,f,_,x,T,S){this.context=o;let M=this.boundPaintVertexBuffers.length!==_.length;for(let P=0;!M&&P<_.length;P++)this.boundPaintVertexBuffers[P]!==_[P]&&(M=!0);let z=this.boundDynamicVertexBuffers.length!==S.length;for(let P=0;!z&&P<S.length;P++)this.boundDynamicVertexBuffers[P]!==S[P]&&(z=!0);if(!o.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||M||z||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(c,f,_,x,T,S);else{o.bindVertexArrayOES.set(this.vao);for(const P of S)P&&P.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(o,c,f,_,x,T){let S;const M=o.numAttributes,z=this.context,P=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T;else{S=z.currentNumAttributes||0;for(let O=M;O<S;O++)P.disableVertexAttribArray(O)}c.enableAttributes(P,o),c.bind(),c.setVertexAttribPointers(P,o,x);for(const O of f)O.enableAttributes(P,o),O.bind(),O.setVertexAttribPointers(P,o,x);for(const O of T)O&&(O.enableAttributes(P,o),O.bind(),O.setVertexAttribPointers(P,o,x));_&&_.bind(),z.currentNumAttributes=M}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function id(d,o){const c=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new s.MercatorCoordinate(0,f/c).toLngLat().lat,new s.MercatorCoordinate(0,(f+1)/c).toLngLat().lat]}function Hf(d,o,c,f,_,x,T){const S=d.context,M=S.gl,z=c.fbo;if(!z)return;d.prepareDrawTile();const P=d.useProgram("hillshade");S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get());const O=((X,te,B,W)=>{const ae=B.paint.get("hillshade-shadow-color"),le=B.paint.get("hillshade-highlight-color"),_e=B.paint.get("hillshade-accent-color");let xe=B.paint.get("hillshade-illumination-direction")*(Math.PI/180);B.paint.get("hillshade-illumination-anchor")==="viewport"&&(xe-=X.transform.angle);const ve=!X.options.moving;return{u_matrix:W||X.transform.calculateProjMatrix(te.tileID.toUnwrapped(),ve),u_image:0,u_latrange:id(0,te.tileID),u_light:[B.paint.get("hillshade-exaggeration"),xe],u_shadow:ae,u_highlight:le,u_accent:_e}})(d,c,f,d.terrain?o.projMatrix:null);d.prepareDrawProgram(S,P,o.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Z,tileBoundsSegments:J}=d.getTileBoundsBuffers(c);P.draw(S,M.TRIANGLES,_,x,T,s.CullFaceMode.disabled,O,f.id,G,Z,J)}function od(d,o,c){if(!o.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||d.getTileTexture(c.stride);const x=c.getPixels();o.demTexture?o.demTexture.update(x,{premultiply:!1}):o.demTexture=new s.Texture(f,x,_.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Xf(d,o,c,f,_,x){const T=d.context,S=T.gl;if(!o.dem)return;const M=o.dem;if(T.activeTexture.set(S.TEXTURE1),od(d,o,M),!o.demTexture)return;o.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const z=M.dim;T.activeTexture.set(S.TEXTURE0);let P=o.fbo;if(!P){const J=new s.Texture(T,{width:z,height:z,data:null},S.RGBA);J.bind(S.LINEAR,S.CLAMP_TO_EDGE),P=o.fbo=T.createFramebuffer(z,z,!0),P.colorAttachment.set(J.texture)}T.bindFramebuffer.set(P.framebuffer),T.viewport.set([0,0,z,z]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,f,_,x,s.CullFaceMode.disabled,((J,X)=>{const te=X.stride,B=s.create();return s.ortho(B,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(B,B,[0,-s.EXTENT,0]),{u_matrix:B,u_image:1,u_dimension:[te,te],u_zoom:J.overscaledZ,u_unpack:X.unpackVector}})(o.tileID,M),c.id,O,G,Z),o.needsHillshadePrepare=!1}const sd=d=>({u_matrix:new s.UniformMatrix4f(d),u_image0:new s.Uniform1i(d),u_skirt_height:new s.Uniform1f(d)}),Ba=(d,o)=>({u_matrix:d,u_image0:0,u_skirt_height:o}),Wc=(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:M,u_frustum_bl:z,u_globe_pos:P,u_globe_radius:O,u_viewport:G,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:Z});function Fa(d,o){return d!=null&&o!=null&&!(!d.hasData()||!o.hasData())&&d.demTexture!=null&&o.demTexture!=null&&d.tileID.key!==o.tileID.key}const ts=new class{constructor(){this.operations={}}newMorphing(d,o,c,f,_){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[d]={startTime:f,phase:0,duration:_,from:o,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const o=this.operations[d];return{from:o.from,to:o.to,phase:o.phase}}update(d){for(const o in this.operations){const c=this.operations[o];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[o];break}}}_nextOp(d,o){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=o,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Xs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Zc(d){return 6*Math.pow(1.5,22-d)}function Kf(d,o){const c=1<<d.z;return!o&&(d.x===0||d.x===c-1)||d.y===0||d.y===c-1}const $l=d=>({u_matrix:d});function ad(d,o,c,f,_){if(_>0){const x=s.exported.now(),T=(x-d.timeAdded)/_,S=o?(x-o.timeAdded)/_:-1,M=c.getSource(),z=f.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),P=!o||Math.abs(o.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),O=P&&d.refreshedUponExpiration?1:s.clamp(P?T:1-S,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),o?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class ld extends s.SourceCache{constructor(o){const c={type:"raster-dem",maxzoom:o.transform.maxZoom},f=new bt(Zo(),null),_=Gt("mock-dem",c,f,o.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class Hc extends s.SourceCache{constructor(o){const c=Gt("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new bt(Zo(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,f){if(o.freezeTileCoverage)return;this.transform=o;const _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const S=new s.Tile(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom);S.state="loaded",this._tiles[T.key]=S}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(o){const c=this.proxyCachedFBO[o];if(c!==void 0){const f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xc extends s.OverscaledTileID{constructor(o,c,f){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class cd extends s.Elevation{constructor(o,c){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,x]=function(M){const z=new s.StructArrayLayout2i4,P=new s.StructArrayLayout3ui6,O=131;z.reserve(17161),P.reserve(33800);const G=s.EXTENT/128,Z=s.EXTENT+G/2,J=Z+G;for(let te=-G;te<J;te+=G)for(let B=-G;B<J;B+=G){const W=B<0||B>Z||te<0||te>Z?24575:0,ae=s.clamp(Math.round(B),0,s.EXTENT),le=s.clamp(Math.round(te),0,s.EXTENT);z.emplaceBack(ae+W,le)}const X=(te,B)=>{const W=B*O+te;P.emplaceBack(W+1,W,W+O),P.emplaceBack(W+O,W+O+1,W+1)};for(let te=1;te<129;te++)for(let B=1;B<129;B++)X(B,te);return[0,129].forEach(te=>{for(let B=0;B<130;B++)X(B,te),X(te,B)}),[z,P,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(f,s.posAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(_),this.gridSegments=s.SegmentVector.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Hc(c.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const S=T.gl;this._overlapStencilMode=new s.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ld(c.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,f){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const _=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const x=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(c,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=c.getIds().map(M=>{const z=c.getTileByID(M).tileID;return z.projMatrix=f.calculateProjMatrix(z.toUnwrapped()),z});(function(M,z){const P=z.transform.pointCoordinate(z.transform.getCameraPoint()),O=new s.Point(P.x,P.y);M.sort((G,Z)=>{if(Z.overscaledZ-G.overscaledZ)return Z.overscaledZ-G.overscaledZ;const J=new s.Point(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),X=new s.Point(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),te=O.mult(1<<G.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(J)-te.distSqr(X)})})(_,this.painter),this._previousZoom=f.zoom;const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const M in T){const z=T[M];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,o[M],x),z.usedForTerrain))continue;const P=o[M];z.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[c.id]=_.map(M=>new Xc(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const S={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const z=this.terrainTileForTile[M.key];if(!z)continue;const P=z.tileID.key;P in S||(this._visibleDemTiles.push(z),S[P]=P)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),od(this.painter,_,x))}}_prepareDemTileUniforms(o,c,f,_){if(!c||c.demTexture==null)return!1;const x=o.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-x.z),S=_||"";return f[`u_dem_tl${S}`]=[x.x*T%1,x.y*T%1],f[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){const f=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(o,f,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const c=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const x=_.dem.tree.minimums[0];return x>0&&o++,f+x},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(f,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new s.Texture(o,_,c.RGBA,{premultiply:!1}),x}setupElevationDraw(o,c,f){const _=this.painter.context,x=_.gl,T=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let M=null,z=null,P=1;if(f&&f.morphing&&this._useVertexMorphing){const O=f.morphing.srcDemTile,G=f.morphing.dstDemTile;P=f.morphing.phase,O&&G&&(this._prepareDemTileUniforms(o,O,T,"_prev")&&(z=O),this._prepareDemTileUniforms(o,G,T)&&(M=G))}if(z&&M?(_.activeTexture.set(x.TEXTURE2),M.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),_.activeTexture.set(x.TEXTURE4),z.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=P):(M=this.terrainTileForTile[o.tileID.key],_.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(o,M,T)?M.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),_.activeTexture.set(x.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&M){const O=(1<<M.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=O}if(f&&f.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(_,T),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,o.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,O)}}globeUniformValues(o,c,f){const _=o.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,s.EXTENT,0),u_tile_br_up:_.upVector(c,s.EXTENT,s.EXTENT),u_tile_bl_up:_.upVector(c,0,s.EXTENT),u_tile_up_scale:f?s.globeMetersToEcef(1):_.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const c=this.painter,f=this.painter.context;o.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,T,S,M){if(_.transform.projection.name==="globe")(function(z,P,O,G,Z){const J=z.context,X=J.gl;let te,B;const W=z.options.showTerrainWireframe?2:0,ae=z.transform,le=s.globeUseCustomAntiAliasing(z,J,ae),_e=(Qe,ke)=>{if(B===Qe)return;const $e=[Xs[Qe],"PROJECTION_GLOBE_VIEW"];le&&$e.push("CUSTOM_ANTIALIASING"),ke&&$e.push(Xs[W]),te=z.useProgram("globeRaster",null,$e),B=Qe},xe=z.colorModeForRenderPass(),ve=new s.DepthMode(X.LEQUAL,s.DepthMode.ReadWrite,z.depthRangeFor3D);ts.update(Z);const Se=s.calculateGlobeMercatorMatrix(ae),Ee=[s.mercatorXfromLng(ae.center.lng),s.mercatorYfromLat(ae.center.lat)],Pe=W?[!1,!0]:[!1],nt=z.globeSharedBuffers,Ae=[ae.width*s.exported.devicePixelRatio,ae.height*s.exported.devicePixelRatio],Ge=Float32Array.from(ae.globeMatrix),Le={useDenormalizedUpVectorScale:!0};if(Pe.forEach(Qe=>{const ke=z.transform,$e=Zc(ke.zoom)*P.exaggeration();B=-1;const it=Qe?X.LINES:X.TRIANGLES;for(const Xe of G){const ot=O.getTile(Xe),Ct=s.StencilMode.disabled,Ot=P.prevTerrainTileForTile[Xe.key],xt=P.terrainTileForTile[Xe.key];Fa(Ot,xt)&&ts.newMorphing(Xe.key,Ot,xt,Z,250),J.activeTexture.set(X.TEXTURE0),ot.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const kt=ts.getMorphValuesForProxy(Xe.key),nn=kt?1:0;kt&&s.extend$1(Le,{morphing:{srcDemTile:kt.from,dstDemTile:kt.to,phase:s.easeCubicInOut(kt.phase)}});const Jt=s.tileCornersToBounds(Xe.canonical),Tt=s.getLatitudinalLod(Jt.getCenter().lat),_n=s.getGridMatrix(Xe.canonical,Jt,Tt,ke.worldSize/ke._pixelsPerMercatorPixel),Tn=s.globeNormalizeECEF(s.globeTileBounds(Xe.canonical)),Sn=Wc(ke.projMatrix,Ge,Se,Tn,s.globeToMercatorTransition(ke.zoom),Ee,ke.frustumCorners.TL,ke.frustumCorners.TR,ke.frustumCorners.BR,ke.frustumCorners.BL,ke.globeCenterInViewSpace,ke.globeRadius,Ae,$e,_n);if(_e(nn,Qe),P.setupElevationDraw(ot,te,Le),z.prepareDrawProgram(J,te,Xe.toUnwrapped()),nt){const[Cn,ti,Fr]=Qe?nt.getWirefameBuffers(z.context,Tt):nt.getGridBuffers(Tt,$e!==0);te.draw(J,it,ve,Ct,xe,s.CullFaceMode.backCCW,Sn,"globe_raster",Cn,ti,Fr)}}}),nt){const Qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&Qe.push("CUSTOM_ANTIALIASING"),te=z.useProgram("globeRaster",null,Qe);for(const ke of G){const{x:$e,y:it,z:Xe}=ke.canonical,ot=it===0,Ct=it===(1<<Xe)-1,[Ot,xt,kt,nn]=nt.getPoleBuffers(Xe);if(nn&&(ot||Ct)){const Jt=O.getTile(ke);J.activeTexture.set(X.TEXTURE0),Jt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let Tt=s.globePoleMatrixForTile(Xe,$e,ae);const _n=s.globeNormalizeECEF(s.globeTileBounds(ke.canonical)),Tn=(Sn,Cn)=>Sn.draw(J,X.TRIANGLES,ve,s.StencilMode.disabled,xe,s.CullFaceMode.disabled,Wc(ae.projMatrix,Tt,Tt,_n,0,Ee,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Ae,0),"globe_pole_raster",Cn,kt,nn);P.setupElevationDraw(Jt,te,Le),z.prepareDrawProgram(J,te,ke.toUnwrapped()),ot&&Tn(te,Ot),Ct&&(Tt=s.scale(s.create(),Tt,[1,-1,1]),Tn(te,xt))}}}})(_,x,T,S,M);else{const z=_.context,P=z.gl;let O,G;const Z=_.options.showTerrainWireframe?2:0,J=(ae,le)=>{if(G===ae)return;const _e=[Xs[ae]];le&&_e.push(Xs[Z]),O=_.useProgram("terrainRaster",null,_e),G=ae},X=_.colorModeForRenderPass(),te=new s.DepthMode(P.LEQUAL,s.DepthMode.ReadWrite,_.depthRangeFor3D);ts.update(M);const B=_.transform,W=Zc(B.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(ae=>{G=-1;const le=ae?P.LINES:P.TRIANGLES,[_e,xe]=ae?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const ve of S){const Se=T.getTile(ve),Ee=s.StencilMode.disabled,Pe=x.prevTerrainTileForTile[ve.key],nt=x.terrainTileForTile[ve.key];Fa(Pe,nt)&&ts.newMorphing(ve.key,Pe,nt,M,250),z.activeTexture.set(P.TEXTURE0),Se.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ae=ts.getMorphValuesForProxy(ve.key),Ge=Ae?1:0;let Le;Ae&&(Le={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:s.easeCubicInOut(Ae.phase)}});const Qe=Ba(ve.projMatrix,Kf(ve.canonical,B.renderWorldCopies)?W/10:W);J(Ge,ae),x.setupElevationDraw(Se,O,Le),_.prepareDrawProgram(z,O,ve.toUnwrapped()),O.draw(z,le,te,Ee,X,s.CullFaceMode.backCCW,Qe,"terrain_raster",x.gridBuffer,_e,xe)}})}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const c=this.painter,f=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],T=this._drapedRenderBatches.shift(),S=[],M=c.style.order;let z=0;for(const P of x){const O=_.getTileByID(P.proxyTileKey),G=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][o]:void 0,Z=G!==void 0?_.renderCache[G]:this.pool[z++],J=G!==void 0;if(O.texture=Z.tex,J&&!Z.dirty){S.push(O.tileID);continue}let X;f.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(f.clear({color:s.Color.transparent,stencil:0}),Z.dirty=!1);for(let te=T.start;te<=T.end;++te){const B=c.style._layers[M[te]];if(B.isHidden(c.transform.zoom))continue;const W=c.style._getLayerSourceCache(B),ae=W?this.proxyToSource[P.key][W.id]:[P];if(!ae)continue;const le=ae;f.viewport.set([0,0,Z.fb.width,Z.fb.height]),X!==(W?W.id:null)&&(this._setupStencil(Z,ae,B,W),X=W?W.id:null),c.renderLayer(c,W,B,le)}this.renderedToTile?(Z.dirty=!0,S.push(O.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}renderCacheEfficiency(o){const c=o.order.length;if(c===0)return{efficiency:100};let f,_=0,x=0,T=!1;for(let S=0;S<c;++S){const M=o._layers[o.order[S]];this._style.isLayerDraped(M)?(T&&++_,++x):T||(T=!0,f=M.id)}return x===0?{efficiency:100}:{efficiency:100*(1-_/x),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,S=1<<T.overscaledZ,{x:M,y:z}=T.canonical,P=M/S,O=(M+1)/S,G=z/S,Z=(z+1)/S;return{minx:P,miny:G,maxx:O,maxy:Z,t:x.dem.tree.raycastRoot(P,G,O,Z,o,c,f),tile:x}});_.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,o,c,f);if(T!=null)return T}return null}_createFBO(){const o=this.painter.context,c=o.gl,f=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const _=new s.Texture(o,{width:f[0],height:f[1],data:null},c.RGBA);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=o.createFramebuffer(f[0],f[1],!1);return x.colorAttachment.set(_.texture),x.depthAttachment=new ge(o,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._layers[o],f=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const f of this._style._getSources())if(f instanceof ct){o=!0;break}if(!o)return;const c={};for(let f=0;f<this._style.order.length;++f){const _=this._style._layers[this._style.order[f]],x=this._style._getLayerSourceCache(_);if(x&&!c[x.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof s.ZoomDependentExpression){c[x.id]=!0;for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][x.id];if(S)for(const M of S)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof tt){o=!0;break}if(!o)return;const c={};for(let f=0;f<this._style.order.length;++f){const _=this._style._layers[this._style.order[f]],x=this._style._getLayerSourceCache(_);if(!x||c[x.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const T=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const M=this.proxyToSource[S.key][x.id];if(M)for(const z of M){const P=ad(x.getTile(z),x.findLoadedParent(z,0),x,this.painter.transform,T);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(x.id,z)}}}}_setupDrapedRenderBatches(){const o=this._style.order,c=o.length;if(c===0)return;const f=[];let _,x=0,T=this._style._layers[o[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<c;)T=this._style._layers[o[x]];for(;x<c;++x){const S=this._style._layers[o[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=x):_!==void 0&&(f.push({start:_,end:x-1}),_=void 0))}_!==void 0&&f.push({start:_,end:x-1}),this._drapedRenderBatches=f}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<T.length;++S){const M=Object.values(T[S]);c.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let T=f.length-1;T>=0;T--){const S=f[T];if(c.getTileByID(S.key),c.proxyCachedFBO[S.key]!==void 0){const M=o[S.key],z=this.proxyToSource[S.key];let P=0;for(const O in z){const G=z[O],Z=M[O];if(!Z||Z.length!==G.length||G.some((J,X)=>J!==Z[X]||_[O]&&_[O].hasOwnProperty(J.key))){P=-1;break}++P}for(const O in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][O]].dirty=P<0||P!==Object.values(M).length}}const x=[...this._drapedRenderBatches];x.sort((T,S)=>S.end-S.start-(T.end-T.start));for(const T of x)for(const S of f){if(c.proxyCachedFBO[S.key])continue;let M=c.renderCachePool.pop();M===void 0&&c.renderCache.length<50&&(M=c.renderCache.length,c.renderCache.push(this._createFBO())),M!==void 0&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][T.start]=M,c.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(f.isTileClipped())S=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(o,c){const f=this.painter,_=this.painter.context,x=_.gl;f._tileClippingMaskIDs={},_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const T=f.useProgram("clippingMask");for(const S of o){const M=f._tileClippingMaskIDs[S.key]=--c;T.draw(_,x.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,$l(S.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const f=[o.x,o.y,1,1];s.transformMat4$1(f,f,c.pixelMatrixInverse),s.scale$1(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;const _=c._camera.position,x=s.mercatorZfromAltitude(1,c.center.lat),T=[_[0],_[1],_[2]/x,0],S=s.subtract([],f.slice(0,3),T);s.normalize(S,S);const M=this.raycast(T,S,this._exaggeration);return M!==null&&M?(s.scaleAndAdd(T,T,S,M),T[3]=T[2],T[2]*=x,T):null}drawDepth(){const o=this.painter,c=o.context,f=this.proxySourceCache,_=Math.ceil(o.width),x=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=c.gl,S=c.createFramebuffer(_,x,!0);c.activeTexture.set(T.TEXTURE0);const M=new s.Texture(c,{width:_,height:x,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.colorAttachment.set(M.texture);const z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,_,x);S.depthAttachment.set(z),this._depthFBO=S,this._depthTexture=M}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,_,x]),function(T,S,M,z){if(T.transform.projection.name==="globe")return;const P=T.context,O=P.gl;P.clear({depth:1});const G=T.useProgram("terrainDepth"),Z=new s.DepthMode(O.LESS,s.DepthMode.ReadWrite,T.depthRangeFor3D);for(const J of z){const X=M.getTile(J),te=Ba(J.projMatrix,0);S.setupElevationDraw(X,G),G.draw(P,O.TRIANGLES,Z,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,te,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(o,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,f){if(o.getSource()instanceof Dt)return this._setupProxiedCoordsForImageSource(o,c,f);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const _=this.proxiedCoords[o.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){const M=x[S],z=this._findTileCoveringTileID(M,o);if(z){const P=this._createProxiedId(M,z,f[M.key]&&f[M.key][o.id]);_.push(P),this.proxyToSource[M.key][o.id]=[P]}}let T=!1;for(let S=0;S<c.length;S++){const M=o.getTile(c[S]);if(!M||!M.hasData())continue;const z=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==M.tileID.canonical.z){const P=this.proxyToSource[z.tileID.key][o.id],O=this._createProxiedId(z.tileID,M,f[z.tileID.key]&&f[z.tileID.key][o.id]);P?P.splice(P.length-1,0,O):this.proxyToSource[z.tileID.key][o.id]=[O],_.push(O),T=!0}}this._sourceTilesOverlap[o.id]=T}_setupProxiedCoordsForImageSource(o,c,f){if(!o.getSource().loaded())return;const _=this.proxiedCoords[o.id]=[],x=this.proxyCoords,T=o.getSource(),S=new s.Point(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),M=T.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((P,O)=>(P.min.x=Math.min(P.min.x,O.x-S.x),P.min.y=Math.min(P.min.y,O.y-S.y),P.max.x=Math.max(P.max.x,O.x-S.x),P.max.y=Math.max(P.max.y,O.y-S.y),P),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(P,O)=>{const G=P.wrap+P.canonical.x/(1<<P.canonical.z),Z=P.canonical.y/(1<<P.canonical.z),J=s.EXTENT/(1<<P.canonical.z),X=O.wrap+O.canonical.x/(1<<O.canonical.z),te=O.canonical.y/(1<<O.canonical.z);return G+J<X+M.min.x||G>X+M.max.x||Z+J<te+M.min.y||Z>te+M.max.y};for(let P=0;P<x.length;P++){const O=x[P];for(let G=0;G<c.length;G++){const Z=o.getTile(c[G]);if(!Z||!Z.hasData()||z(O,Z.tileID))continue;const J=this._createProxiedId(O,Z,f[O.key]&&f[O.key][o.id]),X=this.proxyToSource[O.key][o.id];X?X.push(J):this.proxyToSource[O.key][o.id]=[J],_.push(J)}}}_createProxiedId(o,c,f){let _=this.orthoMatrix;if(f){const x=f.find(T=>T.key===c.tileID.key);if(x)return x}if(c.tileID.key!==o.key){const x=o.canonical.z-c.tileID.canonical.z;let T,S,M;_=s.create();const z=c.tileID.wrap-o.wrap<<o.overscaledZ;x>0?(T=s.EXTENT>>x,S=T*((c.tileID.canonical.x<<x)-o.canonical.x+z),M=T*((c.tileID.canonical.y<<x)-o.canonical.y)):(T=s.EXTENT<<-x,S=s.EXTENT*(c.tileID.canonical.x-(o.canonical.x+z<<-x)),M=s.EXTENT*(c.tileID.canonical.y-(o.canonical.y<<-x))),s.ortho(_,0,T,0,T,0,1),s.translate(_,_,[S,M,0])}return new Xc(c.tileID,o.key,_)}_findTileCoveringTileID(o,c){let f=c.getTile(o);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[c.id],x=_[o.key];if(f=x?c.getTileByID(x):null,f&&f.hasData()||x===null)return f;let T=f?f.tileID:o,S=T.overscaledZ;const M=c.getSource().minzoom,z=[];if(!x){const O=c.getSource().maxzoom;if(o.canonical.z>=O){const G=o.canonical.z-O;c.getSource().reparseOverscaled?(S=Math.max(o.canonical.z+2,c.transform.tileZoom),T=new s.OverscaledTileID(S,o.wrap,O,o.canonical.x>>G,o.canonical.y>>G)):G!==0&&(S=O,T=new s.OverscaledTileID(S,o.wrap,O,o.canonical.x>>G,o.canonical.y>>G))}T.key!==o.key&&(z.push(T.key),f=c.getTile(T))}const P=O=>{z.forEach(G=>{_[G]=O}),z.length=0};for(S-=1;S>=M&&(!f||!f.hasData());S--){f&&P(f.tileID.key);const O=T.calculateScaledKey(S);if(f=c.getTileByID(O),f&&f.hasData())break;const G=_[O];if(G===null)break;G===void 0?z.push(O):f=c.getTileByID(G)}return P(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let f=this._tilesDirty[o];f||(f=this._tilesDirty[o]={}),f[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(c){let f=0;const _=new s.StructArrayLayout2ui4,x=131;for(let T=1;T<129;T++){for(let S=1;S<129;S++)f=T*x+S,_.emplaceBack(f,f+1),_.emplaceBack(f,f+x),_.emplaceBack(f+1,f+x),T===128&&_.emplaceBack(f+x,f+x+1);_.emplaceBack(f+1,f+1+x)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ln{static cacheKey(o,c,f,_){let x=`${c}${_?_.cacheKey:""}`;for(const T of f)o.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(o,c,f,_,x,T){const S=o.gl;this.program=S.createProgram();const M=function(B){const W=[];for(let ae=0;ae<B.length;ae++){if(B[ae]===null)continue;const le=B[ae].split(" ");W.push(le.pop())}return W}(f.staticAttributes),z=_?_.getBinderAttributes():[],P=M.concat(z);let O=_?_.defines():[];O=O.concat(T.map(B=>`#define ${B}`));const G=o.isWebGL2?`#version 300 es
`:"",Z=G+O.concat(o.extStandardDerivatives&&G.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(nd):nd,nd,qc,Zf.fragmentSource,La.fragmentSource,f.fragmentSource).join(`
`),J=G+O.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,qc,Zf.vertexSource,La.vertexSource,Gc.vertexSource,f.vertexSource).join(`
`),X=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(X,Z),S.compileShader(X),S.attachShader(this.program,X);const te=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(te,J),S.compileShader(te),S.attachShader(this.program,te),this.attributes={},this.numAttributes=P.length;for(let B=0;B<this.numAttributes;B++)P[B]&&(S.bindAttribLocation(this.program,B,P[B]),this.attributes[P[B]]=B);S.linkProgram(this.program),S.deleteShader(te),S.deleteShader(X),this.fixedUniforms=x(o),this.binderUniforms=_?_.getUniforms(o):[],T.includes("TERRAIN")&&(this.terrainUniforms=(B=>({u_dem:new s.Uniform1i(B),u_dem_prev:new s.Uniform1i(B),u_dem_unpack:new s.Uniform4f(B),u_dem_tl:new s.Uniform2f(B),u_dem_scale:new s.Uniform1f(B),u_dem_tl_prev:new s.Uniform2f(B),u_dem_scale_prev:new s.Uniform1f(B),u_dem_size:new s.Uniform1f(B),u_dem_lerp:new s.Uniform1f(B),u_exaggeration:new s.Uniform1f(B),u_depth:new s.Uniform1i(B),u_depth_size_inv:new s.Uniform2f(B),u_meter_to_dem:new s.Uniform1f(B),u_label_plane_matrix_inv:new s.UniformMatrix4f(B)}))(o)),T.includes("GLOBE")&&(this.globeUniforms=(B=>({u_tile_tl_up:new s.Uniform3f(B),u_tile_tr_up:new s.Uniform3f(B),u_tile_br_up:new s.Uniform3f(B),u_tile_bl_up:new s.Uniform3f(B),u_tile_up_scale:new s.Uniform1f(B)}))(o)),T.includes("FOG")&&(this.fogUniforms=(B=>({u_fog_matrix:new s.UniformMatrix4f(B),u_fog_range:new s.Uniform2f(B),u_fog_color:new s.Uniform4f(B),u_fog_horizon_blend:new s.Uniform1f(B),u_fog_temporal_offset:new s.Uniform1f(B),u_frustum_tl:new s.Uniform3f(B),u_frustum_tr:new s.Uniform3f(B),u_frustum_br:new s.Uniform3f(B),u_frustum_bl:new s.Uniform3f(B),u_globe_pos:new s.Uniform3f(B),u_globe_radius:new s.Uniform1f(B),u_globe_transition:new s.Uniform1f(B),u_is_globe:new s.Uniform1i(B),u_viewport:new s.Uniform2f(B)}))(o))}}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)f[_].set(this.program,_,c[_])}}draw(o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X){const te=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(f),o.setStencilMode(_),o.setColorMode(x),o.setCullFace(T);for(const W of Object.keys(this.fixedUniforms))this.fixedUniforms[W].set(this.program,W,S[W]);J&&J.setUniforms(this.program,o,this.binderUniforms,G,{zoom:Z});const B={[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[c];for(const W of O.get()){const ae=W.vaos||(W.vaos={});(ae[M]||(ae[M]=new zy)).bind(o,this,z,J?J.getPaintVertexBuffers():[],P,W.vertexOffset,X||[]),te.drawElements(c,W.primitiveLength*B,te.UNSIGNED_SHORT,W.primitiveOffset*B*2)}}}function Gl(d,o){const c=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,d.transform.tileZoom)/c,_=f*(o.tileID.canonical.x+o.tileID.wrap*c),x=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_tile_units_to_pixels:1/Kt(o,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const Yf=s.create(),ud=(d,o,c,f,_,x,T,S,M,z,P)=>{const O=o.style.light,G=O.properties.get("position"),Z=[G.x,G.y,G.z],J=s.create$1();O.properties.get("anchor")==="viewport"&&(s.fromRotation(J,-o.transform.angle),s.transformMat3(Z,Z,J));const X=O.properties.get("color"),te=o.transform,B={u_matrix:d,u_lightpos:Z,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:x};return te.projection.name==="globe"&&(B.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],B.u_zoom_transition=M,B.u_inv_rot_matrix=P,B.u_merc_center=z,B.u_up_dir=te.projection.upVector(new s.CanonicalTileID(0,0,0),z[0]*s.EXTENT,z[1]*s.EXTENT),B.u_height_lift=S),B},Jf=(d,o,c,f,_,x,T,S,M,z,P,O)=>{const G=ud(d,o,c,f,_,x,T,M,z,P,O),Z={u_height_factor:-Math.pow(2,T.overscaledZ)/S.tileSize/8};return s.extend(G,Gl(o,S),Z)},Ks=d=>({u_matrix:d}),hd=(d,o,c)=>s.extend(Ks(d),Gl(o,c)),Ry=(d,o)=>({u_matrix:d,u_world:o}),Dy=(d,o,c,f)=>s.extend(hd(d,o,c),{u_world:f}),Ly=s.create(),dd=(d,o,c,f,_,x)=>{const T=d.transform,S=T.projection.name==="globe";let M;if(x.paint.get("circle-pitch-alignment")==="map")if(S){const P=s.globePixelsToTileUnits(T.zoom,o.canonical)*T._pixelsPerMercatorPixel;M=Float32Array.from([P,0,0,P])}else M=T.calculatePixelsToTileUnitsMatrix(c);else M=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:d.translatePosMatrix(o.projMatrix,c,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:Ly,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){z.u_inv_rot_matrix=f,z.u_merc_center=_,z.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const P=_[0]*s.EXTENT,O=_[1]*s.EXTENT;z.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),P,O)}return z},pd=d=>{const o=[];return d.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},fd=(d,o,c,f)=>{const _=s.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:o.getCameraToCenterDistance(f),u_extrude_scale:[o.pixelsToGLUnits[0]/_,o.pixelsToGLUnits[1]/_]}},Kc=(d,o,c=1)=>({u_matrix:d,u_color:o,u_overlay:0,u_overlay_scale:c}),Qf=s.create(),em=(d,o,c,f,_,x,T)=>{const S=d.transform,M=S.projection.name==="globe",z=M?s.globePixelsToTileUnits(S.zoom,o.canonical)*S._pixelsPerMercatorPixel:Kt(c,1,x),P={u_matrix:o.projMatrix,u_extrude_scale:z,u_intensity:T,u_inv_rot_matrix:Qf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){P.u_inv_rot_matrix=f,P.u_merc_center=_,P.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],P.u_zoom_transition=s.globeToMercatorTransition(S.zoom);const O=_[0]*s.EXTENT,G=_[1]*s.EXTENT;P.u_up_dir=S.projection.upVector(new s.CanonicalTileID(0,0,0),O,G)}return P},Oy=(d,o,c,f,_,x,T)=>{const S=d.transform,M=S.calculatePixelsToTileUnitsMatrix(o);return{u_matrix:md(d,o,c,f),u_pixels_to_tile_units:M,u_device_pixel_ratio:x,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:Wl(c)?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Na(o,d.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},ql=(d,o,c,f,_)=>{const x=d.transform;return{u_matrix:md(d,o,c,f),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:Na(o,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Na(d,o){return 1/Kt(d,1,o.tileZoom)}function md(d,o,c,f){return d.translatePosMatrix(f||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Wl(d){const o=d.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const gd=(d,o,c,f,_,x)=>{return{u_matrix:d,u_tl_parent:o,u_scale_parent:c,u_fade_t:f.mix,u_opacity:f.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(S=_.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=_.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Io(_.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,S};function Io(d){d*=Math.PI/180;const o=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Yc=s.create(),_d=(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X)=>{const te=_.transform,B={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:te.width/te.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+M,u_pitch_with_map:+f,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Yc,u_up_vector:[0,-1,0]};return X.name==="globe"&&(B.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],B.u_zoom_transition=O,B.u_inv_rot_matrix=Z,B.u_merc_center=G,B.u_camera_forward=te._camera.forward(),B.u_ecef_origin=s.globeECEFOrigin(te.globeMatrix,P.toUnwrapped()),B.u_tile_matrix=Float32Array.from(te.globeMatrix),B.u_up_vector=J),B},Jc=(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X,te)=>s.extend(_d(d,o,c,f,_,x,T,S,M,z,O,G,Z,J,X,te),{u_gamma_scale:f?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+P}),tm=(d,o,c,f,_,x,T,S,M,z,P,O,G,Z,J,X)=>s.extend(Jc(d,o,c,f,_,x,T,S,!0,M,!0,P,O,G,Z,J,X),{u_texsize_icon:z,u_texture_icon:1}),yd=(d,o,c)=>({u_matrix:d,u_opacity:o,u_color:c}),By=(d,o,c,f,_)=>s.extend(function(x,T,S){const M=T.imageManager.getPattern(x.toString()),{width:z,height:P}=T.imageManager.getPixelSize(),O=Math.pow(2,S.tileID.overscaledZ),G=S.tileSize*Math.pow(2,T.transform.tileZoom)/O,Z=G*(S.tileID.canonical.x+S.tileID.wrap*O),J=G*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:M.tl,u_pattern_br:M.br,u_texsize:[z,P],u_pattern_size:M.displaySize,u_tile_units_to_pixels:1/Kt(S,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,J>>16],u_pixel_coord_lower:[65535&Z,65535&J]}}(f,c,_),{u_matrix:d,u_opacity:o}),vd={fillExtrusion:d=>({u_matrix:new s.UniformMatrix4f(d),u_lightpos:new s.Uniform3f(d),u_lightintensity:new s.Uniform1f(d),u_lightcolor:new s.Uniform3f(d),u_vertical_gradient:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_edge_radius:new s.Uniform1f(d),u_ao:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_up_dir:new s.Uniform3f(d),u_height_lift:new s.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_lightpos:new s.Uniform3f(d),u_lightintensity:new s.Uniform1f(d),u_lightcolor:new s.Uniform3f(d),u_vertical_gradient:new s.Uniform1f(d),u_height_factor:new s.Uniform1f(d),u_edge_radius:new s.Uniform1f(d),u_ao:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_up_dir:new s.Uniform3f(d),u_height_lift:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d)}),fill:d=>({u_matrix:new s.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),fillOutline:d=>({u_matrix:new s.UniformMatrix4f(d),u_world:new s.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_world:new s.Uniform2f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new s.Uniform1f(d),u_extrude_scale:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_up_dir:new s.Uniform3f(d)}),collisionBox:d=>({u_matrix:new s.UniformMatrix4f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_extrude_scale:new s.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new s.UniformMatrix4f(d),u_inv_matrix:new s.UniformMatrix4f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_viewport_size:new s.Uniform2f(d)}),debug:d=>({u_color:new s.UniformColor(d),u_matrix:new s.UniformMatrix4f(d),u_overlay:new s.Uniform1i(d),u_overlay_scale:new s.Uniform1f(d)}),clippingMask:d=>({u_matrix:new s.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new s.Uniform1f(d),u_intensity:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_up_dir:new s.Uniform3f(d)}),heatmapTexture:d=>({u_image:new s.Uniform1i(d),u_color_ramp:new s.Uniform1i(d),u_opacity:new s.Uniform1f(d)}),hillshade:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_latrange:new s.Uniform2f(d),u_light:new s.Uniform2f(d),u_shadow:new s.UniformColor(d),u_highlight:new s.UniformColor(d),u_accent:new s.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_dimension:new s.Uniform2f(d),u_zoom:new s.Uniform1f(d),u_unpack:new s.Uniform4f(d)}),line:d=>({u_matrix:new s.UniformMatrix4f(d),u_pixels_to_tile_units:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_units_to_pixels:new s.Uniform2f(d),u_dash_image:new s.Uniform1i(d),u_gradient_image:new s.Uniform1i(d),u_image_height:new s.Uniform1f(d),u_texsize:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_alpha_discard_threshold:new s.Uniform1f(d),u_trim_offset:new s.Uniform2f(d)}),linePattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_texsize:new s.Uniform2f(d),u_pixels_to_tile_units:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_units_to_pixels:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_alpha_discard_threshold:new s.Uniform1f(d)}),raster:d=>({u_matrix:new s.UniformMatrix4f(d),u_tl_parent:new s.Uniform2f(d),u_scale_parent:new s.Uniform1f(d),u_fade_t:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_image0:new s.Uniform1i(d),u_image1:new s.Uniform1i(d),u_brightness_low:new s.Uniform1f(d),u_brightness_high:new s.Uniform1f(d),u_saturation_factor:new s.Uniform1f(d),u_contrast_factor:new s.Uniform1f(d),u_spin_weights:new s.Uniform3f(d),u_perspective_transform:new s.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_camera_forward:new s.Uniform3f(d),u_tile_matrix:new s.UniformMatrix4f(d),u_up_vector:new s.Uniform3f(d),u_ecef_origin:new s.Uniform3f(d),u_texture:new s.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_texture:new s.Uniform1i(d),u_gamma_scale:new s.Uniform1f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_camera_forward:new s.Uniform3f(d),u_tile_matrix:new s.UniformMatrix4f(d),u_up_vector:new s.Uniform3f(d),u_ecef_origin:new s.Uniform3f(d),u_is_halo:new s.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_texsize_icon:new s.Uniform2f(d),u_texture:new s.Uniform1i(d),u_texture_icon:new s.Uniform1i(d),u_gamma_scale:new s.Uniform1f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_is_halo:new s.Uniform1i(d)}),background:d=>({u_matrix:new s.UniformMatrix4f(d),u_opacity:new s.Uniform1f(d),u_color:new s.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_opacity:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_pattern_tl:new s.Uniform2f(d),u_pattern_br:new s.Uniform2f(d),u_texsize:new s.Uniform2f(d),u_pattern_size:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),terrainRaster:sd,terrainDepth:sd,skybox:d=>({u_matrix:new s.UniformMatrix4f(d),u_sun_direction:new s.Uniform3f(d),u_cubemap:new s.Uniform1i(d),u_opacity:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new s.UniformMatrix4f(d),u_color_ramp:new s.Uniform1i(d),u_center_direction:new s.Uniform3f(d),u_radius:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new s.UniformMatrix3f(d),u_sun_direction:new s.Uniform3f(d),u_sun_intensity:new s.Uniform1f(d),u_color_tint_r:new s.Uniform4f(d),u_color_tint_m:new s.Uniform4f(d),u_luminance:new s.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new s.UniformMatrix4f(d),u_globe_matrix:new s.UniformMatrix4f(d),u_normalize_matrix:new s.UniformMatrix4f(d),u_merc_matrix:new s.UniformMatrix4f(d),u_zoom_transition:new s.Uniform1f(d),u_merc_center:new s.Uniform2f(d),u_image0:new s.Uniform1i(d),u_grid_matrix:new s.UniformMatrix3f(d),u_skirt_height:new s.Uniform1f(d),u_frustum_tl:new s.Uniform3f(d),u_frustum_tr:new s.Uniform3f(d),u_frustum_br:new s.Uniform3f(d),u_frustum_bl:new s.Uniform3f(d),u_globe_pos:new s.Uniform3f(d),u_globe_radius:new s.Uniform1f(d),u_viewport:new s.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.Uniform3f(d),u_frustum_tr:new s.Uniform3f(d),u_frustum_br:new s.Uniform3f(d),u_frustum_bl:new s.Uniform3f(d),u_horizon:new s.Uniform1f(d),u_transition:new s.Uniform1f(d),u_fadeout_range:new s.Uniform1f(d),u_color:new s.Uniform4f(d),u_high_color:new s.Uniform4f(d),u_space_color:new s.Uniform4f(d),u_star_intensity:new s.Uniform1f(d),u_star_density:new s.Uniform1f(d),u_star_size:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d),u_horizon_angle:new s.Uniform1f(d),u_rotation_matrix:new s.UniformMatrix4f(d)})};let Qc;function Zl(d,o,c,f,_,x,T){const S=d.context,M=S.gl,z=d.transform,P=d.useProgram("collisionBox"),O=[];let G=0,Z=0;for(let le=0;le<f.length;le++){const _e=f[le],xe=o.getTile(_e),ve=xe.getBucket(c);if(!ve)continue;const Se=Ui(_e,ve,z);let Ee=Se;_[0]===0&&_[1]===0||(Ee=d.translatePosMatrix(Se,xe,_,x));const Pe=T?ve.textCollisionBox:ve.iconCollisionBox,nt=ve.collisionCircleArray;if(nt.length>0){const Ae=s.create(),Ge=Ee;s.mul(Ae,ve.placementInvProjMatrix,z.glCoordMatrix),s.mul(Ae,Ae,ve.placementViewportMatrix),O.push({circleArray:nt,circleOffset:Z,transform:Ge,invTransform:Ae,projection:ve.getProjection()}),G+=nt.length/4,Z=G}Pe&&(d.terrain&&d.terrain.setupElevationDraw(xe,P),P.draw(S,M.LINES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,fd(Ee,z,xe,ve.getProjection()),c.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,null,z.zoom,null,[Pe.collisionVertexBuffer,Pe.collisionVertexBufferExt]))}if(!T||!O.length)return;const J=d.useProgram("collisionCircle"),X=new s.StructArrayLayout2f1f2i16;X.resize(4*G),X._trim();let te=0;for(const le of O)for(let _e=0;_e<le.circleArray.length/4;_e++){const xe=4*_e,ve=le.circleArray[xe+0],Se=le.circleArray[xe+1],Ee=le.circleArray[xe+2],Pe=le.circleArray[xe+3];X.emplace(te++,ve,Se,Ee,Pe,0),X.emplace(te++,ve,Se,Ee,Pe,1),X.emplace(te++,ve,Se,Ee,Pe,2),X.emplace(te++,ve,Se,Ee,Pe,3)}(!Qc||Qc.length<2*G)&&(Qc=function(le){const _e=2*le,xe=new s.StructArrayLayout3ui6;xe.resize(_e),xe._trim();for(let ve=0;ve<_e;ve++){const Se=6*ve;xe.uint16[Se+0]=4*ve+0,xe.uint16[Se+1]=4*ve+1,xe.uint16[Se+2]=4*ve+2,xe.uint16[Se+3]=4*ve+2,xe.uint16[Se+4]=4*ve+3,xe.uint16[Se+5]=4*ve+0}return xe}(G));const B=S.createIndexBuffer(Qc,!0),W=S.createVertexBuffer(X,s.collisionCircleLayout.members,!0);for(const le of O){const _e={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(ae=z).getCameraToCenterDistance(le.projection),u_viewport_size:[ae.width,ae.height]};J.draw(S,M.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,_e,c.id,W,B,s.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,z.zoom)}var ae;W.destroy(),B.destroy()}const nm=s.create();function xd({width:d,height:o,anchor:c,textOffset:f,textScale:_},x){const{horizontalAlign:T,verticalAlign:S}=s.getAnchorAlignment(c),M=-(T-.5)*d,z=-(S-.5)*o,P=s.evaluateVariableOffset(c,f);return new s.Point((M/_+P[0])*x,(z/_+P[1])*x)}function Fy(d,o,c,f,_,x,T,S,M,z,P){const O=d.text.placedSymbolArray,G=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,J={},X=d.getProjection(),te=Hn(S,X,x),B=x.elevation,W=X.upVectorScale(S.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ae=0;ae<O.length;ae++){const le=O.get(ae),{tileAnchorX:_e,tileAnchorY:xe,numGlyphs:ve}=le,Se=le.hidden||!le.crossTileID||d.allowVerticalPlacement&&!le.placedOrientation?null:f[le.crossTileID];if(Se){let Ee=0,Pe=0,nt=0;if(B){const ot=B?B.getAtTileOffset(S,_e,xe):0,[Ct,Ot,xt]=X.upVector(S.canonical,_e,xe);Ee=ot*Ct*W,Pe=ot*Ot*W,nt=ot*xt*W}let[Ae,Ge,Le,Qe]=Or(le.projectedAnchorX+Ee,le.projectedAnchorY+Pe,le.projectedAnchorZ+nt,c?te:T);const ke=Vf(x.getCameraToCenterDistance(X),Qe);let $e=_.evaluateSizeForFeature(d.textSizeData,z,le)*ke/s.ONE_EM;c&&($e*=d.tilePixelRatio/M);const it=xd(Se,$e);c?({x:Ae,y:Ge,z:Le}=X.projectTilePoint(_e+it.x,xe+it.y,S.canonical),[Ae,Ge,Le]=Or(Ae+Ee,Ge+Pe,Le+nt,T)):(o&&it._rotate(-x.angle),Ae+=it.x,Ge+=it.y,Le=0);const Xe=d.allowVerticalPlacement&&le.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<ve;ot++)s.addDynamicAttributes(G,Ae,Ge,Le,Xe);P&&le.associatedIconIndex>=0&&(J[le.associatedIconIndex]={x:Ae,y:Ge,z:Le,angle:Xe})}else io(ve,G)}if(P){Z.clear();const ae=d.icon.placedSymbolArray;for(let le=0;le<ae.length;le++){const _e=ae.get(le),{numGlyphs:xe}=_e,ve=J[le];if(_e.hidden||!ve)io(xe,Z);else{const{x:Se,y:Ee,z:Pe,angle:nt}=ve;for(let Ae=0;Ae<xe;Ae++)s.addDynamicAttributes(Z,Se,Ee,Pe,nt)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(G)}function wd(d,o,c){return c.iconsInText&&o?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function rm(d,o,c,f,_,x,T,S,M,z,P,O){const G=d.context,Z=G.gl,J=d.transform,X=S==="map",te=M==="map",B=X&&c.layout.get("symbol-placement")!=="point",W=X&&!te&&!B,ae=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let le=!1;const _e=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),xe=[s.mercatorXfromLng(J.center.lng),s.mercatorYfromLat(J.center.lat)],ve=c.layout.get("text-variable-anchor"),Se=J.projection.name==="globe",Ee=[],Pe=[0,-1,0];let nt=Pe;!Se&&!J.mercatorFromTransition||X||(nt=function(Ae){const Ge=Ae._camera.getWorldToCamera(Ae.worldSize,1),Le=s.multiply([],Ge,Ae.globeMatrix);s.invert(Le,Le);const Qe=[0,0,0],ke=[0,1,0,0];return s.transformMat4$1(ke,ke,Le),Qe[0]=ke[0],Qe[1]=ke[1],Qe[2]=ke[2],s.normalize(Qe,Qe),Qe}(J));for(const Ae of f){const Ge=o.getTile(Ae),Le=Ge.getBucket(c);if(!Le||Le.projection.name==="mercator"&&Se)continue;const Qe=_?Le.text:Le.icon;if(!Qe||Le.fullyClipped||!Qe.segments.get().length)continue;const ke=Qe.programConfigurations.get(c.id),$e=_||Le.sdfIcons,it=_?Le.textSizeData:Le.iconSizeData,Xe=te||J.pitch!==0,ot=s.evaluateSizeForZoom(it,J.zoom);let Ct,Ot,xt,kt,nn=[0,0],Jt=null;if(_)Ot=Ge.glyphAtlasTexture,xt=Z.LINEAR,Ct=Ge.glyphAtlasTexture.size,Le.iconsInText&&(nn=Ge.imageAtlasTexture.size,Jt=Ge.imageAtlasTexture,kt=Xe||d.options.rotating||d.options.zooming||it.kind==="composite"||it.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const is=c.layout.get("icon-size").constantOr(0)!==1||Le.iconsNeedLinear;Ot=Ge.imageAtlasTexture,xt=$e||d.options.rotating||d.options.zooming||is||Xe?Z.LINEAR:Z.NEAREST,Ct=Ge.imageAtlasTexture.size}const Tt=Le.projection.name==="globe",_n=Tt?nt:Pe,Tn=Tt?s.globeToMercatorTransition(J.zoom):0,Sn=Hn(Ae,Le.getProjection(),J),Cn=J.calculatePixelsToTileUnitsMatrix(Ge),ti=je(Sn,Ge.tileID.canonical,te,X,J,Le.getProjection(),Cn),Fr=d.terrain&&te&&B?s.invert(s.create(),ti):nm,qi=hr(Sn,Ge.tileID.canonical,te,X,J,Le.getProjection(),Cn),Po=ve&&Le.hasTextData(),Xn=c.layout.get("icon-text-fit")!=="none"&&Po&&Le.hasIconData();if(B){const is=J.elevation,Ts=is?is.getAtTileOffsetFunc(Ae,J.center.lat,J.worldSize,Le.getProjection()):null,ta=Ko(Sn,Ge.tileID.canonical,te,X,J,Le.getProjection(),Cn);Zh(Le,Sn,d,_,ta,qi,te,z,Ts,Ae)}const An=B||_&&ve||Xn,hn=d.translatePosMatrix(Sn,Ge,x,T),dr=An?nm:ti,li=d.translatePosMatrix(qi,Ge,x,T,!0),qn=Le.getProjection().createInversionMatrix(J,Ae.canonical),yi=[];d.terrainRenderModeElevated()&&te&&yi.push("PITCH_WITH_MAP_TERRAIN"),Tt&&yi.push("PROJECTION_GLOBE_VIEW"),An&&yi.push("PROJECTED_POS_ON_VIEWPORT");const mu=$e&&c.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ea;ea=$e?Le.iconsInText?tm(it.kind,ot,W,te,d,hn,dr,li,Ct,nn,Ae,Tn,xe,qn,_n,Le.getProjection()):Jc(it.kind,ot,W,te,d,hn,dr,li,_,Ct,!0,Ae,Tn,xe,qn,_n,Le.getProjection()):_d(it.kind,ot,W,te,d,hn,dr,li,_,Ct,Ae,Tn,xe,qn,_n,Le.getProjection());const ic={program:d.useProgram(wd($e,_,Le),ke,yi),buffers:Qe,uniformValues:ea,atlasTexture:Ot,atlasTextureIcon:Jt,atlasInterpolation:xt,atlasInterpolationIcon:kt,isSDF:$e,hasHalo:mu,tile:Ge,labelPlaneMatrixInv:Fr};if(ae&&Le.canOverlap){le=!0;const is=Qe.segments.get();for(const Ts of is)Ee.push({segments:new s.SegmentVector([Ts]),sortKey:Ts.sortKey,state:ic})}else Ee.push({segments:Qe.segments,sortKey:0,state:ic})}le&&Ee.sort((Ae,Ge)=>Ae.sortKey-Ge.sortKey);for(const Ae of Ee){const Ge=Ae.state;if(d.terrain&&d.terrain.setupElevationDraw(Ge.tile,Ge.program,{useDepthForOcclusion:!Se,labelPlaneMatrixInv:Ge.labelPlaneMatrixInv}),G.activeTexture.set(Z.TEXTURE0),Ge.atlasTexture.bind(Ge.atlasInterpolation,Z.CLAMP_TO_EDGE),Ge.atlasTextureIcon&&(G.activeTexture.set(Z.TEXTURE1),Ge.atlasTextureIcon&&Ge.atlasTextureIcon.bind(Ge.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ge.isSDF){const Le=Ge.uniformValues;Ge.hasHalo&&(Le.u_is_halo=1,Hl(Ge.buffers,Ae.segments,c,d,Ge.program,_e,P,O,Le)),Le.u_is_halo=0}Hl(Ge.buffers,Ae.segments,c,d,Ge.program,_e,P,O,Ge.uniformValues)}}function Hl(d,o,c,f,_,x,T,S,M){const z=f.context,P=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];_.draw(z,z.gl.TRIANGLES,x,T,S,s.CullFaceMode.disabled,M,c.id,d.layoutVertexBuffer,d.indexBuffer,o,c.paint,f.transform.zoom,d.programConfigurations.get(c.id),P)}function im(d,o,c,f,_,x,T){const S=d.context.gl,M=c.paint.get("fill-pattern"),z=M&&M.constantOr(1);let P,O,G,Z,J;T?(O=z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=S.LINES):(O=z?"fillPattern":"fill",P=S.TRIANGLES);for(const X of f){const te=o.getTile(X);if(z&&!te.patternsLoaded())continue;const B=te.getBucket(c);if(!B)continue;d.prepareDrawTile();const W=B.programConfigurations.get(c.id),ae=d.useProgram(O,W);z&&(d.context.activeTexture.set(S.TEXTURE0),te.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),W.updatePaintBuffers());const le=M.constantOr(null);if(le&&te.imageAtlas){const xe=te.imageAtlas.patternPositions[le.toString()];xe&&W.setConstantPatternPositions(xe)}const _e=d.translatePosMatrix(X.projMatrix,te,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){Z=B.indexBuffer2,J=B.segments2;const xe=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];G=O==="fillOutlinePattern"&&z?Dy(_e,d,te,xe):Ry(_e,xe)}else Z=B.indexBuffer,J=B.segments,G=z?hd(_e,d,te):Ks(_e);d.prepareDrawProgram(d.context,ae,X.toUnwrapped()),ae.draw(d.context,P,_,d.stencilModeForClipping(X),x,s.CullFaceMode.disabled,G,c.id,B.layoutVertexBuffer,Z,J,c.paint,d.transform.zoom,W)}}function eu(d,o,c,f,_,x,T){const S=d.context,M=S.gl,z=d.transform,P=c.paint.get("fill-extrusion-pattern"),O=P.constantOr(1),G=c.paint.get("fill-extrusion-opacity"),Z=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],J=c.layout.get("fill-extrusion-edge-radius"),X=J>0&&!c.paint.get("fill-extrusion-rounded-roof"),te=X?0:J,B=z.projection.name==="globe"?s.fillExtrusionHeightLift():0,W=z.projection.name==="globe",ae=W?s.globeToMercatorTransition(z.zoom):0,le=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],_e=[];W&&_e.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&_e.push("FAUX_AO"),X&&_e.push("ZERO_ROOF_RADIUS");for(const xe of f){const ve=o.getTile(xe),Se=ve.getBucket(c);if(!Se||Se.projection.name!==z.projection.name)continue;const Ee=Se.programConfigurations.get(c.id),Pe=d.useProgram(O?"fillExtrusionPattern":"fillExtrusion",Ee,_e);if(d.terrain){const $e=d.terrain;if(d.style.terrainSetForDrapingOnly())$e.setupElevationDraw(ve,Pe,{useMeterToDem:!0});else{if(!Se.enableTerrain)continue;if($e.setupElevationDraw(ve,Pe,{useMeterToDem:!0}),om(S,o,xe,Se,c,$e),!Se.centroidVertexBuffer){const it=Pe.attributes.a_centroid_pos;it!==void 0&&M.vertexAttrib2f(it,0,0)}}}O&&(d.context.activeTexture.set(M.TEXTURE0),ve.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ee.updatePaintBuffers());const nt=P.constantOr(null);if(nt&&ve.imageAtlas){const $e=ve.imageAtlas.patternPositions[nt.toString()];$e&&Ee.setConstantPatternPositions($e)}const Ae=d.translatePosMatrix(xe.projMatrix,ve,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ge=z.projection.createInversionMatrix(z,xe.canonical),Le=c.paint.get("fill-extrusion-vertical-gradient"),Qe=O?Jf(Ae,d,Le,G,Z,te,xe,ve,B,ae,le,Ge):ud(Ae,d,Le,G,Z,te,xe,B,ae,le,Ge);d.prepareDrawProgram(S,Pe,xe.toUnwrapped());const ke=[];d.terrain&&ke.push(Se.centroidVertexBuffer),W&&ke.push(Se.layoutVertexExtBuffer),Pe.draw(S,S.gl.TRIANGLES,_,x,T,s.CullFaceMode.backCCW,Qe,c.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,c.paint,d.transform.zoom,Ee,ke)}}function om(d,o,c,f,_,x){const T=[B=>{let W=B.canonical.x-1,ae=B.wrap;return W<0&&(W=(1<<B.canonical.z)-1,ae--),new s.OverscaledTileID(B.overscaledZ,ae,B.canonical.z,W,B.canonical.y)},B=>{let W=B.canonical.x+1,ae=B.wrap;return W===1<<B.canonical.z&&(W=0,ae++),new s.OverscaledTileID(B.overscaledZ,ae,B.canonical.z,W,B.canonical.y)},B=>new s.OverscaledTileID(B.overscaledZ,B.wrap,B.canonical.z,B.canonical.x,(B.canonical.y===0?1<<B.canonical.z:B.canonical.y)-1),B=>new s.OverscaledTileID(B.overscaledZ,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y===(1<<B.canonical.z)-1?0:B.canonical.y+1)],S=B=>{const W=o.getSource().minzoom,ae=_e=>{const xe=o.getTileByID(_e);if(xe&&xe.hasData())return xe.getBucket(_)},le=[0,-1,1];for(const _e of le){if(B.overscaledZ+_e<W)continue;const xe=ae(B.calculateScaledKey(B.overscaledZ+_e));if(xe)return xe}},M=[0,0,0],z=(B,W)=>(M[0]=Math.min(B.min.y,W.min.y),M[1]=Math.max(B.max.y,W.max.y),M[2]=s.EXTENT-W.min.x>B.max.x?W.min.x-s.EXTENT:B.max.x,M),P=(B,W)=>(M[0]=Math.min(B.min.x,W.min.x),M[1]=Math.max(B.max.x,W.max.x),M[2]=s.EXTENT-W.min.y>B.max.y?W.min.y-s.EXTENT:B.max.y,M),O=[(B,W)=>z(B,W),(B,W)=>z(W,B),(B,W)=>P(B,W),(B,W)=>P(W,B)],G=new s.Point(0,0);let Z,J,X;const te=(B,W,ae,le,_e)=>{const xe=[[le?ae:B,le?B:ae,0],[le?ae:W,le?W:ae,0]],ve=_e<0?s.EXTENT+_e:_e,Se=[le?ve:(B+W)/2,le?(B+W)/2:ve,0];return ae===0&&_e<0||ae!==0&&_e>0?x.getForTilePoints(X,[Se],!0,J):xe.push(Se),x.getForTilePoints(c,xe,!0,Z),Math.max(xe[0][2],xe[1][2],Se[2])/x.exaggeration()};for(let B=0;B<4;B++){const W=(B<2?1:5)-B,ae=f.borders[B];if(ae.length===0)continue;const le=X=T[B](c),_e=S(le);if(!(_e&&_e instanceof s.FillExtrusionBucket&&_e.enableTerrain)||f.borderDoneWithNeighborZ[B]===_e.canonical.z&&_e.borderDoneWithNeighborZ[W]===f.canonical.z||(J=x.findDEMTileFor(le),!J||!J.dem))continue;if(!Z){const Ee=x.findDEMTileFor(c);if(!Ee||!Ee.dem)return;Z=Ee}const xe=_e.borders[W];let ve=0;const Se=_e.borderDoneWithNeighborZ[W]!==f.canonical.z;if(f.canonical.z===_e.canonical.z){for(let Ee=0;Ee<ae.length;Ee++){const Pe=f.featuresOnBorder[ae[Ee]],nt=Pe.borders[B];let Ae;for(;ve<xe.length&&(Ae=_e.featuresOnBorder[xe[ve]],!(Ae.borders[W][1]>nt[0]+3));)Se&&_e.encodeCentroid(void 0,Ae,!1),ve++;if(Ae&&ve<xe.length){const Ge=ve;let Le=0;for(;!(Ae.borders[W][0]>nt[1]-3)&&(Le++,++ve!==xe.length);)Ae=_e.featuresOnBorder[xe[ve]];if(Ae=_e.featuresOnBorder[xe[Ge]],Pe.intersectsCount()>1||Ae.intersectsCount()>1||Le!==1){Le!==1&&(ve=Ge),f.encodeCentroid(void 0,Pe,!1),Se&&_e.encodeCentroid(void 0,Ae,!1);continue}const Qe=O[B](Pe,Ae),ke=B%2?s.EXTENT-1:0;G.x=te(Qe[0],Math.min(s.EXTENT-1,Qe[1]),ke,B<2,Qe[2]),G.y=0,f.encodeCentroid(G,Pe,!1),Se&&_e.encodeCentroid(G,Ae,!1)}else f.encodeCentroid(void 0,Pe,!1)}f.borderDoneWithNeighborZ[B]=_e.canonical.z,f.needsCentroidUpdate=!0,Se&&(_e.borderDoneWithNeighborZ[W]=f.canonical.z,_e.needsCentroidUpdate=!0)}else{for(const Ee of ae)f.encodeCentroid(void 0,f.featuresOnBorder[Ee],!1);if(Se){for(const Ee of xe)_e.encodeCentroid(void 0,_e.featuresOnBorder[Ee],!1);_e.borderDoneWithNeighborZ[W]=f.canonical.z,_e.needsCentroidUpdate=!0}f.borderDoneWithNeighborZ[B]=_e.canonical.z,f.needsCentroidUpdate=!0}}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const ja=new s.Color(1,0,0,1),Ny=new s.Color(0,1,0,1),jy=new s.Color(0,0,1,1),Uy=new s.Color(1,0,1,1),Vy=new s.Color(0,1,1,1);function $y(d,o,c){const f=d.context,_=d.transform,x=f.gl,T=_.projection.name==="globe",S=T?["PROJECTION_GLOBE_VIEW"]:null;let M=c.projMatrix;if(T&&s.globeToMercatorTransition(_.zoom)>0){const Pe=s.transitionTileAABBinECEF(c.canonical,_),nt=s.globeDenormalizeECEF(Pe);M=s.multiply(new Float32Array(16),_.globeMatrix,nt),s.multiply(M,_.projMatrix,M)}const z=d.useProgram("debug",null,S),P=o.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(P,z);const O=s.DepthMode.disabled,G=s.StencilMode.disabled,Z=d.colorModeForRenderPass(),J="$debug";f.activeTexture.set(x.TEXTURE0),d.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T?P._makeGlobeTileDebugBuffers(d.context,_):P._makeDebugTileBoundsBuffers(d.context,_.projection);const X=P._tileDebugBuffer||d.debugBuffer,te=P._tileDebugIndexBuffer||d.debugIndexBuffer,B=P._tileDebugSegments||d.debugSegments;z.draw(f,x.LINE_STRIP,O,G,Z,s.CullFaceMode.disabled,Kc(M,s.Color.red),J,X,te,B,null,null,null,[P._globeTileDebugBorderBuffer]);const W=P.latestRawTileData,ae=Math.floor((W&&W.byteLength||0)/1024),le=o.getTile(c).tileSize,_e=512/Math.min(le,512)*(c.overscaledZ/_.zoom)*.5;let xe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(xe+=` => ${c.overscaledZ}`),xe+=` ${ae}kb`,function(Pe,nt){Pe.initDebugOverlayCanvas();const Ae=Pe.debugOverlayCanvas,Ge=Pe.context.gl,Le=Pe.debugOverlayCanvas.getContext("2d");Le.clearRect(0,0,Ae.width,Ae.height),Le.shadowColor="white",Le.shadowBlur=2,Le.lineWidth=1.5,Le.strokeStyle="white",Le.textBaseline="top",Le.font="bold 36px Open Sans, sans-serif",Le.fillText(nt,5,5),Le.strokeText(nt,5,5),Pe.debugOverlayTexture.update(Ae),Pe.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(d,xe);const ve=P._tileDebugTextBuffer||d.debugBuffer,Se=P._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ee=P._tileDebugTextSegments||d.debugSegments;z.draw(f,x.TRIANGLES,O,G,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Kc(M,s.Color.transparent,_e),J,ve,Se,Ee,null,null,null,[P._globeTileDebugTextBuffer])}function sm(d,o,c,f){Ua(d,0,o+c/2,d.transform.width,c,f)}function tu(d,o,c,f){Ua(d,o-c/2,0,c,d.transform.height,f)}function Ua(d,o,c,f,_,x){const T=d.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(o*s.exported.devicePixelRatio,c*s.exported.devicePixelRatio,f*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio),T.clear({color:x}),S.disable(S.SCISSOR_TEST)}const am=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:lm}=am;function ns(d,o,c,f){d.emplaceBack(o,c,f)}class nu{constructor(o){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,ns(this.vertexArray,-1,-1,1),ns(this.vertexArray,1,-1,1),ns(this.vertexArray,-1,1,1),ns(this.vertexArray,1,1,1),ns(this.vertexArray,-1,-1,-1),ns(this.vertexArray,1,-1,-1),ns(this.vertexArray,-1,1,-1),ns(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,lm),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function $i(d,o,c,f,_,x){const T=d.gl,S=o.paint.get("sky-atmosphere-color"),M=o.paint.get("sky-atmosphere-halo-color"),z=o.paint.get("sky-atmosphere-sun-intensity"),P=((O,G,Z,J,X)=>({u_matrix_3f:O,u_sun_direction:G,u_sun_intensity:Z,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),f),_,z,S,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,o.skyboxTexture,0),c.draw(d,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,P,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Xl=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cm{constructor(o){const c=new s.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const f=new s.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,Xl.members),this.indexBuffer=o.createIndexBuffer(f),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ys={symbol:function(d,o,c,f,_){if(d.renderPass!=="translucent")return;const x=s.StencilMode.disabled,T=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,M,z,P,O,G,Z){const J=M.transform,X=O==="map",te=G==="map";for(const B of S){const W=P.getTile(B),ae=W.getBucket(z);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const le=s.evaluateSizeForZoom(ae.textSizeData,J.zoom),_e=Hn(B,ae.getProjection(),J),xe=J.calculatePixelsToTileUnitsMatrix(W),ve=je(_e,W.tileID.canonical,te,X,J,ae.getProjection(),xe),Se=z.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(le){const Ee=Math.pow(2,J.zoom-W.tileID.overscaledZ);Fy(ae,X,te,Z,s.symbolSize,J,ve,B,Ee,le,Se)}}}(f,d,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_),c.paint.get("icon-opacity").constantOr(1)!==0&&rm(d,o,c,f,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,T),c.paint.get("text-opacity").constantOr(1)!==0&&rm(d,o,c,f,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,T),o.map.showCollisionBoxes&&(Zl(d,o,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Zl(d,o,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,o,c,f){if(d.renderPass!=="translucent")return;const _=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),S=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const M=d.context,z=M.gl,P=d.transform,O=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),G=s.StencilMode.disabled,Z=d.colorModeForRenderPass(),J=P.projection.name==="globe",X=[s.mercatorXfromLng(P.center.lng),s.mercatorYfromLat(P.center.lat)],te=[];for(let W=0;W<f.length;W++){const ae=f[W],le=o.getTile(ae),_e=le.getBucket(c);if(!_e||_e.projection.name!==P.projection.name)continue;const xe=_e.programConfigurations.get(c.id),ve=pd(c);J&&ve.push("PROJECTION_GLOBE_VIEW");const Se=d.useProgram("circle",xe,ve),Ee=_e.layoutVertexBuffer,Pe=_e.globeExtVertexBuffer,nt=_e.indexBuffer,Ae=P.projection.createInversionMatrix(P,ae.canonical),Ge={programConfiguration:xe,program:Se,layoutVertexBuffer:Ee,globeExtVertexBuffer:Pe,indexBuffer:nt,uniformValues:dd(d,ae,le,Ae,X,c),tile:le};if(S){const Le=_e.segments.get();for(const Qe of Le)te.push({segments:new s.SegmentVector([Qe]),sortKey:Qe.sortKey,state:Ge})}else te.push({segments:_e.segments,sortKey:0,state:Ge})}S&&te.sort((W,ae)=>W.sortKey-ae.sortKey);const B={useDepthForOcclusion:!J};for(const W of te){const{programConfiguration:ae,program:le,layoutVertexBuffer:_e,globeExtVertexBuffer:xe,indexBuffer:ve,uniformValues:Se,tile:Ee}=W.state,Pe=W.segments;d.terrain&&d.terrain.setupElevationDraw(Ee,le,B),d.prepareDrawProgram(M,le,Ee.tileID.toUnwrapped()),le.draw(M,z.TRIANGLES,O,G,Z,s.CullFaceMode.disabled,Se,c.id,_e,ve,Pe,c.paint,P.zoom,ae,[xe])}},heatmap:function(d,o,c,f){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,x=_.gl,T=s.StencilMode.disabled,S=new s.ColorMode([x.ONE,x.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(Z,J,X,te){const B=Z.gl,W=J.width*te,ae=J.height*te;Z.activeTexture.set(B.TEXTURE1),Z.viewport.set([0,0,W,ae]);let le=X.heatmapFbo;if(!le||le&&(le.width!==W||le.height!==ae)){le&&le.destroy();const _e=B.createTexture();B.bindTexture(B.TEXTURE_2D,_e),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),le=X.heatmapFbo=Z.createFramebuffer(W,ae,!1),function(xe,ve,Se,Ee,Pe,nt){const Ae=xe.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,xe.isWebGL2&&xe.extRenderToTextureHalfFloat?Ae.RGBA16F:Ae.RGBA,Pe,nt,0,Ae.RGBA,xe.extRenderToTextureHalfFloat?xe.isWebGL2?Ae.HALF_FLOAT:xe.extTextureHalfFloat.HALF_FLOAT_OES:Ae.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Se)}(Z,0,_e,le,W,ae)}else B.bindTexture(B.TEXTURE_2D,le.colorAttachment.get()),Z.bindFramebuffer.set(le.framebuffer)})(_,d,c,d.transform.projection.name==="globe"?.5:.25),_.clear({color:s.Color.transparent});const M=d.transform,z=M.projection.name==="globe",P=z?["PROJECTION_GLOBE_VIEW"]:null,O=z?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,G=[s.mercatorXfromLng(M.center.lng),s.mercatorYfromLat(M.center.lat)];for(let Z=0;Z<f.length;Z++){const J=f[Z];if(o.hasRenderableParent(J))continue;const X=o.getTile(J),te=X.getBucket(c);if(!te||te.projection.name!==M.projection.name)continue;const B=te.programConfigurations.get(c.id),W=d.useProgram("heatmap",B,P),{zoom:ae}=d.transform;d.terrain&&d.terrain.setupElevationDraw(X,W),d.prepareDrawProgram(_,W,J.toUnwrapped());const le=M.projection.createInversionMatrix(M,J.canonical);W.draw(_,x.TRIANGLES,s.DepthMode.disabled,T,S,O,em(d,J,X,le,G,ae,c.paint.get("heatmap-intensity")),c.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,c.paint,d.transform.zoom,B,z?[te.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,x){const T=_.context,S=T.gl,M=x.heatmapFbo;if(!M)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let z=x.colorRampTexture;z||(z=x.colorRampTexture=new s.Texture(T,x.colorRamp,S.RGBA)),z.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(T,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,_.colorModeForRenderPass(),s.CullFaceMode.disabled,((P,O,G,Z)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(d,c))},line:function(d,o,c,f){if(d.renderPass!=="translucent")return;const _=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const T=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),M=d.terrain&&d.terrain.renderingToTexture?1:s.exported.devicePixelRatio,z=c.paint.get("line-dasharray"),P=z.constantOr(1),O=c.layout.get("line-cap"),G=c.paint.get("line-pattern"),Z=G.constantOr(1),J=c.paint.get("line-gradient"),X=Z?"linePattern":"line",te=d.context,B=te.gl,W=(le=>{const _e=[];Wl(le)&&_e.push("RENDER_LINE_DASH"),le.paint.get("line-gradient")&&_e.push("RENDER_LINE_GRADIENT");const xe=le.paint.get("line-trim-offset");xe[0]===0&&xe[1]===0||_e.push("RENDER_LINE_TRIM_OFFSET");const ve=le.paint.get("line-pattern").constantOr(1),Se=le.paint.get("line-opacity").constantOr(1)!==1;return!ve&&Se&&_e.push("RENDER_LINE_ALPHA_DISCARD"),_e})(c);let ae=W.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const le of f){const _e=o.getTile(le);if(Z&&!_e.patternsLoaded())continue;const xe=_e.getBucket(c);if(!xe)continue;d.prepareDrawTile();const ve=xe.programConfigurations.get(c.id),Se=d.useProgram(X,ve,W),Ee=G.constantOr(null);if(Ee&&_e.imageAtlas){const $e=_e.imageAtlas.patternPositions[Ee.toString()];$e&&ve.setConstantPatternPositions($e)}const Pe=z.constantOr(null),nt=O.constantOr(null);if(!Z&&Pe&&nt&&_e.lineAtlas){const $e=_e.lineAtlas.getDash(Pe,nt);$e&&ve.setConstantPatternPositions($e)}let[Ae,Ge]=c.paint.get("line-trim-offset");(nt==="round"||nt==="square")&&Ae!==Ge&&(Ae===0&&(Ae-=1),Ge===1&&(Ge+=1));const Le=d.terrain?le.projMatrix:null,Qe=Z?ql(d,_e,c,Le,M):Oy(d,_e,c,Le,xe.lineClipsArray.length,M,[Ae,Ge]);if(J){const $e=xe.gradients[c.id];let it=$e.texture;if(c.gradientVersion!==$e.version){let Xe=256;if(c.stepInterpolant){const ot=o.getSource().maxzoom,Ct=le.canonical.z===ot?Math.ceil(1<<d.transform.maxZoom-le.canonical.z):1;Xe=s.clamp(s.nextPowerOfTwo(xe.maxLineLength/s.EXTENT*1024*Ct),256,te.maxTextureSize)}$e.gradient=s.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Xe,image:$e.gradient||void 0,clips:xe.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new s.Texture(te,$e.gradient,B.RGBA),$e.version=c.gradientVersion,it=$e.texture}te.activeTexture.set(B.TEXTURE1),it.bind(c.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}P&&(te.activeTexture.set(B.TEXTURE0),_e.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),ve.updatePaintBuffers()),Z&&(te.activeTexture.set(B.TEXTURE0),_e.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ve.updatePaintBuffers()),d.prepareDrawProgram(te,Se,le.toUnwrapped());const ke=$e=>{Se.draw(te,B.TRIANGLES,T,$e,S,s.CullFaceMode.disabled,Qe,c.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,c.paint,d.transform.zoom,ve,[xe.layoutVertexBuffer2])};if(ae){const $e=d.stencilModeForClipping(le).ref;$e===0&&d.terrain&&te.clear({stencil:0});const it={func:B.EQUAL,mask:255};Qe.u_alpha_discard_threshold=.8,ke(new s.StencilMode(it,$e,255,B.KEEP,B.KEEP,B.INVERT)),Qe.u_alpha_discard_threshold=0,ke(new s.StencilMode(it,$e,255,B.KEEP,B.KEEP,B.KEEP))}else ke(d.stencilModeForClipping(le))}ae&&(d.resetStencilClippingMasks(),d.terrain&&te.clear({stencil:0}))},fill:function(d,o,c,f){const _=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=d.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),M=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(s.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===M){const z=d.depthModeForSublayer(1,d.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);im(d,o,c,f,z,T,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){const z=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);im(d,o,c,f,z,T,!0)}},"fill-extrusion":function(d,o,c,f){const _=c.paint.get("fill-extrusion-opacity");if(_!==0&&d.renderPass==="translucent"){const x=new s.DepthMode(d.context.gl.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D);if(_!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))eu(d,o,c,f,x,s.StencilMode.disabled,s.ColorMode.disabled),eu(d,o,c,f,x,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const T=d.colorModeForRenderPass();eu(d,o,c,f,x,s.StencilMode.disabled,T)}}},hillshade:function(d,o,c,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const _=d.context,x=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=d.colorModeForRenderPass(),S=d.terrain&&d.terrain.renderingToTexture,[M,z]=d.renderPass!=="translucent"||S?[{},f]:d.stencilConfigForOverlap(f);for(const P of z){const O=o.getTile(P);if(O.needsHillshadePrepare&&d.renderPass==="offscreen")Xf(d,O,c,x,s.StencilMode.disabled,T);else if(d.renderPass==="translucent"){const G=S&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):M[P.overscaledZ];Hf(d,P,O,c,x,G,T)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,o,c,f,_,x){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!f.length)return;const T=d.context,S=T.gl,M=o.getSource(),z=d.useProgram("raster"),P=d.colorModeForRenderPass(),O=d.terrain&&d.terrain.renderingToTexture,[G,Z]=M instanceof Dt||O?[{},f]:d.stencilConfigForOverlap(f),J=Z[Z.length-1].overscaledZ,X=!d.options.moving;for(const te of Z){const B=O?s.DepthMode.disabled:d.depthModeForSublayer(te.overscaledZ-J,c.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,S.LESS),W=te.toUnwrapped(),ae=o.getTile(te);if(O&&(!ae||!ae.hasData()))continue;const le=O?te.projMatrix:d.transform.calculateProjMatrix(W,X),_e=d.terrain&&O?d.terrain.stencilModeForRTTOverlap(te):G[te.overscaledZ],xe=x?0:c.paint.get("raster-fade-duration");ae.registerFadeDuration(xe);const ve=o.findLoadedParent(te,0),Se=ad(ae,ve,o,d.transform,xe);let Ee,Pe;d.terrain&&d.terrain.prepareDrawTile();const nt=c.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;T.activeTexture.set(S.TEXTURE0),ae.texture.bind(nt,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),ve?(ve.texture.bind(nt,S.CLAMP_TO_EDGE),Ee=Math.pow(2,ve.tileID.overscaledZ-ae.tileID.overscaledZ),Pe=[ae.tileID.canonical.x*Ee%1,ae.tileID.canonical.y*Ee%1]):ae.texture.bind(nt,S.CLAMP_TO_EDGE),ae.texture.useMipmap&&T.extTextureFilterAnisotropic&&d.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const Ae=gd(le,Pe||[0,0],Ee||1,Se,c,M instanceof Dt?M.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(T,z,W),M instanceof Dt)M.boundsBuffer&&M.boundsSegments&&z.draw(T,S.TRIANGLES,B,s.StencilMode.disabled,P,s.CullFaceMode.disabled,Ae,c.id,M.boundsBuffer,d.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:Ge,tileBoundsIndexBuffer:Le,tileBoundsSegments:Qe}=d.getTileBoundsBuffers(ae);z.draw(T,S.TRIANGLES,B,_e,P,s.CullFaceMode.disabled,Ae,c.id,Ge,Le,Qe)}}d.resetStencilClippingMasks()},background:function(d,o,c,f){const _=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(x===0)return;const T=d.context,S=T.gl,M=d.transform,z=M.tileSize,P=c.paint.get("background-pattern");if(d.isPatternMissing(P))return;const O=!P&&_.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==O)return;const G=s.StencilMode.disabled,Z=d.depthModeForSublayer(0,O==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),J=d.colorModeForRenderPass(),X=d.useProgram(P?"backgroundPattern":"background");let te,B=f;B||(te=d.getBackgroundTiles(),B=Object.values(te).map(W=>W.tileID)),P&&(T.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context));for(const W of B){const ae=W.toUnwrapped(),le=f?W.projMatrix:d.transform.calculateProjMatrix(ae);d.prepareDrawTile();const _e=o?o.getTile(W):te?te[W.key]:new s.Tile(W,z,M.zoom,d),xe=P?By(le,x,d,P,{tileID:W,tileSize:z}):yd(le,x,_);d.prepareDrawProgram(T,X,ae);const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Se,tileBoundsSegments:Ee}=d.getTileBoundsBuffers(_e);X.draw(T,S.TRIANGLES,Z,G,J,s.CullFaceMode.disabled,xe,c.id,ve,Se,Ee)}},sky:function(d,o,c){const f=d.transform,_=f.projection.name==="mercator"||f.projection.name==="globe"?1:s.smoothstep(7,8,f.zoom),x=c.paint.get("sky-opacity")*_;if(x===0)return;const T=d.context,S=c.paint.get("sky-type"),M=new s.DepthMode(T.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),z=d.frameCounter/1e3%1;S==="atmosphere"?d.renderPass==="offscreen"?c.needsSkyboxCapture(d)&&(function(P,O,G,Z){const J=P.context,X=J.gl;let te=O.skyboxFbo;if(!te){te=O.skyboxFbo=J.createFramebuffer(32,32,!1),O.skyboxGeometry=new nu(J),O.skyboxTexture=J.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,O.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let le=0;le<6;++le)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(te.framebuffer),J.viewport.set([0,0,32,32]);const B=O.getCenter(P,!0),W=P.useProgram("skyboxCapture"),ae=new Float64Array(16);s.identity(ae),s.rotateY(ae,ae,.5*-Math.PI),$i(J,O,W,ae,B,0),s.identity(ae),s.rotateY(ae,ae,.5*Math.PI),$i(J,O,W,ae,B,1),s.identity(ae),s.rotateX(ae,ae,.5*-Math.PI),$i(J,O,W,ae,B,2),s.identity(ae),s.rotateX(ae,ae,.5*Math.PI),$i(J,O,W,ae,B,3),s.identity(ae),$i(J,O,W,ae,B,4),s.identity(ae),s.rotateY(ae,ae,Math.PI),$i(J,O,W,ae,B,5),J.viewport.set([0,0,P.width,P.height])}(d,c),c.markSkyboxValid(d)):d.renderPass==="sky"&&function(P,O,G,Z,J){const X=P.context,te=X.gl,B=P.transform,W=P.useProgram("skybox");X.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,O.skyboxTexture);const ae=((le,_e,xe,ve,Se)=>({u_matrix:le,u_sun_direction:_e,u_cubemap:0,u_opacity:ve,u_temporal_offset:Se}))(B.skyboxMatrix,O.getCenter(P,!1),0,Z,J);P.prepareDrawProgram(X,W),W.draw(X,te.TRIANGLES,G,s.StencilMode.disabled,P.colorModeForRenderPass(),s.CullFaceMode.backCW,ae,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,c,M,x,z):S==="gradient"&&d.renderPass==="sky"&&function(P,O,G,Z,J){const X=P.context,te=X.gl,B=P.transform,W=P.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new nu(X)),X.activeTexture.set(te.TEXTURE0);let ae=O.colorRampTexture;ae||(ae=O.colorRampTexture=new s.Texture(X,O.colorRamp,te.RGBA)),ae.bind(te.LINEAR,te.CLAMP_TO_EDGE);const le=((_e,xe,ve,Se,Ee)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:xe,u_radius:s.degToRad(ve),u_opacity:Se,u_temporal_offset:Ee}))(B.skyboxMatrix,O.getCenter(P,!1),O.paint.get("sky-gradient-radius"),Z,J);P.prepareDrawProgram(X,W),W.draw(X,te.TRIANGLES,G,s.StencilMode.disabled,P.colorModeForRenderPass(),s.CullFaceMode.backCW,le,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,c,M,x,z)},debug:function(d,o,c){for(let f=0;f<c.length;f++)$y(d,o,c[f])},custom:function(d,o,c,f){const _=d.context,x=c.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&c.isLayerDraped()){if(d.renderPass==="offscreen"){const T=x.prerender;if(T){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;T.call(x,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else T.call(x,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const S=x.renderToTile;if(S){const M=f[0].canonical,z=new s.MercatorCoordinate(M.x+f[0].wrap*(1<<M.z),M.y,M.z);_.setDepthMode(s.DepthMode.disabled),_.setStencilMode(s.StencilMode.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),S.call(x,_.gl,z),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(s.StencilMode.disabled);const T=x.renderingMode==="3d"?new s.DepthMode(d.context.gl.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(_.setDepthMode(T),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;x.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else x.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Va{constructor(o,c,f=!1){this.context=new et(o,f),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,c){const f=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cd(this,o));const _=this._terrain;this.transform.elevation=f?_:null,_.update(o,this.transform,c)}_updateFog(o){const c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=c.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const x=f+.78*(_-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,c){if(this.width=o*s.exported.devicePixelRatio,this.height=c*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const o=this.context,c=new s.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(s.EXTENT,0),c.emplaceBack(0,s.EXTENT),c.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=o.createVertexBuffer(f,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const _=new s.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const x=new s.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(s.EXTENT,0,s.EXTENT,0),x.emplaceBack(0,s.EXTENT,0,s.EXTENT),x.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(x,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const T=new s.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const S=new s.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])S.emplaceBack(z);this.debugIndexBuffer=o.createIndexBuffer(S),this.emptyTexture=new s.Texture(o,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=s.create();const M=this.context.gl;this.stencilClearMode=new s.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new cm(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,c.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,$l(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,f){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const M of f)if(this._tileClippingMaskIDs[M.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=c.id;const _=this.context,x=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of f){const M=c.getTile(S),z=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:G}=this.getTileBoundsBuffers(M);T.draw(_,x.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:x.ALWAYS,mask:0},z,255,x.KEEP,x.KEEP,x.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,$l(S.projMatrix),"$clipping",P,O,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new s.StencilMode({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new s.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,f=o.sort((T,S)=>S.overscaledZ-T.overscaledZ),_=f[f.length-1].overscaledZ,x=f[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let S=0;S<x;S++)T[S+_]=new s.StencilMode({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[T,f]}return[{[_]:s.StencilMode.disabled},f]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([o.CONSTANT_COLOR,o.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(o,c,f){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new s.DepthMode(f||this.context.gl.LEQUAL,c,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const f=this.style.order,_=this.style._sourceCaches;for(const z in _){const P=_[z];P.used&&P.prepare(this.context)}const x={},T={},S={};for(const z in _){const P=_[z];x[z]=P.getVisibleCoordinates(),T[z]=x[z].slice().reverse(),S[z]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<f.length;z++)if(this.style._layers[f[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of f){const P=this.style._layers[z],O=o._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const G=O?T[O.id]:void 0;(P.type==="custom"||P.isSky()||G&&G.length)&&this.renderLayer(this,O,P,G)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon];const M=this.terrain;if(M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&M.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[f[this.currentLayer]],P=o._getLayerSourceCache(z);if(z.isSky())continue;const O=P?T[P.id]:void 0;this._renderTileClippingMasks(z,P,O),this.renderLayer(this,P,z,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(z,P){const O=z.context,G=O.gl,Z=z.transform,J=new s.DepthMode(G.LEQUAL,s.DepthMode.ReadOnly,[0,1]),X=z.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),te=s.globeToMercatorTransition(Z.zoom),B=P.properties.get("color").toArray01(),W=P.properties.get("high-color").toArray01(),ae=P.properties.get("space-color").toArray01PremultipliedAlpha(),le=s.identity$1([]);s.rotateY$1(le,le,-s.degToRad(Z._center.lng)),s.rotateX$1(le,le,s.degToRad(Z._center.lat)),s.rotateZ$1(le,le,Z.angle),s.rotateX$1(le,le,-Z._pitch);const _e=s.fromQuat(new Float32Array(16),le),xe=s.mapValue(P.properties.get("star-intensity"),0,1,0,.25),ve=5e-4,Se=s.mapValue(P.properties.get("horizon-blend"),0,1,ve,.25),Ee=s.globeUseCustomAntiAliasing(z,O,Z)&&Se===ve?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,Pe=z.frameCounter/1e3%1,nt=s.length(Z.globeCenterInViewSpace),Ae=Math.sqrt(Math.pow(nt,2)-Math.pow(Ee,2)),Ge=Math.acos(Ae/nt),Le=((ke,$e,it,Xe,ot,Ct,Ot,xt,kt,nn,Jt,Tt,_n,Tn)=>({u_frustum_tl:ke,u_frustum_tr:$e,u_frustum_br:it,u_frustum_bl:Xe,u_horizon:ot,u_transition:Ct,u_fadeout_range:Ot,u_color:xt,u_high_color:kt,u_space_color:nn,u_star_intensity:Jt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Tt,u_horizon_angle:_n,u_rotation_matrix:Tn}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,te,Se,B,W,ae,xe,Pe,Ge,_e);z.prepareDrawProgram(O,X);const Qe=z.atmosphereBuffer;Qe&&X.draw(O,G.TRIANGLES,J,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Le,"skybox",Qe.vertexBuffer,Qe.indexBuffer,Qe.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const z=this.style._layers[f[this.currentLayer]],P=o._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,P,z,P?T[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const z=this.style._layers[f[this.currentLayer]],P=o._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=P?(z.type==="symbol"?S:T)[P.id]:void 0;this._renderTileClippingMasks(z,P,P?x[P.id]:void 0),this.renderLayer(this,P,z,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let z=null;s.values(this.style._layers).forEach(P=>{const O=o._getLayerSourceCache(P);O&&!P.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<O.getSource().maxzoom)&&(z=O)}),z&&this.options.showTileBoundaries&&Ys.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const P=z.transform.padding;sm(z,z.transform.height-(P.top||0),3,ja),sm(z,P.bottom||0,3,Ny),tu(z,P.left||0,3,jy),tu(z,z.transform.width-(P.right||0),3,Uy);const O=z.transform.centerPoint;(function(G,Z,J,X){Ua(G,Z-1,J-10,2,20,X),Ua(G,Z-10,J-1,20,2,X)})(z,O.x,z.transform.height-O.y,Vy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,c,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(f.type)||o.terrain&&f.type==="custom")&&Ys[f.type](o,c,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let f=this.gpuTimers[o.id];f||(f=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),f.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,c=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),o.beginQueryEXT(o.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const c={};for(const f in o){const _=o[f],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),c[f]=T}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let f=0;for(const _ of o)f+=c.getQueryObjectEXT(_,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(_);return f}translatePosMatrix(o,c,f,_,x){if(!f[0]&&!f[1])return o;const T=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const z=Math.sin(T),P=Math.cos(T);f=[f[0]*P-f[1]*z,f[0]*z+f[1]*P]}const S=[x?f[0]:Kt(c,f[0],this.transform.zoom),x?f[1]:Kt(c,f[1],this.transform.zoom),0],M=new Float32Array(16);return s.translate(M,o,S),M}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,f=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),this.transform.projection.name==="globe"&&_.push("GLOBE"),c&&_.push("ZERO_EXAGGERATION"),f&&!o&&f.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),o&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(o,c,f){this.cache=this.cache||{};const _=f||[],x=this.currentGlobalDefines().concat(_),T=ln.cacheKey(rd[o],o,x,c);return this.cache[T]||(this.cache[T]=new ln(this.context,o,rd[o],c,vd[o],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,c,f){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch),T=((S,M,z,P,O,G,Z,J,X,te,B)=>{const W=S.transform,ae=M.properties.get("color").toArray01();ae[3]=P;const le=S.frameCounter/1e3%1;return{u_fog_matrix:z?W.calculateFogTileMatrix(z):S.identityMat,u_fog_range:M.getFovAdjustedRange(W._fov),u_fog_color:ae,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:O,u_frustum_tr:G,u_frustum_br:Z,u_frustum_bl:J,u_globe_pos:X,u_globe_radius:te,u_viewport:B,u_globe_transition:s.globeToMercatorTransition(W.zoom),u_is_globe:+(W.projection.name==="globe")}})(this,_,f,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);c.setFogUniformValues(o,T)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)c[_.key]=o[_.key]||new s.Tile(_,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ru{constructor(o=0,c=0,f=0,_=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=f,this.right=_}interpolate(o,c,f){return c.top!=null&&o.top!=null&&(this.top=s.number(o.top,c.top,f)),c.bottom!=null&&o.bottom!=null&&(this.bottom=s.number(o.bottom,c.bottom,f)),c.left!=null&&o.left!=null&&(this.left=s.number(o.left,c.left,f)),c.right!=null&&o.right!=null&&(this.right=s.number(o.right,c.right,f)),this}getCenter(o,c){const f=s.clamp((this.left+o-this.right)/2,0,o),_=s.clamp((this.top+c-this.bottom)/2,0,c);return new s.Point(f,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ru(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function iu(d,o){const c=s.getColumn(d,3);s.fromQuat(d,o),s.setColumn(d,3,c)}function cn(d,o){const c=s.identity$1([]);return s.rotateZ$1(c,c,-o),s.rotateX$1(c,c,-d),c}function Kl(d,o){const c=[d[0],d[1],0],f=[o[0],o[1],0];if(s.length(c)>=1e-15){const T=s.normalize([],c);s.scale$2(f,T,s.dot(f,T)),o[0]=f[0],o[1]=f[1]}const _=s.cross([],o,d);if(s.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return cn(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}class um{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){const c=o instanceof s.MercatorCoordinate?o:new s.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=s.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(o)):0,x=s.MercatorCoordinate.fromLngLat(o,_),T=[x.x-f.x,x.y-f.y,x.z-f.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Kl(T,c)}setPitchBearing(o,c){this.orientation=cn(s.degToRad(o),s.degToRad(-c))}}class ou{constructor(o,c){this._transform=s.identity([]),this.orientation=c,this.position=o}get mercatorPosition(){const o=this.position;return new s.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=s.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&s.setColumn(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.identity$1([]),o&&iu(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=cn(o,c),iu(this._transform,this._orientation)}forward(){const o=s.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const f=new Float64Array(16);return s.invert(f,this.getWorldToCamera(o,c)),f}getWorldToCameraPosition(o,c,f){const _=this.position;s.scale$2(_,_,-o);const x=new Float64Array(16);return s.fromScaling(x,[f,f,f]),s.translate(x,x,_),x[10]*=c,x}getWorldToCamera(o,c){const f=new Float64Array(16),_=new Float64Array(4),x=this.position;return s.conjugate(_,this._orientation),s.scale$2(x,x,-o),s.fromQuat(f,_),s.translate(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(o,c,f,_){const x=new Float64Array(16);return s.perspective(x,o,c,f,_),x}getDistanceToElevation(o,c=!1){const f=o===0?0:s.mercatorZfromAltitude(o,c?s.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new ou([...this.position],[...this.orientation])}}function $a(d,o){const c=su(d.projection,d.zoom,d.width,d.height),f=function(x,T,S,M,z){const P=new s.LngLat(S.lng-180*rs,S.lat),O=new s.LngLat(S.lng+180*rs,S.lat),G=x.project(P.lng,P.lat),Z=x.project(O.lng,O.lat),J=-Math.atan2(Z.y-G.y,Z.x-G.x),X=s.MercatorCoordinate.fromLngLat(S);X.y=s.clamp(X.y,-1+rs,1-rs);const te=X.toLngLat(),B=x.project(te.lng,te.lat),W=s.MercatorCoordinate.fromLngLat(te);W.x+=rs;const ae=W.toLngLat(),le=x.project(ae.lng,ae.lat),_e=au(le.x-B.x,le.y-B.y,J),xe=s.MercatorCoordinate.fromLngLat(te);xe.y+=rs;const ve=xe.toLngLat(),Se=x.project(ve.lng,ve.lat),Ee=au(Se.x-B.x,Se.y-B.y,J),Pe=Math.abs(_e.x)/Math.abs(Ee.y),nt=s.identity([]);s.rotateZ(nt,nt,-J*(1-(z?0:M)));const Ae=s.identity([]);return s.scale(Ae,Ae,[1,1-(1-Pe)*M,1]),Ae[4]=-Ee.x/Ee.y*M,s.rotateZ(Ae,Ae,J),s.multiply(Ae,nt,Ae),Ae}(d.projection,0,d.center,c,o),_=hm(d);return s.scale(f,f,[_,_,1]),f}function hm(d){const o=d.projection,c=su(d.projection,d.zoom,d.width,d.height),f=dm(o,d.center),_=dm(o,s.LngLat.convert(o.center));return Math.pow(2,f*c+(1-c)*_)}function su(d,o,c,f,_=1/0){const x=d.range;if(!x)return 0;const T=Math.min(_,Math.max(c,f)),S=Math.log(T/1024)/Math.LN2;return s.smoothstep(x[0]+S,x[1]+S,o)}const rs=1/4e4;function dm(d,o){const c=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),f=new s.LngLat(o.lng-180*rs,c),_=new s.LngLat(o.lng+180*rs,c),x=d.project(f.lng,c),T=d.project(_.lng,c),S=s.MercatorCoordinate.fromLngLat(f),M=s.MercatorCoordinate.fromLngLat(_),z=T.x-x.x,P=T.y-x.y,O=M.x-S.x,G=M.y-S.y,Z=Math.sqrt((O*O+G*G)/(z*z+P*P));return Math.log(Z)/Math.LN2}function au(d,o,c){const f=Math.cos(c),_=Math.sin(c);return{x:d*f-o*_,y:d*_+o*f}}class Ga{constructor(o,c,f,_,x,T,S){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ru,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ou,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new Ga(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o,c=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(o||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const f=!A(c,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;var f;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(f=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(_,x,T){var S=x[0],M=x[1],z=x[2],P=x[3],O=Math.sin(T),G=Math.cos(T);_[0]=S*G+z*O,_[1]=M*G+P*O,_[2]=S*-O+z*G,_[3]=M*-O+P*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=s.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.degToRad(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,x=0;for(let T=0;T<c.length;T++){const S=new s.Point(c[T][0]*this.width,f+c[T][1]*(this.height-f)),M=o.pointCoordinate(S);if(!M)continue;const z=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);_+=M[3]*z,x+=z}return x===0?NaN:_/x}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(o),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(_-f,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let f;f=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const _=s.length(s.sub([],this._camera.position,f));return s.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!s.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const f=[o.position.x,o.position.y,o.position.z];s.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new um;return c.position=new s.MercatorCoordinate(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!s.length$1(o))return!1;s.normalize$1(o,o);const c=s.transformQuat([],[0,0,-1],o),f=s.transformQuat([],[0,-1,0],o);if(f[2]<0)return!1;const _=Kl(c,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=s.clamp(o[2],_/f,_/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,f){this._unmodified=!1,this._edgeInsets.interpolate(o,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new s.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.Point(0,0)),_=this.pointCoordinate(new s.Point(this.width,0)),x=this.pointCoordinate(new s.Point(this.width,this.height)),T=this.pointCoordinate(new s.Point(0,this.height)),S=Math.floor(Math.min(f.x,_.x,x.x,T.x)),M=Math.floor(Math.max(f.x,_.x,x.x,T.x)),z=1;for(let P=S-z;P<=M+z;P++)P!==0&&c.push(new s.UnwrappedTileID(P,o))}return c}coveringTiles(o){let c=this.coveringZoomLevel(o);const f=c,_=this.elevation&&!o.isTerrainDEM,x=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,M=1<<c,z=[M*T.x,M*T.y,0],P=this.projection.name==="globe",O=!P,G=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,O),Z=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=M*s.mercatorZfromAltitude(1,this.center.lat),X=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),te=[M*Z.x,M*Z.y,X*(O?1:J)],B=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ae=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=o.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,_e=this.projection.isReprojectedInTileSpace?hm(this):1,xe=ke=>{const it=new s.MercatorCoordinate(ke.x+25e-6,ke.y,ke.z),Xe=new s.MercatorCoordinate(ke.x,ke.y+25e-6,ke.z),ot=ke.toLngLat(),Ct=it.toLngLat(),Ot=Xe.toLngLat(),xt=this.locationCoordinate(ot),kt=this.locationCoordinate(Ct),nn=this.locationCoordinate(Ot),Jt=Math.hypot(kt.x-xt.x,kt.y-xt.y),Tt=Math.hypot(nn.x-xt.x,nn.y-xt.y);return Math.sqrt(Jt*Tt)*_e/25e-6},ve=ke=>{const $e=ae,it=le;return{aabb:s.tileAABB(this,M,0,0,0,ke,it,$e,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:$e,wrap:ke,fullyVisible:!1}},Se=[];let Ee=[];const Pe=c,nt=o.reparseOverscaled?f:c,Ae=ke=>ke*ke,Ge=Ae((X-this._centerAltitude)*J),Le=ke=>{if(!this._elevation||!ke.tileID||!x)return;const $e=this._elevation.getMinMaxForTile(ke.tileID),it=ke.aabb;$e?(it.min[2]=$e.min,it.max[2]=$e.max,it.center[2]=(it.min[2]+it.max[2])/2):(ke.shouldSplit=Qe(ke),ke.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},Qe=ke=>{if(ke.zoom<W)return!0;if(ke.zoom===Pe)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const $e=ke.aabb.distanceX(te),it=ke.aabb.distanceY(te);let Xe=Ge,ot=1;if(P){Xe=Ae(ke.aabb.distanceZ(te));const xt=Math.pow(2,ke.zoom),kt=s.latFromMercatorY((ke.y+1)/xt),nn=s.latFromMercatorY(ke.y/xt),Jt=Math.min(Math.max(S,kt),nn),Tt=s.circumferenceAtLatitude(Jt)/s.circumferenceAtLatitude(S);if(ot=Jt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Tt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&ke.zoom===Pe-1&&Tt>=.9)return!0}else if(_&&(Xe=Ae(ke.aabb.distanceZ(te)*J)),this.projection.isReprojectedInTileSpace&&f<=5){const xt=Math.pow(2,ke.zoom),kt=xe(new s.MercatorCoordinate((ke.x+.5)/xt,(ke.y+.5)/xt));ot=kt>.85?1:kt}const Ct=$e*$e+it*it+Xe,Ot=Ae((1<<Pe-ke.zoom)*B*ot*((xt,kt)=>{if(kt*Ae(.707)<xt)return 1;const nn=Math.sqrt(kt/xt);return nn/(1.4144271570014144+(Math.pow(1.1,nn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Xe,Ge),Ct));return Ct<Ot};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Se.push(ve(-ke)),Se.push(ve(ke));for(Se.push(ve(0));Se.length>0;){const ke=Se.pop(),$e=ke.x,it=ke.y;let Xe=ke.fullyVisible;if(!Xe){const ot=ke.aabb.intersects(G);if(ot===0)continue;Xe=ot===2}if(ke.zoom!==Pe&&Qe(ke))for(let ot=0;ot<4;ot++){const Ct=($e<<1)+ot%2,Ot=(it<<1)+(ot>>1),xt={aabb:x?ke.aabb.quadrant(ot):s.tileAABB(this,M,ke.zoom+1,Ct,Ot,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:Ct,y:Ot,wrap:ke.wrap,fullyVisible:Xe,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};_&&!P&&(xt.tileID=new s.OverscaledTileID(ke.zoom+1===Pe?nt:ke.zoom+1,ke.wrap,ke.zoom+1,Ct,Ot),Le(xt)),Se.push(xt)}else{const ot=ke.zoom===Pe?nt:ke.zoom;if(o.minzoom&&o.minzoom>ot)continue;const Ct=z[0]-(.5+$e+(ke.wrap<<ke.zoom))*(1<<c-ke.zoom),Ot=z[1]-.5-it,xt=ke.tileID?ke.tileID:new s.OverscaledTileID(ot,ke.wrap,ke.zoom,$e,it);Ee.push({tileID:xt,distanceSq:Ct*Ct+Ot*Ot})}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,$e=this.horizonLineFromTop();Ee=Ee.filter(it=>{const Xe=[0,0,0,1],ot=[s.EXTENT,s.EXTENT,0,1],Ct=this.calculateFogTileMatrix(it.tileID.toUnwrapped());s.transformMat4$1(Xe,Xe,Ct),s.transformMat4$1(ot,ot,Ct);const Ot=s.getAABBPointSquareDist(Xe,ot);if(Ot===0)return!0;let xt=!1;const kt=this._elevation;if(kt&&Ot>ke&&$e!==0){const nn=this.calculateProjMatrix(it.tileID.toUnwrapped());let Jt;o.isTerrainDEM||(Jt=kt.getMinMaxForTile(it.tileID)),Jt||(Jt={min:le,max:ae});const Tt=s.furthestTileCorner(this.rotation),_n=[Tt[0]*s.EXTENT,Tt[1]*s.EXTENT,Jt.max];s.transformMat4(_n,_n,nn),xt=(1-_n[1])*this.height*.5<$e}return Ot<ke||xt})}return Ee.sort((ke,$e)=>ke.distanceSq-$e.distanceSq).map(ke=>ke.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),f=this.projection.project(o.lng,c);return new s.Point(f.x*this.worldSize,f.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let f,_;const x=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;f=(c.x-x.x)/S,_=(c.y-x.y)/S}else{const S=this.pointCoordinate(c),M=this.pointCoordinate(x);f=S.x-M.x,_=S.y-M.y}const T=this.locationCoordinate(o);this.setLocation(new s.MercatorCoordinate(T.x-f,T.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){const f=c?s.mercatorZfromAltitude(c,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new s.MercatorCoordinate(_.x,_.y,f)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const f=c??this._centerAltitude,_=[o.x,o.y,0,1],x=[o.x,o.y,1,1];s.transformMat4$1(_,_,this.pixelMatrixInverse),s.transformMat4$1(x,x,this.pixelMatrixInverse);const T=x[3];s.scale$1(_,_,1/_[3]),s.scale$1(x,x,1/T);const S=_[2],M=x[2];return{p0:_,p1:x,t:S===M?0:(f-S)/(M-S)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],f=[o.x,o.y,1,1];return s.transformMat4$1(c,c,this.pixelMatrixInverse),s.transformMat4$1(f,f,this.pixelMatrixInverse),s.scale$1(c,c,1/c[3]),s.scale$1(f,f,1/f[3]),c[2]=s.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,f[2]=s.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,s.scale$1(c,c,1/this.worldSize),s.scale$1(f,f,1/this.worldSize),new s.Ray([c[0],c[1],c[2]],s.normalize([],s.sub([],f,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:f,t:_}=o,x=s.mercatorZfromAltitude(c[2],this._center.lat),T=s.mercatorZfromAltitude(f[2],this._center.lat);return new s.MercatorCoordinate(s.number(c[0],f[0],_)/this.worldSize,s.number(c[1],f[1],_)/this.worldSize,s.number(x,T,_))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let c=this.projection.pointCoordinate3D(this,o.x,o.y);if(c)return new s.MercatorCoordinate(c[0],c[1],c[2]);let f=0,_=this.horizonLineFromTop();if(o.y>_)return this.pointCoordinate(o);const x=.02*_,T=o.clone();for(let S=0;S<10&&_-f>x;S++){T.y=s.number(f,_,.66);const M=this.projection.pointCoordinate3D(this,T.x,T.y);M?(_=T.y,c=M):f=T.y}return c?new s.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(o);const c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){const f=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,f+o.toAltitude(),1];return s.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new s.Point(_[0]/_[3],_[1]/_[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new s.Point(c,o)),T=this.pointLocation3D(new s.Point(_,o)),S=this.pointLocation3D(new s.Point(_,f)),M=this.pointLocation3D(new s.Point(c,f));let z=Math.min(x.lng,T.lng,S.lng,M.lng),P=Math.max(x.lng,T.lng,S.lng,M.lng),O=Math.min(x.lat,T.lat,S.lat,M.lat),G=Math.max(x.lat,T.lat,S.lat,M.lat);const Z=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,X=(te,B,W,ae,le)=>{const _e=(te+W)/2,xe=(B+ae)/2,ve=new s.Point(_e,xe),{lng:Se,lat:Ee}=this.pointLocation3D(ve),Pe=Math.max(0,z-Se,O-Ee,Se-P,Ee-G);z=Math.min(z,Se),P=Math.max(P,Se),O=Math.min(O,Ee),G=Math.max(G,Ee),(le<J||Pe>Z)&&(X(te,B,_e,xe,le+1),X(_e,xe,W,ae,le+1))};if(X(c,o,_,o,1),X(_,o,_,f,1),X(_,f,c,f,1),X(c,f,c,o,1),this.projection.name==="globe"){const[te,B]=s.polesInViewport(this);te?(G=90,P=180,z=-180):B&&(O=-90,P=180,z=-180)}return new s.LngLatBounds(new s.LngLat(z,O),new s.LngLat(P,G))}_getBoundsRectangular(o,c){const{top:f,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,S=new s.Point(_,f),M=new s.Point(T,f),z=new s.Point(T,x),P=new s.Point(_,x);let O=this.pointCoordinate(S,o),G=this.pointCoordinate(M,o);const Z=this.pointCoordinate(z,c),J=this.pointCoordinate(P,c),X=(te,B)=>(B.y-te.y)/(B.x-te.x);return O.y>1&&G.y>=0?O=new s.MercatorCoordinate((1-J.y)/X(J,O)+J.x,1):O.y<0&&G.y<=1&&(O=new s.MercatorCoordinate(-J.y/X(J,O)+J.x,0)),G.y>1&&O.y>=0?G=new s.MercatorCoordinate((1-Z.y)/X(Z,G)+Z.x,1):G.y<0&&O.y<=1&&(G=new s.MercatorCoordinate(-Z.y/X(Z,G)+Z.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=o.visibleDemTiles.reduce((f,_)=>{if(_.dem){const x=_.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){const c=o.key,f=this._distanceTileDataCache;if(f[c])return f[c];const _=o.canonical,x=1/this.height,T=this.cameraWorldSize,S=T/this.zoomScale(_.z),M=(_.x+Math.pow(2,_.z)*o.wrap)*S,z=_.y*S,P=this.point;P.x*=T/this.worldSize,P.y*=T/this.worldSize;const O=this.angle,G=Math.sin(-O),Z=-Math.cos(-O);return f[c]={bearing:[G,Z],center:[(P.x-M)*x,(P.y-z)*x],scale:S/s.EXTENT*x},f[c]}calculateFogTileMatrix(o){const c=o.key,f=this._fogTileMatrixCache;if(f[c])return f[c];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.multiply(_,this.worldToFogMatrix,_),f[c]=new Float32Array(_),f[c]}calculateProjMatrix(o,c=!1){const f=o.key,_=c?this._alignedProjMatrixCache:this._projMatrixCache;if(_[f])return _[f];const x=this.calculatePosMatrix(o,this.worldSize);return s.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),_[f]=new Float32Array(x),_[f]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];const _=function(x,T){const{scale:S}=x.tileTransform,M=S*s.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return z=new Float32Array(4),G=(P=T.inverseAdjustmentMatrix)[1],Z=P[2],J=P[3],te=(O=[M,M])[1],z[0]=P[0]*(X=O[0]),z[1]=G*X,z[2]=Z*te,z[3]=J*te,z;var z,P,O,G,Z,J,X,te}(o,this);return f[c]=_,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,c=s.fromScaling([],[o,o,o]);return s.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const c=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=this._camera.forward(),x=s.mercatorZfromAltitude(1,this._center.lat);f[2]/=x,_[2]/=x,s.normalize(_,_);const T=o.raycast(f,_,o.exaggeration());if(T){const S=s.scaleAndAdd([],f,_,T),M=new s.MercatorCoordinate(S[0],S[1],s.mercatorZfromAltitude(S[2],s.latFromMercatorY(S[1]))),z=(M.z+s.length([M.x-f[0],M.y-f[1],M.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const c=this._elevation,f=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),x=c.getAtPointOrZero(new s.MercatorCoordinate(..._)),T=this.pixelsPerMeter/this.worldSize*x,S=this._minimumHeightOverTerrain(),M=_[2]-T;if(M<=S)if(M<0||o){const z=this.locationCoordinate(this._center,this._centerAltitude),P=[_[0],_[1],z.z-_[2]],O=s.length(P);P[2]-=(S-M)/this._pixelsPerMercatorPixel;const G=s.length(P);if(G===0)return;s.scale$2(P,P,O/G*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],z.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const G=this.center;return G.lat=s.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(G.lng=s.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const c=this._unmodified,{x:f,y:_}=this.point;let x=0,T=f,S=_;const M=this.width/2,z=this.height/2,P=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-z<P&&(S=P+z),_+z>O&&(S=O-z),O-P<this.height&&(x=Math.max(x,this.height/(O-P)),S=(O+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,J=this.worldSize/2-(G+Z)/2;T=(f+J+this.worldSize)%this.worldSize-J,T-M<G&&(T=G+M),T+M>Z&&(T=Z-M),Z-G<this.width&&(x=Math.max(x,this.width/(Z-G)),T=(Z+G)/2)}T===f&&S===_||(this.center=this.unproject(new s.Point(T,S))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const f=su(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?c:1,x=this._camera.getWorldToCamera(this.worldSize,_),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-o.x/this.width,T[9]=2*o.y/this.height;let S=s.mul([],T,x);if(this.projection.isReprojectedInTileSpace){const xe=this.locationCoordinate(this.center),ve=s.identity([]);s.translate(ve,ve,[xe.x*this.worldSize,xe.y*this.worldSize,0]),s.multiply(ve,ve,$a(this)),s.translate(ve,ve,[-xe.x*this.worldSize,-xe.y*this.worldSize,0]),s.multiply(S,S,ve),this.inverseAdjustmentMatrix=function(Se){const Ee=$a(Se,!0);return Ie([],[Ee[0],Ee[1],Ee[4],Ee[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],S,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=S,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const M=s.invert([],T);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(M,this.horizonLineFromTop(),this.height);const z=new Float32Array(16);s.identity(z),s.scale(z,z,[1,-1,1]),s.rotateX(z,z,this._pitch),s.rotateZ(z,z,this.angle);const P=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-o.x/this.width,P[9]=2*(o.y+O)/this.height,this.skyboxMatrix=s.multiply(z,P,z);const G=this.point,Z=G.x,J=G.y,X=this.width%2/2,te=this.height%2/2,B=Math.cos(this.angle),W=Math.sin(this.angle),ae=Z-Math.round(Z)+B*X+W*te,le=J-Math.round(J)+B*te+W*X,_e=new Float64Array(S);if(s.translate(_e,_e,[ae>.5?ae-1:ae,le>.5?le-1:le,0]),this.alignedProjMatrix=_e,S=s.create(),s.scale(S,S,[this.width/2,-this.height/2,1]),s.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=s.create(),s.scale(S,S,[1,-1,1]),s.translate(S,S,[-1,-1,0]),s.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=s.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const xe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(xe,xe,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[o,o,c];s.scale$2(x,x,_),s.scale$2(f,f,-1),s.multiply$2(f,f,x);const T=s.create();s.translate(T,T,f),s.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,_)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*x,_.y/this.worldSize-f[1]*x,o/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=o[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((c-f)/_,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),x=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),S=Math.max((o[2]-x)/Math.cos(f),T),M=this._zoomFromMercatorZ(S);s.scaleAndAdd(o,o,c,S),this._pitch=s.clamp(f,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(_,-Math.PI,Math.PI),this._setZoom(s.clamp(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,f=s.GLOBE_ZOOM_THRESHOLD_MAX,_=0,x=1/0;for(;f-c>1e-6&&f>c;){const T=c+.5*(f-c),S=this.tileSize*Math.pow(2,T),M=this.getCameraToCenterDistance(this.projection,T,S),z=this.scaleZoom(M/(o*this.tileSize)),P=Math.abs(T-z);P<x&&(x=P,_=T),T<z?c=T:f=T}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){const f=Math.min(o.x,c.x),_=Math.max(o.x,c.x),x=Math.min(o.y,c.y),T=Math.max(o.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.Point(f,x),new s.Point(_,T),new s.Point(f,T),new s.Point(_,x)],M=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const P of S){const O=this.pointRayIntersection(P);if(O.t<0)return!0;const G=this.rayIntersectionCoordinate(O);if(G.x<M||G.y<0||G.x>z||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(o,c){const f=s.length(s.sub([],this._camera.position,o)),_=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([c,f,_],x){const T=[c,f,_,1];s.transformMat4$1(T,T,x);const S=T[3]=Math.max(T[3],1e-6);return T[0]/=S,T[1]/=S,T[2]/=S,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,o))}}getCameraToCenterDistance(o,c=this.zoom,f=this.worldSize){const _=su(o,c,this.width,this.height,1024),x=o.pixelSpaceConversion(this.center.lat,f,_);return .5/Math.tan(.5*this._fov)*this.height*x}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(o,o,this.globeMatrix),o}}function qa(d,o){let c=!1,f=null;const _=()=>{f=null,c&&(d(),f=setTimeout(_,o),c=!1)};return()=>(c=!0,f||_(),f)}class bd{constructor(o){this._hashName=o&&encodeURIComponent(o),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qa(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,s.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const c=Yl(o);if(this._hashName){const f=this._hashName;let _=!1;const x=s.window.location.hash.slice(1).split("&").map(T=>{const S=T.split("=")[0];return S===f?(_=!0,`${S}=${c}`):T}).filter(T=>T);return _||x.push(`${f}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const o=s.window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(f=>isNaN(f))){const f=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,o)}}function Yl(d,o){const c=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),T=Math.round(c.lng*x)/x,S=Math.round(c.lat*x)/x,M=d.getBearing(),z=d.getPitch();let P=o?`/${T}/${S}/${f}`:`${f}/${S}/${T}`;return(M||z)&&(P+="/"+Math.round(10*M)/10),z&&(P+=`/${Math.round(z)}`),P}const Jl={linearity:.3,easing:s.bezier(0,0,.3,1)},lu=s.extend({deceleration:2500,maxSpeed:1400},Jl),cu=s.extend({deceleration:20,maxSpeed:1400},Jl),yt=s.extend({deceleration:1e3,maxSpeed:360},Jl),oo=s.extend({deceleration:1e3,maxSpeed:90},Jl);class pm{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=s.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){const x=ec(c.pan.mag(),f,s.extend({},lu,o||{}));_.offset=c.pan.mult(x.amount/c.pan.mag()),_.center=this._map.transform.center,Ql(_,x)}if(c.zoom){const x=ec(c.zoom,f,cu);_.zoom=this._map.transform.zoom+x.amount,Ql(_,x)}if(c.bearing){const x=ec(c.bearing,f,yt);_.bearing=this._map.transform.bearing+s.clamp(x.amount,-179,179),Ql(_,x)}if(c.pitch){const x=ec(c.pitch,f,oo);_.pitch=this._map.transform.pitch+x.amount,Ql(_,x)}if(_.zoom||_.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Ql(d,o){(!d.duration||d.duration<o.duration)&&(d.duration=o.duration,d.easing=o.easing)}function ec(d,o,c){const{maxSpeed:f,linearity:_,deceleration:x}=c,T=s.clamp(d*_/(o/1e3),-f,f),S=Math.abs(T)/(x*_);return{easing:c.easing,duration:1e3*S,amount:T*(S/2)}}class Br extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f,_={}){const x=De(c.getCanvasContainer(),f),T=c.unproject(x);super(o,s.extend({point:x,lngLat:T,originalEvent:f},_)),this._defaultPrevented=!1,this.target=c}}class tc extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){const _=o==="touchend"?f.changedTouches:f.touches,x=He(c.getCanvasContainer(),_),T=x.map(M=>c.unproject(M)),S=x.reduce((M,z,P,O)=>M.add(z.div(O.length)),new s.Point(0,0));super(o,{points:x,point:S,lngLats:T,lngLat:c.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class uu extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){super(o,{originalEvent:f}),this._defaultPrevented=!1}}class Ed{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new uu(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new Br(o.type,this._map,o))}mouseup(o){this._map.fire(new Br(o.type,this._map,o))}preclick(o){const c=s.extend({},o);c.type="preclick",this._map.fire(new Br(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Br(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Br(o.type,this._map,o))}mouseover(o){this._map.fire(new Br(o.type,this._map,o))}mouseout(o){this._map.fire(new Br(o.type,this._map,o))}touchstart(o){return this._firePreventable(new tc(o.type,this._map,o))}touchmove(o){this._map.fire(new tc(o.type,this._map,o))}touchend(o){this._map.fire(new tc(o.type,this._map,o))}touchcancel(o){this._map.fire(new tc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hu{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Br(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Br(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fm{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(ee(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const f=c,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=$("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const T=Math.min(_.x,f.x),S=Math.max(_.x,f.x),M=Math.min(_.y,f.y),z=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=S-T+"px",this._box.style.height=z-M+"px")})}mouseupWindow(o,c){if(!this._active)return;const f=this._startPos,_=c;if(f&&o.button===0){if(this.reset(),se(),f.x!==_.x||f.y!==_.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ne(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new s.Event(o,{originalEvent:c}))}}function du(d,o){const c={};for(let f=0;f<d.length;f++)c[d[f].identifier]=o[f];return c}class Wa{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const x=new s.Point(0,0);for(const T of _)x._add(T);return x.div(_.length)}(c),this.touches=du(f,c)))}touchmove(o,c,f){if(this.aborted||!this.centroid)return;const _=du(f,c);for(const x in this.touches){const T=_[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(o,c,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Td{constructor(o){this.singleTap=new Wa(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,f){this.singleTap.touchstart(o,c,f)}touchmove(o,c,f){this.singleTap.touchmove(o,c,f)}touchend(o,c,f){const _=this.singleTap.touchend(o,c,f);if(_){const x=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(x&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Gy{constructor(){this._zoomIn=new Td({numTouches:1,numTaps:2}),this._zoomOut=new Td({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,f){this._zoomIn.touchstart(o,c,f),this._zoomOut.touchstart(o,c,f)}touchmove(o,c,f){this._zoomIn.touchmove(o,c,f),this._zoomOut.touchmove(o,c,f)}touchend(o,c,f){const _=this._zoomIn.touchend(o,c,f),x=this._zoomOut.touchend(o,c,f);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const mm={0:1,2:2};class Za{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const f=Be(o);this._correctButton(o,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(o,c){const f=this._lastPoint;if(f){if(o.preventDefault(),this._eventButton!=null&&function(_,x){const T=mm[x];return _.buttons===void 0||(_.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(o){this._lastPoint&&Be(o)===this._eventButton&&(this._moved&&se(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sd extends Za{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class Cd extends Za{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){const f=.8*(c.x-o.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(o){o.preventDefault()}}class Ad extends Za{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){const f=-.5*(c.y-o.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(o){o.preventDefault()}}class pu{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(o,c,f){return this._calculateTransform(o,c,f)}touchmove(o,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,f)}}touchend(o,c,f){this._calculateTransform(o,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,f){f.length>0&&(this._active=!0);const _=du(f,c),x=new s.Point(0,0),T=new s.Point(0,0);let S=0;for(const z in _){const P=_[z],O=this._touches[z];O&&(x._add(P),T._add(P.sub(O)),S++,_[z]=P)}if(this._touches=_,S<this._minTouches||!T.mag())return;const M=T.div(S);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class nc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,f){return{}}touchstart(o,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,f){const _=this._firstTwoTouches;if(!_)return;o.preventDefault();const[x,T]=_,S=rc(f,c,x),M=rc(f,c,T);if(!S||!M)return;const z=this._aroundCenter?null:S.add(M).div(2);return this._move([S,M],z,o)}touchend(o,c,f){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,T=rc(f,c,_),S=rc(f,c,x);T&&S||(this._active&&se(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rc(d,o,c){for(let f=0;f<d.length;f++)if(d[f].identifier===c)return o[f]}function Md(d,o){return Math.log(d/o)/Math.LN2}class gm extends nc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Md(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Md(this._distance,f),pinchAround:c}}}function Id(d,o){return 180*d.angleWith(o)/Math.PI}class _m extends nc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const f=this._vector;if(this._vector=o[0].sub(o[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Id(this._vector,f),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=Id(o,f);return Math.abs(_)<c}}function Es(d){return Math.abs(d.y)>Math.abs(d.x)}class ym extends nc{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Es(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,f){const _=this._lastPoints;if(!_)return;const x=o[0].sub(_[0]),T=o[1].sub(_[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,f.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(o,c,f){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,x=c.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=o.y>0==c.y>0;return Es(o)&&Es(c)&&T}}const vm={panStep:100,bearingStep:15,pitchStep:10};class qy{constructor(){const o=vm;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,f=0,_=0,x=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:S=>{const M=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:xm,zoom:c?Math.round(M)+c*(o.shiftKey?2:1):M,bearing:S.getBearing()+f*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xm(d){return d*(2-d)}const kd=4.000244140625;class wm{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const f=s.exported.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%kd==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=De(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>kd?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const P=c(),O=Math.pow(2,P),G=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(G*z))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,x=this._easing;let T,S=!1;if(this._type==="wheel"&&_&&x){const M=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),z=x(M);T=s.number(_,f,z),M<1?this._frameId||(this._frameId=!0):S=!0}else T=f,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:T-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=s.ease;if(this._prevEase){const f=this._prevEase,_=(s.exported.now()-f.start)/f.duration,x=f.easing(_+.01)-f.easing(_),T=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-T*T);c=s.bezier(T,S,.25,1)}return this._prevEase={start:s.exported.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class bm{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ei{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(o.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wy{constructor(){this._tap=new Td({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,f){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(o,c,f))}touchmove(o,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=c[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,c,f)}touchend(o,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(o,c,f)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Em{constructor(o,c,f){this._el=o,this._mousePan=c,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zy{constructor(o,c,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Hy{constructor(o,c,f,_){this._el=o,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Gi=d=>d.zoom||d.drag||d.pitch||d.rotate;class Tm extends s.Event{}class Xy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const f=s.sub([],c,o);this.radius=s.length(f[2]<0?s.div([],f,this.constants):[f[0],f[1],0])}projectRay(o){s.div(o,o,this.constants),s.normalize(o,o),s.mul$1(o,o,this.constants);const c=s.scale$2([],o,this.radius);if(c[2]>0){const f=s.scale$2([],[0,0,1],s.dot(c,[0,0,1])),_=s.scale$2([],s.normalize([],[c[0],c[1],0]),this.radius),x=s.add([],c,s.scale$2([],s.sub([],s.add([],_,f),c),2));c[0]=x[0],c[1]=x[1]}return c}}function so(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class ko{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pm(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[_,x,T]of this._listeners)_.addEventListener(x,_===s.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[o,c,f]of this._listeners)o.removeEventListener(c,o===s.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(o){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new Ed(c,o));const _=c.boxZoom=new fm(c,o);this._add("boxZoom",_);const x=new Gy,T=new ei;c.doubleClickZoom=new bm(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const S=new Wy;this._add("tapDragZoom",S);const M=c.touchPitch=new ym(c);this._add("touchPitch",M);const z=new Cd(o),P=new Ad(o);c.dragRotate=new Zy(o,z,P),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const O=new Sd(o),G=new pu(c,o);c.dragPan=new Em(f,O,G),this._add("mousePan",O),this._add("touchPan",G,["touchZoom","touchRotate"]);const Z=new _m,J=new gm;c.touchZoomRotate=new Hy(f,J,Z,S),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new hu(c));const X=c.scrollZoom=new wm(c,this);this._add("scrollZoom",X,["mousePan"]);const te=c.keyboard=new qy;this._add("keyboard",te);for(const B of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[B]&&c[B].enable(o[B])}_add(o,c,f){this._handlers.push({handlerName:o,handler:c,allowed:f}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,f){for(const _ in o)if(_!==f&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const f of o)this._el.contains(f.target)&&c.push(f);return c}handleEvent(o,c){this._updatingCamera=!0;const f=o.type==="renderFrame",_=f?void 0:o,x={needsRenderFrame:!1},T={},S={},M=o.touches?this._getMapTouches(o.touches):void 0,z=M?He(this._el,M):f?void 0:De(this._el,o);for(const{handlerName:G,handler:Z,allowed:J}of this._handlers){if(!Z.isEnabled())continue;let X;this._blockedByActive(S,J,G)?Z.reset():Z[c||o.type]&&(X=Z[c||o.type](o,z,M),this.mergeHandlerResult(x,T,X,G,_),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||Z.isActive())&&(S[G]=Z)}const P={};for(const G in this._previousActiveHandlers)S[G]||(P[G]=_);this._previousActiveHandlers=S,(Object.keys(P).length||so(x))&&(this._changes.push([x,T,P]),this._triggerRenderFrame()),(Object.keys(S).length||so(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=x;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(o,c,f,_,x){if(!f)return;s.extend(o,f);const T={handlerName:_,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(c.zoom=T),f.panDelta!==void 0&&(c.drag=T),f.pitchDelta!==void 0&&(c.pitch=T),f.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const o={},c={},f={};for(const[_,x,T]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new s.Point(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),s.extend(c,x),s.extend(f,T);this._updateMapTransform(o,c,f),this._changes=[]}_updateMapTransform(o,c,f){const _=this._map,x=_.transform,T=W=>[W.x,W.y,W.z];if((W=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!so(o)){const W=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",W!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!so(o))return void this._fireEvents(c,f,!0);let{panDelta:S,zoomDelta:M,bearingDelta:z,pitchDelta:P,around:O,aroundCoord:G,pinchAround:Z}=o;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),Z!==void 0&&(O=Z),(M||(W=>c[W]&&!this._eventsInProgress[W])("drag"))&&O&&(this._dragOrigin=T(x.pointCoordinate3D(O)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),O=O||_.transform.centerPoint,z&&(x.bearing+=z),P&&(x.pitch+=P),x._updateCameraState();const J=[0,0,0];if(S)if(x.projection.name==="mercator"){const W=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(O).dir),ae=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(O.sub(S)).dir);J[0]=ae[0]-W[0],J[1]=ae[1]-W[1]}else{const W=x.pointCoordinate(O);if(x.projection.name==="globe"){S=S.rotate(-x.angle);const ae=x._pixelsPerMercatorPixel/x.worldSize;J[0]=-S.x*s.mercatorScale(s.latFromMercatorY(W.y))*ae,J[1]=-S.y*s.mercatorScale(x.center.lat)*ae}else{const ae=x.pointCoordinate(O.sub(S));W&&ae&&(J[0]=ae.x-W.x,J[1]=ae.y-W.y)}}const X=x.zoom,te=[0,0,0];if(M){const W=T(G||x.pointCoordinate3D(O)),ae={dir:s.normalize([],s.sub([],W,x._camera.position))};if(ae.dir[2]<0){const le=x.zoomDeltaToMovement(W,M);s.scale$2(te,ae.dir,le)}}const B=s.add(J,J,te);x._translateCameraConstrained(B),M&&Math.abs(x.zoom-X)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,f,!0)}_fireEvents(o,c,f){const _=Gi(this._eventsInProgress),x=Gi(o),T={};for(const P in o){const{originalEvent:O}=o[P];this._eventsInProgress[P]||(T[`${P}start`]=O),this._eventsInProgress[P]=o[P]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const P in T)this._fireEvent(P,T[P]);x&&this._fireEvent("move",x.originalEvent);for(const P in o){const{originalEvent:O}=o[P];this._fireEvent(P,O)}const S={};let M;for(const P in this._eventsInProgress){const{handlerName:O,originalEvent:G}=this._eventsInProgress[P];this._handlersById[O].isActive()||(delete this._eventsInProgress[P],M=c[O]||G,S[`${P}end`]=M)}for(const P in S)this._fireEvent(P,S[P]);const z=Gi(this._eventsInProgress);if(f&&(_||x)&&!z){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;P?(O(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:M})):(this._map.fire(new s.Event("moveend",{originalEvent:M})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new s.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Tm("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Js="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class fu extends s.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,f){return o=s.Point.convert(o).mult(-1),this.panTo(this.transform.center,s.extend({offset:o},c),f)}panTo(o,c,f){return this.easeTo(s.extend({center:o},c),f)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,f){return this.easeTo(s.extend({zoom:o},c),f)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,f){return this.easeTo(s.extend({bearing:o},c),f)}resetNorth(o,c){return this.rotateTo(0,s.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=s.LngLatBounds.convert(o);const f=c&&c.bearing||0,_=c&&c.pitch||0,x=o.getNorthWest(),T=o.getSouthEast();return this._cameraForBounds(this.transform,x,T,f,_,c)}_extendCameraOptions(o){const c={top:0,bottom:0,right:0,left:0};if(typeof(o=s.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const f=o.padding;o.padding={top:f,bottom:f,right:f,left:f}}return o.padding=s.extend(c,o.padding),o}_minimumAABBFrustumDistance(o,c){const f=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return f/_>o.aspect?f/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,f,_,x,T){const S=o.clone(),M=this._extendCameraOptions(T);S.bearing=_,S.pitch=x;const z=s.LngLat.convert(c),P=s.LngLat.convert(f),O=.5*(z.lat+P.lat),G=.5*(z.lng+P.lng),Z=s.latLngToECEF(O,G),J=s.normalize([],Z),X=s.normalize([],s.cross([],J,[0,1,0])),te=s.cross([],X,J),B=[X[0],X[1],X[2],0,te[0],te[1],te[2],0,J[0],J[1],J[2],0,0,0,0,1],W=[Z,s.latLngToECEF(z.lat,z.lng),s.latLngToECEF(P.lat,z.lng),s.latLngToECEF(P.lat,P.lng),s.latLngToECEF(z.lat,P.lng),s.latLngToECEF(O,z.lng),s.latLngToECEF(O,P.lng),s.latLngToECEF(z.lat,G),s.latLngToECEF(P.lat,G)];let ae=s.Aabb.fromPoints(W.map(Xe=>[s.dot(X,Xe),s.dot(te,Xe),s.dot(J,Xe)]));const le=s.transformMat4([],ae.center,B);s.squaredLength(le)===0&&s.set(le,0,0,1),s.normalize(le,le),s.scale$2(le,le,s.GLOBE_RADIUS),S.center=s.ecefToLatLng(le);const _e=S.getWorldToCameraMatrix(),xe=s.invert(new Float64Array(16),_e);ae=s.Aabb.applyTransform(ae,s.multiply([],_e,B)),s.transformMat4(le,le,_e);const ve=.5*(ae.max[2]-ae.min[2]),Se=this._minimumAABBFrustumDistance(S,ae),Ee=s.scale$2([],[0,0,1],ve),Pe=s.add(Ee,le,Ee),nt=Se+(S.pitch===0?0:s.distance(le,Pe)),Ae=S.globeCenterInViewSpace,Ge=s.sub([],le,[Ae[0],Ae[1],Ae[2]]);s.normalize(Ge,Ge),s.scale$2(Ge,Ge,nt);const Le=s.add([],le,Ge);s.transformMat4(Le,Le,xe);const Qe=s.earthRadius/s.GLOBE_RADIUS,ke=s.length(Le),$e=s.mercatorZfromAltitude(Math.max(ke*Qe-s.earthRadius,Number.EPSILON),0),it=Math.min(S.zoomFromMercatorZAdjusted($e),M.maxZoom);return it>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=it,this._cameraForBounds(S,c,f,_,x,T)):{center:S.center,zoom:it,bearing:_,pitch:x}}queryTerrainElevation(o,c){const f=this.transform.elevation;return f?(c=s.extend({},{exaggerated:!0},c),f.getAtPoint(s.MercatorCoordinate.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,f,_,x,T){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,f,_,x,T);const S=o.clone(),M=this._extendCameraOptions(T),z=S.padding;S.bearing=_,S.pitch=x;const P=s.LngLat.convert(c),O=s.LngLat.convert(f),G=new s.LngLat(P.lng,O.lat),Z=new s.LngLat(O.lng,P.lat),J=S.project(P),X=S.project(O),te=this.queryTerrainElevation(P),B=this.queryTerrainElevation(O),W=this.queryTerrainElevation(G),ae=this.queryTerrainElevation(Z),le=[[J.x,J.y,Math.min(te||0,B||0,W||0,ae||0)],[X.x,X.y,Math.max(te||0,B||0,W||0,ae||0)]];let _e=s.Aabb.fromPoints(le);const xe=S.getWorldToCameraMatrix(),ve=s.invert(new Float64Array(16),xe);_e=s.Aabb.applyTransform(_e,xe);const Se=s.sub([],_e.max,_e.min),Ee=z.left||0,Pe=z.right||0,nt=z.bottom||0,Ae=z.top||0,{left:Ge,right:Le,top:Qe,bottom:ke}=M.padding,$e=.5*(Ee+Pe),it=.5*(Ae+nt),Xe=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(Ee+Pe+Ge+Le))/Se[0],(S.height-(nt+Ae+ke+Qe))/Se[1])),M.maxZoom),ot=S.scale/S.zoomScale(Xe);_e=new s.Aabb([_e.min[0]-(Ge+$e)*ot,_e.min[1]-(ke+it)*ot,_e.min[2]],[_e.max[0]+(Le+$e)*ot,_e.max[1]+(Qe+it)*ot,_e.max[2]]);const Ct=.5*Se[2],Ot=this._minimumAABBFrustumDistance(S,_e),xt=[0,0,1,0];s.transformMat4$1(xt,xt,xe),s.normalize$2(xt,xt);const kt=s.scale$2([],xt,Ot+Ct),nn=s.add([],_e.center,kt),Jt=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new s.Point(M.offset.x,M.offset.y):s.Point.convert(M.offset)).rotate(-s.degToRad(_));_e.center[0]-=Jt.x*ot,_e.center[1]+=Jt.y*ot,s.transformMat4(_e.center,_e.center,ve),s.transformMat4(nn,nn,ve);const Tt=[_e.center[0],_e.center[1],nn[2]*S.pixelsPerMeter];s.scale$2(Tt,Tt,1/S.worldSize);const _n=s.lngFromMercatorX(Tt[0]),Tn=s.latFromMercatorY(Tt[1]),Sn=Math.min(S._zoomFromMercatorZ(Tt[2]),M.maxZoom),Cn=new s.LngLat(_n,Tn);return S.mercatorFromTransition&&Sn<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=Sn,this._cameraForBounds(S,c,f,_,x,T)):{center:Cn,zoom:Sn,bearing:_,pitch:x}}fitBounds(o,c,f){const _=this.cameraForBounds(o,c);return this._fitInternal(_,c,f)}fitScreenCoordinates(o,c,f,_,x){const T=s.Point.convert(o),S=s.Point.convert(c),M=new s.Point(Math.min(T.x,S.x),Math.min(T.y,S.y)),z=new s.Point(Math.max(T.x,S.x),Math.max(T.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,S))return this;const P=this.transform.pointLocation3D(M),O=this.transform.pointLocation3D(z),G=this.transform.pointLocation3D(new s.Point(M.x,z.y)),Z=this.transform.pointLocation3D(new s.Point(z.x,M.y)),J=[Math.min(P.lng,O.lng,G.lng,Z.lng),Math.min(P.lat,O.lat,G.lat,Z.lat)],X=[Math.max(P.lng,O.lng,G.lng,Z.lng),Math.max(P.lat,O.lat,G.lat,Z.lat)],te=_&&_.pitch?_.pitch:this.getPitch(),B=this._cameraForBounds(this.transform,J,X,f,te,_);return this._fitInternal(B,_,x)}_fitInternal(o,c,f){return o?(delete(c=s.extend(o,c)).padding,c.linear?this.easeTo(c,f):this.flyTo(c,f)):this}jumpTo(o,c){this.stop();const f=o.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,T=!1;return"zoom"in o&&f.zoom!==+o.zoom&&(_=!0,f.zoom=+o.zoom),o.center!==void 0&&(f.center=s.LngLat.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(x=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(T=!0,f.pitch=+o.pitch),o.padding==null||f.isPaddingEqual(o.padding)||(f.padding=o.padding),o.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),_&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),x&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),T&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Js),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.warnOnce(Js),this;this.stop();const _=f.zoom,x=f.pitch,T=f.bearing;f.setFreeCameraOptions(o);const S=_!==f.zoom,M=x!==f.pitch,z=T!==f.bearing;return this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),S&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),z&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),M&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=s.extend({offset:[0,0],duration:500,easing:s.ease},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const f=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),S=this.getPadding(),M="zoom"in o?+o.zoom:_,z="bearing"in o?this._normalizeBearing(o.bearing,x):x,P="pitch"in o?+o.pitch:T,O="padding"in o?o.padding:f.padding,G=s.Point.convert(o.offset);let Z,J,X;if(f.projection.name==="globe"){const Ee=s.MercatorCoordinate.fromLngLat(f.center),Pe=G.rotate(-f.angle);Ee.x+=Pe.x/f.worldSize,Ee.y+=Pe.y/f.worldSize;const nt=Ee.toLngLat(),Ae=s.LngLat.convert(o.center||nt);this._normalizeCenter(Ae),Z=f.centerPoint.add(Pe),J=new s.Point(Ee.x,Ee.y).mult(f.worldSize),X=new s.Point(s.mercatorXfromLng(Ae.lng),s.mercatorYfromLat(Ae.lat)).mult(f.worldSize).sub(J)}else{Z=f.centerPoint.add(G);const Ee=f.pointLocation(Z),Pe=s.LngLat.convert(o.center||Ee);this._normalizeCenter(Pe),J=f.project(Ee),X=f.project(Pe).sub(J)}const te=f.zoomScale(M-_);let B,W;o.around&&(B=s.LngLat.convert(o.around),W=f.locationPoint(B));const ae=this._zooming||M!==_,le=this._rotating||x!==z,_e=this._pitching||P!==T,xe=!f.isPaddingEqual(O),ve=Ee=>Pe=>{if(ae&&(Ee.zoom=s.number(_,M,Pe)),le&&(Ee.bearing=s.number(x,z,Pe)),_e&&(Ee.pitch=s.number(T,P,Pe)),xe&&(Ee.interpolatePadding(S,O,Pe),Z=Ee.centerPoint.add(G)),B)Ee.setLocationAtPoint(B,W);else{const nt=Ee.zoomScale(Ee.zoom-_),Ae=M>_?Math.min(2,te):Math.max(.5,te),Ge=Math.pow(Ae,1-Pe),Le=Ee.unproject(J.add(X.mult(Pe*Ge)).mult(nt));Ee.setLocationAtPoint(Ee.renderWorldCopies?Le.wrap():Le,Z)}return o.preloadOnly||this._fireMoveEvents(c),Ee};if(o.preloadOnly){const Ee=this._emulate(ve,o.duration,f);return this._preloadTiles(Ee),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=le,this._pitching=_e,this._padding=xe,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,Se),this._ease(ve(f),Ee=>{f.recenterOnTerrain(),this._afterEase(c,Ee)},o),this}_prepareEase(o,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||f.moving||this.fire(new s.Event("movestart",o)),this._zooming&&!f.zooming&&this.fire(new s.Event("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new s.Event("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new s.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.Event("move",o)),this._zooming&&this.fire(new s.Event("zoom",o)),this._rotating&&this.fire(new s.Event("rotate",o)),this._pitching&&this.fire(new s.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new s.Event("zoomend",o)),_&&this.fire(new s.Event("rotateend",o)),x&&this.fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){const Xe=s.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xe,c)}this.stop(),o=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},o);const f=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),S=this.getPadding(),M="zoom"in o?s.clamp(+o.zoom,f.minZoom,f.maxZoom):_,z="bearing"in o?this._normalizeBearing(o.bearing,x):x,P="pitch"in o?+o.pitch:T,O="padding"in o?o.padding:f.padding,G=f.zoomScale(M-_),Z=s.Point.convert(o.offset);let J=f.centerPoint.add(Z);const X=f.pointLocation(J),te=s.LngLat.convert(o.center||X);this._normalizeCenter(te);const B=f.project(X),W=f.project(te).sub(B);let ae=o.curve;const le=Math.max(f.width,f.height),_e=le/G,xe=W.mag();if("minZoom"in o){const Xe=s.clamp(Math.min(o.minZoom,_,M),f.minZoom,f.maxZoom),ot=le/f.zoomScale(Xe-_);ae=Math.sqrt(ot/xe*2)}const ve=ae*ae;function Se(Xe){const ot=(_e*_e-le*le+(Xe?-1:1)*ve*ve*xe*xe)/(2*(Xe?_e:le)*ve*xe);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Ee(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function Pe(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const nt=Se(0);let Ae=function(Xe){return Pe(nt)/Pe(nt+ae*Xe)},Ge=function(Xe){return le*((Pe(nt)*(Ee(ot=nt+ae*Xe)/Pe(ot))-Ee(nt))/ve)/xe;var ot},Le=(Se(1)-nt)/ae;if(Math.abs(xe)<1e-6||!isFinite(Le)){if(Math.abs(le-_e)<1e-6)return this.easeTo(o,c);const Xe=_e<le?-1:1;Le=Math.abs(Math.log(_e/le))/ae,Ge=function(){return 0},Ae=function(ot){return Math.exp(Xe*ae*ot)}}o.duration="duration"in o?+o.duration:1e3*Le/("screenSpeed"in o?+o.screenSpeed/ae:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Qe=x!==z,ke=P!==T,$e=!f.isPaddingEqual(O),it=Xe=>ot=>{const Ct=ot*Le,Ot=1/Ae(Ct);Xe.zoom=ot===1?M:_+Xe.scaleZoom(Ot),Qe&&(Xe.bearing=s.number(x,z,ot)),ke&&(Xe.pitch=s.number(T,P,ot)),$e&&(Xe.interpolatePadding(S,O,ot),J=Xe.centerPoint.add(Z));const xt=ot===1?te:Xe.unproject(B.add(W.mult(Ge(Ct))).mult(Ot));return Xe.setLocationAtPoint(Xe.renderWorldCopies?xt.wrap():xt,J),Xe._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),Xe};if(o.preloadOnly){const Xe=this._emulate(it,o.duration,f);return this._preloadTiles(Xe),this}return this._zooming=!0,this._rotating=Qe,this._pitching=ke,this._padding=$e,this._prepareEase(c,!1),this._ease(it(f),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!o){const f=this.handlers;f&&f.stop(!1)}return this}_ease(o,c,f){f.animate===!1||f.duration===0?(o(1),c()):(this._easeStart=s.exported.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=s.wrap(o,-180,180);const f=Math.abs(o-c);return Math.abs(o-360-c)<f&&(o-=360),Math.abs(o+360-c)<f&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const f=o.lng-c.center.lng;o.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,f){const _=Math.ceil(15*c/1e3),x=[],T=o(f.clone());for(let S=0;S<=_;S++){const M=T(S/_);x.push(M.clone())}return x}}class vt{constructor(o={}){this.options=o,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact;return this._map=o,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=$("button","mapboxgl-ctrl-attrib-button",this._container),$("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const f=this._map._getUIString(`AttributionControl.${c}`);o.setAttribute("aria-label",f),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(o){const f=c.reduce((_,x,T)=>(x.value&&(_+=`${x.key}=${x.value}${T<c.length-1?"&":""}`),_),"?");o.href=`${s.config.FEEDBACK_URL}/${f}#${Yl(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const c=this._map.style._sourceCaches;for(const _ in c){const x=c[_];if(x.used){const T=x.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((_,x)=>_.length-x.length),o=o.filter((_,x)=>{for(let T=x+1;T<o.length;T++)if(o[T].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const f=o.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Pd{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=$("div","mapboxgl-ctrl");const c=$("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const c in o){const f=o[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class zd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const _ of f)if(_.id===o)return void(_.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ha(d,o,c){if(d=new s.LngLat(d.lng,d.lat),o){const f=new s.LngLat(d.lng-360,d.lat),_=new s.LngLat(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),T=c.locationPoint(d).distSqr(o),S=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(f).distSqr(o)<T&&(S||Math.abs(f.lng-c.center.lng)<x)?d=f:c.locationPoint(_).distSqr(o)<T&&(S||Math.abs(_.lng-c.center.lng)<x)&&(d=_)}for(;Math.abs(d.lng-c.center.lng)>180;){const f=c.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const Qs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class gt extends s.Evented{constructor(o,c){if(super(),(o instanceof s.window.HTMLElement||c)&&(o=s.extend({element:o},c)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=s.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=$("div");const _=41,x=27,T=pe("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),S=pe("radialGradient",{id:"shadowGradient"},pe("defs",{},T));pe("stop",{offset:"10%","stop-opacity":.4},S),pe("stop",{offset:"100%","stop-opacity":.05},S),pe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),pe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),pe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),pe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=s.Point.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const f=this._element.classList;for(const _ in Qs)f.remove(`mapboxgl-marker-anchor-${_}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,f=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,c=this._pos;if(!o||!c)return!1;const f=o.unproject(c),_=o.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();const f=o.unproject(c);let _;o._showingGlobe()&&s.isLngLatBehindGlobe(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(f),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Qs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const o=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!o||f!=="map")return"";if(!c._showingGlobe()){const M=c.getPitch();return M?`rotateX(${M}deg)`:""}const _=s.radToDeg(s.globeTiltAtLngLat(c.transform,this._lngLat)),x=o.sub(s.globeCenterToScreenPoint(c.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const S=_/T;return`rotateX(${-x.y*S}deg) rotateY(${x.x*S}deg)`}_calculateZTransform(){const o=this._pos,c=this._map;if(!c||!o)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){const x=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);f=s.radToDeg(Math.atan2(T.y,T.x))-90}else f=-c.getBearing();else if(_==="horizon"){const x=s.smoothstep(4,6,c.getZoom()),T=s.globeCenterToScreenPoint(c.transform);T.y+=x*c.transform.height;const S=o.sub(T),M=s.radToDeg(Math.atan2(S.y,S.x));f=(M>90?M-270:M+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(o){s.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Ha(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),o===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.Point.convert(o),this._update(),this}_onMove(o){const c=this._map;if(!c)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(o.point.dist(f)<x)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(o){const c=this._map,f=this._pos;c&&f&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(f),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Rd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ky=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sm(d=new s.Point(0,0),o="bottom"){if(typeof d=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(o){case"top":return new s.Point(0,d);case"top-left":return new s.Point(c,c);case"top-right":return new s.Point(-c,c);case"bottom":return new s.Point(0,-d);case"bottom-left":return new s.Point(c,-c);case"bottom-right":return new s.Point(-c,-c);case"left":return new s.Point(d,0);case"right":return new s.Point(-d,0)}return new s.Point(0,0)}return d instanceof s.Point||Array.isArray(d)?s.Point.convert(d):s.Point.convert(d[o]||[0,0])}class Dd{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=s.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,f){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+f}}const Cm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Am={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Yy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Jy{constructor(o,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Cd({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,f&&(this.mousePitch=new Ad({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),ee()}move(o,c){const f=this.map,_=this.mouseRotate.mousemoveWindow(o,c),x=_&&_.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,c),S=T&&T.pitchDelta;S&&f.setPitch(f.getPitch()+S)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ne(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(s.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),De(this.element,o)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,De(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=He(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=He(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ld={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Od={maxWidth:100,unit:"metric"},Bd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Xa={version:s.version,supported:R,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends fu{constructor(d){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(d=s.extend({},Am,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(d.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ga(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new zd,this._domRenderTaskQueue=new zd,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Cm,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Dd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=s.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ko(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new bd(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,s.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new vt({customAttribution:d.customAttribution})),this._logoControl=new Pd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(d,o){if(o===void 0&&(o=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[o];return o.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(d);return o>-1&&this._controls.splice(o,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.Event("movestart",d)).fire(new s.Event("move",d)),this.fire(new s.Event("resize",d)),o&&this.fire(new s.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?s.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(o=>o==="auto"?s.window.navigator.language:o):d}setLanguage(d){const o=this._parseLanguage(d);if(!this.style||o===this._language)return this;this._language=o,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,o=d.projection.name;let c;o==="globe"&&d.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),c=!0):o==="mercator"&&d.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,o){return this._updateProjection(d||o||{name:"mercator"})}_updateProjection(d){let o;if(o=d.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),o){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(s.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(s.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,o,c){if(d==="mouseenter"||d==="mouseover"){let f=!1;const _=T=>{const S=o.filter(z=>this.getLayer(z)),M=S.length?this.queryRenderedFeatures(T.point,{layers:S}):[];M.length?f||(f=!0,c.call(this,new Br(d,this,T.originalEvent,{features:M}))):f=!1},x=()=>{f=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:_,mouseout:x}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;const _=T=>{const S=o.filter(M=>this.getLayer(M));(S.length?this.queryRenderedFeatures(T.point,{layers:S}):[]).length?f=!0:f&&(f=!1,c.call(this,new Br(d,this,T.originalEvent)))},x=T=>{f&&(f=!1,c.call(this,new Br(d,this,T.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:_,mouseout:x}}}{const f=_=>{const x=o.filter(S=>this.getLayer(S)),T=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];T.length&&(_.features=T,c.call(this,_),delete _.features)};return{layers:new Set(o),listener:c,delegates:{[d]:f}}}}on(d,o,c){if(c===void 0)return super.on(d,o);Array.isArray(o)||(o=[o]);const f=this._createDelegatedListener(d,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,o,c){if(c===void 0)return super.once(d,o);Array.isArray(o)||(o=[o]);const f=this._createDelegatedListener(d,o,c);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,o,c){if(c===void 0)return super.off(d,o);o=new Set(Array.isArray(o)?o:[o]);const f=(x,T)=>{if(x.size!==T.size)return!1;for(const S of x)if(!T.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(x=>{for(let T=0;T<x.length;T++){const S=x[T];if(S.listener===c&&f(S.layers,o)){for(const M in S.delegates)this.off(M,S.delegates[M]);return x.splice(T,1),this}}})(_),this}queryRenderedFeatures(d,o){return this.style?(o!==void 0||d===void 0||d instanceof s.Point||Array.isArray(d)||(o=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(d,o){return this.style.querySourceFeatures(d,o)}isPointOnSurface(d){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.warnOnce(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(d))}setStyle(d,o){return(o=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(d,o))}_getUIString(d){const o=this._locale[d];if(o==null)throw new Error(`Missing UI string '${d}'`);return o}_updateStyle(d,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Mo(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Mo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,o){if(typeof d=="string"){const c=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(c,s.ResourceType.Style);s.getJSON(f,(_,x)=>{_?this.fire(new s.ErrorEvent(_)):x&&this._updateDiff(x,o)})}else typeof d=="object"&&this._updateDiff(d,o)}_updateDiff(d,o){try{this.style.setState(d)&&this._update(!0)}catch(c){s.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(d,o){return this._lazyInitEmptyStyle(),this.style.addSource(d,o),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const o in d){const c=d[o]._tiles;for(const f in c){const _=c[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(d,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,o,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,o,{pixelRatio:c=1,sdf:f=!1,stretchX:_,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap){const{width:S,height:M,data:z}=s.exported.getImageData(o);this.style.addImage(d,{data:new s.RGBAImage({width:S,height:M},z),pixelRatio:c,stretchX:_,stretchY:x,content:T,sdf:f,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:M}=o,z=o;this.style.addImage(d,{data:new s.RGBAImage({width:S,height:M},new Uint8Array(z.data)),pixelRatio:c,stretchX:_,stretchY:x,content:T,sdf:f,version:0,userImage:z}),z.onAdd&&z.onAdd(this,d)}}updateImage(d,o){const c=this.style.getImage(d);if(!c)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap?s.exported.getImageData(o):o,{width:_,height:x}=f;_!==void 0&&x!==void 0?_===c.data.width&&x===c.data.height?(c.data.replace(f.data,!(o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap)),this.style.updateImage(d,c)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,o){s.getImage(this._requestManager.transformRequest(d,s.ResourceType.Image),(c,f)=>{o(c,f instanceof s.window.HTMLImageElement?s.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(d,o){return this._lazyInitEmptyStyle(),this.style.addLayer(d,o),this._update(!0)}moveLayer(d,o){return this.style.moveLayer(d,o),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,o,c){return this.style.setLayerZoomRange(d,o,c),this._update(!0)}setFilter(d,o,c={}){return this.style.setFilter(d,o,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,o,c,f={}){return this.style.setPaintProperty(d,o,c,f),this._update(!0)}getPaintProperty(d,o){return this.style.getPaintProperty(d,o)}setLayoutProperty(d,o,c,f={}){return this.style.setLayoutProperty(d,o,c,f),this._update(!0)}getLayoutProperty(d,o){return this.style.getLayoutProperty(d,o)}setLight(d,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(d),this.transform):0}setFeatureState(d,o){return this.style.setFeatureState(d,o),this._update()}removeFeatureState(d,o){return this.style.removeFeatureState(d,o),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,f,_,x=this._container;for(;x&&(!f||!_);){const T=s.window.getComputedStyle(x).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),x=x.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=$("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=$("div","mapboxgl-canvas-container",d);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=$("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=$("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=$("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,o){const c=s.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${o}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const o=this._markers.indexOf(d);o!==-1&&this._markers.splice(o,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const o=this._popups.indexOf(d);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const d=s.extend({},R.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._useWebGL2&&this._canvas.getContext("webgl2",d),c=o||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);c?(this._useWebGL2&&!o&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(c,!0),this.painter=new Va(c,this.transform,!!o),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(c)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let o;const c=this.painter.context.extTimerQuery,f=s.exported.now();if(this.listens("gpu-timing-frame")&&(o=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,M=this.transform.pitch,z=s.exported.now(),P=new s.EvaluationParameters(S,{now:z,fadeDuration:_,pitch:M,transition:this.style.getTransition()});this.style.update(P)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(f),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const S=s.exported.now()-f;c.endQueryEXT(c.TIME_ELAPSED_EXT,o),setTimeout(()=>{const M=c.getQueryObjectEXT(o,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(o),this.fire(new s.Event("gpu-timing-frame",{cpuTime:S,gpuTime:M})),s.window.performance.mark("frame-gpu",{startTime:f,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(S);this.fire(new s.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(S);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(x=this._updateAverageElevation(f,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const o of this._markers)d&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!d||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(d,o=!1){const c=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((o||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const f=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const T=Math.abs(f-_);if(T>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(_),c(_);this._averageElevation.easeTo(_,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(_),c(_)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===s.AUTH_ERR_MSG||d.status===401)){const o=this.painter.context.gl;s.storeAuthState(o,!1),this._logoControl instanceof Pd&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,f=c.createFramebuffer();function _(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(d,o,c){let f=c[1]-c[0];const _=d.length/4;for(let x=0;x<o.length;x++){const T=o[x];let S=0;for(let M=0;M<T.length;M+=4)T[M]===d[M]&&T[M+1]===d[M+1]&&T[M+2]===d[M+2]&&T[M+3]===d[M+3]&&(S+=1);f+=(c[x+2]-c[x+1])*(1-S/_)}return f}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.exported.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(d){const o=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(o,(c,f)=>c._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,o){s.setCacheLimits(d,o)}get version(){return s.version}},NavigationControl:class{constructor(d){this.options=s.extend({},Yy,d),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),$("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),$("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=$("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const o=d.getZoom(),c=o===d.getMaxZoom(),f=o===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jy(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,o){const c=$("button",d,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(d,o){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${o}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.Evented{constructor(d){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Ld,d),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=qa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,d(c)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(d){const o=this._map.getMaxBounds(),c=d.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",d)),this._finish()}}_updateCamera(d){const o=new s.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,f=this._map.getBearing(),_=s.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),_,{geolocateSource:!0})}_updateMarker(d){if(d){const o=new s.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,o=s.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=$("button","mapboxgl-ctrl-geolocate",this._container),$("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$("div","mapboxgl-user-location"),this._dotElement.appendChild($("div","mapboxgl-user-location-dot")),this._dotElement.appendChild($("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new gt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=$("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vt,ScaleControl:class{constructor(d){this.options=s.extend({},Od,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,f=o._containerWidth/2-d/2,_=o.unproject([f,c]),x=o.unproject([f+d,c]),T=_.distanceTo(x);if(this.options.unit==="imperial"){const S=3.2808*T;S>5280?this._setScale(d,S/5280,"mile"):this._setScale(d,S,"foot")}else this.options.unit==="nautical"?this._setScale(d,T/1852,"nautical-mile"):T>=1e3?this._setScale(d,T/1e3,"kilometer"):this._setScale(d,T,"meter")}_setScale(d,o,c){this._map._requestDomTask(()=>{const f=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let S=x/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(S),T*S}(o),_=f/o;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(f):`${f}&nbsp;${Bd[c]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof s.window.HTMLElement?this._container=d.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=$("button","mapboxgl-ctrl-fullscreen",this._controlContainer);$("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(d){super(),this.options=s.extend(Object.create(Rd),d),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(s.window.document.createTextNode(d))}setHTML(d){const o=s.window.document.createDocumentFragment(),c=s.window.document.createElement("body");let f;for(c.innerHTML=d;f=c.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=$("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(d),this.options.closeButton){const c=this._closeButton=$("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let o;return this._classList.delete(d)?o=!1:(this._classList.add(d),o=!0),this._updateClassList(),o}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const o=this._map,c=this._container,f=this._pos;if(!o||!c||!f)return"bottom";const _=c.offsetWidth,x=c.offsetHeight,T=f.x<_/2,S=f.x>o.transform.width-_/2;if(f.y+d<x)return T?"top-left":S?"top-right":"top";if(f.y>o.transform.height-x){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),d.className=o.join(" ")}_update(d){const o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=$("div","mapboxgl-popup",o.getContainer()),this._tip=$("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ha(this._lngLat,this._pos,o.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d?d:o.project(this._lngLat),x=Sm(this.options.offset),T=this._anchor=this._getAnchor(x.y),S=Sm(this.options.offset,T),M=_.add(S).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Qs[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&o._showingGlobe()){const _=s.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ky);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:gt,Style:Mo,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:um,Evented:s.Evented,config:s.config,prewarm:function(){Zo().acquire(mi)},clearPrewarmedResources:function(){const d=ur;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(mi),ur=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(d){s.config.ACCESS_TOKEN=d},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(d){s.config.API_URL=d},get workerCount(){return an.workerCount},set workerCount(d){an.workerCount=d},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Xa});var b=m;return b})})(qM);var gB=qM.exports;const Lp=Fc(gB),_B=({data:e})=>{const{locations:n}=e;Lp.accessToken="pk.eyJ1IjoibmdoaXF1eWVuIiwiYSI6ImNsam5hMGpjajBzbW8zZ24zempjZTMyeG4ifQ.5Va3f5ZRbHLqz-gq-aF6QQ";const l=Te.useRef(null),h=Te.useRef(null);return Te.useEffect(()=>{h.current||(h.current=new Lp.Map({container:"map",style:"mapbox://styles/nghiquyen/cljorc30d00p301r5em444bmo"}),h.current.on("load",()=>{const m=new Lp.LngLatBounds;n.forEach(y=>{const b=document.createElement("div");b.className="marker";const s=new Lp.Popup({offset:30,anchor:"top",closeOnClick:!1}).setLngLat(y.coordinates).setHTML(`<p>Day ${y.day}: ${y.description}</p>`);new Lp.Marker({element:b,anchor:"bottom"}).setLngLat(y.coordinates).setPopup(s).addTo(h.current),s.addTo(h.current),m.extend(y.coordinates)}),h.current.fitBounds(m,{padding:{top:250,bottom:200,left:200,right:200}})}))}),Q.jsx("div",{ref:l,id:"map"})},yB=({img:e,i:n,tourName:l})=>Q.jsx("div",{className:"picture-box",children:Q.jsx("img",{className:`picture-box__img picture-box__img--${n+1}`,src:`/img/tours/${e}`,alt:`${l} Tour ${n+1}`})}),vB=({review:e})=>{const{user:n}=e,l="reviews__star reviews__star--active",h="reviews__star reviews__star--inactive";return Q.jsxs("div",{className:"reviews__card",children:[Q.jsxs("div",{className:"reviews__avatar",children:[Q.jsx("img",{src:`/img/users/${n.photo}`,alt:n.name,className:"reviews__avatar-img"}),Q.jsx("h6",{className:"reviews__user",children:n.name})]}),Q.jsx("p",{className:"reviews__text",children:e.review}),Q.jsxs("div",{className:"reviews__rating",children:[Q.jsx("svg",{className:e.rating>0?l:h,children:Q.jsx("use",{xlinkHref:"/img/icons.svg#icon-star"})}),Q.jsx("svg",{className:e.rating>1?l:h,children:Q.jsx("use",{xlinkHref:"/img/icons.svg#icon-star"})}),Q.jsx("svg",{className:e.rating>2?l:h,children:Q.jsx("use",{xlinkHref:"/img/icons.svg#icon-star"})}),Q.jsx("svg",{className:e.rating>3?l:h,children:Q.jsx("use",{xlinkHref:"/img/icons.svg#icon-star"})}),Q.jsx("svg",{className:e.rating>3?l:h,children:Q.jsx("use",{xlinkHref:"/img/icons.svg#icon-star"})})]})]})},xB=({guide:e})=>Q.jsxs("div",{className:"overview-box__detail",children:[Q.jsx("img",{src:`/img/users/${e.photo}`,alt:"Lead guide",className:"overview-box__img"}),e.role==="lead-guide"?Q.jsx("span",{className:"overview-box__label",children:"Lead guide"}):Q.jsx("span",{className:"overview-box__label",children:"Tour guide"}),Q.jsx("span",{className:"overview-box__text",children:e.name})]}),wB=()=>{const{tourSlug:e}=kL(),[n,l]=Te.useState(),h=aB(),m=Fh(),y=Ca(),{auth:b}=Aa(),s=b.user;if(console.log(s),Te.useEffect(()=>{let V=!0;const $=new AbortController;return(async()=>{try{const Y=await h.get(`/tours/${e}`);V&&l(Y.data.data)}catch(Y){console.error(Y),m("/login",{state:{from:y},replace:!0})}})(),()=>{V=!1,$.abort()}},[]),!n)return Q.jsx("div",{children:"Loading..."});const A=n.startDates&&new Date(n.startDates[0]),R=A==null?void 0:A.toLocaleString("en-US",{year:"numeric",month:"long"}),U=n.description.split(`
`);return Q.jsx(Q.Fragment,{children:Q.jsxs(Ac,{children:[Q.jsxs(tf,{children:[Q.jsxs("title",{children:[n.name," Tour "]}),Q.jsx("link",{href:"https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css",rel:"stylesheet"}),Q.jsx("script",{src:"../mapBox.ts",defer:!0})]}),Q.jsxs("section",{className:"section-header",children:[Q.jsxs("div",{className:"heading-hero",children:[Q.jsx("div",{className:"header__hero-overlay"}),Q.jsx("img",{className:"header__hero-img",src:`/img/tours/${n.imageCover}`,alt:n.name})]}),Q.jsxs("div",{className:"heading-box",children:[Q.jsx("h1",{className:"heading-primary",children:Q.jsxs("span",{children:[n.name," tour ",Q.jsx("br",{})]})}),Q.jsxs("div",{className:"heading-box__group",children:[Q.jsxs("div",{className:"heading-box__detail",children:[Q.jsx("svg",{className:"heading-box__icon",children:Q.jsx("use",{xlinkHref:"img/icons.svg#icon-clock"})}),Q.jsxs("span",{className:"heading-box__text",children:[n.duration," days"]})]}),Q.jsxs("div",{className:"heading-box__detail",children:[Q.jsx("svg",{className:"heading-box__icon",children:Q.jsx("use",{xlinkHref:"img/icons.svg#icon-map-pin"})}),Q.jsx("span",{className:"heading-box__text",children:n.startLocation.description})]})]})]})]}),Q.jsxs("section",{className:"section-description",children:[Q.jsx("div",{className:"overview-box",children:Q.jsxs("div",{children:[Q.jsxs("div",{className:"overview-box__group",children:[Q.jsx("h2",{className:"heading-secondary ma-bt-lg",children:"Quick facts"}),Q.jsx(zg,{label:"Next date",text:R,icon:"calendar"}),Q.jsx(zg,{label:"Difficulty",text:n.difficulty,icon:"trending-up"}),Q.jsx(zg,{label:"Participants",text:`${n.maxGroupSize} people`,icon:"user"}),Q.jsx(zg,{label:"Rating",text:`${n.ratingsAverage} / 5`,icon:"star"})]}),Q.jsxs("div",{className:"overview-box__group",children:[Q.jsx("h2",{className:"heading-secondary ma-bt-lg",children:"Your tour guides"}),Q.jsx(Q.Fragment,{children:n.guides.map(V=>Q.jsx(xB,{guide:V},V.name))})]})]})}),Q.jsxs("div",{className:"description-box",children:[Q.jsxs("h2",{className:"heading-secondary ma-bt-lg",children:["About ",n.name," tour"]}),U.map((V,$)=>Q.jsx("p",{className:"description__text",children:V},$))]})]}),Q.jsx("section",{className:"section-pictures",children:n.images.map((V,$)=>Q.jsx(yB,{img:V,i:$,tourName:n.name},$))}),Q.jsx("section",{className:"section-map",children:Q.jsx(_B,{data:n})}),Q.jsx("section",{className:"section-reviews",children:Q.jsx("div",{className:"reviews",children:n.reviews.map((V,$)=>Q.jsx(vB,{review:V},$))})}),Q.jsx("section",{className:"section-cta",children:Q.jsxs("div",{className:"cta",children:[Q.jsx("div",{className:"cta__img cta__img--logo",children:Q.jsx("img",{src:"/img/logo-white.png",alt:"Natours logo",className:""})}),Q.jsx("img",{src:`/img/tours/${n.images[1]}`,alt:"Tour picture 1",className:"cta__img cta__img--1"}),Q.jsx("img",{src:`/img/tours/${n.images[2]}`,alt:"Tour picture 2",className:"cta__img cta__img--2"}),Q.jsxs("div",{className:"cta__content",children:[Q.jsx("h2",{className:"heading-secondary",children:"What are you waiting for?"}),Q.jsxs("p",{className:"cta__text",children:[n.duration," days. 1 adventure. Infinite memories. Make it yours today!"]}),Q.jsx(mB,{tourSlug:n.slug})]})]})})]})})},bB="/assets/error-login-2ad048f8.svg",EB=({})=>{var Y,K;const[e,n]=Te.useState(""),[l,h]=Te.useState(""),[m,y]=Te.useState(""),b=Fh(),A=((K=(Y=Ca().state)==null?void 0:Y.from)==null?void 0:K.pathname)||"/",{auth:R,dispatchAuth:U}=Aa(),V=Ce=>{n(Ce.target.value)},$=Ce=>{h(Ce.target.value)},pe=async Ce=>{Ce.preventDefault();try{const ee=await EO(e,l);console.log("Login successful:",ee),R.user||U({type:"logging",payload:{user:ee.data.user,accessToken:ee.accessToken}}),n(""),h(""),y(""),b(A,{replace:!0})}catch(ee){console.log("Login error:",ee.response.data),n(""),h(""),y("Please provide a valid email and password")}};return Q.jsx("main",{className:"main",children:Q.jsxs("div",{className:"login-form",children:[Q.jsx("h2",{className:"heading-secondary ma-bt-lg",children:"Log into your account"}),Q.jsxs("form",{className:"form",onSubmit:pe,children:[Q.jsxs("div",{className:"form__group",children:[Q.jsx("label",{className:"form__label",htmlFor:"email",children:"Email address"}),Q.jsx("input",{id:"email",className:"form__input",type:"email",placeholder:"you@example.com",value:e,onChange:V,required:!0})]}),Q.jsxs("div",{className:"form__group ma-bt-md",children:[Q.jsx("label",{className:"form__label",htmlFor:"password",children:"Password"}),Q.jsx("input",{id:"password",className:"form__input",type:"password",placeholder:"••••••••",value:l,onChange:$,required:!0,minLength:8})]}),m&&Q.jsxs("div",{className:"error-login-background",style:{display:"flex"},children:[Q.jsx("div",{style:{display:"flex",alignItems:"center"},children:Q.jsx("img",{src:bB,style:{height:"20px",marginRight:"20px"}})}),Q.jsx("div",{className:"error-login",children:m})]}),Q.jsx("div",{className:"form__group",children:Q.jsx("button",{className:"btn btn--green",children:"Login"})})]})]})})},$p=()=>{const e=gM();return console.log(e),Q.jsx("main",{className:"main",children:Q.jsxs("div",{className:"error",children:[Q.jsxs("div",{className:"error__title",children:[Q.jsx("h2",{className:"heading-secondary heading-secondary--error",children:"Uh oh! Something went wrong!"}),Q.jsx("h2",{className:"error__emoji",children:"😢 🤯"})]}),Q.jsx("div",{className:"error__msg",children:"Page not found!"})]})})},TB=({allowedRoles:e})=>{var y;const{auth:n}=Aa(),l=Ca(),h=((y=n==null?void 0:n.user)==null?void 0:y.role)||"";return e.includes(h)?Q.jsx(hw,{}):Q.jsxs(Q.Fragment,{children:[Q.jsx($p,{}),Q.jsx(GL,{to:"/login",state:{from:l},replace:!0})]})},SB=()=>{const[e,n]=Te.useState(!0),l=UM(),{auth:h}=Aa();return Te.useEffect(()=>{const m=async()=>{try{await l()}catch(y){console.log(y)}finally{n(!1)}};h!=null&&h.accessToken?n(!1):m()},[h.accessToken,l]),Q.jsx(Q.Fragment,{children:e?Q.jsx("p",{children:"Loading..."}):Q.jsx(hw,{})})},cl=({link:e,text:n,icon:l,active:h})=>Q.jsx("li",{className:`${h?"side-nav--active":""}`,children:Q.jsxs("a",{href:e,children:[Q.jsx("svg",{children:Q.jsx("use",{xlinkHref:`/img/icons.svg#icon-${l}`})}),n]})});function Cr(e,n){if(e==null)return{};var l={},h=Object.keys(e),m,y;for(y=0;y<h.length;y++)m=h[y],!(n.indexOf(m)>=0)&&(l[m]=e[m]);return l}function ft(){return ft=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(e[h]=l[h])}return e},ft.apply(this,arguments)}function CB(e){return typeof e=="string"}function AB(e,n,l){return e===void 0||CB(e)?n:ft({},n,{ownerState:ft({},n.ownerState,l)})}function ZM(e,n=[]){if(e===void 0)return{};const l={};return Object.keys(e).filter(h=>h.match(/^on[A-Z]/)&&typeof e[h]=="function"&&!n.includes(h)).forEach(h=>{l[h]=e[h]}),l}function MB(e,n,l){return typeof e=="function"?e(n,l):e}function Zu(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function HM(e){if(!Zu(e))return e;const n={};return Object.keys(e).forEach(l=>{n[l]=HM(e[l])}),n}function ya(e,n,l={clone:!0}){const h=l.clone?ft({},e):e;return Zu(e)&&Zu(n)&&Object.keys(n).forEach(m=>{m!=="__proto__"&&(Zu(n[m])&&m in e&&Zu(e[m])?h[m]=ya(e[m],n[m],l):l.clone?h[m]=Zu(n[m])?HM(n[m]):n[m]:h[m]=n[m])}),h}function Ih(e){let n="https://mui.com/production-error/?code="+e;for(let l=1;l<arguments.length;l+=1)n+="&args[]="+encodeURIComponent(arguments[l]);return"Minified MUI error #"+e+"; visit "+n+" for the full message."}function zn(e){if(typeof e!="string")throw new Error(Ih(7));return e.charAt(0).toUpperCase()+e.slice(1)}function IB(...e){return e.reduce((n,l)=>l==null?n:function(...m){n.apply(this,m),l.apply(this,m)},()=>{})}function kB(e,n=166){let l;function h(...m){const y=()=>{e.apply(this,m)};clearTimeout(l),l=setTimeout(y,n)}return h.clear=()=>{clearTimeout(l)},h}function PB(e,n){return()=>null}function zB(e,n){return Te.isValidElement(e)&&n.indexOf(e.type.muiName)!==-1}function nf(e){return e&&e.ownerDocument||document}function RB(e){return nf(e).defaultView||window}function DB(e,n){return()=>null}function XM(e,n){typeof e=="function"?e(n):e&&(e.current=n)}const LB=typeof window<"u"?Te.useLayoutEffect:Te.useEffect,KM=LB;let sS=0;function OB(e){const[n,l]=Te.useState(e),h=e||n;return Te.useEffect(()=>{n==null&&(sS+=1,l(`mui-${sS}`))},[n]),h}const aS=i_["useId".toString()];function BB(e){if(aS!==void 0){const n=aS();return e??n}return OB(e)}function FB(e,n,l,h,m){return null}function NB({controlled:e,default:n,name:l,state:h="value"}){const{current:m}=Te.useRef(e!==void 0),[y,b]=Te.useState(n),s=m?e:y,A=Te.useCallback(R=>{m||b(R)},[]);return[s,A]}function gl(e){const n=Te.useRef(e);return KM(()=>{n.current=e}),Te.useCallback((...l)=>(0,n.current)(...l),[])}function kh(...e){return Te.useMemo(()=>e.every(n=>n==null)?null:n=>{e.forEach(l=>{XM(l,n)})},e)}let cy=!0,o1=!1,lS;const jB={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function UB(e){const{type:n,tagName:l}=e;return!!(l==="INPUT"&&jB[n]&&!e.readOnly||l==="TEXTAREA"&&!e.readOnly||e.isContentEditable)}function VB(e){e.metaKey||e.altKey||e.ctrlKey||(cy=!0)}function qv(){cy=!1}function $B(){this.visibilityState==="hidden"&&o1&&(cy=!0)}function GB(e){e.addEventListener("keydown",VB,!0),e.addEventListener("mousedown",qv,!0),e.addEventListener("pointerdown",qv,!0),e.addEventListener("touchstart",qv,!0),e.addEventListener("visibilitychange",$B,!0)}function qB(e){const{target:n}=e;try{return n.matches(":focus-visible")}catch{}return cy||UB(n)}function YM(){const e=Te.useCallback(m=>{m!=null&&GB(m.ownerDocument)},[]),n=Te.useRef(!1);function l(){return n.current?(o1=!0,window.clearTimeout(lS),lS=window.setTimeout(()=>{o1=!1},100),n.current=!1,!0):!1}function h(m){return qB(m)?(n.current=!0,!0):!1}return{isFocusVisibleRef:n,onFocus:h,onBlur:l,ref:e}}function yw(e,n){const l=ft({},n);return Object.keys(e).forEach(h=>{if(h.toString().match(/^(components|slots)$/))l[h]=ft({},e[h],l[h]);else if(h.toString().match(/^(componentsProps|slotProps)$/)){const m=e[h]||{},y=n[h];l[h]={},!y||!Object.keys(y)?l[h]=m:!m||!Object.keys(m)?l[h]=y:(l[h]=ft({},y),Object.keys(m).forEach(b=>{l[h][b]=yw(m[b],y[b])}))}else l[h]===void 0&&(l[h]=e[h])}),l}function Pl(e,n,l=void 0){const h={};return Object.keys(e).forEach(m=>{h[m]=e[m].reduce((y,b)=>{if(b){const s=n(b);s!==""&&y.push(s),l&&l[b]&&y.push(l[b])}return y},[]).join(" ")}),h}const cS=e=>e,WB=()=>{let e=cS;return{configure(n){e=n},generate(n){return e(n)},reset(){e=cS}}},ZB=WB(),JM=ZB,HB={active:"active",checked:"checked",completed:"completed",disabled:"disabled",readOnly:"readOnly",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function Ma(e,n,l="Mui"){const h=HB[n];return h?`${l}-${h}`:`${JM.generate(e)}-${n}`}function Ia(e,n,l="Mui"){const h={};return n.forEach(m=>{h[m]=Ma(e,m,l)}),h}function QM(e){var n,l,h="";if(typeof e=="string"||typeof e=="number")h+=e;else if(typeof e=="object")if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(l=QM(e[n]))&&(h&&(h+=" "),h+=l);else for(n in e)e[n]&&(h&&(h+=" "),h+=n);return h}function Kr(){for(var e,n,l=0,h="";l<arguments.length;)(e=arguments[l++])&&(n=QM(e))&&(h&&(h+=" "),h+=n);return h}function uS(e){if(e===void 0)return{};const n={};return Object.keys(e).filter(l=>!(l.match(/^on[A-Z]/)&&typeof e[l]=="function")).forEach(l=>{n[l]=e[l]}),n}function XB(e){const{getSlotProps:n,additionalProps:l,externalSlotProps:h,externalForwardedProps:m,className:y}=e;if(!n){const pe=Kr(m==null?void 0:m.className,h==null?void 0:h.className,y,l==null?void 0:l.className),Y=ft({},l==null?void 0:l.style,m==null?void 0:m.style,h==null?void 0:h.style),K=ft({},l,m,h);return pe.length>0&&(K.className=pe),Object.keys(Y).length>0&&(K.style=Y),{props:K,internalRef:void 0}}const b=ZM(ft({},m,h)),s=uS(h),A=uS(m),R=n(b),U=Kr(R==null?void 0:R.className,l==null?void 0:l.className,y,m==null?void 0:m.className,h==null?void 0:h.className),V=ft({},R==null?void 0:R.style,l==null?void 0:l.style,m==null?void 0:m.style,h==null?void 0:h.style),$=ft({},R,l,A,s);return U.length>0&&($.className=U),Object.keys(V).length>0&&($.style=V),{props:$,internalRef:R.ref}}const KB=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function YB(e){var n;const{elementType:l,externalSlotProps:h,ownerState:m,skipResolvingSlotProps:y=!1}=e,b=Cr(e,KB),s=y?{}:MB(h,m),{props:A,internalRef:R}=XB(ft({},b,{externalSlotProps:s})),U=kh(R,s==null?void 0:s.ref,(n=e.additionalProps)==null?void 0:n.ref);return AB(l,ft({},A,{ref:U}),m)}function hS(e){return e.substring(2).toLowerCase()}function JB(e,n){return n.documentElement.clientWidth<e.clientX||n.documentElement.clientHeight<e.clientY}function QB(e){const{children:n,disableReactTree:l=!1,mouseEvent:h="onClick",onClickAway:m,touchEvent:y="onTouchEnd"}=e,b=Te.useRef(!1),s=Te.useRef(null),A=Te.useRef(!1),R=Te.useRef(!1);Te.useEffect(()=>(setTimeout(()=>{A.current=!0},0),()=>{A.current=!1}),[]);const U=kh(n.ref,s),V=gl(Y=>{const K=R.current;R.current=!1;const Ce=nf(s.current);if(!A.current||!s.current||"clientX"in Y&&JB(Y,Ce))return;if(b.current){b.current=!1;return}let ee;Y.composedPath?ee=Y.composedPath().indexOf(s.current)>-1:ee=!Ce.documentElement.contains(Y.target)||s.current.contains(Y.target),!ee&&(l||!K)&&m(Y)}),$=Y=>K=>{R.current=!0;const Ce=n.props[Y];Ce&&Ce(K)},pe={ref:U};return y!==!1&&(pe[y]=$(y)),Te.useEffect(()=>{if(y!==!1){const Y=hS(y),K=nf(s.current),Ce=()=>{b.current=!0};return K.addEventListener(Y,V),K.addEventListener("touchmove",Ce),()=>{K.removeEventListener(Y,V),K.removeEventListener("touchmove",Ce)}}},[V,y]),h!==!1&&(pe[h]=$(h)),Te.useEffect(()=>{if(h!==!1){const Y=hS(h),K=nf(s.current);return K.addEventListener(Y,V),()=>{K.removeEventListener(Y,V)}}},[V,h]),Q.jsx(Te.Fragment,{children:Te.cloneElement(n,pe)})}function e5(e){const{autoHideDuration:n=null,disableWindowBlurListener:l=!1,onClose:h,open:m,resumeHideDuration:y}=e,b=Te.useRef();Te.useEffect(()=>{if(!m)return;function ee(ne){ne.defaultPrevented||(ne.key==="Escape"||ne.key==="Esc")&&(h==null||h(ne,"escapeKeyDown"))}return document.addEventListener("keydown",ee),()=>{document.removeEventListener("keydown",ee)}},[m,h]);const s=gl((ee,ne)=>{h==null||h(ee,ne)}),A=gl(ee=>{!h||ee==null||(clearTimeout(b.current),b.current=setTimeout(()=>{s(null,"timeout")},ee))});Te.useEffect(()=>(m&&A(n),()=>{clearTimeout(b.current)}),[m,n,A]);const R=ee=>{h==null||h(ee,"clickaway")},U=()=>{clearTimeout(b.current)},V=Te.useCallback(()=>{n!=null&&A(y??n*.5)},[n,y,A]),$=ee=>ne=>{const ce=ee.onBlur;ce==null||ce(ne),V()},pe=ee=>ne=>{const ce=ee.onFocus;ce==null||ce(ne),U()},Y=ee=>ne=>{const ce=ee.onMouseEnter;ce==null||ce(ne),U()},K=ee=>ne=>{const ce=ee.onMouseLeave;ce==null||ce(ne),V()};return Te.useEffect(()=>{if(!l&&m)return window.addEventListener("focus",V),window.addEventListener("blur",U),()=>{window.removeEventListener("focus",V),window.removeEventListener("blur",U)}},[l,V,m]),{getRootProps:(ee={})=>{const ne=ZM(e),ce=ft({},ne,ee);return ft({role:"presentation"},ce,{onBlur:$(ce),onFocus:pe(ce),onMouseEnter:Y(ce),onMouseLeave:K(ce)})},onClickAway:R}}function eI(e){var n=Object.create(null);return function(l){return n[l]===void 0&&(n[l]=e(l)),n[l]}}var t5=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,n5=eI(function(e){return t5.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91});function r5(e){if(e.sheet)return e.sheet;for(var n=0;n<document.styleSheets.length;n++)if(document.styleSheets[n].ownerNode===e)return document.styleSheets[n]}function i5(e){var n=document.createElement("style");return n.setAttribute("data-emotion",e.key),e.nonce!==void 0&&n.setAttribute("nonce",e.nonce),n.appendChild(document.createTextNode("")),n.setAttribute("data-s",""),n}var o5=function(){function e(l){var h=this;this._insertTag=function(m){var y;h.tags.length===0?h.insertionPoint?y=h.insertionPoint.nextSibling:h.prepend?y=h.container.firstChild:y=h.before:y=h.tags[h.tags.length-1].nextSibling,h.container.insertBefore(m,y),h.tags.push(m)},this.isSpeedy=l.speedy===void 0?!0:l.speedy,this.tags=[],this.ctr=0,this.nonce=l.nonce,this.key=l.key,this.container=l.container,this.prepend=l.prepend,this.insertionPoint=l.insertionPoint,this.before=null}var n=e.prototype;return n.hydrate=function(h){h.forEach(this._insertTag)},n.insert=function(h){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(i5(this));var m=this.tags[this.tags.length-1];if(this.isSpeedy){var y=r5(m);try{y.insertRule(h,y.cssRules.length)}catch{}}else m.appendChild(document.createTextNode(h));this.ctr++},n.flush=function(){this.tags.forEach(function(h){return h.parentNode&&h.parentNode.removeChild(h)}),this.tags=[],this.ctr=0},e}(),Ci="-ms-",R_="-moz-",jn="-webkit-",tI="comm",vw="rule",xw="decl",s5="@import",nI="@keyframes",a5="@layer",l5=Math.abs,uy=String.fromCharCode,c5=Object.assign;function u5(e,n){return ui(e,0)^45?(((n<<2^ui(e,0))<<2^ui(e,1))<<2^ui(e,2))<<2^ui(e,3):0}function rI(e){return e.trim()}function h5(e,n){return(e=n.exec(e))?e[0]:e}function Un(e,n,l){return e.replace(n,l)}function s1(e,n){return e.indexOf(n)}function ui(e,n){return e.charCodeAt(n)|0}function Sf(e,n,l){return e.slice(n,l)}function Ls(e){return e.length}function ww(e){return e.length}function Dg(e,n){return n.push(e),e}function d5(e,n){return e.map(n).join("")}var hy=1,Ph=1,iI=0,to=0,Vr=0,jh="";function dy(e,n,l,h,m,y,b){return{value:e,root:n,parent:l,type:h,props:m,children:y,line:hy,column:Ph,length:b,return:""}}function Op(e,n){return c5(dy("",null,null,"",null,null,0),e,{length:-e.length},n)}function p5(){return Vr}function f5(){return Vr=to>0?ui(jh,--to):0,Ph--,Vr===10&&(Ph=1,hy--),Vr}function mo(){return Vr=to<iI?ui(jh,to++):0,Ph++,Vr===10&&(Ph=1,hy++),Vr}function Vs(){return ui(jh,to)}function e_(){return to}function Ff(e,n){return Sf(jh,e,n)}function Cf(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function oI(e){return hy=Ph=1,iI=Ls(jh=e),to=0,[]}function sI(e){return jh="",e}function t_(e){return rI(Ff(to-1,a1(e===91?e+2:e===40?e+1:e)))}function m5(e){for(;(Vr=Vs())&&Vr<33;)mo();return Cf(e)>2||Cf(Vr)>3?"":" "}function g5(e,n){for(;--n&&mo()&&!(Vr<48||Vr>102||Vr>57&&Vr<65||Vr>70&&Vr<97););return Ff(e,e_()+(n<6&&Vs()==32&&mo()==32))}function a1(e){for(;mo();)switch(Vr){case e:return to;case 34:case 39:e!==34&&e!==39&&a1(Vr);break;case 40:e===41&&a1(e);break;case 92:mo();break}return to}function _5(e,n){for(;mo()&&e+Vr!==47+10;)if(e+Vr===42+42&&Vs()===47)break;return"/*"+Ff(n,to-1)+"*"+uy(e===47?e:mo())}function y5(e){for(;!Cf(Vs());)mo();return Ff(e,to)}function v5(e){return sI(n_("",null,null,null,[""],e=oI(e),0,[0],e))}function n_(e,n,l,h,m,y,b,s,A){for(var R=0,U=0,V=b,$=0,pe=0,Y=0,K=1,Ce=1,ee=1,ne=0,ce="",se=m,De=y,He=h,Be=ce;Ce;)switch(Y=ne,ne=mo()){case 40:if(Y!=108&&ui(Be,V-1)==58){s1(Be+=Un(t_(ne),"&","&\f"),"&\f")!=-1&&(ee=-1);break}case 34:case 39:case 91:Be+=t_(ne);break;case 9:case 10:case 13:case 32:Be+=m5(Y);break;case 92:Be+=g5(e_()-1,7);continue;case 47:switch(Vs()){case 42:case 47:Dg(x5(_5(mo(),e_()),n,l),A);break;default:Be+="/"}break;case 123*K:s[R++]=Ls(Be)*ee;case 125*K:case 59:case 0:switch(ne){case 0:case 125:Ce=0;case 59+U:ee==-1&&(Be=Un(Be,/\f/g,"")),pe>0&&Ls(Be)-V&&Dg(pe>32?pS(Be+";",h,l,V-1):pS(Un(Be," ","")+";",h,l,V-2),A);break;case 59:Be+=";";default:if(Dg(He=dS(Be,n,l,R,U,m,s,ce,se=[],De=[],V),y),ne===123)if(U===0)n_(Be,n,He,He,se,y,V,s,De);else switch($===99&&ui(Be,3)===110?100:$){case 100:case 108:case 109:case 115:n_(e,He,He,h&&Dg(dS(e,He,He,0,0,m,s,ce,m,se=[],V),De),m,De,V,s,h?se:De);break;default:n_(Be,He,He,He,[""],De,0,s,De)}}R=U=pe=0,K=ee=1,ce=Be="",V=b;break;case 58:V=1+Ls(Be),pe=Y;default:if(K<1){if(ne==123)--K;else if(ne==125&&K++==0&&f5()==125)continue}switch(Be+=uy(ne),ne*K){case 38:ee=U>0?1:(Be+="\f",-1);break;case 44:s[R++]=(Ls(Be)-1)*ee,ee=1;break;case 64:Vs()===45&&(Be+=t_(mo())),$=Vs(),U=V=Ls(ce=Be+=y5(e_())),ne++;break;case 45:Y===45&&Ls(Be)==2&&(K=0)}}return y}function dS(e,n,l,h,m,y,b,s,A,R,U){for(var V=m-1,$=m===0?y:[""],pe=ww($),Y=0,K=0,Ce=0;Y<h;++Y)for(var ee=0,ne=Sf(e,V+1,V=l5(K=b[Y])),ce=e;ee<pe;++ee)(ce=rI(K>0?$[ee]+" "+ne:Un(ne,/&\f/g,$[ee])))&&(A[Ce++]=ce);return dy(e,n,l,m===0?vw:s,A,R,U)}function x5(e,n,l){return dy(e,n,l,tI,uy(p5()),Sf(e,2,-2),0)}function pS(e,n,l,h){return dy(e,n,l,xw,Sf(e,0,h),Sf(e,h+1,-1),h)}function _h(e,n){for(var l="",h=ww(e),m=0;m<h;m++)l+=n(e[m],m,e,n)||"";return l}function w5(e,n,l,h){switch(e.type){case a5:if(e.children.length)break;case s5:case xw:return e.return=e.return||e.value;case tI:return"";case nI:return e.return=e.value+"{"+_h(e.children,h)+"}";case vw:e.value=e.props.join(",")}return Ls(l=_h(e.children,h))?e.return=e.value+"{"+l+"}":""}function b5(e){var n=ww(e);return function(l,h,m,y){for(var b="",s=0;s<n;s++)b+=e[s](l,h,m,y)||"";return b}}function E5(e){return function(n){n.root||(n=n.return)&&e(n)}}var T5=function(n,l,h){for(var m=0,y=0;m=y,y=Vs(),m===38&&y===12&&(l[h]=1),!Cf(y);)mo();return Ff(n,to)},S5=function(n,l){var h=-1,m=44;do switch(Cf(m)){case 0:m===38&&Vs()===12&&(l[h]=1),n[h]+=T5(to-1,l,h);break;case 2:n[h]+=t_(m);break;case 4:if(m===44){n[++h]=Vs()===58?"&\f":"",l[h]=n[h].length;break}default:n[h]+=uy(m)}while(m=mo());return n},C5=function(n,l){return sI(S5(oI(n),l))},fS=new WeakMap,A5=function(n){if(!(n.type!=="rule"||!n.parent||n.length<1)){for(var l=n.value,h=n.parent,m=n.column===h.column&&n.line===h.line;h.type!=="rule";)if(h=h.parent,!h)return;if(!(n.props.length===1&&l.charCodeAt(0)!==58&&!fS.get(h))&&!m){fS.set(n,!0);for(var y=[],b=C5(l,y),s=h.props,A=0,R=0;A<b.length;A++)for(var U=0;U<s.length;U++,R++)n.props[R]=y[A]?b[A].replace(/&\f/g,s[U]):s[U]+" "+b[A]}}},M5=function(n){if(n.type==="decl"){var l=n.value;l.charCodeAt(0)===108&&l.charCodeAt(2)===98&&(n.return="",n.value="")}};function aI(e,n){switch(u5(e,n)){case 5103:return jn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return jn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return jn+e+R_+e+Ci+e+e;case 6828:case 4268:return jn+e+Ci+e+e;case 6165:return jn+e+Ci+"flex-"+e+e;case 5187:return jn+e+Un(e,/(\w+).+(:[^]+)/,jn+"box-$1$2"+Ci+"flex-$1$2")+e;case 5443:return jn+e+Ci+"flex-item-"+Un(e,/flex-|-self/,"")+e;case 4675:return jn+e+Ci+"flex-line-pack"+Un(e,/align-content|flex-|-self/,"")+e;case 5548:return jn+e+Ci+Un(e,"shrink","negative")+e;case 5292:return jn+e+Ci+Un(e,"basis","preferred-size")+e;case 6060:return jn+"box-"+Un(e,"-grow","")+jn+e+Ci+Un(e,"grow","positive")+e;case 4554:return jn+Un(e,/([^-])(transform)/g,"$1"+jn+"$2")+e;case 6187:return Un(Un(Un(e,/(zoom-|grab)/,jn+"$1"),/(image-set)/,jn+"$1"),e,"")+e;case 5495:case 3959:return Un(e,/(image-set\([^]*)/,jn+"$1$`$1");case 4968:return Un(Un(e,/(.+:)(flex-)?(.*)/,jn+"box-pack:$3"+Ci+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+jn+e+e;case 4095:case 3583:case 4068:case 2532:return Un(e,/(.+)-inline(.+)/,jn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ls(e)-1-n>6)switch(ui(e,n+1)){case 109:if(ui(e,n+4)!==45)break;case 102:return Un(e,/(.+:)(.+)-([^]+)/,"$1"+jn+"$2-$3$1"+R_+(ui(e,n+3)==108?"$3":"$2-$3"))+e;case 115:return~s1(e,"stretch")?aI(Un(e,"stretch","fill-available"),n)+e:e}break;case 4949:if(ui(e,n+1)!==115)break;case 6444:switch(ui(e,Ls(e)-3-(~s1(e,"!important")&&10))){case 107:return Un(e,":",":"+jn)+e;case 101:return Un(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+jn+(ui(e,14)===45?"inline-":"")+"box$3$1"+jn+"$2$3$1"+Ci+"$2box$3")+e}break;case 5936:switch(ui(e,n+11)){case 114:return jn+e+Ci+Un(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return jn+e+Ci+Un(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return jn+e+Ci+Un(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return jn+e+Ci+e+e}return e}var I5=function(n,l,h,m){if(n.length>-1&&!n.return)switch(n.type){case xw:n.return=aI(n.value,n.length);break;case nI:return _h([Op(n,{value:Un(n.value,"@","@"+jn)})],m);case vw:if(n.length)return d5(n.props,function(y){switch(h5(y,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return _h([Op(n,{props:[Un(y,/:(read-\w+)/,":"+R_+"$1")]})],m);case"::placeholder":return _h([Op(n,{props:[Un(y,/:(plac\w+)/,":"+jn+"input-$1")]}),Op(n,{props:[Un(y,/:(plac\w+)/,":"+R_+"$1")]}),Op(n,{props:[Un(y,/:(plac\w+)/,Ci+"input-$1")]})],m)}return""})}},k5=[I5],P5=function(n){var l=n.key;if(l==="css"){var h=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(h,function(K){var Ce=K.getAttribute("data-emotion");Ce.indexOf(" ")!==-1&&(document.head.appendChild(K),K.setAttribute("data-s",""))})}var m=n.stylisPlugins||k5,y={},b,s=[];b=n.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+l+' "]'),function(K){for(var Ce=K.getAttribute("data-emotion").split(" "),ee=1;ee<Ce.length;ee++)y[Ce[ee]]=!0;s.push(K)});var A,R=[A5,M5];{var U,V=[w5,E5(function(K){U.insert(K)})],$=b5(R.concat(m,V)),pe=function(Ce){return _h(v5(Ce),$)};A=function(Ce,ee,ne,ce){U=ne,pe(Ce?Ce+"{"+ee.styles+"}":ee.styles),ce&&(Y.inserted[ee.name]=!0)}}var Y={key:l,sheet:new o5({key:l,container:b,nonce:n.nonce,speedy:n.speedy,prepend:n.prepend,insertionPoint:n.insertionPoint}),nonce:n.nonce,inserted:y,registered:{},insert:A};return Y.sheet.hydrate(s),Y},lI={exports:{}},Zn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var si=typeof Symbol=="function"&&Symbol.for,bw=si?Symbol.for("react.element"):60103,Ew=si?Symbol.for("react.portal"):60106,py=si?Symbol.for("react.fragment"):60107,fy=si?Symbol.for("react.strict_mode"):60108,my=si?Symbol.for("react.profiler"):60114,gy=si?Symbol.for("react.provider"):60109,_y=si?Symbol.for("react.context"):60110,Tw=si?Symbol.for("react.async_mode"):60111,yy=si?Symbol.for("react.concurrent_mode"):60111,vy=si?Symbol.for("react.forward_ref"):60112,xy=si?Symbol.for("react.suspense"):60113,z5=si?Symbol.for("react.suspense_list"):60120,wy=si?Symbol.for("react.memo"):60115,by=si?Symbol.for("react.lazy"):60116,R5=si?Symbol.for("react.block"):60121,D5=si?Symbol.for("react.fundamental"):60117,L5=si?Symbol.for("react.responder"):60118,O5=si?Symbol.for("react.scope"):60119;function vo(e){if(typeof e=="object"&&e!==null){var n=e.$$typeof;switch(n){case bw:switch(e=e.type,e){case Tw:case yy:case py:case my:case fy:case xy:return e;default:switch(e=e&&e.$$typeof,e){case _y:case vy:case by:case wy:case gy:return e;default:return n}}case Ew:return n}}}function cI(e){return vo(e)===yy}Zn.AsyncMode=Tw;Zn.ConcurrentMode=yy;Zn.ContextConsumer=_y;Zn.ContextProvider=gy;Zn.Element=bw;Zn.ForwardRef=vy;Zn.Fragment=py;Zn.Lazy=by;Zn.Memo=wy;Zn.Portal=Ew;Zn.Profiler=my;Zn.StrictMode=fy;Zn.Suspense=xy;Zn.isAsyncMode=function(e){return cI(e)||vo(e)===Tw};Zn.isConcurrentMode=cI;Zn.isContextConsumer=function(e){return vo(e)===_y};Zn.isContextProvider=function(e){return vo(e)===gy};Zn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===bw};Zn.isForwardRef=function(e){return vo(e)===vy};Zn.isFragment=function(e){return vo(e)===py};Zn.isLazy=function(e){return vo(e)===by};Zn.isMemo=function(e){return vo(e)===wy};Zn.isPortal=function(e){return vo(e)===Ew};Zn.isProfiler=function(e){return vo(e)===my};Zn.isStrictMode=function(e){return vo(e)===fy};Zn.isSuspense=function(e){return vo(e)===xy};Zn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===py||e===yy||e===my||e===fy||e===xy||e===z5||typeof e=="object"&&e!==null&&(e.$$typeof===by||e.$$typeof===wy||e.$$typeof===gy||e.$$typeof===_y||e.$$typeof===vy||e.$$typeof===D5||e.$$typeof===L5||e.$$typeof===O5||e.$$typeof===R5)};Zn.typeOf=vo;lI.exports=Zn;var B5=lI.exports,uI=B5,F5={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},N5={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},hI={};hI[uI.ForwardRef]=F5;hI[uI.Memo]=N5;var j5=!0;function U5(e,n,l){var h="";return l.split(" ").forEach(function(m){e[m]!==void 0?n.push(e[m]+";"):h+=m+" "}),h}var dI=function(n,l,h){var m=n.key+"-"+l.name;(h===!1||j5===!1)&&n.registered[m]===void 0&&(n.registered[m]=l.styles)},V5=function(n,l,h){dI(n,l,h);var m=n.key+"-"+l.name;if(n.inserted[l.name]===void 0){var y=l;do n.insert(l===y?"."+m:"",y,n.sheet,!0),y=y.next;while(y!==void 0)}};function $5(e){for(var n=0,l,h=0,m=e.length;m>=4;++h,m-=4)l=e.charCodeAt(h)&255|(e.charCodeAt(++h)&255)<<8|(e.charCodeAt(++h)&255)<<16|(e.charCodeAt(++h)&255)<<24,l=(l&65535)*1540483477+((l>>>16)*59797<<16),l^=l>>>24,n=(l&65535)*1540483477+((l>>>16)*59797<<16)^(n&65535)*1540483477+((n>>>16)*59797<<16);switch(m){case 3:n^=(e.charCodeAt(h+2)&255)<<16;case 2:n^=(e.charCodeAt(h+1)&255)<<8;case 1:n^=e.charCodeAt(h)&255,n=(n&65535)*1540483477+((n>>>16)*59797<<16)}return n^=n>>>13,n=(n&65535)*1540483477+((n>>>16)*59797<<16),((n^n>>>15)>>>0).toString(36)}var G5={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},q5=/[A-Z]|^ms/g,W5=/_EMO_([^_]+?)_([^]*?)_EMO_/g,pI=function(n){return n.charCodeAt(1)===45},mS=function(n){return n!=null&&typeof n!="boolean"},Wv=eI(function(e){return pI(e)?e:e.replace(q5,"-$&").toLowerCase()}),gS=function(n,l){switch(n){case"animation":case"animationName":if(typeof l=="string")return l.replace(W5,function(h,m,y){return Os={name:m,styles:y,next:Os},m})}return G5[n]!==1&&!pI(n)&&typeof l=="number"&&l!==0?l+"px":l};function Af(e,n,l){if(l==null)return"";if(l.__emotion_styles!==void 0)return l;switch(typeof l){case"boolean":return"";case"object":{if(l.anim===1)return Os={name:l.name,styles:l.styles,next:Os},l.name;if(l.styles!==void 0){var h=l.next;if(h!==void 0)for(;h!==void 0;)Os={name:h.name,styles:h.styles,next:Os},h=h.next;var m=l.styles+";";return m}return Z5(e,n,l)}case"function":{if(e!==void 0){var y=Os,b=l(e);return Os=y,Af(e,n,b)}break}}if(n==null)return l;var s=n[l];return s!==void 0?s:l}function Z5(e,n,l){var h="";if(Array.isArray(l))for(var m=0;m<l.length;m++)h+=Af(e,n,l[m])+";";else for(var y in l){var b=l[y];if(typeof b!="object")n!=null&&n[b]!==void 0?h+=y+"{"+n[b]+"}":mS(b)&&(h+=Wv(y)+":"+gS(y,b)+";");else if(Array.isArray(b)&&typeof b[0]=="string"&&(n==null||n[b[0]]===void 0))for(var s=0;s<b.length;s++)mS(b[s])&&(h+=Wv(y)+":"+gS(y,b[s])+";");else{var A=Af(e,n,b);switch(y){case"animation":case"animationName":{h+=Wv(y)+":"+A+";";break}default:h+=y+"{"+A+"}"}}}return h}var _S=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Os,fI=function(n,l,h){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var m=!0,y="";Os=void 0;var b=n[0];b==null||b.raw===void 0?(m=!1,y+=Af(h,l,b)):y+=b[0];for(var s=1;s<n.length;s++)y+=Af(h,l,n[s]),m&&(y+=b[s]);_S.lastIndex=0;for(var A="",R;(R=_S.exec(y))!==null;)A+="-"+R[1];var U=$5(y)+A;return{name:U,styles:y,next:Os}},H5=function(n){return n()},X5=i_["useInsertionEffect"]?i_["useInsertionEffect"]:!1,K5=X5||H5,mI=Te.createContext(typeof HTMLElement<"u"?P5({key:"css"}):null);mI.Provider;var Y5=function(n){return Te.forwardRef(function(l,h){var m=Te.useContext(mI);return n(l,m,h)})},gI=Te.createContext({});function J5(){for(var e=arguments.length,n=new Array(e),l=0;l<e;l++)n[l]=arguments[l];return fI(n)}var Sw=function(){var n=J5.apply(void 0,arguments),l="animation-"+n.name;return{name:l,styles:"@keyframes "+l+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},Q5=n5,e4=function(n){return n!=="theme"},yS=function(n){return typeof n=="string"&&n.charCodeAt(0)>96?Q5:e4},vS=function(n,l,h){var m;if(l){var y=l.shouldForwardProp;m=n.__emotion_forwardProp&&y?function(b){return n.__emotion_forwardProp(b)&&y(b)}:y}return typeof m!="function"&&h&&(m=n.__emotion_forwardProp),m},t4=function(n){var l=n.cache,h=n.serialized,m=n.isStringTag;return dI(l,h,m),K5(function(){return V5(l,h,m)}),null},n4=function e(n,l){var h=n.__emotion_real===n,m=h&&n.__emotion_base||n,y,b;l!==void 0&&(y=l.label,b=l.target);var s=vS(n,l,h),A=s||yS(m),R=!A("as");return function(){var U=arguments,V=h&&n.__emotion_styles!==void 0?n.__emotion_styles.slice(0):[];if(y!==void 0&&V.push("label:"+y+";"),U[0]==null||U[0].raw===void 0)V.push.apply(V,U);else{V.push(U[0][0]);for(var $=U.length,pe=1;pe<$;pe++)V.push(U[pe],U[0][pe])}var Y=Y5(function(K,Ce,ee){var ne=R&&K.as||m,ce="",se=[],De=K;if(K.theme==null){De={};for(var He in K)De[He]=K[He];De.theme=Te.useContext(gI)}typeof K.className=="string"?ce=U5(Ce.registered,se,K.className):K.className!=null&&(ce=K.className+" ");var Be=fI(V.concat(se),Ce.registered,De);ce+=Ce.key+"-"+Be.name,b!==void 0&&(ce+=" "+b);var ut=R&&s===void 0?yS(ne):A,Ie={};for(var Je in K)R&&Je==="as"||ut(Je)&&(Ie[Je]=K[Je]);return Ie.className=ce,Ie.ref=ee,Te.createElement(Te.Fragment,null,Te.createElement(t4,{cache:Ce,serialized:Be,isStringTag:typeof ne=="string"}),Te.createElement(ne,Ie))});return Y.displayName=y!==void 0?y:"Styled("+(typeof m=="string"?m:m.displayName||m.name||"Component")+")",Y.defaultProps=n.defaultProps,Y.__emotion_real=Y,Y.__emotion_base=m,Y.__emotion_styles=V,Y.__emotion_forwardProp=s,Object.defineProperty(Y,"toString",{value:function(){return"."+b}}),Y.withComponent=function(K,Ce){return e(K,ft({},l,Ce,{shouldForwardProp:vS(Y,Ce,!0)})).apply(void 0,V)},Y}},r4=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],l1=n4.bind();r4.forEach(function(e){l1[e]=l1(e)});/**
 * @mui/styled-engine v5.13.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function i4(e,n){return l1(e,n)}const o4=(e,n)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=n(e.__emotion_styles))},s4=["values","unit","step"],a4=e=>{const n=Object.keys(e).map(l=>({key:l,val:e[l]}))||[];return n.sort((l,h)=>l.val-h.val),n.reduce((l,h)=>ft({},l,{[h.key]:h.val}),{})};function l4(e){const{values:n={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:l="px",step:h=5}=e,m=Cr(e,s4),y=a4(n),b=Object.keys(y);function s($){return`@media (min-width:${typeof n[$]=="number"?n[$]:$}${l})`}function A($){return`@media (max-width:${(typeof n[$]=="number"?n[$]:$)-h/100}${l})`}function R($,pe){const Y=b.indexOf(pe);return`@media (min-width:${typeof n[$]=="number"?n[$]:$}${l}) and (max-width:${(Y!==-1&&typeof n[b[Y]]=="number"?n[b[Y]]:pe)-h/100}${l})`}function U($){return b.indexOf($)+1<b.length?R($,b[b.indexOf($)+1]):s($)}function V($){const pe=b.indexOf($);return pe===0?s(b[1]):pe===b.length-1?A(b[pe]):R($,b[b.indexOf($)+1]).replace("@media","@media not all and")}return ft({keys:b,values:y,up:s,down:A,between:R,only:U,not:V,unit:l},m)}const c4={borderRadius:4},u4=c4;function rf(e,n){return n?ya(e,n,{clone:!1}):e}const Cw={xs:0,sm:600,md:900,lg:1200,xl:1536},xS={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${Cw[e]}px)`};function Ea(e,n,l){const h=e.theme||{};if(Array.isArray(n)){const y=h.breakpoints||xS;return n.reduce((b,s,A)=>(b[y.up(y.keys[A])]=l(n[A]),b),{})}if(typeof n=="object"){const y=h.breakpoints||xS;return Object.keys(n).reduce((b,s)=>{if(Object.keys(y.values||Cw).indexOf(s)!==-1){const A=y.up(s);b[A]=l(n[s],s)}else{const A=s;b[A]=n[A]}return b},{})}return l(n)}function h4(e={}){var n;return((n=e.keys)==null?void 0:n.reduce((h,m)=>{const y=e.up(m);return h[y]={},h},{}))||{}}function d4(e,n){return e.reduce((l,h)=>{const m=l[h];return(!m||Object.keys(m).length===0)&&delete l[h],l},n)}function Ey(e,n,l=!0){if(!n||typeof n!="string")return null;if(e&&e.vars&&l){const h=`vars.${n}`.split(".").reduce((m,y)=>m&&m[y]?m[y]:null,e);if(h!=null)return h}return n.split(".").reduce((h,m)=>h&&h[m]!=null?h[m]:null,e)}function D_(e,n,l,h=l){let m;return typeof e=="function"?m=e(l):Array.isArray(e)?m=e[l]||h:m=Ey(e,l)||h,n&&(m=n(m,h,e)),m}function Gn(e){const{prop:n,cssProperty:l=e.prop,themeKey:h,transform:m}=e,y=b=>{if(b[n]==null)return null;const s=b[n],A=b.theme,R=Ey(A,h)||{};return Ea(b,s,V=>{let $=D_(R,m,V);return V===$&&typeof V=="string"&&($=D_(R,m,`${n}${V==="default"?"":zn(V)}`,V)),l===!1?$:{[l]:$}})};return y.propTypes={},y.filterProps=[n],y}function p4(e){const n={};return l=>(n[l]===void 0&&(n[l]=e(l)),n[l])}const f4={m:"margin",p:"padding"},m4={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},wS={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},g4=p4(e=>{if(e.length>2)if(wS[e])e=wS[e];else return[e];const[n,l]=e.split(""),h=f4[n],m=m4[l]||"";return Array.isArray(m)?m.map(y=>h+y):[h+m]}),Aw=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],Mw=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...Aw,...Mw];function Nf(e,n,l,h){var m;const y=(m=Ey(e,n,!1))!=null?m:l;return typeof y=="number"?b=>typeof b=="string"?b:y*b:Array.isArray(y)?b=>typeof b=="string"?b:y[b]:typeof y=="function"?y:()=>{}}function _I(e){return Nf(e,"spacing",8)}function jf(e,n){if(typeof n=="string"||n==null)return n;const l=Math.abs(n),h=e(l);return n>=0?h:typeof h=="number"?-h:`-${h}`}function _4(e,n){return l=>e.reduce((h,m)=>(h[m]=jf(n,l),h),{})}function y4(e,n,l,h){if(n.indexOf(l)===-1)return null;const m=g4(l),y=_4(m,h),b=e[l];return Ea(e,b,y)}function yI(e,n){const l=_I(e.theme);return Object.keys(e).map(h=>y4(e,n,h,l)).reduce(rf,{})}function Er(e){return yI(e,Aw)}Er.propTypes={};Er.filterProps=Aw;function Tr(e){return yI(e,Mw)}Tr.propTypes={};Tr.filterProps=Mw;function v4(e=8){if(e.mui)return e;const n=_I({spacing:e}),l=(...h)=>(h.length===0?[1]:h).map(y=>{const b=n(y);return typeof b=="number"?`${b}px`:b}).join(" ");return l.mui=!0,l}function Ty(...e){const n=e.reduce((h,m)=>(m.filterProps.forEach(y=>{h[y]=m}),h),{}),l=h=>Object.keys(h).reduce((m,y)=>n[y]?rf(m,n[y](h)):m,{});return l.propTypes={},l.filterProps=e.reduce((h,m)=>h.concat(m.filterProps),[]),l}function Fs(e){return typeof e!="number"?e:`${e}px solid`}const x4=Gn({prop:"border",themeKey:"borders",transform:Fs}),w4=Gn({prop:"borderTop",themeKey:"borders",transform:Fs}),b4=Gn({prop:"borderRight",themeKey:"borders",transform:Fs}),E4=Gn({prop:"borderBottom",themeKey:"borders",transform:Fs}),T4=Gn({prop:"borderLeft",themeKey:"borders",transform:Fs}),S4=Gn({prop:"borderColor",themeKey:"palette"}),C4=Gn({prop:"borderTopColor",themeKey:"palette"}),A4=Gn({prop:"borderRightColor",themeKey:"palette"}),M4=Gn({prop:"borderBottomColor",themeKey:"palette"}),I4=Gn({prop:"borderLeftColor",themeKey:"palette"}),Sy=e=>{if(e.borderRadius!==void 0&&e.borderRadius!==null){const n=Nf(e.theme,"shape.borderRadius",4),l=h=>({borderRadius:jf(n,h)});return Ea(e,e.borderRadius,l)}return null};Sy.propTypes={};Sy.filterProps=["borderRadius"];Ty(x4,w4,b4,E4,T4,S4,C4,A4,M4,I4,Sy);const Cy=e=>{if(e.gap!==void 0&&e.gap!==null){const n=Nf(e.theme,"spacing",8),l=h=>({gap:jf(n,h)});return Ea(e,e.gap,l)}return null};Cy.propTypes={};Cy.filterProps=["gap"];const Ay=e=>{if(e.columnGap!==void 0&&e.columnGap!==null){const n=Nf(e.theme,"spacing",8),l=h=>({columnGap:jf(n,h)});return Ea(e,e.columnGap,l)}return null};Ay.propTypes={};Ay.filterProps=["columnGap"];const My=e=>{if(e.rowGap!==void 0&&e.rowGap!==null){const n=Nf(e.theme,"spacing",8),l=h=>({rowGap:jf(n,h)});return Ea(e,e.rowGap,l)}return null};My.propTypes={};My.filterProps=["rowGap"];const k4=Gn({prop:"gridColumn"}),P4=Gn({prop:"gridRow"}),z4=Gn({prop:"gridAutoFlow"}),R4=Gn({prop:"gridAutoColumns"}),D4=Gn({prop:"gridAutoRows"}),L4=Gn({prop:"gridTemplateColumns"}),O4=Gn({prop:"gridTemplateRows"}),B4=Gn({prop:"gridTemplateAreas"}),F4=Gn({prop:"gridArea"});Ty(Cy,Ay,My,k4,P4,z4,R4,D4,L4,O4,B4,F4);function yh(e,n){return n==="grey"?n:e}const N4=Gn({prop:"color",themeKey:"palette",transform:yh}),j4=Gn({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:yh}),U4=Gn({prop:"backgroundColor",themeKey:"palette",transform:yh});Ty(N4,j4,U4);function ho(e){return e<=1&&e!==0?`${e*100}%`:e}const V4=Gn({prop:"width",transform:ho}),Iw=e=>{if(e.maxWidth!==void 0&&e.maxWidth!==null){const n=l=>{var h;return{maxWidth:((h=e.theme)==null||(h=h.breakpoints)==null||(h=h.values)==null?void 0:h[l])||Cw[l]||ho(l)}};return Ea(e,e.maxWidth,n)}return null};Iw.filterProps=["maxWidth"];const $4=Gn({prop:"minWidth",transform:ho}),G4=Gn({prop:"height",transform:ho}),q4=Gn({prop:"maxHeight",transform:ho}),W4=Gn({prop:"minHeight",transform:ho});Gn({prop:"size",cssProperty:"width",transform:ho});Gn({prop:"size",cssProperty:"height",transform:ho});const Z4=Gn({prop:"boxSizing"});Ty(V4,Iw,$4,G4,q4,W4,Z4);const H4={border:{themeKey:"borders",transform:Fs},borderTop:{themeKey:"borders",transform:Fs},borderRight:{themeKey:"borders",transform:Fs},borderBottom:{themeKey:"borders",transform:Fs},borderLeft:{themeKey:"borders",transform:Fs},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:Sy},color:{themeKey:"palette",transform:yh},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:yh},backgroundColor:{themeKey:"palette",transform:yh},p:{style:Tr},pt:{style:Tr},pr:{style:Tr},pb:{style:Tr},pl:{style:Tr},px:{style:Tr},py:{style:Tr},padding:{style:Tr},paddingTop:{style:Tr},paddingRight:{style:Tr},paddingBottom:{style:Tr},paddingLeft:{style:Tr},paddingX:{style:Tr},paddingY:{style:Tr},paddingInline:{style:Tr},paddingInlineStart:{style:Tr},paddingInlineEnd:{style:Tr},paddingBlock:{style:Tr},paddingBlockStart:{style:Tr},paddingBlockEnd:{style:Tr},m:{style:Er},mt:{style:Er},mr:{style:Er},mb:{style:Er},ml:{style:Er},mx:{style:Er},my:{style:Er},margin:{style:Er},marginTop:{style:Er},marginRight:{style:Er},marginBottom:{style:Er},marginLeft:{style:Er},marginX:{style:Er},marginY:{style:Er},marginInline:{style:Er},marginInlineStart:{style:Er},marginInlineEnd:{style:Er},marginBlock:{style:Er},marginBlockStart:{style:Er},marginBlockEnd:{style:Er},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:Cy},rowGap:{style:My},columnGap:{style:Ay},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ho},maxWidth:{style:Iw},minWidth:{transform:ho},height:{transform:ho},maxHeight:{transform:ho},minHeight:{transform:ho},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}},kw=H4;function X4(...e){const n=e.reduce((h,m)=>h.concat(Object.keys(m)),[]),l=new Set(n);return e.every(h=>l.size===Object.keys(h).length)}function K4(e,n){return typeof e=="function"?e(n):e}function Y4(){function e(l,h,m,y){const b={[l]:h,theme:m},s=y[l];if(!s)return{[l]:h};const{cssProperty:A=l,themeKey:R,transform:U,style:V}=s;if(h==null)return null;if(R==="typography"&&h==="inherit")return{[l]:h};const $=Ey(m,R)||{};return V?V(b):Ea(b,h,Y=>{let K=D_($,U,Y);return Y===K&&typeof Y=="string"&&(K=D_($,U,`${l}${Y==="default"?"":zn(Y)}`,Y)),A===!1?K:{[A]:K}})}function n(l){var h;const{sx:m,theme:y={}}=l||{};if(!m)return null;const b=(h=y.unstable_sxConfig)!=null?h:kw;function s(A){let R=A;if(typeof A=="function")R=A(y);else if(typeof A!="object")return A;if(!R)return null;const U=h4(y.breakpoints),V=Object.keys(U);let $=U;return Object.keys(R).forEach(pe=>{const Y=K4(R[pe],y);if(Y!=null)if(typeof Y=="object")if(b[pe])$=rf($,e(pe,Y,y,b));else{const K=Ea({theme:y},Y,Ce=>({[pe]:Ce}));X4(K,Y)?$[pe]=n({sx:Y,theme:y}):$=rf($,K)}else $=rf($,e(pe,Y,y,b))}),d4(V,$)}return Array.isArray(m)?m.map(s):s(m)}return n}const vI=Y4();vI.filterProps=["sx"];const Pw=vI,J4=["breakpoints","palette","spacing","shape"];function zw(e={},...n){const{breakpoints:l={},palette:h={},spacing:m,shape:y={}}=e,b=Cr(e,J4),s=l4(l),A=v4(m);let R=ya({breakpoints:s,direction:"ltr",components:{},palette:ft({mode:"light"},h),spacing:A,shape:ft({},u4,y)},b);return R=n.reduce((U,V)=>ya(U,V),R),R.unstable_sxConfig=ft({},kw,b==null?void 0:b.unstable_sxConfig),R.unstable_sx=function(V){return Pw({sx:V,theme:this})},R}function Q4(e){return Object.keys(e).length===0}function eF(e=null){const n=Te.useContext(gI);return!n||Q4(n)?e:n}const tF=zw();function xI(e=tF){return eF(e)}const nF=["variant"];function bS(e){return e.length===0}function wI(e){const{variant:n}=e,l=Cr(e,nF);let h=n||"";return Object.keys(l).sort().forEach(m=>{m==="color"?h+=bS(h)?e[m]:zn(e[m]):h+=`${bS(h)?m:zn(m)}${zn(e[m].toString())}`}),h}const rF=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function iF(e){return Object.keys(e).length===0}function oF(e){return typeof e=="string"&&e.charCodeAt(0)>96}const sF=(e,n)=>n.components&&n.components[e]&&n.components[e].styleOverrides?n.components[e].styleOverrides:null,aF=(e,n)=>{let l=[];n&&n.components&&n.components[e]&&n.components[e].variants&&(l=n.components[e].variants);const h={};return l.forEach(m=>{const y=wI(m.props);h[y]=m.style}),h},lF=(e,n,l,h)=>{var m;const{ownerState:y={}}=e,b=[],s=l==null||(m=l.components)==null||(m=m[h])==null?void 0:m.variants;return s&&s.forEach(A=>{let R=!0;Object.keys(A.props).forEach(U=>{y[U]!==A.props[U]&&e[U]!==A.props[U]&&(R=!1)}),R&&b.push(n[wI(A.props)])}),b};function r_(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const cF=zw();function Bp({defaultTheme:e,theme:n,themeId:l}){return iF(n)?e:n[l]||n}function uF(e={}){const{themeId:n,defaultTheme:l=cF,rootShouldForwardProp:h=r_,slotShouldForwardProp:m=r_}=e,y=b=>Pw(ft({},b,{theme:Bp(ft({},b,{defaultTheme:l,themeId:n}))}));return y.__mui_systemSx=!0,(b,s={})=>{o4(b,se=>se.filter(De=>!(De!=null&&De.__mui_systemSx)));const{name:A,slot:R,skipVariantsResolver:U,skipSx:V,overridesResolver:$}=s,pe=Cr(s,rF),Y=U!==void 0?U:R&&R!=="Root"||!1,K=V||!1;let Ce,ee=r_;R==="Root"?ee=h:R?ee=m:oF(b)&&(ee=void 0);const ne=i4(b,ft({shouldForwardProp:ee,label:Ce},pe)),ce=(se,...De)=>{const He=De?De.map(Je=>typeof Je=="function"&&Je.__emotion_real!==Je?Rt=>Je(ft({},Rt,{theme:Bp(ft({},Rt,{defaultTheme:l,themeId:n}))})):Je):[];let Be=se;A&&$&&He.push(Je=>{const Rt=Bp(ft({},Je,{defaultTheme:l,themeId:n})),ht=sF(A,Rt);if(ht){const Ht={};return Object.entries(ht).forEach(([Rn,Bt])=>{Ht[Rn]=typeof Bt=="function"?Bt(ft({},Je,{theme:Rt})):Bt}),$(Je,Ht)}return null}),A&&!Y&&He.push(Je=>{const Rt=Bp(ft({},Je,{defaultTheme:l,themeId:n}));return lF(Je,aF(A,Rt),Rt,A)}),K||He.push(y);const ut=He.length-De.length;if(Array.isArray(se)&&ut>0){const Je=new Array(ut).fill("");Be=[...se,...Je],Be.raw=[...se.raw,...Je]}else typeof se=="function"&&se.__emotion_real!==se&&(Be=Je=>se(ft({},Je,{theme:Bp(ft({},Je,{defaultTheme:l,themeId:n}))})));const Ie=ne(Be,...He);return b.muiName&&(Ie.muiName=b.muiName),Ie};return ne.withConfig&&(ce.withConfig=ne.withConfig),ce}}function hF(e){const{theme:n,name:l,props:h}=e;return!n||!n.components||!n.components[l]||!n.components[l].defaultProps?h:yw(n.components[l].defaultProps,h)}function dF({props:e,name:n,defaultTheme:l,themeId:h}){let m=xI(l);return h&&(m=m[h]||m),hF({theme:m,name:n,props:e})}function Rw(e,n=0,l=1){return Math.min(Math.max(n,e),l)}function pF(e){e=e.slice(1);const n=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let l=e.match(n);return l&&l[0].length===1&&(l=l.map(h=>h+h)),l?`rgb${l.length===4?"a":""}(${l.map((h,m)=>m<3?parseInt(h,16):Math.round(parseInt(h,16)/255*1e3)/1e3).join(", ")})`:""}function Bc(e){if(e.type)return e;if(e.charAt(0)==="#")return Bc(pF(e));const n=e.indexOf("("),l=e.substring(0,n);if(["rgb","rgba","hsl","hsla","color"].indexOf(l)===-1)throw new Error(Ih(9,e));let h=e.substring(n+1,e.length-1),m;if(l==="color"){if(h=h.split(" "),m=h.shift(),h.length===4&&h[3].charAt(0)==="/"&&(h[3]=h[3].slice(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(m)===-1)throw new Error(Ih(10,m))}else h=h.split(",");return h=h.map(y=>parseFloat(y)),{type:l,values:h,colorSpace:m}}function Iy(e){const{type:n,colorSpace:l}=e;let{values:h}=e;return n.indexOf("rgb")!==-1?h=h.map((m,y)=>y<3?parseInt(m,10):m):n.indexOf("hsl")!==-1&&(h[1]=`${h[1]}%`,h[2]=`${h[2]}%`),n.indexOf("color")!==-1?h=`${l} ${h.join(" ")}`:h=`${h.join(", ")}`,`${n}(${h})`}function fF(e){e=Bc(e);const{values:n}=e,l=n[0],h=n[1]/100,m=n[2]/100,y=h*Math.min(m,1-m),b=(R,U=(R+l/30)%12)=>m-y*Math.max(Math.min(U-3,9-U,1),-1);let s="rgb";const A=[Math.round(b(0)*255),Math.round(b(8)*255),Math.round(b(4)*255)];return e.type==="hsla"&&(s+="a",A.push(n[3])),Iy({type:s,values:A})}function c1(e){e=Bc(e);let n=e.type==="hsl"||e.type==="hsla"?Bc(fF(e)).values:e.values;return n=n.map(l=>(e.type!=="color"&&(l/=255),l<=.03928?l/12.92:((l+.055)/1.055)**2.4)),Number((.2126*n[0]+.7152*n[1]+.0722*n[2]).toFixed(3))}function mF(e,n){const l=c1(e),h=c1(n);return(Math.max(l,h)+.05)/(Math.min(l,h)+.05)}function _l(e,n){return e=Bc(e),n=Rw(n),(e.type==="rgb"||e.type==="hsl")&&(e.type+="a"),e.type==="color"?e.values[3]=`/${n}`:e.values[3]=n,Iy(e)}function L_(e,n){if(e=Bc(e),n=Rw(n),e.type.indexOf("hsl")!==-1)e.values[2]*=1-n;else if(e.type.indexOf("rgb")!==-1||e.type.indexOf("color")!==-1)for(let l=0;l<3;l+=1)e.values[l]*=1-n;return Iy(e)}function O_(e,n){if(e=Bc(e),n=Rw(n),e.type.indexOf("hsl")!==-1)e.values[2]+=(100-e.values[2])*n;else if(e.type.indexOf("rgb")!==-1)for(let l=0;l<3;l+=1)e.values[l]+=(255-e.values[l])*n;else if(e.type.indexOf("color")!==-1)for(let l=0;l<3;l+=1)e.values[l]+=(1-e.values[l])*n;return Iy(e)}function gF(e,n=.15){return c1(e)>.5?L_(e,n):O_(e,n)}function _F(e,n){return ft({toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}}},n)}const yF={black:"#000",white:"#fff"},Mf=yF,vF={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},xF=vF,wF={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},ju=wF,bF={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Uu=bF,EF={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Fp=EF,TF={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},Vu=TF,SF={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},$u=SF,CF={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},Gu=CF,AF=["mode","contrastThreshold","tonalOffset"],ES={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Mf.white,default:Mf.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Zv={text:{primary:Mf.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Mf.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function TS(e,n,l,h){const m=h.light||h,y=h.dark||h*1.5;e[n]||(e.hasOwnProperty(l)?e[n]=e[l]:n==="light"?e.light=O_(e.main,m):n==="dark"&&(e.dark=L_(e.main,y)))}function MF(e="light"){return e==="dark"?{main:Vu[200],light:Vu[50],dark:Vu[400]}:{main:Vu[700],light:Vu[400],dark:Vu[800]}}function IF(e="light"){return e==="dark"?{main:ju[200],light:ju[50],dark:ju[400]}:{main:ju[500],light:ju[300],dark:ju[700]}}function kF(e="light"){return e==="dark"?{main:Uu[500],light:Uu[300],dark:Uu[700]}:{main:Uu[700],light:Uu[400],dark:Uu[800]}}function PF(e="light"){return e==="dark"?{main:$u[400],light:$u[300],dark:$u[700]}:{main:$u[700],light:$u[500],dark:$u[900]}}function zF(e="light"){return e==="dark"?{main:Gu[400],light:Gu[300],dark:Gu[700]}:{main:Gu[800],light:Gu[500],dark:Gu[900]}}function RF(e="light"){return e==="dark"?{main:Fp[400],light:Fp[300],dark:Fp[700]}:{main:"#ed6c02",light:Fp[500],dark:Fp[900]}}function DF(e){const{mode:n="light",contrastThreshold:l=3,tonalOffset:h=.2}=e,m=Cr(e,AF),y=e.primary||MF(n),b=e.secondary||IF(n),s=e.error||kF(n),A=e.info||PF(n),R=e.success||zF(n),U=e.warning||RF(n);function V(K){return mF(K,Zv.text.primary)>=l?Zv.text.primary:ES.text.primary}const $=({color:K,name:Ce,mainShade:ee=500,lightShade:ne=300,darkShade:ce=700})=>{if(K=ft({},K),!K.main&&K[ee]&&(K.main=K[ee]),!K.hasOwnProperty("main"))throw new Error(Ih(11,Ce?` (${Ce})`:"",ee));if(typeof K.main!="string")throw new Error(Ih(12,Ce?` (${Ce})`:"",JSON.stringify(K.main)));return TS(K,"light",ne,h),TS(K,"dark",ce,h),K.contrastText||(K.contrastText=V(K.main)),K},pe={dark:Zv,light:ES};return ya(ft({common:ft({},Mf),mode:n,primary:$({color:y,name:"primary"}),secondary:$({color:b,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:$({color:s,name:"error"}),warning:$({color:U,name:"warning"}),info:$({color:A,name:"info"}),success:$({color:R,name:"success"}),grey:xF,contrastThreshold:l,getContrastText:V,augmentColor:$,tonalOffset:h},pe[n]),m)}const LF=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function OF(e){return Math.round(e*1e5)/1e5}const SS={textTransform:"uppercase"},CS='"Roboto", "Helvetica", "Arial", sans-serif';function BF(e,n){const l=typeof n=="function"?n(e):n,{fontFamily:h=CS,fontSize:m=14,fontWeightLight:y=300,fontWeightRegular:b=400,fontWeightMedium:s=500,fontWeightBold:A=700,htmlFontSize:R=16,allVariants:U,pxToRem:V}=l,$=Cr(l,LF),pe=m/14,Y=V||(ee=>`${ee/R*pe}rem`),K=(ee,ne,ce,se,De)=>ft({fontFamily:h,fontWeight:ee,fontSize:Y(ne),lineHeight:ce},h===CS?{letterSpacing:`${OF(se/ne)}em`}:{},De,U),Ce={h1:K(y,96,1.167,-1.5),h2:K(y,60,1.2,-.5),h3:K(b,48,1.167,0),h4:K(b,34,1.235,.25),h5:K(b,24,1.334,0),h6:K(s,20,1.6,.15),subtitle1:K(b,16,1.75,.15),subtitle2:K(s,14,1.57,.1),body1:K(b,16,1.5,.15),body2:K(b,14,1.43,.15),button:K(s,14,1.75,.4,SS),caption:K(b,12,1.66,.4),overline:K(b,12,2.66,1,SS),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return ya(ft({htmlFontSize:R,pxToRem:Y,fontFamily:h,fontSize:m,fontWeightLight:y,fontWeightRegular:b,fontWeightMedium:s,fontWeightBold:A},Ce),$,{clone:!1})}const FF=.2,NF=.14,jF=.12;function sr(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,${FF})`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,${NF})`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,${jF})`].join(",")}const UF=["none",sr(0,2,1,-1,0,1,1,0,0,1,3,0),sr(0,3,1,-2,0,2,2,0,0,1,5,0),sr(0,3,3,-2,0,3,4,0,0,1,8,0),sr(0,2,4,-1,0,4,5,0,0,1,10,0),sr(0,3,5,-1,0,5,8,0,0,1,14,0),sr(0,3,5,-1,0,6,10,0,0,1,18,0),sr(0,4,5,-2,0,7,10,1,0,2,16,1),sr(0,5,5,-3,0,8,10,1,0,3,14,2),sr(0,5,6,-3,0,9,12,1,0,3,16,2),sr(0,6,6,-3,0,10,14,1,0,4,18,3),sr(0,6,7,-4,0,11,15,1,0,4,20,3),sr(0,7,8,-4,0,12,17,2,0,5,22,4),sr(0,7,8,-4,0,13,19,2,0,5,24,4),sr(0,7,9,-4,0,14,21,2,0,5,26,4),sr(0,8,9,-5,0,15,22,2,0,6,28,5),sr(0,8,10,-5,0,16,24,2,0,6,30,5),sr(0,8,11,-5,0,17,26,2,0,6,32,5),sr(0,9,11,-5,0,18,28,2,0,7,34,6),sr(0,9,12,-6,0,19,29,2,0,7,36,6),sr(0,10,13,-6,0,20,31,3,0,8,38,7),sr(0,10,13,-6,0,21,33,3,0,8,40,7),sr(0,10,14,-6,0,22,35,3,0,8,42,7),sr(0,11,14,-7,0,23,36,3,0,9,44,8),sr(0,11,15,-7,0,24,38,3,0,9,46,8)],VF=UF,$F=["duration","easing","delay"],GF={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},qF={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function AS(e){return`${Math.round(e)}ms`}function WF(e){if(!e)return 0;const n=e/36;return Math.round((4+15*n**.25+n/5)*10)}function ZF(e){const n=ft({},GF,e.easing),l=ft({},qF,e.duration);return ft({getAutoHeightDuration:WF,create:(m=["all"],y={})=>{const{duration:b=l.standard,easing:s=n.easeInOut,delay:A=0}=y;return Cr(y,$F),(Array.isArray(m)?m:[m]).map(R=>`${R} ${typeof b=="string"?b:AS(b)} ${s} ${typeof A=="string"?A:AS(A)}`).join(",")}},e,{easing:n,duration:l})}const HF={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},XF=HF,KF=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function YF(e={},...n){const{mixins:l={},palette:h={},transitions:m={},typography:y={}}=e,b=Cr(e,KF);if(e.vars)throw new Error(Ih(18));const s=DF(h),A=zw(e);let R=ya(A,{mixins:_F(A.breakpoints,l),palette:s,shadows:VF.slice(),typography:BF(s,y),transitions:ZF(m),zIndex:ft({},XF)});return R=ya(R,b),R=n.reduce((U,V)=>ya(U,V),R),R.unstable_sxConfig=ft({},kw,b==null?void 0:b.unstable_sxConfig),R.unstable_sx=function(V){return Pw({sx:V,theme:this})},R}const JF=YF(),Dw=JF,Lw="$$material",bI=e=>r_(e)&&e!=="classes",QF=uF({themeId:Lw,defaultTheme:Dw,rootShouldForwardProp:bI}),pi=QF;function EI(){const e=xI(Dw);return e[Lw]||e}function ka({props:e,name:n}){return dF({props:e,name:n,defaultTheme:Dw,themeId:Lw})}function u1(e,n){return u1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,m){return h.__proto__=m,h},u1(e,n)}function TI(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,u1(e,n)}const MS={disabled:!1},B_=zr.createContext(null);var eN=function(n){return n.scrollTop},Gp="unmounted",wc="exited",bc="entering",Hu="entered",h1="exiting",Pa=function(e){TI(n,e);function n(h,m){var y;y=e.call(this,h,m)||this;var b=m,s=b&&!b.isMounting?h.enter:h.appear,A;return y.appearStatus=null,h.in?s?(A=wc,y.appearStatus=bc):A=Hu:h.unmountOnExit||h.mountOnEnter?A=Gp:A=wc,y.state={status:A},y.nextCallback=null,y}n.getDerivedStateFromProps=function(m,y){var b=m.in;return b&&y.status===Gp?{status:wc}:null};var l=n.prototype;return l.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},l.componentDidUpdate=function(m){var y=null;if(m!==this.props){var b=this.state.status;this.props.in?b!==bc&&b!==Hu&&(y=bc):(b===bc||b===Hu)&&(y=h1)}this.updateStatus(!1,y)},l.componentWillUnmount=function(){this.cancelNextCallback()},l.getTimeouts=function(){var m=this.props.timeout,y,b,s;return y=b=s=m,m!=null&&typeof m!="number"&&(y=m.exit,b=m.enter,s=m.appear!==void 0?m.appear:b),{exit:y,enter:b,appear:s}},l.updateStatus=function(m,y){if(m===void 0&&(m=!1),y!==null)if(this.cancelNextCallback(),y===bc){if(this.props.unmountOnExit||this.props.mountOnEnter){var b=this.props.nodeRef?this.props.nodeRef.current:Ig.findDOMNode(this);b&&eN(b)}this.performEnter(m)}else this.performExit();else this.props.unmountOnExit&&this.state.status===wc&&this.setState({status:Gp})},l.performEnter=function(m){var y=this,b=this.props.enter,s=this.context?this.context.isMounting:m,A=this.props.nodeRef?[s]:[Ig.findDOMNode(this),s],R=A[0],U=A[1],V=this.getTimeouts(),$=s?V.appear:V.enter;if(!m&&!b||MS.disabled){this.safeSetState({status:Hu},function(){y.props.onEntered(R)});return}this.props.onEnter(R,U),this.safeSetState({status:bc},function(){y.props.onEntering(R,U),y.onTransitionEnd($,function(){y.safeSetState({status:Hu},function(){y.props.onEntered(R,U)})})})},l.performExit=function(){var m=this,y=this.props.exit,b=this.getTimeouts(),s=this.props.nodeRef?void 0:Ig.findDOMNode(this);if(!y||MS.disabled){this.safeSetState({status:wc},function(){m.props.onExited(s)});return}this.props.onExit(s),this.safeSetState({status:h1},function(){m.props.onExiting(s),m.onTransitionEnd(b.exit,function(){m.safeSetState({status:wc},function(){m.props.onExited(s)})})})},l.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},l.safeSetState=function(m,y){y=this.setNextCallback(y),this.setState(m,y)},l.setNextCallback=function(m){var y=this,b=!0;return this.nextCallback=function(s){b&&(b=!1,y.nextCallback=null,m(s))},this.nextCallback.cancel=function(){b=!1},this.nextCallback},l.onTransitionEnd=function(m,y){this.setNextCallback(y);var b=this.props.nodeRef?this.props.nodeRef.current:Ig.findDOMNode(this),s=m==null&&!this.props.addEndListener;if(!b||s){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var A=this.props.nodeRef?[this.nextCallback]:[b,this.nextCallback],R=A[0],U=A[1];this.props.addEndListener(R,U)}m!=null&&setTimeout(this.nextCallback,m)},l.render=function(){var m=this.state.status;if(m===Gp)return null;var y=this.props,b=y.children;y.in,y.mountOnEnter,y.unmountOnExit,y.appear,y.enter,y.exit,y.timeout,y.addEndListener,y.onEnter,y.onEntering,y.onEntered,y.onExit,y.onExiting,y.onExited,y.nodeRef;var s=Cr(y,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return zr.createElement(B_.Provider,{value:null},typeof b=="function"?b(m,s):zr.cloneElement(zr.Children.only(b),s))},n}(zr.Component);Pa.contextType=B_;Pa.propTypes={};function qu(){}Pa.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:qu,onEntering:qu,onEntered:qu,onExit:qu,onExiting:qu,onExited:qu};Pa.UNMOUNTED=Gp;Pa.EXITED=wc;Pa.ENTERING=bc;Pa.ENTERED=Hu;Pa.EXITING=h1;const tN=Pa;function nN(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ow(e,n){var l=function(y){return n&&Te.isValidElement(y)?n(y):y},h=Object.create(null);return e&&Te.Children.map(e,function(m){return m}).forEach(function(m){h[m.key]=l(m)}),h}function rN(e,n){e=e||{},n=n||{};function l(U){return U in n?n[U]:e[U]}var h=Object.create(null),m=[];for(var y in e)y in n?m.length&&(h[y]=m,m=[]):m.push(y);var b,s={};for(var A in n){if(h[A])for(b=0;b<h[A].length;b++){var R=h[A][b];s[h[A][b]]=l(R)}s[A]=l(A)}for(b=0;b<m.length;b++)s[m[b]]=l(m[b]);return s}function Mc(e,n,l){return l[n]!=null?l[n]:e.props[n]}function iN(e,n){return Ow(e.children,function(l){return Te.cloneElement(l,{onExited:n.bind(null,l),in:!0,appear:Mc(l,"appear",e),enter:Mc(l,"enter",e),exit:Mc(l,"exit",e)})})}function oN(e,n,l){var h=Ow(e.children),m=rN(n,h);return Object.keys(m).forEach(function(y){var b=m[y];if(Te.isValidElement(b)){var s=y in n,A=y in h,R=n[y],U=Te.isValidElement(R)&&!R.props.in;A&&(!s||U)?m[y]=Te.cloneElement(b,{onExited:l.bind(null,b),in:!0,exit:Mc(b,"exit",e),enter:Mc(b,"enter",e)}):!A&&s&&!U?m[y]=Te.cloneElement(b,{in:!1}):A&&s&&Te.isValidElement(R)&&(m[y]=Te.cloneElement(b,{onExited:l.bind(null,b),in:R.props.in,exit:Mc(b,"exit",e),enter:Mc(b,"enter",e)}))}}),m}var sN=Object.values||function(e){return Object.keys(e).map(function(n){return e[n]})},aN={component:"div",childFactory:function(n){return n}},Bw=function(e){TI(n,e);function n(h,m){var y;y=e.call(this,h,m)||this;var b=y.handleExited.bind(nN(y));return y.state={contextValue:{isMounting:!0},handleExited:b,firstRender:!0},y}var l=n.prototype;return l.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},l.componentWillUnmount=function(){this.mounted=!1},n.getDerivedStateFromProps=function(m,y){var b=y.children,s=y.handleExited,A=y.firstRender;return{children:A?iN(m,s):oN(m,b,s),firstRender:!1}},l.handleExited=function(m,y){var b=Ow(this.props.children);m.key in b||(m.props.onExited&&m.props.onExited(y),this.mounted&&this.setState(function(s){var A=ft({},s.children);return delete A[m.key],{children:A}}))},l.render=function(){var m=this.props,y=m.component,b=m.childFactory,s=Cr(m,["component","childFactory"]),A=this.state.contextValue,R=sN(this.state.children).map(b);return delete s.appear,delete s.enter,delete s.exit,y===null?zr.createElement(B_.Provider,{value:A},R):zr.createElement(B_.Provider,{value:A},zr.createElement(y,s,R))},n}(zr.Component);Bw.propTypes={};Bw.defaultProps=aN;const lN=Bw,cN=e=>e.scrollTop;function IS(e,n){var l,h;const{timeout:m,easing:y,style:b={}}=e;return{duration:(l=b.transitionDuration)!=null?l:typeof m=="number"?m:m[n.mode]||0,easing:(h=b.transitionTimingFunction)!=null?h:typeof y=="object"?y[n.mode]:y,delay:b.transitionDelay}}const uN=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function d1(e){return`scale(${e}, ${e**2})`}const hN={entering:{opacity:1,transform:d1(1)},entered:{opacity:1,transform:"none"}},Hv=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),SI=Te.forwardRef(function(n,l){const{addEndListener:h,appear:m=!0,children:y,easing:b,in:s,onEnter:A,onEntered:R,onEntering:U,onExit:V,onExited:$,onExiting:pe,style:Y,timeout:K="auto",TransitionComponent:Ce=tN}=n,ee=Cr(n,uN),ne=Te.useRef(),ce=Te.useRef(),se=EI(),De=Te.useRef(null),He=kh(De,y.ref,l),Be=Bt=>rn=>{if(Bt){const vn=De.current;rn===void 0?Bt(vn):Bt(vn,rn)}},ut=Be(U),Ie=Be((Bt,rn)=>{cN(Bt);const{duration:vn,delay:qe,easing:St}=IS({style:Y,timeout:K,easing:b},{mode:"enter"});let bt;K==="auto"?(bt=se.transitions.getAutoHeightDuration(Bt.clientHeight),ce.current=bt):bt=vn,Bt.style.transition=[se.transitions.create("opacity",{duration:bt,delay:qe}),se.transitions.create("transform",{duration:Hv?bt:bt*.666,delay:qe,easing:St})].join(","),A&&A(Bt,rn)}),Je=Be(R),Rt=Be(pe),ht=Be(Bt=>{const{duration:rn,delay:vn,easing:qe}=IS({style:Y,timeout:K,easing:b},{mode:"exit"});let St;K==="auto"?(St=se.transitions.getAutoHeightDuration(Bt.clientHeight),ce.current=St):St=rn,Bt.style.transition=[se.transitions.create("opacity",{duration:St,delay:vn}),se.transitions.create("transform",{duration:Hv?St:St*.666,delay:Hv?vn:vn||St*.333,easing:qe})].join(","),Bt.style.opacity=0,Bt.style.transform=d1(.75),V&&V(Bt)}),Ht=Be($),Rn=Bt=>{K==="auto"&&(ne.current=setTimeout(Bt,ce.current||0)),h&&h(De.current,Bt)};return Te.useEffect(()=>()=>{clearTimeout(ne.current)},[]),Q.jsx(Ce,ft({appear:m,in:s,nodeRef:De,onEnter:Ie,onEntered:Je,onEntering:ut,onExit:ht,onExited:Ht,onExiting:Rt,addEndListener:Rn,timeout:K==="auto"?null:K},ee,{children:(Bt,rn)=>Te.cloneElement(y,ft({style:ft({opacity:0,transform:d1(.75),visibility:Bt==="exited"&&!s?"hidden":void 0},hN[Bt],Y,y.props.style),ref:He},rn))}))});SI.muiSupportAuto=!0;const dN=SI,pN=e=>{let n;return e<1?n=5.11916*e**2:n=4.5*Math.log(e+1)+2,(n/100).toFixed(2)},kS=pN;function fN(e){return Ma("MuiPaper",e)}Ia("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const mN=["className","component","elevation","square","variant"],gN=e=>{const{square:n,elevation:l,variant:h,classes:m}=e,y={root:["root",h,!n&&"rounded",h==="elevation"&&`elevation${l}`]};return Pl(y,fN,m)},_N=pi("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.root,n[l.variant],!l.square&&n.rounded,l.variant==="elevation"&&n[`elevation${l.elevation}`]]}})(({theme:e,ownerState:n})=>{var l;return ft({backgroundColor:(e.vars||e).palette.background.paper,color:(e.vars||e).palette.text.primary,transition:e.transitions.create("box-shadow")},!n.square&&{borderRadius:e.shape.borderRadius},n.variant==="outlined"&&{border:`1px solid ${(e.vars||e).palette.divider}`},n.variant==="elevation"&&ft({boxShadow:(e.vars||e).shadows[n.elevation]},!e.vars&&e.palette.mode==="dark"&&{backgroundImage:`linear-gradient(${_l("#fff",kS(n.elevation))}, ${_l("#fff",kS(n.elevation))})`},e.vars&&{backgroundImage:(l=e.vars.overlays)==null?void 0:l[n.elevation]}))}),yN=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiPaper"}),{className:m,component:y="div",elevation:b=1,square:s=!1,variant:A="elevation"}=h,R=Cr(h,mN),U=ft({},h,{component:y,elevation:b,square:s,variant:A}),V=gN(U);return Q.jsx(_N,ft({as:y,ownerState:U,className:Kr(V.root,m),ref:l},R))}),CI=yN;function vN(e){return Ma("MuiSnackbarContent",e)}Ia("MuiSnackbarContent",["root","message","action"]);const xN=["action","className","message","role"],wN=e=>{const{classes:n}=e;return Pl({root:["root"],action:["action"],message:["message"]},vN,n)},bN=pi(CI,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(e,n)=>n.root})(({theme:e})=>{const n=e.palette.mode==="light"?.8:.98,l=gF(e.palette.background.default,n);return ft({},e.typography.body2,{color:e.vars?e.vars.palette.SnackbarContent.color:e.palette.getContrastText(l),backgroundColor:e.vars?e.vars.palette.SnackbarContent.bg:l,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(e.vars||e).shape.borderRadius,flexGrow:1,[e.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})}),EN=pi("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(e,n)=>n.message})({padding:"8px 0"}),TN=pi("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(e,n)=>n.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),SN=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiSnackbarContent"}),{action:m,className:y,message:b,role:s="alert"}=h,A=Cr(h,xN),R=h,U=wN(R);return Q.jsxs(bN,ft({role:s,square:!0,elevation:6,className:Kr(U.root,y),ownerState:R,ref:l},A,{children:[Q.jsx(EN,{className:U.message,ownerState:R,children:b}),m?Q.jsx(TN,{className:U.action,ownerState:R,children:m}):null]}))}),CN=SN;function AN(e){return Ma("MuiSnackbar",e)}Ia("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const MN=["onEnter","onExited"],IN=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],kN=e=>{const{classes:n,anchorOrigin:l}=e,h={root:["root",`anchorOrigin${zn(l.vertical)}${zn(l.horizontal)}`]};return Pl(h,AN,n)},PS=pi("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.root,n[`anchorOrigin${zn(l.anchorOrigin.vertical)}${zn(l.anchorOrigin.horizontal)}`]]}})(({theme:e,ownerState:n})=>{const l={left:"50%",right:"auto",transform:"translateX(-50%)"};return ft({zIndex:(e.vars||e).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},n.anchorOrigin.vertical==="top"?{top:8}:{bottom:8},n.anchorOrigin.horizontal==="left"&&{justifyContent:"flex-start"},n.anchorOrigin.horizontal==="right"&&{justifyContent:"flex-end"},{[e.breakpoints.up("sm")]:ft({},n.anchorOrigin.vertical==="top"?{top:24}:{bottom:24},n.anchorOrigin.horizontal==="center"&&l,n.anchorOrigin.horizontal==="left"&&{left:24,right:"auto"},n.anchorOrigin.horizontal==="right"&&{right:24,left:"auto"})})}),PN=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiSnackbar"}),m=EI(),y={enter:m.transitions.duration.enteringScreen,exit:m.transitions.duration.leavingScreen},{action:b,anchorOrigin:{vertical:s,horizontal:A}={vertical:"bottom",horizontal:"left"},autoHideDuration:R=null,children:U,className:V,ClickAwayListenerProps:$,ContentProps:pe,disableWindowBlurListener:Y=!1,message:K,open:Ce,TransitionComponent:ee=dN,transitionDuration:ne=y,TransitionProps:{onEnter:ce,onExited:se}={}}=h,De=Cr(h.TransitionProps,MN),He=Cr(h,IN),Be=ft({},h,{anchorOrigin:{vertical:s,horizontal:A},autoHideDuration:R,disableWindowBlurListener:Y,TransitionComponent:ee,transitionDuration:ne}),ut=kN(Be),{getRootProps:Ie,onClickAway:Je}=e5(ft({},Be)),[Rt,ht]=Te.useState(!0),Ht=YB({elementType:PS,getSlotProps:Ie,externalForwardedProps:He,ownerState:Be,additionalProps:{ref:l},className:[ut.root,V]}),Rn=rn=>{ht(!0),se&&se(rn)},Bt=(rn,vn)=>{ht(!1),ce&&ce(rn,vn)};return!Ce&&Rt?null:Q.jsx(QB,ft({onClickAway:Je},$,{children:Q.jsx(PS,ft({},Ht,{children:Q.jsx(ee,ft({appear:!0,in:Ce,timeout:ne,direction:s==="top"?"down":"up",onEnter:Bt,onExited:Rn},De,{children:U||Q.jsx(CN,ft({message:K,action:b},pe))}))}))}))}),zS=PN;function zN(e){const{className:n,classes:l,pulsate:h=!1,rippleX:m,rippleY:y,rippleSize:b,in:s,onExited:A,timeout:R}=e,[U,V]=Te.useState(!1),$=Kr(n,l.ripple,l.rippleVisible,h&&l.ripplePulsate),pe={width:b,height:b,top:-(b/2)+y,left:-(b/2)+m},Y=Kr(l.child,U&&l.childLeaving,h&&l.childPulsate);return!s&&!U&&V(!0),Te.useEffect(()=>{if(!s&&A!=null){const K=setTimeout(A,R);return()=>{clearTimeout(K)}}},[A,s,R]),Q.jsx("span",{className:$,style:pe,children:Q.jsx("span",{className:Y})})}const RN=Ia("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Fo=RN,DN=["center","classes","className"];let ky=e=>e,RS,DS,LS,OS;const p1=550,LN=80,ON=Sw(RS||(RS=ky`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),BN=Sw(DS||(DS=ky`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),FN=Sw(LS||(LS=ky`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),NN=pi("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),jN=pi(zN,{name:"MuiTouchRipple",slot:"Ripple"})(OS||(OS=ky`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),Fo.rippleVisible,ON,p1,({theme:e})=>e.transitions.easing.easeInOut,Fo.ripplePulsate,({theme:e})=>e.transitions.duration.shorter,Fo.child,Fo.childLeaving,BN,p1,({theme:e})=>e.transitions.easing.easeInOut,Fo.childPulsate,FN,({theme:e})=>e.transitions.easing.easeInOut),UN=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiTouchRipple"}),{center:m=!1,classes:y={},className:b}=h,s=Cr(h,DN),[A,R]=Te.useState([]),U=Te.useRef(0),V=Te.useRef(null);Te.useEffect(()=>{V.current&&(V.current(),V.current=null)},[A]);const $=Te.useRef(!1),pe=Te.useRef(0),Y=Te.useRef(null),K=Te.useRef(null);Te.useEffect(()=>()=>{pe.current&&clearTimeout(pe.current)},[]);const Ce=Te.useCallback(se=>{const{pulsate:De,rippleX:He,rippleY:Be,rippleSize:ut,cb:Ie}=se;R(Je=>[...Je,Q.jsx(jN,{classes:{ripple:Kr(y.ripple,Fo.ripple),rippleVisible:Kr(y.rippleVisible,Fo.rippleVisible),ripplePulsate:Kr(y.ripplePulsate,Fo.ripplePulsate),child:Kr(y.child,Fo.child),childLeaving:Kr(y.childLeaving,Fo.childLeaving),childPulsate:Kr(y.childPulsate,Fo.childPulsate)},timeout:p1,pulsate:De,rippleX:He,rippleY:Be,rippleSize:ut},U.current)]),U.current+=1,V.current=Ie},[y]),ee=Te.useCallback((se={},De={},He=()=>{})=>{const{pulsate:Be=!1,center:ut=m||De.pulsate,fakeElement:Ie=!1}=De;if((se==null?void 0:se.type)==="mousedown"&&$.current){$.current=!1;return}(se==null?void 0:se.type)==="touchstart"&&($.current=!0);const Je=Ie?null:K.current,Rt=Je?Je.getBoundingClientRect():{width:0,height:0,left:0,top:0};let ht,Ht,Rn;if(ut||se===void 0||se.clientX===0&&se.clientY===0||!se.clientX&&!se.touches)ht=Math.round(Rt.width/2),Ht=Math.round(Rt.height/2);else{const{clientX:Bt,clientY:rn}=se.touches&&se.touches.length>0?se.touches[0]:se;ht=Math.round(Bt-Rt.left),Ht=Math.round(rn-Rt.top)}if(ut)Rn=Math.sqrt((2*Rt.width**2+Rt.height**2)/3),Rn%2===0&&(Rn+=1);else{const Bt=Math.max(Math.abs((Je?Je.clientWidth:0)-ht),ht)*2+2,rn=Math.max(Math.abs((Je?Je.clientHeight:0)-Ht),Ht)*2+2;Rn=Math.sqrt(Bt**2+rn**2)}se!=null&&se.touches?Y.current===null&&(Y.current=()=>{Ce({pulsate:Be,rippleX:ht,rippleY:Ht,rippleSize:Rn,cb:He})},pe.current=setTimeout(()=>{Y.current&&(Y.current(),Y.current=null)},LN)):Ce({pulsate:Be,rippleX:ht,rippleY:Ht,rippleSize:Rn,cb:He})},[m,Ce]),ne=Te.useCallback(()=>{ee({},{pulsate:!0})},[ee]),ce=Te.useCallback((se,De)=>{if(clearTimeout(pe.current),(se==null?void 0:se.type)==="touchend"&&Y.current){Y.current(),Y.current=null,pe.current=setTimeout(()=>{ce(se,De)});return}Y.current=null,R(He=>He.length>0?He.slice(1):He),V.current=De},[]);return Te.useImperativeHandle(l,()=>({pulsate:ne,start:ee,stop:ce}),[ne,ee,ce]),Q.jsx(NN,ft({className:Kr(Fo.root,y.root,b),ref:K},s,{children:Q.jsx(lN,{component:null,exit:!0,children:A})}))}),VN=UN;function $N(e){return Ma("MuiButtonBase",e)}const GN=Ia("MuiButtonBase",["root","disabled","focusVisible"]),qN=GN,WN=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],ZN=e=>{const{disabled:n,focusVisible:l,focusVisibleClassName:h,classes:m}=e,b=Pl({root:["root",n&&"disabled",l&&"focusVisible"]},$N,m);return l&&h&&(b.root+=` ${h}`),b},HN=pi("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,n)=>n.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${qN.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),XN=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiButtonBase"}),{action:m,centerRipple:y=!1,children:b,className:s,component:A="button",disabled:R=!1,disableRipple:U=!1,disableTouchRipple:V=!1,focusRipple:$=!1,LinkComponent:pe="a",onBlur:Y,onClick:K,onContextMenu:Ce,onDragLeave:ee,onFocus:ne,onFocusVisible:ce,onKeyDown:se,onKeyUp:De,onMouseDown:He,onMouseLeave:Be,onMouseUp:ut,onTouchEnd:Ie,onTouchMove:Je,onTouchStart:Rt,tabIndex:ht=0,TouchRippleProps:Ht,touchRippleRef:Rn,type:Bt}=h,rn=Cr(h,WN),vn=Te.useRef(null),qe=Te.useRef(null),St=kh(qe,Rn),{isFocusVisibleRef:bt,onFocus:Kt,onBlur:xn,ref:En}=YM(),[Qt,cr]=Te.useState(!1);R&&Qt&&cr(!1),Te.useImperativeHandle(m,()=>({focusVisible:()=>{cr(!0),vn.current.focus()}}),[]);const[Qn,Rr]=Te.useState(!1);Te.useEffect(()=>{Rr(!0)},[]);const ai=Qn&&!U&&!R;Te.useEffect(()=>{Qt&&$&&!U&&Qn&&qe.current.pulsate()},[U,$,Qt,Qn]);function Ar(Vt,Ri,To=V){return gl(ro=>(Ri&&Ri(ro),!To&&qe.current&&qe.current[Vt](ro),!0))}const xo=Ar("start",He),Xt=Ar("stop",Ce),wo=Ar("stop",ee),Gr=Ar("stop",ut),Wo=Ar("stop",Vt=>{Qt&&Vt.preventDefault(),Be&&Be(Vt)}),gn=Ar("start",Rt),qr=Ar("stop",Ie),bo=Ar("stop",Je),Qr=Ar("stop",Vt=>{xn(Vt),bt.current===!1&&cr(!1),Y&&Y(Vt)},!1),Mr=gl(Vt=>{vn.current||(vn.current=Vt.currentTarget),Kt(Vt),bt.current===!0&&(cr(!0),ce&&ce(Vt)),ne&&ne(Vt)}),Dr=()=>{const Vt=vn.current;return A&&A!=="button"&&!(Vt.tagName==="A"&&Vt.href)},Ii=Te.useRef(!1),Eo=gl(Vt=>{$&&!Ii.current&&Qt&&qe.current&&Vt.key===" "&&(Ii.current=!0,qe.current.stop(Vt,()=>{qe.current.start(Vt)})),Vt.target===Vt.currentTarget&&Dr()&&Vt.key===" "&&Vt.preventDefault(),se&&se(Vt),Vt.target===Vt.currentTarget&&Dr()&&Vt.key==="Enter"&&!R&&(Vt.preventDefault(),K&&K(Vt))}),ki=gl(Vt=>{$&&Vt.key===" "&&qe.current&&Qt&&!Vt.defaultPrevented&&(Ii.current=!1,qe.current.stop(Vt,()=>{qe.current.pulsate(Vt)})),De&&De(Vt),K&&Vt.target===Vt.currentTarget&&Dr()&&Vt.key===" "&&!Vt.defaultPrevented&&K(Vt)});let Pi=A;Pi==="button"&&(rn.href||rn.to)&&(Pi=pe);const zi={};Pi==="button"?(zi.type=Bt===void 0?"button":Bt,zi.disabled=R):(!rn.href&&!rn.to&&(zi.role="button"),R&&(zi["aria-disabled"]=R));const no=kh(l,En,vn),Lr=ft({},h,{centerRipple:y,component:A,disabled:R,disableRipple:U,disableTouchRipple:V,focusRipple:$,tabIndex:ht,focusVisible:Qt}),fi=ZN(Lr);return Q.jsxs(HN,ft({as:Pi,className:Kr(fi.root,s),ownerState:Lr,onBlur:Qr,onClick:K,onContextMenu:Xt,onFocus:Mr,onKeyDown:Eo,onKeyUp:ki,onMouseDown:xo,onMouseLeave:Wo,onMouseUp:Gr,onDragLeave:wo,onTouchEnd:qr,onTouchMove:bo,onTouchStart:gn,ref:no,tabIndex:R?-1:ht,type:Bt},zi,rn,{children:[b,ai?Q.jsx(VN,ft({ref:St,center:y},Ht)):null]}))}),AI=XN;function KN(e){return Ma("MuiIconButton",e)}const YN=Ia("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),JN=YN,QN=["edge","children","className","color","disabled","disableFocusRipple","size"],ej=e=>{const{classes:n,disabled:l,color:h,edge:m,size:y}=e,b={root:["root",l&&"disabled",h!=="default"&&`color${zn(h)}`,m&&`edge${zn(m)}`,`size${zn(y)}`]};return Pl(b,KN,n)},tj=pi(AI,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.root,l.color!=="default"&&n[`color${zn(l.color)}`],l.edge&&n[`edge${zn(l.edge)}`],n[`size${zn(l.size)}`]]}})(({theme:e,ownerState:n})=>ft({textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(e.vars||e).palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest})},!n.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:_l(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.edge==="start"&&{marginLeft:n.size==="small"?-3:-12},n.edge==="end"&&{marginRight:n.size==="small"?-3:-12}),({theme:e,ownerState:n})=>{var l;const h=(l=(e.vars||e).palette)==null?void 0:l[n.color];return ft({},n.color==="inherit"&&{color:"inherit"},n.color!=="inherit"&&n.color!=="default"&&ft({color:h==null?void 0:h.main},!n.disableRipple&&{"&:hover":ft({},h&&{backgroundColor:e.vars?`rgba(${h.mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_l(h.main,e.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),n.size==="small"&&{padding:5,fontSize:e.typography.pxToRem(18)},n.size==="large"&&{padding:12,fontSize:e.typography.pxToRem(28)},{[`&.${JN.disabled}`]:{backgroundColor:"transparent",color:(e.vars||e).palette.action.disabled}})}),nj=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiIconButton"}),{edge:m=!1,children:y,className:b,color:s="default",disabled:A=!1,disableFocusRipple:R=!1,size:U="medium"}=h,V=Cr(h,QN),$=ft({},h,{edge:m,color:s,disabled:A,disableFocusRipple:R,size:U}),pe=ej($);return Q.jsx(tj,ft({className:Kr(pe.root,b),centerRipple:!0,focusRipple:!R,disabled:A,ref:l,ownerState:$},V,{children:y}))}),MI=nj;var Fw={},II={exports:{}};(function(e){function n(l){return l&&l.__esModule?l:{default:l}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(II);var kI=II.exports,Xv={};function rj(e){return Ma("MuiSvgIcon",e)}Ia("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const ij=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],oj=e=>{const{color:n,fontSize:l,classes:h}=e,m={root:["root",n!=="inherit"&&`color${zn(n)}`,`fontSize${zn(l)}`]};return Pl(m,rj,h)},sj=pi("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.root,l.color!=="inherit"&&n[`color${zn(l.color)}`],n[`fontSize${zn(l.fontSize)}`]]}})(({theme:e,ownerState:n})=>{var l,h,m,y,b,s,A,R,U,V,$,pe,Y;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:n.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:(l=e.transitions)==null||(h=l.create)==null?void 0:h.call(l,"fill",{duration:(m=e.transitions)==null||(m=m.duration)==null?void 0:m.shorter}),fontSize:{inherit:"inherit",small:((y=e.typography)==null||(b=y.pxToRem)==null?void 0:b.call(y,20))||"1.25rem",medium:((s=e.typography)==null||(A=s.pxToRem)==null?void 0:A.call(s,24))||"1.5rem",large:((R=e.typography)==null||(U=R.pxToRem)==null?void 0:U.call(R,35))||"2.1875rem"}[n.fontSize],color:(V=($=(e.vars||e).palette)==null||($=$[n.color])==null?void 0:$.main)!=null?V:{action:(pe=(e.vars||e).palette)==null||(pe=pe.action)==null?void 0:pe.active,disabled:(Y=(e.vars||e).palette)==null||(Y=Y.action)==null?void 0:Y.disabled,inherit:void 0}[n.color]}}),PI=Te.forwardRef(function(n,l){const h=ka({props:n,name:"MuiSvgIcon"}),{children:m,className:y,color:b="inherit",component:s="svg",fontSize:A="medium",htmlColor:R,inheritViewBox:U=!1,titleAccess:V,viewBox:$="0 0 24 24"}=h,pe=Cr(h,ij),Y=Te.isValidElement(m)&&m.type==="svg",K=ft({},h,{color:b,component:s,fontSize:A,instanceFontSize:n.fontSize,inheritViewBox:U,viewBox:$,hasSvgAsChild:Y}),Ce={};U||(Ce.viewBox=$);const ee=oj(K);return Q.jsxs(sj,ft({as:s,className:Kr(ee.root,y),focusable:"false",color:R,"aria-hidden":V?void 0:!0,role:V?"img":void 0,ref:l},Ce,pe,Y&&m.props,{ownerState:K,children:[Y?m.props.children:m,V?Q.jsx("title",{children:V}):null]}))});PI.muiName="SvgIcon";const BS=PI;function Uh(e,n){function l(h,m){return Q.jsx(BS,ft({"data-testid":`${n}Icon`,ref:m},h,{children:e}))}return l.muiName=BS.muiName,Te.memo(Te.forwardRef(l))}const aj={configure:e=>{JM.configure(e)}},lj=Object.freeze(Object.defineProperty({__proto__:null,capitalize:zn,createChainedFunction:IB,createSvgIcon:Uh,debounce:kB,deprecatedPropType:PB,isMuiElement:zB,ownerDocument:nf,ownerWindow:RB,requirePropFactory:DB,setRef:XM,unstable_ClassNameGenerator:aj,unstable_useEnhancedEffect:KM,unstable_useId:BB,unsupportedProp:FB,useControlled:NB,useEventCallback:gl,useForkRef:kh,useIsFocusVisible:YM},Symbol.toStringTag,{value:"Module"})),cj=dz(lj);var FS;function zI(){return FS||(FS=1,function(e){"use client";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return n.createSvgIcon}});var n=cj}(Xv)),Xv}var uj=kI;Object.defineProperty(Fw,"__esModule",{value:!0});var RI=Fw.default=void 0,hj=uj(zI()),dj=Q,pj=(0,hj.default)((0,dj.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");RI=Fw.default=pj;function fj(e){return Ma("MuiButton",e)}const mj=Ia("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),Lg=mj,gj=Te.createContext({}),_j=gj,yj=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],vj=e=>{const{color:n,disableElevation:l,fullWidth:h,size:m,variant:y,classes:b}=e,s={root:["root",y,`${y}${zn(n)}`,`size${zn(m)}`,`${y}Size${zn(m)}`,n==="inherit"&&"colorInherit",l&&"disableElevation",h&&"fullWidth"],label:["label"],startIcon:["startIcon",`iconSize${zn(m)}`],endIcon:["endIcon",`iconSize${zn(m)}`]},A=Pl(s,fj,b);return ft({},b,A)},DI=e=>ft({},e.size==="small"&&{"& > *:nth-of-type(1)":{fontSize:18}},e.size==="medium"&&{"& > *:nth-of-type(1)":{fontSize:20}},e.size==="large"&&{"& > *:nth-of-type(1)":{fontSize:22}}),xj=pi(AI,{shouldForwardProp:e=>bI(e)||e==="classes",name:"MuiButton",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.root,n[l.variant],n[`${l.variant}${zn(l.color)}`],n[`size${zn(l.size)}`],n[`${l.variant}Size${zn(l.size)}`],l.color==="inherit"&&n.colorInherit,l.disableElevation&&n.disableElevation,l.fullWidth&&n.fullWidth]}})(({theme:e,ownerState:n})=>{var l,h;const m=e.palette.mode==="light"?e.palette.grey[300]:e.palette.grey[800],y=e.palette.mode==="light"?e.palette.grey.A100:e.palette.grey[700];return ft({},e.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:hover":ft({textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:_l(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},n.variant==="text"&&n.color!=="inherit"&&{backgroundColor:e.vars?`rgba(${e.vars.palette[n.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_l(e.palette[n.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},n.variant==="outlined"&&n.color!=="inherit"&&{border:`1px solid ${(e.vars||e).palette[n.color].main}`,backgroundColor:e.vars?`rgba(${e.vars.palette[n.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_l(e.palette[n.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},n.variant==="contained"&&{backgroundColor:e.vars?e.vars.palette.Button.inheritContainedHoverBg:y,boxShadow:(e.vars||e).shadows[4],"@media (hover: none)":{boxShadow:(e.vars||e).shadows[2],backgroundColor:(e.vars||e).palette.grey[300]}},n.variant==="contained"&&n.color!=="inherit"&&{backgroundColor:(e.vars||e).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(e.vars||e).palette[n.color].main}}),"&:active":ft({},n.variant==="contained"&&{boxShadow:(e.vars||e).shadows[8]}),[`&.${Lg.focusVisible}`]:ft({},n.variant==="contained"&&{boxShadow:(e.vars||e).shadows[6]}),[`&.${Lg.disabled}`]:ft({color:(e.vars||e).palette.action.disabled},n.variant==="outlined"&&{border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},n.variant==="contained"&&{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground})},n.variant==="text"&&{padding:"6px 8px"},n.variant==="text"&&n.color!=="inherit"&&{color:(e.vars||e).palette[n.color].main},n.variant==="outlined"&&{padding:"5px 15px",border:"1px solid currentColor"},n.variant==="outlined"&&n.color!=="inherit"&&{color:(e.vars||e).palette[n.color].main,border:e.vars?`1px solid rgba(${e.vars.palette[n.color].mainChannel} / 0.5)`:`1px solid ${_l(e.palette[n.color].main,.5)}`},n.variant==="contained"&&{color:e.vars?e.vars.palette.text.primary:(l=(h=e.palette).getContrastText)==null?void 0:l.call(h,e.palette.grey[300]),backgroundColor:e.vars?e.vars.palette.Button.inheritContainedBg:m,boxShadow:(e.vars||e).shadows[2]},n.variant==="contained"&&n.color!=="inherit"&&{color:(e.vars||e).palette[n.color].contrastText,backgroundColor:(e.vars||e).palette[n.color].main},n.color==="inherit"&&{color:"inherit",borderColor:"currentColor"},n.size==="small"&&n.variant==="text"&&{padding:"4px 5px",fontSize:e.typography.pxToRem(13)},n.size==="large"&&n.variant==="text"&&{padding:"8px 11px",fontSize:e.typography.pxToRem(15)},n.size==="small"&&n.variant==="outlined"&&{padding:"3px 9px",fontSize:e.typography.pxToRem(13)},n.size==="large"&&n.variant==="outlined"&&{padding:"7px 21px",fontSize:e.typography.pxToRem(15)},n.size==="small"&&n.variant==="contained"&&{padding:"4px 10px",fontSize:e.typography.pxToRem(13)},n.size==="large"&&n.variant==="contained"&&{padding:"8px 22px",fontSize:e.typography.pxToRem(15)},n.fullWidth&&{width:"100%"})},({ownerState:e})=>e.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${Lg.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${Lg.disabled}`]:{boxShadow:"none"}}),wj=pi("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.startIcon,n[`iconSize${zn(l.size)}`]]}})(({ownerState:e})=>ft({display:"inherit",marginRight:8,marginLeft:-4},e.size==="small"&&{marginLeft:-2},DI(e))),bj=pi("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.endIcon,n[`iconSize${zn(l.size)}`]]}})(({ownerState:e})=>ft({display:"inherit",marginRight:-4,marginLeft:8},e.size==="small"&&{marginRight:-2},DI(e))),Ej=Te.forwardRef(function(n,l){const h=Te.useContext(_j),m=yw(h,n),y=ka({props:m,name:"MuiButton"}),{children:b,color:s="primary",component:A="button",className:R,disabled:U=!1,disableElevation:V=!1,disableFocusRipple:$=!1,endIcon:pe,focusVisibleClassName:Y,fullWidth:K=!1,size:Ce="medium",startIcon:ee,type:ne,variant:ce="text"}=y,se=Cr(y,yj),De=ft({},y,{color:s,component:A,disabled:U,disableElevation:V,disableFocusRipple:$,fullWidth:K,size:Ce,type:ne,variant:ce}),He=vj(De),Be=ee&&Q.jsx(wj,{className:He.startIcon,ownerState:De,children:ee}),ut=pe&&Q.jsx(bj,{className:He.endIcon,ownerState:De,children:pe});return Q.jsxs(xj,ft({ownerState:De,className:Kr(h.className,He.root,R),component:A,disabled:U,focusRipple:!$,focusVisibleClassName:Kr(He.focusVisible,Y),ref:l,type:ne},se,{classes:He,children:[Be,b,ut]}))}),Tj=Ej;function Sj(e){return Ma("MuiAlert",e)}const Cj=Ia("MuiAlert",["root","action","icon","message","filled","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),NS=Cj,Aj=Uh(Q.jsx("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),Mj=Uh(Q.jsx("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),Ij=Uh(Q.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),kj=Uh(Q.jsx("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),Pj=Uh(Q.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),zj=["action","children","className","closeText","color","components","componentsProps","icon","iconMapping","onClose","role","severity","slotProps","slots","variant"],Rj=e=>{const{variant:n,color:l,severity:h,classes:m}=e,y={root:["root",`${n}${zn(l||h)}`,`${n}`],icon:["icon"],message:["message"],action:["action"]};return Pl(y,Sj,m)},Dj=pi(CI,{name:"MuiAlert",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:l}=e;return[n.root,n[l.variant],n[`${l.variant}${zn(l.color||l.severity)}`]]}})(({theme:e,ownerState:n})=>{const l=e.palette.mode==="light"?L_:O_,h=e.palette.mode==="light"?O_:L_,m=n.color||n.severity;return ft({},e.typography.body2,{backgroundColor:"transparent",display:"flex",padding:"6px 16px"},m&&n.variant==="standard"&&{color:e.vars?e.vars.palette.Alert[`${m}Color`]:l(e.palette[m].light,.6),backgroundColor:e.vars?e.vars.palette.Alert[`${m}StandardBg`]:h(e.palette[m].light,.9),[`& .${NS.icon}`]:e.vars?{color:e.vars.palette.Alert[`${m}IconColor`]}:{color:e.palette[m].main}},m&&n.variant==="outlined"&&{color:e.vars?e.vars.palette.Alert[`${m}Color`]:l(e.palette[m].light,.6),border:`1px solid ${(e.vars||e).palette[m].light}`,[`& .${NS.icon}`]:e.vars?{color:e.vars.palette.Alert[`${m}IconColor`]}:{color:e.palette[m].main}},m&&n.variant==="filled"&&ft({fontWeight:e.typography.fontWeightMedium},e.vars?{color:e.vars.palette.Alert[`${m}FilledColor`],backgroundColor:e.vars.palette.Alert[`${m}FilledBg`]}:{backgroundColor:e.palette.mode==="dark"?e.palette[m].dark:e.palette[m].main,color:e.palette.getContrastText(e.palette[m].main)}))}),Lj=pi("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(e,n)=>n.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),Oj=pi("div",{name:"MuiAlert",slot:"Message",overridesResolver:(e,n)=>n.message})({padding:"8px 0",minWidth:0,overflow:"auto"}),jS=pi("div",{name:"MuiAlert",slot:"Action",overridesResolver:(e,n)=>n.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),US={success:Q.jsx(Aj,{fontSize:"inherit"}),warning:Q.jsx(Mj,{fontSize:"inherit"}),error:Q.jsx(Ij,{fontSize:"inherit"}),info:Q.jsx(kj,{fontSize:"inherit"})},Bj=Te.forwardRef(function(n,l){var h,m,y,b,s,A;const R=ka({props:n,name:"MuiAlert"}),{action:U,children:V,className:$,closeText:pe="Close",color:Y,components:K={},componentsProps:Ce={},icon:ee,iconMapping:ne=US,onClose:ce,role:se="alert",severity:De="success",slotProps:He={},slots:Be={},variant:ut="standard"}=R,Ie=Cr(R,zj),Je=ft({},R,{color:Y,severity:De,variant:ut}),Rt=Rj(Je),ht=(h=(m=Be.closeButton)!=null?m:K.CloseButton)!=null?h:MI,Ht=(y=(b=Be.closeIcon)!=null?b:K.CloseIcon)!=null?y:Pj,Rn=(s=He.closeButton)!=null?s:Ce.closeButton,Bt=(A=He.closeIcon)!=null?A:Ce.closeIcon;return Q.jsxs(Dj,ft({role:se,elevation:0,ownerState:Je,className:Kr(Rt.root,$),ref:l},Ie,{children:[ee!==!1?Q.jsx(Lj,{ownerState:Je,className:Rt.icon,children:ee||ne[De]||US[De]}):null,Q.jsx(Oj,{ownerState:Je,className:Rt.message,children:V}),U!=null?Q.jsx(jS,{ownerState:Je,className:Rt.action,children:U}):null,U==null&&ce?Q.jsx(jS,{ownerState:Je,className:Rt.action,children:Q.jsx(ht,ft({size:"small","aria-label":pe,title:pe,color:"inherit",onClick:ce},Rn,{children:Q.jsx(Ht,ft({fontSize:"small"},Bt))}))}):null]}))}),Fj=Bj,Kv={name:"",email:""},Yv={currentPassword:"",newPassword:"",confirmNewPassword:""};var Nw={},Nj=kI;Object.defineProperty(Nw,"__esModule",{value:!0});var LI=Nw.default=void 0,jj=Nj(zI()),Uj=Q,Vj=(0,jj.default)((0,Uj.jsx)("path",{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"}),"Upload");LI=Nw.default=Vj;const $j=()=>{const{auth:e,dispatchAuth:n}=Aa(),l=e.user,[h,m]=Te.useState(Kv),[y,b]=Te.useState(Yv),[s,A]=Te.useState(!1),R=function(Ie){Ie.preventDefault(),Ie.stopPropagation(),Ie.type==="dragenter"||Ie.type==="dragover"?A(!0):Ie.type==="dragleave"&&A(!1)},U=function(Ie){Ie.preventDefault(),Ie.stopPropagation(),A(!1),Ie.dataTransfer.files&&Ie.dataTransfer.files[0]&&console.log(Ie.dataTransfer.files[0])},V=Te.useRef(null),$=Ie=>{Ie.preventDefault(),Ie.target.files&&Ie.target.files[0]&&console.log(Ie.target.files[0])},pe=()=>{V.current&&V.current.click()},[Y,K]=Te.useState(!1),[Ce,ee]=Te.useState(!1),ne=Ie=>{const{name:Je,value:Rt}=Ie.target;m(ht=>({...ht,[Je]:Rt}))},ce=Ie=>{const{name:Je,value:Rt}=Ie.target;b(ht=>({...ht,[Je]:Rt}))},se=zr.forwardRef(function(Je,Rt){return Q.jsx(Fj,{elevation:6,ref:Rt,variant:"filled",...Je})}),De=(Ie,Je)=>{Je!=="clickaway"&&K(!1)},He=Q.jsxs(zr.Fragment,{children:[Q.jsx(Tj,{color:"secondary",size:"large",onClick:De,children:"UNDO"}),Q.jsx(MI,{size:"large","aria-label":"close",color:"inherit",onClick:De,children:Q.jsx(RI,{fontSize:"large"})})]}),Be=async Ie=>{Ie.preventDefault();try{const Je=await SO(h.name,h.email);n({type:"updateUserInfo",payload:{name:h.name,email:h.email}}),Je.status==="success"&&(K(!0),ee(!1)),m(Kv)}catch(Je){console.log(Je),K(!0),ee(!0),m(Kv)}},ut=async Ie=>{Ie.preventDefault();try{const Je=await CO(y.currentPassword,y.newPassword,y.confirmNewPassword);console.log(Je),n({type:"updateUserPassword",payload:Je.accessToken}),Je.status==="success"&&(K(!0),ee(!1)),b(Yv)}catch(Je){console.log(Je),K(!0),ee(!0),b(Yv)}};return Q.jsx("main",{className:"main",children:Q.jsxs("div",{className:"user-view",children:[Q.jsxs("nav",{className:"user-view__menu",children:[Q.jsxs("ul",{className:"side-nav",children:[Q.jsx(cl,{link:"#",text:"Settings",icon:"settings",active:!0}),Q.jsx(cl,{link:"#",text:"My bookings",icon:"briefcase"}),Q.jsx(cl,{link:"#",text:"My reviews",icon:"star"}),Q.jsx(cl,{link:"#",text:"Billing",icon:"credit-card"})]}),(l==null?void 0:l.role)==="admin"&&Q.jsxs("div",{className:"admin-nav",children:[Q.jsx("h5",{className:"admin-nav__heading",children:"Admin"}),Q.jsxs("ul",{className:"side-nav",children:[Q.jsx(cl,{link:"#",text:"Manage tours",icon:"map"}),Q.jsx(cl,{link:"#",text:"Manage users",icon:"users"}),Q.jsx(cl,{link:"#",text:"Manage reviews",icon:"star"}),Q.jsx(cl,{link:"#",text:"Manage bookings",icon:"briefcase"})]})]})]}),Q.jsxs("div",{className:"user-view__content",children:[Q.jsxs("div",{className:"user-view__form-container",children:[Q.jsx("h2",{className:"heading-secondary ma-bt-md",children:"Your account settings"}),Q.jsxs("form",{className:"form form-user-data",onDragEnter:R,onSubmit:Be,children:[Q.jsxs("div",{className:"form__group",children:[Q.jsx("label",{className:"form__label",htmlFor:"name",children:"Name"}),Q.jsx("input",{id:"name",className:"form__input",type:"text",placeholder:l==null?void 0:l.name,name:"name",value:h.name,onChange:ne,required:!0})]}),Q.jsxs("div",{className:"form__group ma-bt-md",children:[Q.jsx("label",{className:"form__label",htmlFor:"email",children:"Email address"}),Q.jsx("input",{id:"email",className:"form__input",placeholder:l==null?void 0:l.email,type:"email",name:"email",value:h.email,onChange:ne,required:!0})]}),Q.jsxs("div",{style:{display:"flex",gap:"10px",width:"100%"},className:"form__group form__photo-upload",children:[Q.jsx("img",{className:"form__user-photo",src:`/img/users/${l==null?void 0:l.photo}`,alt:"User photo"}),Q.jsx("input",{type:"file",id:"input-file-upload",accept:"image/jpeg, image/jpg, image/png",onChange:$,ref:V}),Q.jsx("label",{id:"label-file-upload",htmlFor:"input-file-upload",className:s?"drag-active":"",style:{flexGrow:1},children:Q.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",position:"relative",flexGrow:1,height:"150px"},children:[Q.jsx(LI,{style:{position:"absolute",zIndex:0,fontSize:"50px"}}),Q.jsxs("p",{style:{zIndex:1,marginTop:"90px",textAlign:"center"},children:["Drag and drop your file here or",Q.jsx("br",{}),Q.jsx("button",{className:"form__upload",onClick:pe,type:"button"}),Q.jsx("label",{htmlFor:"form__upload",children:"Choose a photo"})]})]})}),s&&Q.jsx("div",{id:"drag-file-element",onDragEnter:R,onDragLeave:R,onDragOver:R,onDrop:U})]}),Q.jsx("div",{className:"form__group right",children:Q.jsx("button",{className:"btn btn--small btn--green",type:"submit",children:"Save settings"})}),Q.jsx(zS,{anchorOrigin:{vertical:"top",horizontal:"right"},open:Y,autoHideDuration:5e3,onClose:De,action:He,children:Q.jsx(se,{style:{fontSize:"20px"},onClose:De,severity:Ce?"error":"success",sx:{width:"100%"},children:Ce?"Data update failed":"Data updated successfully"})})]})]}),Q.jsx("div",{className:"line",children:" "}),Q.jsxs("div",{className:"user-view__form-container",children:[Q.jsx("h2",{className:"heading-secondary ma-bt-md",children:"Password change"}),Q.jsxs("form",{className:"form form-user-settings",onSubmit:ut,children:[Q.jsxs("div",{className:"form__group",children:[Q.jsx("label",{className:"form__label",htmlFor:"password-current",children:"Current password"}),Q.jsx("input",{id:"password-current",className:"form__input",type:"password",name:"currentPassword",value:y.currentPassword,onChange:ce,placeholder:"••••••••",required:!0,minLength:8})]}),Q.jsxs("div",{className:"form__group",children:[Q.jsx("label",{className:"form__label",htmlFor:"password",children:"New password"}),Q.jsx("input",{id:"password",className:"form__input",type:"password",name:"newPassword",value:y.newPassword,onChange:ce,placeholder:"••••••••",required:!0,minLength:8})]}),Q.jsxs("div",{className:"form__group ma-bt-lg",children:[Q.jsx("label",{className:"form__label",htmlFor:"password-confirm",children:"Confirm password"}),Q.jsx("input",{id:"password-confirm",className:"form__input",type:"password",name:"confirmNewPassword",value:y.confirmNewPassword,onChange:ce,placeholder:"••••••••",required:!0,minLength:8})]}),Q.jsx("div",{className:"form__group right",children:Q.jsx("button",{className:"btn btn--small btn--green",type:"submit",children:"Save password"})}),Q.jsx(zS,{anchorOrigin:{vertical:"top",horizontal:"right"},open:Y,autoHideDuration:5e3,onClose:De,action:He,children:Q.jsx(se,{style:{fontSize:"20px"},onClose:De,severity:Ce?"error":"success",sx:{width:"100%"},children:Ce?"Data update failed":"Data updated successfully"})})]})]})]})]})})},Gj=()=>Q.jsxs(Q.Fragment,{children:[Q.jsx(IO,{}),Q.jsx(hw,{})]}),qj=YL(Xx(Q.jsx(ca,{path:"/",element:Q.jsx(Gj,{}),errorElement:Q.jsx($p,{}),children:Q.jsxs(ca,{element:Q.jsx(SB,{}),children:[Q.jsx(ca,{index:!0,element:Q.jsx(sB,{}),loader:bO,errorElement:Q.jsx($p,{})}),Q.jsx(ca,{path:"/login",element:Q.jsx(EB,{})}),Q.jsxs(ca,{element:Q.jsx(TB,{allowedRoles:["admin","user","lead-guide"]}),errorElement:Q.jsx($p,{}),children:[Q.jsx(ca,{path:"tours/:tourSlug",element:Q.jsx(wB,{})}),Q.jsx(ca,{path:"/account",element:Q.jsx($j,{})})]}),Q.jsx(ca,{path:"/error",element:Q.jsx($p,{})})]})}))),Wj=()=>Q.jsx(o3,{children:Q.jsx(VL,{router:qj})});Jv.createRoot(document.getElementById("root")).render(Q.jsx(zr.StrictMode,{children:Q.jsx(Wj,{})}));
